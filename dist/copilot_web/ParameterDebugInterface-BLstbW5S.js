import{j as e}from"./vendor-markdown-Dek94WS0.js";import{r as b}from"./vendor-react-V04_Axys.js";import{r as Le,g as De,a as Ee,m as Ie,i as Te}from"./workflowChat-BOa-B2jp.js";import{a as Z,u as $e}from"./message-components-DJrb_1JS.js";import"./input.js";import"./App-DNL9caHT.js";function Ve(m,f){try{if(!m)return console.error("Invalid prompt_output: ",m),m;for(const h of f){if(!m[h.nodeId]){console.error(`Node with ID ${h.nodeId} not found`);continue}if(!m[h.nodeId].inputs){console.error(`Inputs not found for node with ID ${h.nodeId}`);continue}m[h.nodeId].inputs[h.paramName]=h.paramValue}return m}catch(h){return console.error("Error updating prompt:",h),m}}async function Oe(m){const f=await Z.graphToPrompt(),h=Ve(f.output,m);console.log("queuePrompt updated_prompt:",h);const N={prompt:h,client_id:Z.api.clientId,extra_data:{extra_pageinfo:{workflow:f.workflow}}};console.debug("queuePrompt request_body.prompt:",h);const y=await Le(N);return console.debug("queuePrompt response:",y),y}function xe(m){const f=document.createElement("canvas"),h=f.getContext("2d"),N=512,y=512;return f.width=N,f.height=y,h&&(h.fillStyle="red",h.font="20px Arial",h.fillText(m,10,30)),new Blob([f.toDataURL("image/png")],{type:"image/png"})}async function Be(m){try{if(!m||m==="")return console.log("No prompt ID provided"),{1:[xe("Fail to generate prompt ID")]};const f=await De(m);if(!f||!f[m])return console.log("Not finished for prompt ID:",m),{};const h=f[m];if(h.status&&h.status.status_str==="error"){console.error("Error for prompt ID:",m);const y=h.status.messages;if(y&&y.length>0){const C=y[y.length-1];if(C&&C.length>0){const T=C[0];return{1:[xe(T)]}}}}const N={};if(h.outputs)for(const y in h.outputs){const C=h.outputs[y];if(C.images){const T=[];for(const D of C.images){const L=await Ee(D.filename,D.subfolder,D.type);T.push(L)}N[y]=T}}return N}catch(f){throw console.error("Error getting output images from prompt:",f),f}}async function _e(m){const f=await Be(m);if(Object.keys(f).length===0)return[];const h=Object.keys(f).map(y=>parseInt(y)),N=Math.max(...h).toString();return f[N]||[]}const We=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,He=({selectedNodes:m,visible:f,onClose:h})=>{const[N,y]=b.useState(0),[C,T]=b.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[D,L]=b.useState(!1),[F,U]=b.useState(!1),[ee,re]=b.useState(0),[_,me]=b.useState(12),[$,ue]=b.useState(null),[V,ae]=b.useState(()=>Array(12).fill(null).map((t,r)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:r%3===0?5:r%3===1?10:15,sampler_name:"euler",cfg:1}}))),[p,G]=b.useState({}),[E,ne]=b.useState({}),[I,pe]=b.useState({});b.useState({});const[he,H]=b.useState({}),[P,te]=b.useState(1),q=6,[Y,O]=b.useState(null),[ge,oe]=b.useState(!1),[fe,le]=b.useState(!1),[be,je]=b.useState(""),{dispatch:W}=$e();b.useEffect(()=>{if(!m||m.length===0)return;const t={...p},r=m.map(o=>o.id.toString());Object.keys(t).forEach(o=>{r.includes(o)||delete t[o]}),m.forEach(o=>{const s=o.id.toString();t[s]||(t[s]={})}),JSON.stringify(t)!==JSON.stringify(p)&&G(t)},[m,p]),b.useEffect(()=>{W({type:"SET_SCREEN_STATE",payload:{currentScreen:N,isProcessing:D,isCompleted:F}})},[N,D,F,W]),b.useEffect(()=>{const t=document.createElement("style");return t.textContent=We,document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),b.useEffect(()=>{const t=r=>{if(Object.values(E).some(n=>n)){const n=r.target,o=!!n.closest(".dropdown-menu"),s=!!n.closest("[data-dropdown]");!o&&!s&&ne({})}};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[E]);const ye=Math.ceil(_/q),J=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation()),te(Math.max(1,Math.min(t,ye)))},ie=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),N===1){const r=se();me(r.length)}O(null),y(r=>Math.min(r+1,2))},K=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),O(null),F&&U(!1),N===1){const r=m.map(s=>s.id.toString()),n=Object.keys(p),o={...p};n.forEach(s=>{r.includes(s)||delete o[s]}),G(o)}y(r=>Math.max(r-1,0))},ve=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation()),T(n=>({...n,[t]:!n[t]}))},Q=(t,r,n,o=0)=>{t=isNaN(t)?0:t,r=isNaN(r)?100:r,n=isNaN(n)||n<=0?1:n,r<t&&(r=t);const s=Math.floor((r-t)/n)+1;if(s<=1)return[t];const d=[];let l=t;if(s<=10)for(;l<=r&&d.length<=10;){const a=Math.pow(10,o),x=Math.round(l*a)/a;d.push(x),l+=n}else{const x=(r-t)/9;for(let c=0;c<=9;c++){const u=t+x*c,i=Math.pow(10,o),v=Math.round(u*i)/i;d.push(v)}}return d},se=()=>{const t=[],r={};if(Object.keys(p).forEach(s=>{const d=parseInt(s),l=p[s]||{},a=Object.keys(l).filter(c=>l[c]&&l[c].length>0);if(a.length===0)return;const x=[[]];a.forEach(c=>{const u=l[c],i=[];x.forEach(v=>{u.forEach(k=>{const M=[...v,{nodeId:d,paramName:c,paramValue:String(k)}];i.push(M)})}),x.length=0,x.push(...i)}),r[s]=x}),Object.keys(r).length===0)return t;if(Object.keys(r).length===1){const s=Object.keys(r)[0];return r[s]}const n=Object.keys(r);let o=r[n[0]];for(let s=1;s<n.length;s++){const d=r[n[s]],l=[];o.forEach(a=>{d.forEach(x=>{l.push([...a,...x])})}),o=l}return o},we=(t,r,n)=>{n.preventDefault(),n.stopPropagation();const o=`${t}_${r}`;ne(s=>{if(s[o]&&typeof s[o]=="object"?s[o].isOpen:!!s[o])return{...s,[o]:!1};{let l=0,a=0;if(n.currentTarget){const u=n.currentTarget.getBoundingClientRect();l=u.left,a=u.bottom}else l=n.clientX,a=n.clientY+20;const x=window.innerWidth,c=250;return l+c>x&&(l=x-c-10),l<0&&(l=10),{...s,[o]:{isOpen:!0,x:l,y:a}}}})},S=(t,r,n)=>{G(o=>{const s={...o};return s[t]||(s[t]={}),s[t][r]=n,s})},X=(t,r,n,o)=>{o&&(o.preventDefault(),o.stopPropagation()),G(s=>{const d={...s};d[t]||(d[t]={}),d[t][r]||(d[t][r]=[]);const l=d[t][r];return l.includes(n)?d[t][r]=l.filter(a=>a!==n):d[t][r]=[...l,n],d})},Ne=(t,r,n)=>{const o=`${t}_${r}`;pe(s=>({...s,[o]:n}))},ke=(t,r,n)=>{if(!p[t]){S(t,r,n);return}const o=p[t][r]||[];n.length===o.length?S(t,r,[]):S(t,r,[...n])},Ce=(t,r)=>{const n={};n.nodeParams={};const o=se();return r<o.length&&o[r].forEach(d=>{const l=d.nodeId.toString(),a=d.paramName,x=d.paramValue;n.nodeParams[l]||(n.nodeParams[l]={}),n.nodeParams[l][a]=x,n[a]=x}),n},ce=async t=>{t&&(t.preventDefault(),t.stopPropagation());const r=se(),n=r.length;if(n>20){O(`Cannot generate more than 20 images at once (currently: ${n} images)`);return}if(O(null),L(!0),re(0),console.log("Generated parameter combinations:",r),r.length===0){O("No valid parameter combinations found. Please check your parameter selections."),L(!1);return}const o=[];try{for(const x of r){const c=await Oe(x);c.prompt_id?o.push(c.prompt_id):(console.error("Failed to get prompt_id from response:",c),o.push(""))}const s=Array(r.length).fill(null).map((x,c)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:Ce(p,c)}));ae(s);const d=Date.now(),l=5*60*1e3,a=async()=>{if(Date.now()-d>l){console.log("Timeout reached while waiting for images"),L(!1),U(!0),te(1);return}let x=0;for(let c=0;c<o.length;c++){const u=o[c];if(u)try{const i=await _e(u);if(i&&i.length>0){const v=URL.createObjectURL(i[0]);s[c]={...s[c],url:v},x++}}catch(i){console.error(`Error fetching image for prompt ID ${u}:`,i)}}ae([...s]),re(x),x===o.length||Date.now()-d>l?(L(!1),U(!0),te(1)):setTimeout(a,3e3)};a()}catch(s){console.error("Error generating images:",s),L(!1)}},Pe=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation()),ue(t)},Me=(t,r)=>{r.preventDefault(),r.stopPropagation(),je(t),le(!0)},de=t=>{t&&(t.preventDefault(),t.stopPropagation()),le(!1)},Se=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),$!==null){console.log(`Applied image ${$+1} with parameters:`,V[$].params);const r=V[$].params;r.nodeParams&&(Object.entries(r.nodeParams).forEach(([n,o])=>{const s=Z.graph._nodes_by_id[n];!s||!s.widgets||Object.entries(o).forEach(([d,l])=>{for(const a of s.widgets)if(a.name===d){a.value=l;break}})}),Z.graph.setDirtyCanvas(!1,!0),oe(!0),setTimeout(()=>{oe(!1)},3e3))}},B=(t,r)=>{if(t&&(t.preventDefault(),t.stopPropagation()),N===1&&r!==void 0){const n=[...m];n.splice(r,1),n.length===0?h&&(W({type:"SET_SCREEN_STATE",payload:null}),h()):W({type:"SET_SELECTED_NODE",payload:n});return}h?(W({type:"SET_SCREEN_STATE",payload:null}),h()):(y(0),U(!1),L(!1),O(null))};if(!f||m.length===0)return e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"max-w-lg p-8 bg-white rounded-lg shadow-sm border border-blue-100 relative",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-base font-bold text-blue-800 mb-2",children:"GenLab"}),e.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full text-blue-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Batch Test Parameter Pairs"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Select a node to batch test parameter pairs"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-indigo-100 p-2 rounded-full text-indigo-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"How To Use"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Click on any node in your workflow to start the parameter testing process"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No node is currently selected"})})]})]})});if(F){const t=(P-1)*q,r=Math.min(t+q,V.length),n=V.slice(t,r),o=Math.ceil(V.length/q);return e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["All ",V.length," images have been generated."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:B,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),ge&&e.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"py-1",children:e.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:de,children:e.jsxs("div",{className:"bg-white rounded-lg p-2 max-w-4xl max-h-[90vh] relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-700 hover:text-gray-900 rounded-full hover:bg-gray-200 p-1",onClick:de,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"overflow-auto max-h-[calc(90vh-4rem)]",children:e.jsx("img",{src:be,alt:"Enlarged image",className:"max-w-full h-auto"})})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:n.map((s,d)=>{const l=t+d;return e.jsxs("div",{className:`relative rounded-lg overflow-hidden border ${$===l?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:a=>Pe(l,a),children:[e.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:a=>Me(s.url,a),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:s.url,alt:`Generated image ${l+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white",children:Object.entries(s.params).filter(([a,x])=>a!=="nodeParams"&&typeof x!="object").map(([a,x])=>e.jsxs("div",{children:[a,": ",String(x)]},a))})]},l)})}),o>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-4 mb-4",children:[e.jsx("button",{onClick:s=>J(1,s),disabled:P===1,className:`px-2 py-1 rounded ${P===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M8.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L4.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})]})}),e.jsx("button",{onClick:s=>J(P-1,s),disabled:P===1,className:`px-2 py-1 rounded ${P===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"px-2 py-1 text-xs text-gray-800",children:["Page ",P," of ",o]}),e.jsx("button",{onClick:s=>J(P+1,s),disabled:P===o,className:`px-2 py-1 rounded ${P===o?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:s=>J(o,s),disabled:P===o,className:`px-2 py-1 rounded ${P===o?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10 4.293 14.293a1 1 0 000 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M11.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L15.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:s=>K(s),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:s=>Se(s),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:$===null,children:"Apply Selected"})]})]})})}return D?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),e.jsxs("div",{className:"text-xs mb-3",children:["Completed ",ee," of ",_," runs"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${ee/_*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",ee," images"]}),e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),Ie({clear:!0}),Te(),L(!1),y(2)},className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",_," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:B,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),Y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:Y})]})}),m.length>0?m.map((t,r)=>{const n=t.type||"Unknown Node",o=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[n," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:o.map((d,l)=>{const a=d.name;if(!C[a])return null;const x=p[s]?.[a]||[],c=Array.isArray(x)?`[${x.join(", ")}]`:JSON.stringify(x);return e.jsxs("div",{className:l<o.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:a}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:c,onClick:u=>u.preventDefault()})})]},l)})})]},r)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>K(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ce(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})}):N===0?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select Parameters for Testing"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose the parameters you want to include in your batch test"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:B,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.map((t,r)=>{const n=t.title||"Unknown Node",o=t.widgets||[];return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:n}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:o.map((s,d)=>{const l=s.name;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${C[l]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:a=>ve(l,a),children:C[l]&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),e.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:l})]},`widget-${d}`)})})})]},`node-${r}`)}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:t=>ie(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})})]})}):N===1?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Parameter Options"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:B,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.length>0?m.map((t,r)=>{const n=t.widgets||{},o=Object.values(n),s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[e.jsxs("span",{children:[t.type," (ID: ",s,")"]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d=>B(d,r),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 space-y-4",children:o.map((d,l)=>{const a=d.name;if(!C[a])return null;const x=`${s}_${a}`;if(d.type==="number"){const c=d.options?.min||0,u=d.options?.max||100,i=(d.options?.step||10)/10,v=d.options?.precision||0,k=Q(c,u,i,v),M=he[x]||{min:c.toString(),max:u.toString(),step:i.toString()};return(!p[s]||!p[s][a])&&(S(s,a,k),H(g=>({...g,[x]:M}))),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[a,":"]}),e.jsx("div",{className:"w-4"})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:M.min,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(H(w=>({...w,[x]:{...w[x],min:j}})),j===""||!isNaN(parseFloat(j))){const w=j===""?0:parseFloat(j),R=parseFloat(M.max||u.toString()),z=parseFloat(M.step||i.toString()),A=Q(w,R,z,v);S(s,a,A)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:M.max,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(H(w=>({...w,[x]:{...w[x],max:j}})),j===""||!isNaN(parseFloat(j))){const w=parseFloat(M.min||c.toString()),R=j===""?w:parseFloat(j),z=parseFloat(M.step||i.toString()),A=Q(w,R,z,v);S(s,a,A)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:M.step,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(H(w=>({...w,[x]:{...w[x],step:j}})),j===""||!isNaN(parseFloat(j))&&parseFloat(j)>0){const w=parseFloat(M.min||c.toString()),R=parseFloat(M.max||u.toString()),z=j===""?1:parseFloat(j),A=Q(w,R,z,v);S(s,a,A)}}})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(p[s]?.[a]||k).map((g,j)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:w=>{w.stopPropagation(),X(s,a,g,w)},children:[e.jsx("span",{children:g}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},j))})]}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max (max 10 values)"})})]},l)}else if(d.type==="combo"){const c=d.options?.values||[],u=`${s}_${a}`;return(!p[s]||!p[s][a])&&S(s,a,c.slice(0,3)),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:a}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("button",{className:"appearance-none border border-gray-300 rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700",onClick:i=>{i.preventDefault(),i.stopPropagation(),we(s,a,i)},"data-dropdown":u,children:[e.jsx("span",{children:(p[s]?.[a]||[]).length>0?`${a}: ${(p[s]?.[a]||[]).length} selected`:`Select ${a}`}),e.jsx("div",{className:"ml-2",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),E[u]&&e.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof E[u]=="object"?`${E[u].y}px`:"0px",left:typeof E[u]=="object"?`${E[u].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:e.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:I[u]||"",onChange:i=>{i.preventDefault(),i.stopPropagation(),Ne(s,a,i.target.value)},onClick:i=>{i.preventDefault(),i.stopPropagation()},autoFocus:!0})}),e.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:i=>{i.preventDefault(),i.stopPropagation();const v=c.filter(k=>!I[u]||k.toLowerCase().includes((I[u]||"").toLowerCase()));ke(s,a,v)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${c.length>0&&(p[s]?.[a]||[]).length===c.length?"bg-blue-500 border-blue-500":(p[s]?.[a]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(p[s]?.[a]||[]).length>0&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-medium",children:c.length>0&&(p[s]?.[a]||[]).length===c.length?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[c.filter(i=>!I[u]||i.toLowerCase().includes((I[u]||"").toLowerCase())).map((i,v)=>e.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:k=>{k.preventDefault(),k.stopPropagation(),X(s,a,i,k)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(p[s]?.[a]||[]).includes(i)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(p[s]?.[a]||[]).includes(i)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:i})]},v)),c.filter(i=>!I[u]||i.toLowerCase().includes((I[u]||"").toLowerCase())).length===0&&e.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(p[s]?.[a]||[]).map((i,v)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:i}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:k=>{k.preventDefault(),k.stopPropagation(),X(s,a,i,k)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},v)),e.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:i=>{i.preventDefault(),i.stopPropagation();const v=`${a}${(p[s]?.[a]||[]).length+1}`;S(s,a,[...p[s]?.[a]||[],v])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},l)}else return(!p[s]||!p[s][a])&&S(s,a,[`${a}1`,`${a}2`,`${a}3`]),e.jsxs("div",{className:"border-b pb-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("label",{className:"text-xs font-medium text-gray-700",children:a})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(p[s]?.[a]||[]).map((c,u)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:c}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:i=>{i.preventDefault(),i.stopPropagation(),X(s,a,c,i)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},u)),e.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:c=>{c.preventDefault(),c.stopPropagation();const u=`${a}${(p[s]?.[a]||[]).length+1}`;S(s,a,[...p[s]?.[a]||[],u])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},l)})})]},r)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>K(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ie(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",_," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:B,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),Y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:Y})]})}),m.length>0?m.map((t,r)=>{const n=t.type||"Unknown Node",o=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[n," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:o.map((d,l)=>{const a=d.name;if(!C[a])return null;const x=p[s]?.[a]||[],c=Array.isArray(x)?`[${x.join(", ")}]`:JSON.stringify(x);return e.jsxs("div",{className:l<o.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700 text-xs",children:a}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:c,onClick:u=>u.preventDefault()})})]},l)})})]},r)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>K(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ce(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})})};export{He as ParameterDebugInterface};
