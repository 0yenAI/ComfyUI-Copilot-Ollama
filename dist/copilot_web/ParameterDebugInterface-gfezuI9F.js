import{j as e}from"./vendor-markdown-Dek94WS0.js";import{r as j}from"./vendor-react-V04_Axys.js";import{r as ye,g as ve,a as we}from"./workflowChat-DCfX96nk.js";import{a as Y}from"./message-components-CQULTycO.js";import"./input.js";import"./App-Cx4IKkDQ.js";function Ne(p,y){try{if(!p)return console.error("Invalid prompt_output: ",p),p;for(const g of y){if(!p[g.nodeId]){console.error(`Node with ID ${g.nodeId} not found`);continue}if(!p[g.nodeId].inputs){console.error(`Inputs not found for node with ID ${g.nodeId}`);continue}for(const v of g.params)p[g.nodeId].inputs[v.paramName]=v.paramValue}return p}catch(g){return console.error("Error updating prompt:",g),p}}async function ke(p){const y=await Y.graphToPrompt(),g=Ne(y.output,p);console.log("queuePrompt updated_prompt:",g);const v={prompt:g,client_id:Y.api.clientId,extra_data:{extra_pageinfo:{workflow:y.workflow}}};console.debug("queuePrompt request_body.prompt:",g);const w=await ye(v);return console.debug("queuePrompt response:",w),w}async function Ce(p){try{if(!p||p==="")return console.log("No prompt ID provided"),{};const y=await ve(p);if(!y||!y[p])return console.log("Not finished for prompt ID:",p),{};const g=y[p],v={};if(g.outputs)for(const w in g.outputs){const z=g.outputs[w];if(z.images){const R=[];for(const M of z.images){const W=await we(M.filename,M.subfolder,M.type);R.push(W)}v[w]=R}}return v}catch(y){throw console.error("Error getting output images from prompt:",y),y}}async function Pe(p){const y=await Ce(p);if(Object.keys(y).length===0)return[];const g=Object.keys(y).map(w=>parseInt(w)),v=Math.max(...g).toString();return y[v]||[]}const Le=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,Te=({selectedNodes:p,visible:y})=>{const[g,v]=j.useState(0),[w,z]=j.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[R,M]=j.useState(!1),[W,K]=j.useState(!1),[J,Z]=j.useState(0),[S,oe]=j.useState(12),[I,le]=j.useState(null),[V,ee]=j.useState(()=>Array(12).fill(null).map((t,a)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:a%3===0?5:a%3===1?10:15,sampler_name:"euler",cfg:1}}))),[x,te]=j.useState({}),[D,se]=j.useState({}),[$,ie]=j.useState({});j.useState({});const[ce,F]=j.useState({}),[N,X]=j.useState(1),_=6,[A,T]=j.useState(null),[de,re]=j.useState(!1);j.useEffect(()=>{const t=document.createElement("style");return t.textContent=Le,document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),j.useEffect(()=>{const t=a=>{if(Object.values(D).some(o=>o)){const o=a.target,n=!!o.closest(".dropdown-menu"),s=!!o.closest("[data-dropdown]");!n&&!s&&se({})}};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[D]);const me=Math.ceil(S/_),G=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),X(Math.max(1,Math.min(t,me)))},ae=t=>{t&&(t.preventDefault(),t.stopPropagation()),g===1&&oe(pe()),T(null),v(a=>Math.min(a+1,2))},H=t=>{t&&(t.preventDefault(),t.stopPropagation()),T(null),W&&K(!1),v(a=>Math.max(a-1,0))},ue=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),z(o=>({...o,[t]:!o[t]}))},q=(t,a,o,n=0)=>{t=isNaN(t)?0:t,a=isNaN(a)?100:a,o=isNaN(o)||o<=0?1:o,a<t&&(a=t);const s=Math.floor((a-t)/o)+1;if(s<=1)return[t];const l=[];let i=t;if(s<=10)for(;i<=a&&l.length<=10;){const r=Math.pow(10,n),c=Math.round(i*r)/r;l.push(c),i+=o}else{const c=(a-t)/9;for(let d=0;d<=9;d++){const m=t+c*d,u=Math.pow(10,n),k=Math.round(m*u)/u;l.push(k)}}return l},pe=t=>Q().length,Q=()=>{const t=[],a=()=>{const n={};Object.keys(x).forEach(s=>{n[s]=[],Object.entries(x[s]||{}).forEach(([l,i])=>{if(!i||i.length===0)return;const r=[];i.forEach(c=>{const d={};d[l]=c,r.push(d)}),n[s].push(r)})}),Object.entries(n).forEach(([s,l])=>{if(l.length===0)return;o(l).forEach(r=>{const c=[];Object.entries(r).forEach(([d,m])=>{c.push({paramName:d,paramValue:String(m)})}),t.push({nodeId:parseInt(s),params:c})})})},o=n=>{if(n.length===0)return[{}];let s=n[0].map(l=>({...l}));for(let l=1;l<n.length;l++){const i=[];for(const r of s)for(const c of n[l])i.push({...r,...c});s=i}return s};return a(),t},xe=(t,a,o)=>{o.preventDefault(),o.stopPropagation();const n=`${t}_${a}`;se(s=>{if(s[n]&&typeof s[n]=="object"?s[n].isOpen:!!s[n])return{...s,[n]:!1};{let i=0,r=0;if(o.currentTarget){const m=o.currentTarget.getBoundingClientRect();i=m.left,r=m.bottom}else i=o.clientX,r=o.clientY+20;const c=window.innerWidth,d=250;return i+d>c&&(i=c-d-10),i<0&&(i=10),{...s,[n]:{isOpen:!0,x:i,y:r}}}})},P=(t,a,o)=>{te(n=>{const s={...n};return s[t]||(s[t]={}),s[t][a]=o,s})},U=(t,a,o,n)=>{n&&(n.preventDefault(),n.stopPropagation()),te(s=>{const l={...s};l[t]||(l[t]={}),l[t][a]||(l[t][a]=[]);const i=l[t][a];return i.includes(o)?l[t][a]=i.filter(r=>r!==o):l[t][a]=[...i,o],l})},he=(t,a,o)=>{const n=`${t}_${a}`;ie(s=>({...s,[n]:o}))},ge=(t,a,o)=>{if(!x[t]){P(t,a,o);return}const n=x[t][a]||[];o.length===n.length?P(t,a,[]):P(t,a,[...o])},fe=(t,a)=>{const o={};o.nodeParams={};const n=Q();if(a<n.length){const s=n[a];o.nodeParams[s.nodeId]={},s.params.forEach(l=>{o.nodeParams[s.nodeId][l.paramName]=l.paramValue,o[l.paramName]=l.paramValue})}return o},ne=async t=>{if(t&&(t.preventDefault(),t.stopPropagation()),S>20){T(`Cannot generate more than 20 images at once (currently: ${S} images)`);return}T(null),M(!0),Z(0);const a=Q();if(console.log("Generated parameter combinations:",a),a.length===0){T("No valid parameter combinations found. Please check your parameter selections."),M(!1);return}const o=[];try{for(const r of a){const c=await ke([r]);c.prompt_id?o.push(c.prompt_id):(console.error("Failed to get prompt_id from response:",c),o.push(""))}const n=Array(a.length).fill(null).map((r,c)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:fe(x,c)}));ee(n);const s=Date.now(),l=5*60*1e3,i=async()=>{if(Date.now()-s>l){console.log("Timeout reached while waiting for images"),M(!1),K(!0),X(1);return}let r=0;for(let c=0;c<o.length;c++){const d=o[c];if(d)try{const m=await Pe(d);if(m&&m.length>0){const u=URL.createObjectURL(m[0]);n[c]={...n[c],url:u},r++}}catch(m){console.error(`Error fetching image for prompt ID ${d}:`,m)}}ee([...n]),Z(r),r===o.length||Date.now()-s>l?(M(!1),K(!0),X(1)):setTimeout(i,3e3)};i()}catch(n){console.error("Error generating images:",n),M(!1)}},be=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),le(t)},je=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),I!==null){console.log(`Applied image ${I+1} with parameters:`,V[I].params);const a=V[I].params;a.nodeParams&&(Object.entries(a.nodeParams).forEach(([o,n])=>{const s=Y.graph._nodes_by_id[o];!s||!s.widgets||Object.entries(n).forEach(([l,i])=>{for(const r of s.widgets)if(r.name===l){r.value=i;break}})}),Y.graph.setDirtyCanvas(!1,!0),re(!0),setTimeout(()=>{re(!1)},3e3))}};if(!y||p.length===0)return e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"max-w-lg p-8 bg-white rounded-lg shadow-sm border border-blue-100 relative",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-800 mb-2",children:"GenLab"}),e.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full text-blue-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Batch Test Parameter Pairs"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Select a node to batch test parameter pairs"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-indigo-100 p-2 rounded-full text-indigo-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"How To Use"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Click on any node in your workflow to start the parameter testing process"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"No node is currently selected"})})]})]})});if(W){const t=(N-1)*_,a=Math.min(t+_,V.length),o=V.slice(t,a),n=Math.ceil(V.length/_);return e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Generation Complete"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["All ",V.length," images have been generated."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),de&&e.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 shadow-md rounded animate-fade-in-out z-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"py-1",children:e.jsx("svg",{className:"h-6 w-6 text-green-500 mr-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{children:"Parameters has been applied."})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:o.map((s,l)=>{const i=t+l;return e.jsxs("div",{className:`relative rounded-lg overflow-hidden border ${I===i?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:r=>be(i,r),children:[e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:s.url,alt:`Generated image ${i+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white",children:Object.entries(s.params).filter(([r,c])=>r!=="nodeParams"&&typeof c!="object").map(([r,c])=>e.jsxs("div",{children:[r,": ",String(c)]},r))})]},i)})}),n>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-4 mb-4",children:[e.jsx("button",{onClick:s=>G(1,s),disabled:N===1,className:`px-2 py-1 rounded ${N===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M8.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L4.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})]})}),e.jsx("button",{onClick:s=>G(N-1,s),disabled:N===1,className:`px-2 py-1 rounded ${N===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"px-2 py-1 text-sm text-gray-800",children:["Page ",N," of ",n]}),e.jsx("button",{onClick:s=>G(N+1,s),disabled:N===n,className:`px-2 py-1 rounded ${N===n?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:s=>G(n,s),disabled:N===n,className:`px-2 py-1 rounded ${N===n?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10 4.293 14.293a1 1 0 000 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M11.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L15.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:s=>H(s),className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:s=>je(s),className:"px-4 py-2 bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:I===null,children:"Apply Selected"})]})]})})}return R?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"mb-2 font-medium",children:"Processing..."}),e.jsxs("div",{className:"text-sm mb-3",children:["Completed ",J," of ",S," runs"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${J/S*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",J," images"]})]})}),e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["In the selected parameter combinations, there are ",S," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),A&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:A})]})}),p.length>0?p.map((t,a)=>{const o=t.type||"Unknown Node",n=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-medium text-gray-700 border-b",children:[o," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:n.map((l,i)=>{const r=l.name;if(!w[r])return null;const c=x[s]?.[r]||[],d=Array.isArray(c)?`[${c.join(", ")}]`:JSON.stringify(c);return e.jsxs("div",{className:i<n.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:r}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:d,onClick:m=>m.preventDefault()})})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>H(t),className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ne(t),className:"px-4 py-2 bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})}):g===0?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Select Parameters for Testing"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose the parameters you want to include in your batch test"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p.map((t,a)=>{const o=t.title||"Unknown Node",n=t.widgets||[];return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-2 font-medium text-gray-700 border-b",children:o}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:n.map((s,l)=>{const i=s.name;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${w[i]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:r=>ue(i,r),children:w[i]&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),e.jsx("span",{className:"ml-2 text-gray-700",children:i})]},`widget-${l}`)})})})]},`node-${a}`)}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:t=>ae(t),className:"px-8 py-2 bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})})]})}):g===1?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Parameter Options"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure the test values for each parameter"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:t=>v(0),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p.length>0?p.map((t,a)=>{const o=t.widgets||{},n=Object.values(o),s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-medium text-gray-700 border-b",children:[t.type," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-4",children:n.map((l,i)=>{const r=l.name;if(!w[r])return null;const c=`${s}_${r}`;if(l.type==="number"){const d=l.options?.min||0,m=l.options?.max||100,u=(l.options?.step||10)/10,k=l.options?.precision||0,C=q(d,m,u,k),L=ce[c]||{min:d.toString(),max:m.toString(),step:u.toString()};return(!x[s]||!x[s][r])&&(P(s,r,C),F(h=>({...h,[c]:L}))),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"font-medium text-gray-700",children:[r,":"]}),e.jsx("div",{className:"w-4"})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Min"}),e.jsx("input",{type:"text",className:"w-12 h-7 border border-gray-300 rounded text-sm px-2",value:L.min,onClick:h=>{h.preventDefault(),h.stopPropagation()},onChange:h=>{h.preventDefault(),h.stopPropagation();const f=h.target.value;if(F(b=>({...b,[c]:{...b[c],min:f}})),f===""||!isNaN(parseFloat(f))){const b=f===""?0:parseFloat(f),O=parseFloat(L.max||m.toString()),B=parseFloat(L.step||u.toString()),E=q(b,O,B,k);P(s,r,E)}}}),e.jsx("label",{className:"text-sm text-gray-600",children:"Max"}),e.jsx("input",{type:"text",className:"w-12 h-7 border border-gray-300 rounded text-sm px-2",value:L.max,onClick:h=>{h.preventDefault(),h.stopPropagation()},onChange:h=>{h.preventDefault(),h.stopPropagation();const f=h.target.value;if(F(b=>({...b,[c]:{...b[c],max:f}})),f===""||!isNaN(parseFloat(f))){const b=parseFloat(L.min||d.toString()),O=f===""?b:parseFloat(f),B=parseFloat(L.step||u.toString()),E=q(b,O,B,k);P(s,r,E)}}}),e.jsx("label",{className:"text-sm text-gray-600",children:"Step"}),e.jsx("input",{type:"text",className:"w-12 h-7 border border-gray-300 rounded text-sm px-2",value:L.step,onClick:h=>{h.preventDefault(),h.stopPropagation()},onChange:h=>{h.preventDefault(),h.stopPropagation();const f=h.target.value;if(F(b=>({...b,[c]:{...b[c],step:f}})),f===""||!isNaN(parseFloat(f))&&parseFloat(f)>0){const b=parseFloat(L.min||d.toString()),O=parseFloat(L.max||m.toString()),B=f===""?1:parseFloat(f),E=q(b,O,B,k);P(s,r,E)}}})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:(x[s]?.[r]||C).map((h,f)=>e.jsxs("div",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md flex items-center text-sm cursor-pointer hover:bg-blue-200",onClick:b=>{b.stopPropagation(),U(s,r,h,b)},children:[e.jsx("span",{children:h}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},f))})]}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max (max 10 values)"})})]},i)}else if(l.type==="combo"){const d=l.options?.values||[],m=`${s}_${r}`;return(!x[s]||!x[s][r])&&P(s,r,d.slice(0,3)),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:r}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("button",{className:"appearance-none border border-gray-300 rounded px-3 py-1 pr-8 text-sm flex items-center bg-white text-gray-700",onClick:u=>{u.preventDefault(),u.stopPropagation(),xe(s,r,u)},"data-dropdown":m,children:[e.jsx("span",{children:(x[s]?.[r]||[]).length>0?`${r}: ${(x[s]?.[r]||[]).length} selected`:`Select ${r}`}),e.jsx("div",{className:"ml-2",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),D[m]&&e.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof D[m]=="object"?`${D[m].y}px`:"0px",left:typeof D[m]=="object"?`${D[m].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:e.jsx("input",{type:"text",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded",placeholder:"Search...",value:$[m]||"",onChange:u=>{u.preventDefault(),u.stopPropagation(),he(s,r,u.target.value)},onClick:u=>{u.preventDefault(),u.stopPropagation()},autoFocus:!0})}),e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b cursor-pointer text-sm flex items-center text-gray-700 hover:bg-gray-100",onClick:u=>{u.preventDefault(),u.stopPropagation();const k=d.filter(C=>!$[m]||C.toLowerCase().includes(($[m]||"").toLowerCase()));ge(s,r,k)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${d.length>0&&(x[s]?.[r]||[]).length===d.length?"bg-blue-500 border-blue-500":(x[s]?.[r]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(x[s]?.[r]||[]).length>0&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-medium",children:d.length>0&&(x[s]?.[r]||[]).length===d.length?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[d.filter(u=>!$[m]||u.toLowerCase().includes(($[m]||"").toLowerCase())).map((u,k)=>e.jsxs("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm flex items-center text-gray-700",onClick:C=>{C.preventDefault(),C.stopPropagation(),U(s,r,u,C)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(x[s]?.[r]||[]).includes(u)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(x[s]?.[r]||[]).includes(u)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:u})]},k)),d.filter(u=>!$[m]||u.toLowerCase().includes(($[m]||"").toLowerCase())).length===0&&e.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2 min-h-[30px]",children:(x[s]?.[r]||[]).length>0?(x[s]?.[r]||[]).map((u,k)=>e.jsxs("div",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md flex items-center text-sm",children:[e.jsx("span",{children:u}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:C=>{C.preventDefault(),C.stopPropagation(),U(s,r,u,C)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},k)):e.jsx("div",{className:"text-sm text-gray-500",children:"No values selected"})})]})]},i)}else return(!x[s]||!x[s][r])&&P(s,r,[`${r}1`,`${r}2`,`${r}3`]),e.jsxs("div",{className:"border-b pb-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("label",{className:"font-medium text-gray-700",children:r})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2",children:[(x[s]?.[r]||[]).map((d,m)=>e.jsxs("div",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md flex items-center text-sm",children:[e.jsx("span",{children:d}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:u=>{u.preventDefault(),u.stopPropagation(),U(s,r,d,u)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},m)),e.jsxs("button",{className:"px-2 py-1 border border-dashed border-blue-300 text-blue-600 rounded-md text-sm flex items-center hover:bg-blue-50",onClick:d=>{d.preventDefault(),d.stopPropagation();const m=`${r}${(x[s]?.[r]||[]).length+1}`;P(s,r,[...x[s]?.[r]||[],m])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>H(t),className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ae(t),className:"px-4 py-2 bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["In the selected parameter combinations, there are ",S," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:t=>v(0),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),A&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:A})]})}),p.length>0?p.map((t,a)=>{const o=t.type||"Unknown Node",n=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-medium text-gray-700 border-b",children:[o," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:n.map((l,i)=>{const r=l.name;if(!w[r])return null;const c=x[s]?.[r]||[],d=Array.isArray(c)?`[${c.join(", ")}]`:JSON.stringify(c);return e.jsxs("div",{className:i<n.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:r}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:d,onClick:m=>m.preventDefault()})})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>H(t),className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ne(t),className:"px-4 py-2 bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})})};export{Te as ParameterDebugInterface};
