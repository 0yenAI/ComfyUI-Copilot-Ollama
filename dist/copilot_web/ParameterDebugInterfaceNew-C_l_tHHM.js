import{j as e}from"./vendor-markdown-Dek94WS0.js";import{r as b}from"./vendor-react-V04_Axys.js";import{r as Qe,g as Xe,m as Ze,i as et}from"./workflowChat-h1SSPITS.js";import{a as Z,u as Ie,W as Me,g as tt}from"./message-components-B3k4U96-.js";import"./input.js";import"./App-LEwZ99A-.js";function st(o,n){try{if(!o)return console.error("Invalid prompt_output: ",o),o;for(const s of n){if(!o[s.nodeId]){console.error(`Node with ID ${s.nodeId} not found`);continue}if(!o[s.nodeId].inputs){console.error(`Inputs not found for node with ID ${s.nodeId}`);continue}o[s.nodeId].inputs[s.paramName]=s.paramValue}return o}catch(s){return console.error("Error updating prompt:",s),o}}async function rt(o){const n=await Z.graphToPrompt(),s=st(n.output,o);console.log("queuePrompt updated_prompt:",s);const m={prompt:s,client_id:Z.api.clientId,extra_data:{extra_pageinfo:{workflow:n.workflow}}};console.debug("queuePrompt request_body.prompt:",s);const h=await Qe(m);return console.debug("queuePrompt response:",h),h}function Pe(o){const n=document.createElement("canvas"),s=n.getContext("2d");if(n.width=512,n.height=512,s){s.fillStyle="#f8d7da",s.fillRect(0,0,n.width,n.height),s.strokeStyle="#dc3545",s.lineWidth=4,s.strokeRect(10,10,n.width-20,n.height-20),s.fillStyle="#dc3545",s.beginPath(),s.arc(n.width/2,150,50,0,2*Math.PI),s.fill(),s.fillStyle="white",s.font="bold 80px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText("!",n.width/2,150),s.fillStyle="#721c24",s.font="20px Arial",s.textAlign="center",s.textBaseline="middle";const m=n.width-60,h=30,x=o.split(" ");let c="",g=250;for(let f=0;f<x.length;f++){const P=c+x[f]+" ";s.measureText(P).width>m&&f>0?(s.fillText(c,n.width/2,g),c=x[f]+" ",g+=h):c=P}s.fillText(c,n.width/2,g)}return n.toDataURL("image/png")}async function nt(o){try{if(!o||o==="")return console.log("No prompt ID provided"),{1:[Pe("Fail to generate prompt ID")]};const n=await Xe(o);if(!n||!n[o])return console.log("Not finished for prompt ID:",o),{};const s=n[o];if(s.status&&s.status.status_str==="error"){console.error("Error for prompt ID:",o);const h=s.status.messages;if(h&&h.length>0){const x=h[h.length-1];if(x&&x.length>0){const c=x[0];return{1:[Pe(c)]}}}}const m={};if(s.outputs)for(const h in s.outputs){const x=s.outputs[h];if(x&&x.images){m[h]=[];for(const c of x.images)if(c&&c.filename&&c.type){const g=Z.graph._nodes_by_id[h].imgs[0].currentSrc.split("?")[0];m[h].push(g+"?filename="+encodeURIComponent(c.filename)+"&type="+encodeURIComponent(c.type)+(c.subfolder?"&subfolder="+encodeURIComponent(c.subfolder):""))}console.log("outputImages for nodeId:",h,m[h])}}return m}catch(n){throw console.error("Error getting output images from prompt:",n),n}}function ot(){const o=Object.values(Z.graph._nodes_by_id),n=[],s=[];for(const m of o)m.type==="SaveImage"?n.push(m.id):m.type==="PreviewImage"&&s.push(m.id);if(console.log("saveNodeIds:",n),console.log("previewNodeIds:",s),n.length===0&&s.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return n.length===1?n[0]:n.length==0&&s.length===1?s[0]:null}async function at(o,n){const s=await nt(o);return Object.keys(s).length===0?null:s[n.toString()]&&s[n.toString()].length>0?s[n.toString()][0]:null}const lt=({selectedNodes:o,handleParamSelect:n,selectedParams:s,handleNext:m,handleClose:h})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select Parameters for Testing"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose the parameters you want to include in your batch test"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:h,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.map((x,c)=>{const g=x.title||"Unknown Node",f=x.widgets||[];return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:g}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:f.map((P,S)=>{const k=P.name;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${s[k]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:$=>n(k,$),children:s[k]&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),e.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:k})]},`widget-${S}`)})})})]},`node-${c}`)}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:x=>m(x),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})})]}),it=({selectedNodes:o,paramTestValues:n,selectedParams:s,updateParamTestValues:m,toggleDropdown:h,openDropdowns:x,handleTestValueSelect:c,searchTerms:g,handleSearch:f,handleSelectAll:P,handleNext:S,handlePrevious:k,handleClose:$,inputValues:K,setInputValues:O,textInputs:B,handleTextInputChange:W,handleAddTextInput:T,handleRemoveTextInput:j,openAiWritingModal:w})=>{const C=(y,I,F,J=0)=>{if(y=isNaN(y)?0:y,I=isNaN(I)?100:I,F=isNaN(F)||F<=0?1:F,I<y&&(I=y),Math.floor((I-y)/F)+1<=1)return[y];const E=[];let q=y;for(;q<=I;){const d=Math.pow(10,J),G=Math.round(q*d)/d;E.push(G),q+=F}return E};return b.useEffect(()=>{!o||o.length===0||o.forEach(y=>{const I=y.id.toString(),F=y.widgets||{};Object.values(F).forEach(u=>{const E=u.name;if(!s[E])return;const q=n[I]?.[E]?.length>0;if(!q&&u.type==="number"){const d=u.options?.min||0,G=u.options?.max||100,D=(u.options?.step||10)/10,v=u.options?.precision||0,p=C(d,G,D,v);if(p.length>0){m(I,E,p);const z=`${I}_${E}`;O(H=>({...H,[z]:{min:d.toString(),max:G.toString(),step:D.toString()}}))}}if(!q&&(u.type==="customtext"||u.type.toLowerCase().includes("text"))){const d=`${I}_${E}`;(!B[d]||B[d].length===0)&&m(I,E,[""])}})})},[o,s,n,B,m,O,C]),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Parameter Options"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:$,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.length>0?o.map((y,I)=>{const F=y.widgets||{},J=Object.values(F),u=y.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[e.jsxs("span",{children:[y.type," (ID: ",u,")"]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:E=>$(E,I),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 space-y-4",children:J.map((E,q)=>{const d=E.name;if(!s[d])return null;const G=`${u}_${d}`;if(E.type==="customtext"||E.type.toLowerCase().includes("text")){const D=B[G]||[""];return e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[d,":"]}),e.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>w(u,d),children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),e.jsx("div",{className:"space-y-2",children:D.map((v,p)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("textarea",{className:"flex-1 border border-gray-300 rounded p-2 text-xs resize-y",rows:2,placeholder:"Enter text...",value:v,onChange:z=>W(u,d,p,z.target.value)}),e.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>j(u,d,p),title:"Remove",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},p))}),e.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>T(u,d),children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},q)}if(E.type==="number"){const D=E.options?.min||0,v=E.options?.max||100,p=(E.options?.step||10)/10,z=E.options?.precision||0,H=C(D,v,p,z),Y=K[G]||{min:D.toString(),max:v.toString(),step:p.toString()};return e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[d,":"]}),e.jsx("div",{className:"w-4"})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:Y.min,onClick:L=>{L.preventDefault(),L.stopPropagation()},onChange:L=>{L.preventDefault(),L.stopPropagation();const _=L.target.value;if(O(A=>({...A,[G]:{...A[G],min:_}})),_===""||!isNaN(parseFloat(_))){const A=_===""?0:parseFloat(_),R=parseFloat(Y.max||v.toString()),Q=parseFloat(Y.step||p.toString()),V=C(A,R,Q,z);m(u,d,V)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:Y.max,onClick:L=>{L.preventDefault(),L.stopPropagation()},onChange:L=>{L.preventDefault(),L.stopPropagation();const _=L.target.value;if(O(A=>({...A,[G]:{...A[G],max:_}})),_===""||!isNaN(parseFloat(_))){const A=parseFloat(Y.min||D.toString()),R=_===""?A:parseFloat(_),Q=parseFloat(Y.step||p.toString()),V=C(A,R,Q,z);m(u,d,V)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:Y.step,onClick:L=>{L.preventDefault(),L.stopPropagation()},onChange:L=>{L.preventDefault(),L.stopPropagation();const _=L.target.value;if(O(A=>({...A,[G]:{...A[G],step:_}})),_===""||!isNaN(parseFloat(_))&&parseFloat(_)>0){const A=parseFloat(Y.min||D.toString()),R=parseFloat(Y.max||v.toString()),Q=_===""?1:parseFloat(_),V=C(A,R,Q,z);m(u,d,V)}}})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const L=n[u]?.[d]||H;if(L.length<=10)return L.map((_,A)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:R=>{R.stopPropagation(),c(u,d,_,R)},children:[e.jsx("span",{children:_}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},A));{const _=L.slice(0,5),A=L.slice(L.length-5);return e.jsxs(e.Fragment,{children:[_.map((R,Q)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:V=>{V.stopPropagation(),c(u,d,R,V)},children:[e.jsx("span",{children:R}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${Q}`)),e.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),A.map((R,Q)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:V=>{V.stopPropagation(),c(u,d,R,V)},children:[e.jsx("span",{children:R}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${Q}`))]})}})()})]}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},q)}else if(E.type==="combo"){const D=E.options?.values||[],v=`${u}_${d}`;return e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:d}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("button",{className:"appearance-none border border-gray-300 rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700",onClick:p=>{p.preventDefault(),p.stopPropagation(),h(u,d,p)},"data-dropdown":v,children:[e.jsx("span",{children:(n[u]?.[d]||[]).length>0?`${d}: ${(n[u]?.[d]||[]).length} selected`:`Select ${d}`}),e.jsx("div",{className:"ml-2",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),x[v]&&e.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof x[v]=="object"?`${x[v].y}px`:"0px",left:typeof x[v]=="object"?`${x[v].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:e.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:g[v]||"",onChange:p=>{p.preventDefault(),p.stopPropagation(),f(u,d,p.target.value)},onClick:p=>{p.preventDefault(),p.stopPropagation()},autoFocus:!0})}),e.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:p=>{p.preventDefault(),p.stopPropagation();const z=D.filter(H=>!g[v]||H.toLowerCase().includes((g[v]||"").toLowerCase()));P(u,d,z)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${D.length>0&&(n[u]?.[d]||[]).length===D.length?"bg-blue-500 border-blue-500":(n[u]?.[d]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(n[u]?.[d]||[]).length>0&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-medium",children:D.length>0&&(n[u]?.[d]||[]).length===D.length?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[D.filter(p=>!g[v]||p.toLowerCase().includes((g[v]||"").toLowerCase())).map((p,z)=>e.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:H=>{H.preventDefault(),H.stopPropagation(),c(u,d,p,H)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(n[u]?.[d]||[]).includes(p)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(n[u]?.[d]||[]).includes(p)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:p})]},z)),D.filter(p=>!g[v]||p.toLowerCase().includes((g[v]||"").toLowerCase())).length===0&&e.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(n[u]?.[d]||[]).map((p,z)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:p}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:H=>{H.preventDefault(),H.stopPropagation(),c(u,d,p,H)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},z))})]})]},q)}else return e.jsxs("div",{className:"border-b pb-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("label",{className:"text-xs font-medium text-gray-700",children:d})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(n[u]?.[d]||[]).map((D,v)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:D}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:p=>{p.preventDefault(),p.stopPropagation(),c(u,d,D,p)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},v)),e.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:D=>{D.preventDefault(),D.stopPropagation();const v=`${d}${(n[u]?.[d]||[]).length+1}`;m(u,d,[...n[u]?.[d]||[],v])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},q)})})]},I)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:y=>k(y),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:y=>S(y),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},ct=({selectedNodes:o,paramTestValues:n,selectedParams:s,totalCount:m,errorMessage:h,handlePrevious:x,handleStartGeneration:c,handleClose:g})=>{const[f,P]=b.useState([]),[S,k]=b.useState(null),[$,K]=b.useState(!1);Ie();const O=()=>{const W=Object.values(Z.graph._nodes_by_id),T=[],j=[];for(const C of W)C.type==="SaveImage"?T.push(C.id):C.type==="PreviewImage"&&j.push(C.id);const w=[...T,...j];P(w),w.length===1?k(w[0]):w.length>1&&(K(!0),k(null))};b.useEffect(()=>{O()},[]),b.useEffect(()=>{const W=()=>{if(!Z.canvas.selected_nodes)return;const T=Object.values(Z.canvas.selected_nodes);if(T.length===0)return;const j=T[0];j&&(j.type==="SaveImage"||j.type==="PreviewImage")&&(console.log("Selected image node:",j.id),k(j.id))};return document.addEventListener("click",W),()=>{document.removeEventListener("click",W)}},[]);const B=W=>{if(W&&(W.preventDefault(),W.stopPropagation()),f.length>1&&!S){K(!0);return}c(W,S||void 0)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",m," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:g,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),$&&f.length>1&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:S===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${f.join(",")}. Please click the node on canvas.`:`Current node ID is ${S}, please click Start Generation again`})]})}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:h})]})}),o.length>0?o.map((W,T)=>{const j=W.type||"Unknown Node",w=W.widgets||[],C=W.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[j," (ID: ",C,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:w.map((y,I)=>{const F=y.name;if(!s[F])return null;const J=n[C]?.[F]||[],u=Array.isArray(J)?`[${J.join(", ")}]`:JSON.stringify(J);return e.jsxs("div",{className:I<w.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700 text-xs",children:F}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:u,onClick:E=>E.preventDefault()})})]},I)})})]},T)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:W=>x(W),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:W=>B(W),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${f.length>1&&!S?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:f.length>1&&!S,children:"Start Generation"})]})]})},dt=({selectedNodes:o,paramTestValues:n,selectedParams:s,totalCount:m,completedCount:h,errorMessage:x,handleClose:c,setIsProcessing:g,setCurrentScreen:f,cleanupPolling:P})=>{const S=k=>{k.preventDefault(),k.stopPropagation(),Ze({clear:!0}),et(),P&&P(),g(!1),f(2)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),e.jsxs("div",{className:"text-xs mb-3",children:["Completed ",h," of ",m," runs"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${h/m*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",h," images"]}),e.jsx("button",{onClick:S,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",m," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:c,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:x})]})}),o.length>0?o.map((k,$)=>{const K=k.type||"Unknown Node",O=k.widgets||[],B=k.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[K," (ID: ",B,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:O.map((W,T)=>{const j=W.name;if(!s[j])return null;const w=n[B]?.[j]||[],C=Array.isArray(w)?`[${w.join(", ")}]`:JSON.stringify(w);return e.jsxs("div",{className:T<O.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:j}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:C,onClick:y=>y.preventDefault()})})]},T)})})]},$)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},xt=({generatedImages:o,selectedImageIndex:n,handleSelectImage:s,handleApplySelected:m,handlePrevious:h,handleClose:x,currentPage:c,handlePageChange:g,imagesPerPage:f,notificationVisible:P,modalVisible:S,modalImageUrl:k,openImageModal:$,closeImageModal:K})=>{const O=Math.ceil(o.length/f),B=(c-1)*f,W=Math.min(B+f,o.length),T=o.slice(B,W);return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["All ",o.length," images have been generated."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:x,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),P&&e.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"py-1",children:e.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:K,children:e.jsxs("div",{className:"bg-white rounded-lg p-2 max-w-4xl max-h-[90vh] relative",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-700 hover:text-gray-900 rounded-full hover:bg-gray-200 p-1",onClick:K,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"overflow-auto max-h-[calc(90vh-4rem)]",children:e.jsx("img",{src:k,alt:"Enlarged image",className:"max-w-full h-auto"})})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:T.map((j,w)=>{const C=B+w;return e.jsxs("div",{className:`relative rounded-lg overflow-hidden border ${n===C?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:y=>s(C,y),children:[e.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:y=>$(j.url,y),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:j.url,alt:`Generated image ${C+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(j.params).filter(([y,I])=>y!=="nodeParams"&&typeof I!="object").map(([y,I])=>e.jsxs("div",{children:[y,": ",String(I)]},y))})]},C)})}),O>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-4 mb-4",children:[e.jsx("button",{onClick:j=>g(1,j),disabled:c===1,className:`px-2 py-1 rounded ${c===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M8.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L4.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})]})}),e.jsx("button",{onClick:j=>g(c-1,j),disabled:c===1,className:`px-2 py-1 rounded ${c===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"px-2 py-1 text-xs text-gray-800",children:["Page ",c," of ",O]}),e.jsx("button",{onClick:j=>g(c+1,j),disabled:c===O,className:`px-2 py-1 rounded ${c===O?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:j=>g(O,j),disabled:c===O,className:`px-2 py-1 rounded ${c===O?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10 4.293 14.293a1 1 0 000 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M11.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L15.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:j=>h(j),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:j=>m(j),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:n===null,children:"Apply Selected"})]})]})},mt=({visible:o,aiWritingModalText:n,setAiWritingModalText:s,aiGeneratedTexts:m,aiSelectedTexts:h,aiWritingLoading:x,aiWritingError:c,handleAiWriting:g,toggleTextSelection:f,addSelectedTexts:P,onClose:S})=>o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"AI Writing Assistant"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:S,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Enter text and AI will generate variations"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm",rows:3,placeholder:"Enter some text here...",value:n,onChange:k=>s(k.target.value)}),e.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-md text-sm flex items-center hover:bg-blue-200 transition-colors",onClick:g,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-blue-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):e.jsx(e.Fragment,{children:"Generate"})})]}),c&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-sm",children:c}),m.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Generated variations (select items to add):"}),e.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:m.map((k,$)=>e.jsxs("div",{className:"flex items-start border border-gray-200 rounded-md p-2",children:[e.jsx("div",{className:"mr-2 mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",id:`text${$+1}`,checked:!!h[`text${$+1}`],onChange:()=>f(`text${$+1}`),className:"sr-only"}),e.jsx("div",{className:`h-4 w-4 rounded border ${h[`text${$+1}`]?"bg-blue-600 border-blue-600":"bg-white border-gray-300"} flex items-center justify-center`,onClick:()=>f(`text${$+1}`),children:h[`text${$+1}`]&&e.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),e.jsx("label",{htmlFor:`text${$+1}`,className:"text-sm text-gray-700 cursor-pointer flex-1",children:k})]},$))})]})]}),e.jsxs("div",{className:"p-4 border-t flex justify-end",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md text-sm mr-2 hover:bg-gray-200 transition-colors",onClick:S,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 transition-colors",onClick:P,disabled:Object.values(h).every(k=>!k),children:"Add Selected"})]})]})}):null,ye=o=>{const n=[],s={};if(Object.keys(o).forEach(x=>{const c=parseInt(x),g=o[x]||{},f=Object.keys(g).filter(S=>g[S]&&g[S].length>0);if(f.length===0)return;const P=[[]];f.forEach(S=>{const k=g[S],$=[];P.forEach(K=>{k.forEach(O=>{const B=[...K,{nodeId:c,paramName:S,paramValue:String(O)}];$.push(B)})}),P.length=0,P.push(...$)}),s[x]=P}),Object.keys(s).length===0)return n;if(Object.keys(s).length===1){const x=Object.keys(s)[0];return s[x]}const m=Object.keys(s);let h=s[m[0]];for(let x=1;x<m.length;x++){const c=s[m[x]],g=[];h.forEach(f=>{c.forEach(P=>{g.push([...f,...P])})}),h=g}return h},ut=(o,n)=>{const s={};s.nodeParams={};const m=ye(o);return n<m.length&&m[n].forEach(x=>{const c=x.nodeId.toString(),g=x.paramName,f=x.paramValue;s.nodeParams[c]||(s.nodeParams[c]={}),s.nodeParams[c][g]=f,s[g]=f}),s},ht=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,vt=({selectedNodes:o,visible:n,onClose:s})=>{const[m,h]=b.useState(0),[x,c]=b.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[g,f]=b.useState(!1),[P,S]=b.useState(!1),[k,$]=b.useState(0),[K,O]=b.useState(12),[B,W]=b.useState(null),[T,j]=b.useState(()=>Array(12).fill(null).map((t,r)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:r%3===0?5:r%3===1?10:15,sampler_name:"euler",cfg:1}}))),[w,C]=b.useState({}),[y,I]=b.useState({}),[F,J]=b.useState({}),[u,E]=b.useState({}),[q,d]=b.useState(1),G=6,[D,v]=b.useState(null),[p,z]=b.useState(!1),[H,Y]=b.useState(!1),[L,_]=b.useState(""),[A,R]=b.useState({}),[Q,V]=b.useState(!1),[pe,ge]=b.useState(""),[ve,ie]=b.useState([]),[Ee,ce]=b.useState(!1),[we,Ne]=b.useState(""),[ke,Ce]=b.useState(""),[$e,se]=b.useState(null),[Se,re]=b.useState({}),{dispatch:ne}=Ie(),de=b.useRef(null),oe=b.useRef(null),We=async()=>{if(!pe.trim()){se("Please enter some text to generate variations");return}ce(!0),se(null),ie([]),re({});try{const t=await Me.generateSDPrompts(pe);ie(t);const r={};t.forEach((i,a)=>{r[`text${a+1}`]=!1}),re(r)}catch(t){console.error("Error generating text:",t),se("Failed to generate text variations. Please try again.")}finally{ce(!1)}},De=(t,r,i,a)=>{const l=`${t}_${r}`;R(N=>{const U=[...N[l]||[]];return U[i]=a,{...N,[l]:U}});const M=[...A[l]||[]];M[i]=a,ee(t,r,M)},_e=(t,r)=>{const i=`${t}_${r}`;R(l=>{const M=[...l[i]||[]];return M.push(""),{...l,[i]:M}});const a=[...A[i]||[],""];ee(t,r,a)},Ae=(t,r,i)=>{const a=`${t}_${r}`;R(M=>{const N=[...M[a]||[]];return N.splice(i,1),{...M,[a]:N}});const l=[...A[a]||[]];l.splice(i,1),ee(t,r,l)},Oe=t=>{re(r=>({...r,[t]:!r[t]}))},Be=()=>{const t=`${we}_${ke}`,r=Object.entries(Se).filter(([a,l])=>l).map(([a])=>{const l=parseInt(a.replace("text",""))-1;return ve[l]});if(r.length===0)return;R(a=>{const l=[...a[t]||[]];return{...a,[t]:[...l,...r]}});const i=[...A[t]||[],...r];ee(we,ke,i),V(!1)},Te=(t,r)=>{V(!0),Ne(t),Ce(r),ge(""),ie([]),re({}),ce(!1),se(null)};b.useEffect(()=>{if(!o||o.length===0)return;const t={...w},r=o.map(a=>a.id.toString());Object.keys(t).forEach(a=>{r.includes(a)||delete t[a]}),o.forEach(a=>{const l=a.id.toString();t[l]||(t[l]={})}),JSON.stringify(t)!==JSON.stringify(w)&&C(t)},[o,w]),b.useEffect(()=>{ne({type:"SET_SCREEN_STATE",payload:{currentScreen:m,isProcessing:g,isCompleted:P}})},[m,g,P,ne]),b.useEffect(()=>{const t=document.createElement("style");return t.textContent=ht,document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),b.useEffect(()=>{const t=r=>{if(Object.values(y).some(i=>i)){const i=r.target,a=!!i.closest(".dropdown-menu"),l=!!i.closest("[data-dropdown]");!a&&!l&&I({})}};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[y]);const Le=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),m===0){const r={...w};Object.keys(r).forEach(i=>{const a=r[i];Object.keys(a).forEach(l=>{x[l]||delete a[l]})}),C(r)}if(m===1){const r=ye(w);O(r.length)}v(null),h(r=>Math.min(r+1,2))},fe=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),v(null),P&&S(!1),m===1){const r=o.map(l=>l.id.toString()),i=Object.keys(w),a={...w};i.forEach(l=>{r.includes(l)||delete a[l]}),C(a)}h(r=>Math.max(r-1,0))},Re=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation());const i=x[t];if(c(a=>({...a,[t]:!i})),i){const a={...w};Object.keys(a).forEach(l=>{a[l][t]&&delete a[l][t]}),C(a)}},ze=(t,r,i)=>{i.preventDefault(),i.stopPropagation();const a=`${t}_${r}`;I(l=>{if(l[a]&&typeof l[a]=="object"?l[a].isOpen:!!l[a])return{...l,[a]:!1};{let N=0,U=0;if(i.currentTarget){const le=i.currentTarget.getBoundingClientRect();N=le.left,U=le.bottom}else N=i.clientX,U=i.clientY+20;const me=window.innerWidth,ue=250;return N+ue>me&&(N=me-ue-10),N<0&&(N=10),{...l,[a]:{isOpen:!0,x:N,y:U}}}})},ee=(t,r,i)=>{C(a=>{const l={...a};return l[t]||(l[t]={}),l[t][r]=i,l})},Fe=(t,r,i,a)=>{a&&(a.preventDefault(),a.stopPropagation()),C(l=>{const M={...l};M[t]||(M[t]={}),M[t][r]||(M[t][r]=[]);const N=M[t][r];return N.includes(i)?M[t][r]=N.filter(U=>U!==i):M[t][r]=[...N,i],M})},Ge=(t,r,i)=>{const a=`${t}_${r}`;J(l=>({...l,[a]:i}))},Ve=(t,r,i)=>{if(!w[t]){ee(t,r,i);return}const a=w[t][r]||[];i.length===a.length?ee(t,r,[]):ee(t,r,[...i])},Ue=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation()),d(Math.max(1,Math.min(t,Math.ceil(T.length/G))))},xe=()=>{de.current&&(clearTimeout(de.current),de.current=null),oe.current=null};b.useEffect(()=>()=>{xe()},[]);const He=async(t,r)=>{t&&(t.preventDefault(),t.stopPropagation()),xe();const i=ye(w),a=i.length;if(a>100){v(`Cannot generate more than 100 images at once (currently: ${a} images)`);return}if(v(null),f(!0),$(0),console.log("Generated parameter combinations:",i),i.length===0){v("No valid parameter combinations found. Please check your parameter selections."),f(!1);return}let l=r||null;if(l===null){const N=ot();N!==null&&(l=N)}if(l===null){v("Please select a SaveImage or PreviewImage node first."),f(!1);return}const M=[];try{const N=Date.now().toString();oe.current=N;for(const te of i){const X=await rt(te);X.prompt_id?M.push(X.prompt_id):(console.error("Failed to get prompt_id from response:",X),M.push(""))}const U=Array(i.length).fill(null).map((te,X)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:ut(w,X)}));j(U);const me=Date.now(),ue=5*60*1e3,le=async()=>{if(oe.current!==N){console.log("Another polling session has started, stopping this one");return}if(Date.now()-me>ue){console.log("Timeout reached while waiting for images"),oe.current===N&&(f(!1),S(!0),d(1));return}let te=0;for(let X=0;X<M.length;X++){const je=M[X];if(je)try{const he=await at(je,Number(l));he&&(U[X]={...U[X],url:he},te++)}catch(he){console.error(`Error fetching image for prompt ID ${je}:`,he)}}oe.current===N&&(j([...U]),$(te),te===M.length?(console.log("All images ready, completing session"),f(!1),S(!0),d(1)):de.current=setTimeout(le,3e3))};le()}catch(N){console.error("Error generating images:",N),f(!1)}},Ke=(t,r)=>{r&&(r.preventDefault(),r.stopPropagation()),W(t)},qe=(t,r)=>{r.preventDefault(),r.stopPropagation(),_(t),Y(!0)},Ye=t=>{t&&(t.preventDefault(),t.stopPropagation()),Y(!1)},Je=async t=>{if(t&&(t.preventDefault(),t.stopPropagation()),B!==null){console.log(`Applied image ${B+1} with parameters:`,T[B].params),Me.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:tt(),data:{workflow:(await Z.graphToPrompt()).output,selected_params:T[B].params,all_params:w,count:Object.keys(w).length}});const r=T[B].params;r.nodeParams&&(Object.entries(r.nodeParams).forEach(([i,a])=>{const l=Z.graph._nodes_by_id[i];!l||!l.widgets||Object.entries(a).forEach(([M,N])=>{for(const U of l.widgets)if(U.name===M){U.value=N;break}})}),Z.graph.setDirtyCanvas(!1,!0),z(!0),setTimeout(()=>{z(!1)},3e3))}},ae=(t,r)=>{if(t&&(t.preventDefault(),t.stopPropagation()),m===1&&r!==void 0){const i=[...o],a=i[r];if(i.splice(r,1),a){const l=a.id.toString();C(M=>{const N={...M};return delete N[l],N})}i.length===0?s&&(ne({type:"SET_SCREEN_STATE",payload:null}),be(),s()):ne({type:"SET_SELECTED_NODE",payload:i});return}s?(ne({type:"SET_SCREEN_STATE",payload:null}),be(),s()):be()},be=()=>{h(0),c({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),xe(),f(!1),S(!1),$(0),O(12),W(null),j(Array(12).fill(null).map((t,r)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:r%3===0?5:r%3===1?10:15,sampler_name:"euler",cfg:1}}))),C({}),I({}),J({}),E({}),d(1),v(null),z(!1),Y(!1),_(""),R({}),V(!1),ge(""),ie([]),ce(!1),Ne(""),Ce(""),se(null),re({})};return!n||o.length===0?e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"max-w-lg p-8 bg-white rounded-lg shadow-sm border border-blue-100 relative",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-base font-bold text-blue-800 mb-2",children:"GenLab"}),e.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full text-blue-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Batch Test Parameter Pairs"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Select a node to batch test parameter pairs"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-indigo-100 p-2 rounded-full text-indigo-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"How To Use"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Click on any node in your workflow to start the parameter testing process"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No node is currently selected"})})]})]})}):P?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsx(xt,{generatedImages:T,selectedImageIndex:B,handleSelectImage:Ke,handleApplySelected:Je,handlePrevious:fe,handleClose:ae,currentPage:q,handlePageChange:Ue,imagesPerPage:G,notificationVisible:p,modalVisible:H,modalImageUrl:L,openImageModal:qe,closeImageModal:Ye})}):g?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsx(dt,{selectedNodes:o,paramTestValues:w,selectedParams:x,totalCount:K,completedCount:k,errorMessage:D,handleClose:ae,setIsProcessing:f,setCurrentScreen:h,cleanupPolling:xe})}):m===0?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsx(lt,{selectedNodes:o,handleParamSelect:Re,selectedParams:x,handleNext:Le,handleClose:ae})}):m===1?e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:[e.jsx(it,{selectedNodes:o,paramTestValues:w,selectedParams:x,updateParamTestValues:ee,toggleDropdown:ze,openDropdowns:y,handleTestValueSelect:Fe,searchTerms:F,handleSearch:Ge,handleSelectAll:Ve,handleNext:Le,handlePrevious:fe,handleClose:ae,inputValues:u,setInputValues:E,textInputs:A,handleTextInputChange:De,handleAddTextInput:_e,handleRemoveTextInput:Ae,openAiWritingModal:Te}),e.jsx(mt,{visible:Q,aiWritingModalText:pe,setAiWritingModalText:ge,aiGeneratedTexts:ve,aiSelectedTexts:Se,aiWritingLoading:Ee,aiWritingError:$e,handleAiWriting:We,toggleTextSelection:Oe,addSelectedTexts:Be,onClose:()=>V(!1)})]}):e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsx(ct,{selectedNodes:o,paramTestValues:w,selectedParams:x,totalCount:K,errorMessage:D,handlePrevious:fe,handleStartGeneration:He,handleClose:ae})})};export{vt as ParameterDebugInterface};
