function getImportPath(filename) {
            return `./${filename}`;
        }
            const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/WorkflowOption-3qf6K5VM.js","copilot_web/vendor-markdown-CBmlBP6m.js","copilot_web/vendor-react-Dixhfmvb.js","copilot_web/message-components-DoPpEV2n.js"].map(path => {
                        const apiBase = window.comfyAPI?.api?.api?.api_base;
                        if (apiBase) {
                            // 有 API base 时，使用完整路径
                            return `${apiBase.substring(1)}/${path}`;
                        } else {        
                            // 没有 API base 时，使用相对路径
                            return `./${path}`;
                        }
                    }))))=>i.map(i=>d[i]);
import{j as i,r as $m,b as Gm}from"./vendor-markdown-CBmlBP6m.js";import{r as k,R as ms,c as xr,a as Km}from"./vendor-react-Dixhfmvb.js";import{f as Hm,v as qm,W as Bt,B as Cl,u as bn,a as Te,g as Xe,U as Jm,A as gs,b as Vm,c as vr,M as Ym}from"./message-components-DoPpEV2n.js";import{_ as xs}from"./input.js";import{C as Vn}from"./App-az6oTL5x.js";/* empty css     *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xm=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Al=(...a)=>a.filter((u,r,d)=>!!u&&u.trim()!==""&&d.indexOf(u)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qm=k.forwardRef(({color:a="currentColor",size:u=24,strokeWidth:r=2,absoluteStrokeWidth:d,className:f="",children:h,iconNode:m,...x},v)=>k.createElement("svg",{ref:v,...Zm,width:u,height:u,stroke:a,strokeWidth:d?Number(r)*24/Number(u):r,className:Al("lucide",f),...x},[...m.map(([I,_])=>k.createElement(I,_)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=(a,u)=>{const r=k.forwardRef(({className:d,...f},h)=>k.createElement(Qm,{ref:h,iconNode:u,className:Al(`lucide-${Xm(a)}`,d),...f}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],t0=En("CircleStop",e0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n0=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],r0=En("Image",n0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],i0=En("Plus",s0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],a0=En("Send",o0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],c0=En("Settings",l0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u0=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],d0=En("Trash",u0);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f0=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],zi=En("X",f0);function h0({isOpen:a,onClose:u,onSave:r,initialApiKey:d=""}){const[f,h]=k.useState(d),[m,x]=k.useState(!1),[v,I]=k.useState(""),[_,S]=k.useState("https://api.openai.com/v1"),[j,M]=k.useState(!1),[P,R]=k.useState(!1),[D,F]=k.useState(null),[G,Z]=k.useState(null);k.useEffect(()=>{h(d);const B=localStorage.getItem("openaiApiKey"),V=localStorage.getItem("openaiBaseUrl");B&&I(B),V&&S(V),(async()=>{try{const z=localStorage.getItem("rsaPublicKey");if(z)Z(z);else{const le=await Hm();Z(le),localStorage.setItem("rsaPublicKey",le)}}catch(z){console.error("Failed to fetch RSA public key:",z)}})()},[d]);const ae=async()=>{if(!v.trim()){F({success:!1,message:"Please enter an OpenAI API key"});return}if(!G){F({success:!1,message:"RSA public key not available. Please try again later."});return}R(!0),F(null);try{const B=await qm(v,_,G);F({success:B,message:B?"API key is valid!":"Invalid API key. Please check and try again."})}catch(B){F({success:!1,message:B instanceof Error?B.message:"Failed to verify API key"})}finally{R(!1)}},w=()=>{r(f),v.trim()?(localStorage.setItem("openaiApiKey",v),localStorage.setItem("openaiBaseUrl",_)):(localStorage.removeItem("openaiApiKey"),localStorage.removeItem("openaiBaseUrl")),u()};return a?i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] shadow-2xl",children:[i.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:m?"text":"password",value:f,onChange:B=>h(B.target.value),placeholder:"Enter your API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg mb-4 pr-12
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                            hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>x(!m),children:m?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[i.jsx("span",{children:"Don't have an API key? "}),i.jsx("a",{href:"https://form.typeform.com/to/tkg91K8D",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Click here to request one"})]})]}),i.jsxs("div",{className:"mb-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[i.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:"OpenAI API Configuration (Optional)"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:j?"text":"password",value:v,onChange:B=>I(B.target.value),placeholder:"Enter your OpenAI API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs
                                bg-gray-50 dark:bg-gray-700 
                                text-gray-900 dark:text-white
                                placeholder-gray-500 dark:placeholder-gray-400
                                focus:border-blue-500 dark:focus:border-blue-400 
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                                hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>M(!j),children:j?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI Base URL"}),i.jsx("input",{type:"text",value:_,onChange:B=>S(B.target.value),placeholder:"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`})]}),i.jsx("div",{className:"flex items-center mb-2",children:i.jsx("button",{onClick:ae,disabled:P||!v.trim(),className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${P||!v.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:P?i.jsxs("span",{className:"flex items-center",children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),D&&i.jsx("div",{className:`text-xs p-2 rounded-md ${D.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:D.message})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:u,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),i.jsx("button",{onClick:w,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]})}):null}const g0="/copilot_web/assets/logo-BTZhX0BN.png";function m0({onClose:a,onClear:u,hasMessages:r,onHeightResize:d,title:f="ComfyUI-Copilot"}){const[h,m]=k.useState(!1),[x,v]=k.useState(!1),I=()=>{m(!0)},_=S=>{localStorage.setItem("chatApiKey",S)};return k.useEffect(()=>{const S=M=>{if(!x)return;const P=M.movementY;d?.(P)},j=()=>{v(!1)};return x&&(document.addEventListener("mousemove",S),document.addEventListener("mouseup",j)),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",j)}},[x,d]),i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 
                        bg-white border-gray-200 sticky top-2 z-10`,children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("img",{src:`.${g0}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),i.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:f}),i.jsx("button",{onClick:I,className:"p-1 bg-white border-none hover:bg-gray-100 rounded text-gray-500",children:i.jsx(c0,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex items-center gap-1",children:i.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${r?"text-gray-500 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!r,onClick:u,children:i.jsx(d0,{className:"h-4 w-4"})})})]}),i.jsx(h0,{isOpen:h,onClose:()=>m(!1),onSave:_,initialApiKey:localStorage.getItem("chatApiKey")||""})]})}const p0=5*1024*1024,xl=["image/jpeg","image/png","image/gif","image/webp"];function x0({input:a,loading:u,onChange:r,onSend:d,onKeyPress:f,onUploadImages:h,uploadedImages:m,onRemoveImage:x,selectedModel:v,onModelChange:I,onStop:_}){const[S,j]=k.useState(!1),[M,P]=k.useState([]),R=ms.useRef(null),D=k.useRef(null);k.useEffect(()=>{D.current&&(D.current.style.height="auto",D.current.style.height=`${Math.min(D.current.scrollHeight,400)}px`)},[a]),k.useEffect(()=>{(async()=>{try{const Z=await Bt.listModels();P(Z.models)}catch(Z){console.error("Failed to load models:",Z),P([{name:"gpt-4o",image_enable:!0},{name:"gpt-4o-mini",image_enable:!0},{name:"qwen-plus",image_enable:!1},{name:"DeepSeek-V3",image_enable:!1}])}})()},[]);const F=G=>{if(G.target.files){const Z=[],ae=[];if(Array.from(G.target.files).forEach(w=>{xl.includes(w.type)?w.size>p0?Z.push(`${w.name} (exceeds 5MB)`):ae.push(w):Z.push(`${w.name} (unsupported format)`)}),Z.length>0&&alert(`The following files couldn't be uploaded:
${Z.join(`
`)}`),ae.length>0){const w=new DataTransfer;ae.forEach(B=>w.items.add(B)),h(w.files)}}};return i.jsxs("div",{className:`relative ${m.length>0?"mt-12":""}`,children:[m.length>0&&i.jsx("div",{className:"absolute -top-10 left-0 flex gap-2",children:m.map(G=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:G.preview,alt:"uploaded",className:"w-8 h-8 rounded object-cover"}),i.jsx("button",{onClick:()=>x(G.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5
                                         opacity-0 group-hover:opacity-100 transition-opacity`,children:i.jsx(zi,{className:"w-3 h-3"})})]},G.id))}),i.jsx("textarea",{ref:D,onChange:r,onKeyDown:G=>{if(G.key==="Enter"&&!G.shiftKey){if(G.nativeEvent.isComposing)return;G.preventDefault(),a.trim()!==""&&d()}f(G)},value:a,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border 
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm 
                         focus:outline-none focus:ring-2 focus:ring-blue-500 
                         focus:border-transparent bg-white transition-all 
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),i.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-2 
                          bg-white border-t border-gray-100 pt-1`,children:[i.jsx("select",{value:v,onChange:G=>I(G.target.value),className:`px-1.5 py-0.5 text-xs rounded-md 
                             border border-gray-200 bg-white text-gray-700
                             focus:outline-none focus:ring-2 focus:ring-blue-500
                             focus:border-transparent hover:bg-gray-50
                             transition-colors border-0`,children:M.map(G=>i.jsx("option",{value:G.name,children:G.name},G.name))}),i.jsx("button",{type:"button",onClick:()=>j(!0),disabled:!M.find(G=>G.name===v)?.image_enable,className:`p-1.5 text-gray-500 bg-white border-none
                             hover:bg-gray-100 hover:text-gray-600 
                             transition-all duration-200 outline-none
                             ${M.find(G=>G.name===v)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx(r0,{className:"h-4 w-4"})})]}),i.jsx("button",{type:"submit",onClick:u?_:d,disabled:u?!1:a.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50 
                         transition-all duration-200 active:scale-95`,children:u?i.jsx(t0,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):i.jsx(a0,{className:"h-5 w-5 group-hover:translate-x-1"})}),S&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[i.jsx("button",{onClick:()=>j(!1),className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:text-gray-700",children:i.jsx(zi,{className:"w-5 h-5"})}),i.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),i.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8
                                      flex flex-col items-center justify-center gap-4
                                      hover:border-blue-500 transition-colors cursor-pointer`,onClick:()=>R.current?.click(),children:[i.jsx(i0,{className:"w-8 h-8 text-gray-400"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB"})]})]}),i.jsx("input",{ref:R,type:"file",multiple:!0,accept:xl.join(","),onChange:F,className:"hidden"}),m.length>0&&i.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:m.map(G=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:G.preview,alt:"preview",className:"w-full h-20 object-cover rounded"}),i.jsx("button",{onClick:()=>x(G.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 
                                                     rounded-full p-0.5 opacity-0 group-hover:opacity-100 
                                                     transition-opacity`,children:i.jsx(zi,{className:"w-3 h-3"})})]},G.id))}),i.jsx("div",{className:"mt-4 flex justify-end gap-2",children:i.jsx("button",{onClick:()=>j(!1),className:`px-4 py-2 text-sm font-medium text-gray-700 
                                         bg-white border border-gray-300 rounded-md 
                                         hover:bg-gray-50`,children:"Close"})})]})})]})}function b0(){return i.jsx(Cl,{name:"Assistant",children:i.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),i.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const y0=[{type:"chat",tool:"workflow_generate",name:"给我一个SK波普风插画工作流",messages:[{id:"showcase1-1",role:"user",content:"我需要一个创建SK波普风插画的工作流",trace_id:"showcase1"},{id:"showcase1-2",role:"ai",content:'{"session_id":"3da22770-b7ba-46ff-851f-d43d4190ba35","text":"我为您找到了一些相关的SK波普风插画工作流：\\n\\n1. **SK波普风插画工作流**\\n   - 描述: SK波普风插画工作流v2\\n   - 图片: ![SK波普风插画工作流](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||9b6dee1eb02e454b8b9f90047f67fdcf||00d68f37853c540b8a179f890056cbdf.jpg)\\n\\n2. **SK清新风插画出图工作流**\\n   - 描述: SK清新风插画F.1，推荐模型强度：1.4（0.8到1.4都有不同效果，自己尝试）\\n   - 图片: ![SK清新风插画出图工作流](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||c469a538da36496b9bc299bbfe4dcbfb||2c7a058f219502bf7f7ab006717541a1.jpg)\\n\\n3. **SK点线艺术抽象插画蓝墨工作流**\\n   - 描述: SK点线艺术抽象插画 | 蓝墨效果。推荐使用ComfyUI生图，生成快、节省算力。点击在线ComfyUI生图，模型推荐强度：0.8~1.4。\\n   - 图片: ![SK点线艺术抽象插画蓝墨工作流](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||5dea5dd339de4cdc9b77d755b9f0789a||22d21104ece72e8b034905e0fe436633.jpg)\\n\\n同时，我已经生成了一个定制的工作流：\\n\\n- **AI生成的工作流**\\n  - 描述: 将任何肖像或插图转换为SK波普艺术风格，保持鲜艳的色彩和大胆的几何形状。该工作流应优化低VRAM使用和快速渲染速度，使用稳定的官方模型。\\n  - 图片: ![AI生成的工作流](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\n您可以选择以上推荐的工作流或使用AI生成的定制解决方案。","finished":true,"format":"markdown","ext":[{"type":"workflow","data":[{"id":29504,"name":"AI Generated Workflow","description":"Build a workflow that transforms any portrait or illustration into SK Pop Art style, maintaining vibrant colors and bold geometric shapes. The workflow should be optimized for low VRAM usage and quick rendering speeds, using stable and official models where possible.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"75f4dc64e8947aefc00451fd574dbdc8","score":null,"source":"AI Generated"}, {"id":3806,"name":"SK_波普风插画_工作流","description":"SK_波普风插画_工作流v2","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||9b6dee1eb02e454b8b9f90047f67fdcf||00d68f37853c540b8a179f890056cbdf.jpg","unique_id":"0d5f9aa415592f370ad05747594f851d","score":[0.7427938887126632,1]},{"id":4126,"name":"SK_清新风插画_出图工作流","description":"SK_清新风插画_F.1 建议模型强度：1.4 （0.81.4都有不同效果，自己尝试吧）","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||c469a538da36496b9bc299bbfe4dcbfb||2c7a058f219502bf7f7ab006717541a1.jpg","unique_id":"4c8f9233892a68aa1fdb7b0aa7d7eab0","score":[0.646644434532856,0.6666666666666666]},{"id":4904,"name":"SK_点线艺术抽象插画_蓝墨_工作流","description":"SK_点线艺术抽象插画 | 蓝墨效果 建议使用ComfyUI生图（以下是我搭建的工作流，出图快，省算力） 点击在线 ComfyUI 生图   大模型：F.1基础算法模型 模型强度建议：0.8~1.4，（每种强度有不同效果，快去尝试吧！） 基础魔法：SK,Stylish blue and white line paintings with radiating line patterns on the background,（1 girl） ","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||5dea5dd339de4cdc9b77d755b9f0789a||22d21104ece72e8b034905e0fe436633.jpg","unique_id":"e0bf07efb70e4720347a571a3be8587d","score":[0.6317212205099343,0.6666666666666666]}]}],"message_id":"277361b7-f5f7-4b2a-80b8-d88a75fa2687"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"node_recommend",name:"给我一个把多张图合并的节点",messages:[{id:"showcase2-1",role:"user",content:"给我一个把多张图合并的节点",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"以下是可以合并多张图片的节点：\\n\\n1. **MonoMerge**  \\n   [GitHub链接](https://github.com/bmad4ever/comfyui_bmad_nodes): 将两张图片合并为单色图片，可选择在白色或黑色方向合并。\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub链接](https://github.com/melMass/comfy_mtb): 可将多张图片合并成一个批次，适用于处理和操控图片集。\\n\\n3. **JoinImageBatch**  \\n   [GitHub链接](https://github.com/yolain/ComfyUI-Easy-Use): 合并批量图片成一张大图，支持水平或垂直拼接。\\n\\n4. **MergeLayers**  \\n   [GitHub链接](https://github.com/shadowcz007/comfyui-mixlab-nodes): 将多层图像合并为单张图片，支持指定的遮罩和混合选项。\\n\\n5. **Composite Images 🧅**  \\n   [GitHub链接](https://github.com/natto-maki/ComfyUI-NegiTools): 结合两张图片，支持多种复合方法，如乘法、划分、叠加等。\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub链接](https://github.com/Nourepide/ComfyUI-Allor): 通过总结图像维度以创建复合图像，适用于需要考虑输入图像总宽和高的情况。\\n\\n7. **Join Image Lists**  \\n   [GitHub链接](https://github.com/M1kep/Comfy_KepListStuff): 合并多张图片列表成为一个列表，同时提供原列表大小。\\n\\n8. **Merge Image List**  \\n   [GitHub链接](https://github.com/AInseven/ComfyUI-fastblend): 合并图像张量列表为一个单一张量，便于图像相关任务的批处理。\\n\\n根据你的具体需求选择合适的节点使用。","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"给我一个宫崎骏风格的lora",messages:[{id:"showcase3-1",role:"user",content:"给我一个宫崎骏风格的lora",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"请问您需要基于哪种基座模型的宫崎骏风格LORA？可选择以下基座模型：\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"以下是几个基于Flux.1的宫崎骏风格LORA模型：\\n\\n1. **宫崎骏风格插画**  \\n   - 描述：此模型擅长创作灵感来自宫崎骏风格的插图，展示奇幻、细致的风景和幻想元素。它强调丰富的质感、鲜艳的色彩和复杂的自然环境，擅长营造充满生机和暖意的场景，以讲述具有特色的宫崎骏风格的故事。  \\n   - [获取链接](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **宫崎骏的现实主义**  \\n   - 描述：模型擅长生成吉卜力风格的梦幻景观，展现葱郁的绿地、鲜亮的蓝色以及自然与建筑之间的和谐融合。它捕捉梦幻般的场景，具有柔和的幻想氛围，体现出在宁静森林和空中城堡间的魔幻现实主义。  \\n   - ![示例图片1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![示例图片2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [获取链接](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-宫崎骏风格**  \\n   - 描述：模型擅长生成宫崎骏影响下的动漫风格图像，呈现鲜艳的色彩、富有想象力的构图和生动的表现。专注于生成年轻女孩在各种迷人环境中的场景，擅长渲染云的细节纹理和复杂的光影。 \\n   - [获取链接](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\n您可以选择一个适合您需求的模型进行使用。","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"宫崎骏风格插画","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"宫崎骏的现实主义","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-宫崎骏风格","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"基于我的描述生成prompt",messages:[{id:"showcase4-1",role:"user",content:'请为我生成英文prompt: "一个红衣女子在海边跳舞，笑容很灿烂"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"根据我的诉求生成3个prompt，各自生图查看效果",messages:[{id:"showcase5-1",role:"user",content:"根据我的诉求生成3个prompt，各自生图查看效果",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"请根据下面的演示，使用Genlab来实现您的调试prompt的诉求。\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],bl=[{type:"chat",tool:"workflow_generate",name:"Give me an SK Pop Art illustration workflow",messages:[{id:"showcase1-1",role:"user",content:"I need a workflow for creating SK Pop Art illustrations",trace_id:"showcase1"},{id:"showcase1-2",role:"ai",content:'{"session_id":"3da22770-b7ba-46ff-851f-d43d4190ba35","text":"I found some relevant SK Pop Art illustration workflows for you:\\n\\n1. **SK Pop Art Illustration Workflow**\\n   - Description: SK Pop Art Illustration Workflow v2\\n   - Image: ![SK Pop Art Illustration Workflow](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||9b6dee1eb02e454b8b9f90047f67fdcf||00d68f37853c540b8a179f890056cbdf.jpg)\\n\\n2. **SK Fresh Style Illustration Workflow**\\n   - Description: SK Fresh Style Illustration F.1, Recommended model strength: 1.4 (0.8 to 1.4 all have different effects, try it yourself)\\n   - Image: ![SK Fresh Style Illustration Workflow](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||c469a538da36496b9bc299bbfe4dcbfb||2c7a058f219502bf7f7ab006717541a1.jpg)\\n\\n3. **SK Dot Line Art Abstract Illustration Blue Ink Workflow**\\n   - Description: SK Dot Line Art Abstract Illustration | Blue Ink Effect. Recommended to use ComfyUI for generation, fast generation and power saving. Click online ComfyUI generation, model recommended strength: 0.8~1.4.\\n   - Image: ![SK Dot Line Art Abstract Illustration Blue Ink Workflow](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||5dea5dd339de4cdc9b77d755b9f0789a||22d21104ece72e8b034905e0fe436633.jpg)\\n\\nAdditionally, I have generated a custom workflow:\\n\\n- **AI Generated Workflow**\\n  - Description: Transform any portrait or illustration into SK Pop Art style, maintaining vibrant colors and bold geometric shapes. The workflow should be optimized for low VRAM usage and quick rendering speeds, using stable official models.\\n  - Image: ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nYou can choose from the recommended workflows above or use the AI-generated custom solution.","finished":true,"format":"markdown","ext":[{"type":"workflow","data":[{"id":29504,"name":"AI Generated Workflow","description":"Build a workflow that transforms any portrait or illustration into SK Pop Art style, maintaining vibrant colors and bold geometric shapes. The workflow should be optimized for low VRAM usage and quick rendering speeds, using stable and official models where possible.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"75f4dc64e8947aefc00451fd574dbdc8","score":null,"source":"AI Generated"}, {"id":3806,"name":"SK_Pop_Art_Illustration_Workflow","description":"SK_Pop_Art_Illustration_Workflow_v2","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||9b6dee1eb02e454b8b9f90047f67fdcf||00d68f37853c540b8a179f890056cbdf.jpg","unique_id":"0d5f9aa415592f370ad05747594f851d","score":[0.7427938887126632,1]},{"id":4126,"name":"SK_Fresh_Style_Illustration_Workflow","description":"SK_Fresh_Style_Illustration_F.1 Recommended model strength: 1.4 (0.8-1.4 all have different effects, try it yourself)","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||c469a538da36496b9bc299bbfe4dcbfb||2c7a058f219502bf7f7ab006717541a1.jpg","unique_id":"4c8f9233892a68aa1fdb7b0aa7d7eab0","score":[0.646644434532856,0.6666666666666666]},{"id":4904,"name":"SK_Dot_Line_Art_Abstract_Illustration_Blue_Ink_Workflow","description":"SK_Dot_Line_Art_Abstract_Illustration | Blue Ink Effect Recommended to use ComfyUI for generation (below is the workflow I built, fast generation, power saving) Click online ComfyUI generation   Base model: F.1 base algorithm model Model strength recommendation: 0.8~1.4, (each strength has different effects, go try it!) Base magic: SK,Stylish blue and white line paintings with radiating line patterns on the background,(1 girl) ","image":"https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||5dea5dd339de4cdc9b77d755b9f0789a||22d21104ece72e8b034905e0fe436633.jpg","unique_id":"e0bf07efb70e4720347a571a3be8587d","score":[0.6317212205099343,0.6666666666666666]}]}],"message_id":"277361b7-f5f7-4b2a-80b8-d88a75fa2687"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"node_recommend",name:"Give me a node to merge multiple images",messages:[{id:"showcase2-1",role:"user",content:"Give me a node to merge multiple images",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"Here are nodes that can merge multiple images:\\n\\n1. **MonoMerge**  \\n   [GitHub Link](https://github.com/bmad4ever/comfyui_bmad_nodes): Merges two images into a monochromatic image, with options to merge towards white or black direction.\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub Link](https://github.com/melMass/comfy_mtb): Can merge multiple images into a single batch, suitable for processing and manipulating image collections.\\n\\n3. **JoinImageBatch**  \\n   [GitHub Link](https://github.com/yolain/ComfyUI-Easy-Use): Merges batch images into one large image, supports horizontal or vertical stitching.\\n\\n4. **MergeLayers**  \\n   [GitHub Link](https://github.com/shadowcz007/comfyui-mixlab-nodes): Merges multi-layer images into a single image, supports specified masks and blending options.\\n\\n5. **Composite Images 🧅**  \\n   [GitHub Link](https://github.com/natto-maki/ComfyUI-NegiTools): Combines two images, supports multiple composite methods such as multiply, divide, overlay, etc.\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub Link](https://github.com/Nourepide/ComfyUI-Allor): Creates composite images by summarizing image dimensions, suitable for cases that need to consider the total width and height of input images.\\n\\n7. **Join Image Lists**  \\n   [GitHub Link](https://github.com/M1kep/Comfy_KepListStuff): Merges multiple image lists into one list while providing original list sizes.\\n\\n8. **Merge Image List**  \\n   [GitHub Link](https://github.com/AInseven/ComfyUI-fastblend): Merges image tensor lists into a single tensor, convenient for batch processing of image-related tasks.\\n\\nChoose the appropriate node based on your specific needs.","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"Give me a Studio Ghibli style LoRA",messages:[{id:"showcase3-1",role:"user",content:"Give me a Studio Ghibli style LoRA",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Which base model would you like for the Studio Ghibli style LoRA? You can choose from the following base models:\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Here are several Studio Ghibli style LoRA models based on Flux.1:\\n\\n1. **Studio Ghibli Style Illustration**  \\n   - Description: This model excels at creating illustrations inspired by Studio Ghibli's style, showcasing whimsical, detailed landscapes and fantasy elements. It emphasizes rich textures, vibrant colors, and intricate natural environments, excelling at creating scenes full of life and warmth to tell stories with distinctive Studio Ghibli characteristics.  \\n   - [Get Link](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **Studio Ghibli Realism**  \\n   - Description: The model excels at generating Ghibli-style dreamlike landscapes, showcasing lush greenery, bright blues, and harmonious integration between nature and architecture. It captures dreamy scenes with soft fantasy atmosphere, embodying magical realism between tranquil forests and sky castles.  \\n   - ![Example Image 1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![Example Image 2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [Get Link](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-Studio Ghibli Style**  \\n   - Description: The model excels at generating anime-style images influenced by Studio Ghibli, presenting vibrant colors, imaginative compositions, and lively expressions. It focuses on generating scenes of young girls in various charming environments, excelling at rendering detailed cloud textures and complex lighting and shadows. \\n   - [Get Link](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\nYou can choose a model that suits your needs.","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"Studio Ghibli Style Illustration","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"Studio Ghibli Realism","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-Studio Ghibli Style","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"Generate prompt based on my description",messages:[{id:"showcase4-1",role:"user",content:'Please generate an English prompt for me: "A woman in red dancing by the seaside with a bright smile"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"Generate 3 prompts based on my requirements and test each with image generation",messages:[{id:"showcase5-1",role:"user",content:"Generate 3 prompts based on my requirements and test each with image generation",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"Please follow the demonstration below to use Genlab to fulfill your prompt debugging requirements.\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],v0=2,_0=()=>{const{dispatch:a,isAutoScroll:u,showcasIng:r}=bn(),d=(x,v=!1,I=()=>{})=>{let _=0;const S=Xe(),j=(M=!1)=>{if(!r.current)return;_+=v0;const R=typeof x=="string"?x:x?.text||"",D=v?{id:S,role:"user",content:R.slice(0,_)}:{id:S,role:"ai",content:_>R.length&&x?.ext?JSON.stringify({text:R.slice(0,_),ext:x?.ext}):JSON.stringify({text:R.slice(0,_)}),finished:_>R.length,format:"markdown",name:"Assistant"};a({type:M?"ADD_MESSAGE":"UPDATE_MESSAGE",payload:D}),_<=R.length?setTimeout(()=>{j()},v?10:50):setTimeout(()=>{I()},500)};j(!0)},f=(x,v)=>{a({type:"SET_LOADING",payload:!0}),d(x,!0,v)},h=(x,v)=>{a({type:"SET_LOADING",payload:!1}),d(x,!1,v)},m=()=>{const x=Te.extensionManager.setting.get("Comfy.Locale");let v=bl,I="welcome to ComfyUI Copilot!";switch(x){case"zh":I="欢迎使用ComfyUI Copilot!",v=y0;break;case"en":default:I="welcome to ComfyUI Copilot!",v=bl;break}return{title:I,list:v}};return i.jsx(Cl,{name:"showcase",children:i.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[i.jsx("div",{className:"text-xl text-gray-900 font-extrabold",children:m()?.title}),m()?.list?.map((x,v)=>i.jsx("div",{className:"flex mt-2",onClick:()=>{u.current=!0,r.current=!0;const I=x.messages||[];let _=0;const S=()=>{if(_<I.length){const j=I[_];j.role==="user"?f(j.content,S):h(JSON.parse(j.content||"{}")||"",S),_++}};S()},children:i.jsx("span",{className:"text-sm text-gray-900 font-normal border border-gray-900 rounded-md px-2 py-1",children:x.name})},v.toString()))]})})},w0=a=>`https://ui-avatars.com/api/?name=${a||"User"}&background=random`,S0=k.lazy(()=>xs(()=>import(getImportPath("WorkflowOption-3qf6K5VM.js")),__vite__mapDeps([0,1,2,3])).then(a=>({default:a.WorkflowOption}))),N0=k.lazy(()=>xs(()=>import(getImportPath("message-components-DoPpEV2n.js")).then(a=>a.N),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeSearch}))),I0=k.lazy(()=>xs(()=>import(getImportPath("message-components-DoPpEV2n.js")).then(a=>a.D),__vite__mapDeps([3,2,1])).then(a=>({default:a.DownstreamSubgraphs}))),j0=k.lazy(()=>xs(()=>import(getImportPath("message-components-DoPpEV2n.js")).then(a=>a.d),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeInstallGuide}))),k0=3;function C0({messages:a,latestInput:u,onOptionClick:r,installedNodes:d,onAddMessage:f,loading:h,isActive:m}){const{isAutoScroll:x}=bn(),[v,I]=k.useState(0),[_,S]=k.useState([]),j=k.useRef(null),M=k.useRef(0),P=k.useRef(0),R=k.useRef(!1);k.useEffect(()=>{const w=j.current;if(!w)return;const B=()=>{j.current&&(x.current=w.scrollHeight-w.scrollTop-w.clientHeight<=10),P.current=w.scrollHeight};return w.addEventListener("scroll",B),()=>w.removeEventListener("scroll",B)},[]);const D=()=>{j?.current&&x.current&&(j.current.scrollTop=j.current.scrollHeight)},F=w=>{if(w.role==="user")return i.jsx(Jm,{content:w.content,trace_id:w.trace_id},w.id);if(w.role==="showcase")return i.jsx(_0,{});if(w.role==="ai"||w.role==="tool"){const B=w0(w.role);try{const V=JSON.parse(w.content),de=V.ext?.find(te=>te.type==="workflow"),z=V.ext?.find(te=>te.type==="node"),le=V.ext?.find(te=>te.type==="downstream_subgraph_search"),$e=V.ext?.find(te=>te.type==="node_install_guide");let U=null;if(de)U=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(S0,{content:w.content,name:w.name,avatar:B,latestInput:u,installedNodes:d,onAddMessage:f,onFinishLoad:D})});else if(z)U=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(N0,{content:w.content,name:w.name,avatar:B,installedNodes:d,onFinishLoad:D})});else if(le){const te=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(I0,{content:w.content,name:w.name,avatar:B,onAddMessage:f,onFinishLoad:D})});if(w.metadata?.intent==="downstream_subgraph_search")return i.jsx(gs,{content:w.content,name:w.name,avatar:B,format:w.format,onOptionClick:r,extComponent:te,metadata:w.metadata},w.id);U=te}else $e&&(U=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(j0,{content:w.content,onLoadSubgraph:()=>{if(w.metadata?.pendingSubgraph){const te=Object.values(Te.canvas.selected_nodes)[0];if(te){const fe=w.metadata.pendingSubgraph,ne=fe.json.nodes,ve=fe.json.links,be=ne.find($=>$.id===0),H=be?.id,re={};H&&(re[H]=te),Te.canvas.emitBeforeChange();try{for(const $ of ne)if($.id!==H){const Y=be?.pos||[0,0],we=te._pos||[0,0],Ee=[$.pos[0]+we[0]-Y[0],$.pos[1]+we[1]-Y[1]];re[$.id]=Vm($.type,{pos:Ee})}}finally{Te.canvas.emitAfterChange()}for(const $ of ve){const Y=re[$.origin_id],we=re[$.target_id];Y&&we&&Y.connect($.origin_slot,we,$.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(w.metadata?.pendingWorkflow){const te=w.metadata.pendingWorkflow,fe=w.metadata.optimizedParams;if(te.nodes)Te.loadGraphData(te);else{Te.loadApiJson(te);const ve=Object.keys(te),be=Object.keys(Te.graph._nodes_by_id)[0],H=Te.graph._nodes_by_id[be],re=H?H.pos[0]:0,$=H?H.pos[1]:0,Y=250,we=60,Ee=20,Oe=60,je=50,Ze=1e3;let zt=re,ct=$,Qe=0;for(const qt of ve){const Fe=Te.graph._nodes_by_id[qt];if(Fe){Qe>Ze&&(zt+=Y+Oe,Qe=0,ct=$);const Mt=Fe.inputs?Fe.inputs.length:0,Tt=Fe.outputs?Fe.outputs.length:0,et=Fe.widgets?Fe.widgets.length:0,mt=Math.max(Mt,Tt)+et,Jt=Ee*mt+we;Fe.size[0]=Y,Fe.size[1]=Jt,Fe.pos[0]=zt,Fe.pos[1]=ct,Qe+=Jt+je,ct+=Jt+je}}}for(const[ve,be,H,re,$]of fe){const Y=Te.graph._nodes_by_id[ve].widgets;for(const we of Y)we.name===re&&(we.value=$)}Te.graph.setDirtyCanvas(!1,!0);const ne={id:Xe(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};f?.(ne)}},onFinishLoad:D})}));return V.text||U?i.jsx(gs,{content:w.content,name:w.name,avatar:B,format:w.format,onOptionClick:r,extComponent:U,metadata:w.metadata},w.id):U||i.jsx(gs,{content:w.content,name:w.name,avatar:B,format:w.format,onOptionClick:r,metadata:w.metadata},w.id)}catch(V){return console.error("[MessageList] Error parsing message content:",V),console.error("解析JSON失败",w.content),i.jsx(gs,{content:w.content,name:w.name,avatar:B,format:w.format,onOptionClick:r,metadata:w.metadata},w.id)}}return null},G=w=>{const B=w?.buttonStatus==="not_used";return i.jsx("div",{className:"flex justify-center items-center",children:B?i.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:ae,children:"Load more"}):i.jsx("div",{className:"w-full h-[24px] bg-transparent"})},w.id)};function Z(w){return w&&typeof w=="object"&&w.buttonType==="loadmore"}const ae=()=>{R.current=!0,I(w=>w+1)};return k.useEffect(()=>{let w=[];if(M.current>0&&M.current<a.length)w=a.slice(M.current),a[M.current].role==="user"&&w.unshift({id:`${a[M.current].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),S(B=>[...B,...w]);else{let B=0,V=a?.length;for(let de=a?.length-1;de>=0;de--)if(a[de].role==="ai"||de===0)if(B>k0+v){w.unshift({id:`${a[de].id}_loadmore`,buttonType:"loadmore",buttonStatus:"not_used"});break}else B++,w?.length>0&&w.unshift({id:`${a[de].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),w=[...a?.slice(Math.min(V,de===0?de:de+1),V+1),...w],V=de;S(w)}M.current=a.length},[a,v]),k.useLayoutEffect(()=>{j?.current&&(R.current?(j.current.scrollTop=j.current.scrollHeight-P.current,R.current=!1):x.current&&(j.current.scrollTop=j.current.scrollHeight),P.current=j.current.scrollHeight)},[_]),i.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:j,style:{display:m?"block":"none"},children:[_?.map(w=>!!w&&(Z(w)?G(w):F(w))),h&&i.jsx(b0,{})]})}async function A0(){try{return await(await vr.fetchApi("/object_info",{method:"GET"})).json()}catch(a){throw console.error("Error fetching object info:",a),a}}async function E0(){const a=await A0();return Object.keys(a)}async function L0(a){return await(await vr.fetchApi("/prompt",{method:"POST",body:JSON.stringify(a)})).json()}async function M0(a){try{const u=await vr.fetchApi("/queue",{method:"POST",body:JSON.stringify(a)});if(!u.ok)throw new Error(`Failed to manage queue: ${u.status} ${u.statusText}`);return u}catch(u){throw console.error("Error managing queue:",u),u}}async function T0(){try{const a=await vr.fetchApi("/interrupt",{method:"POST"});if(!a.ok)throw new Error(`Failed to interrupt processing: ${a.status} ${a.statusText}`);return a}catch(a){throw console.error("Error interrupting processing:",a),a}}async function O0(a){try{const u=await vr.fetchApi(`/history/${a}`,{method:"GET"});if(!u.ok)throw new Error(`Failed to fetch history: ${u.status} ${u.statusText}`);return await u.json()}catch(u){throw console.error("Error fetching history:",u),u}}var ps={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */ps.exports;(function(a,u){(function(){var r,d="4.17.21",f=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",m="Expected a function",x="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",I=500,_="__lodash_placeholder__",S=1,j=2,M=4,P=1,R=2,D=1,F=2,G=4,Z=8,ae=16,w=32,B=64,V=128,de=256,z=512,le=30,$e="...",U=800,te=16,fe=1,ne=2,ve=3,be=1/0,H=9007199254740991,re=17976931348623157e292,$=NaN,Y=4294967295,we=Y-1,Ee=Y>>>1,Oe=[["ary",V],["bind",D],["bindKey",F],["curry",Z],["curryRight",ae],["flip",z],["partial",w],["partialRight",B],["rearg",de]],je="[object Arguments]",Ze="[object Array]",zt="[object AsyncFunction]",ct="[object Boolean]",Qe="[object Date]",qt="[object DOMException]",Fe="[object Error]",Mt="[object Function]",Tt="[object GeneratorFunction]",et="[object Map]",mt="[object Number]",Jt="[object Null]",ut="[object Object]",Vt="[object Promise]",Ln="[object Proxy]",Ut="[object RegExp]",tt="[object Set]",$t="[object String]",Ot="[object Symbol]",on="[object Undefined]",q="[object WeakMap]",ce="[object WeakSet]",ye="[object ArrayBuffer]",Se="[object DataView]",He="[object Float32Array]",Le="[object Float64Array]",De="[object Int8Array]",Pe="[object Int16Array]",Ve="[object Int32Array]",Pt="[object Uint8Array]",wt="[object Uint8ClampedArray]",yn="[object Uint16Array]",Xn="[object Uint32Array]",bs=/\b__p \+= '';/g,ys=/\b(__p \+=) '' \+/g,vs=/(__e\(.*?\)|\b__t\)) \+\n'';/g,_r=/&(?:amp|lt|gt|quot|#39);/g,wr=/[&<>"']/g,_s=RegExp(_r.source),ws=RegExp(wr.source),Sr=/<%-([\s\S]+?)%>/g,Ss=/<%([\s\S]+?)%>/g,Nr=/<%=([\s\S]+?)%>/g,Ns=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Be=/^\w*$/,Is=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mn=/[\\^$.*+?()[\]{}|]/g,Zn=RegExp(Mn.source),Qn=/^\s+/,js=/\s/,an=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ks=/\{\n\/\* \[wrapped with (.+)\] \*/,Cs=/,? & /,As=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ir=/[()=,{}\[\]\/\s]/,er=/\\(\\)?/g,jr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,tr=/\w*$/,kr=/^[-+]0x[0-9a-f]+$/i,vn=/^0b[01]+$/i,Es=/^\[object .+?Constructor\]$/,ln=/^0o[0-7]+$/i,Tn=/^(?:0|[1-9]\d*)$/,L=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,O=/($^)/,_e=/['\n\r\u2028\u2029\\]/g,ze="\\ud800-\\udfff",St="\\u0300-\\u036f",On="\\ufe20-\\ufe2f",Dl="\\u20d0-\\u20ff",Ki=St+On+Dl,Hi="\\u2700-\\u27bf",qi="a-z\\xdf-\\xf6\\xf8-\\xff",Wl="\\xac\\xb1\\xd7\\xf7",Fl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Bl="\\u2000-\\u206f",zl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ji="A-Z\\xc0-\\xd6\\xd8-\\xde",Vi="\\ufe0e\\ufe0f",Yi=Wl+Fl+Bl+zl,Ls="['’]",Ul="["+ze+"]",Xi="["+Yi+"]",Cr="["+Ki+"]",Zi="\\d+",$l="["+Hi+"]",Qi="["+qi+"]",eo="[^"+ze+Yi+Zi+Hi+qi+Ji+"]",Ms="\\ud83c[\\udffb-\\udfff]",Gl="(?:"+Cr+"|"+Ms+")",to="[^"+ze+"]",Ts="(?:\\ud83c[\\udde6-\\uddff]){2}",Os="[\\ud800-\\udbff][\\udc00-\\udfff]",Pn="["+Ji+"]",no="\\u200d",ro="(?:"+Qi+"|"+eo+")",Kl="(?:"+Pn+"|"+eo+")",so="(?:"+Ls+"(?:d|ll|m|re|s|t|ve))?",io="(?:"+Ls+"(?:D|LL|M|RE|S|T|VE))?",oo=Gl+"?",ao="["+Vi+"]?",Hl="(?:"+no+"(?:"+[to,Ts,Os].join("|")+")"+ao+oo+")*",ql="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Jl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lo=ao+oo+Hl,Vl="(?:"+[$l,Ts,Os].join("|")+")"+lo,Yl="(?:"+[to+Cr+"?",Cr,Ts,Os,Ul].join("|")+")",Xl=RegExp(Ls,"g"),Zl=RegExp(Cr,"g"),Ps=RegExp(Ms+"(?="+Ms+")|"+Yl+lo,"g"),Ql=RegExp([Pn+"?"+Qi+"+"+so+"(?="+[Xi,Pn,"$"].join("|")+")",Kl+"+"+io+"(?="+[Xi,Pn+ro,"$"].join("|")+")",Pn+"?"+ro+"+"+so,Pn+"+"+io,Jl,ql,Zi,Vl].join("|"),"g"),ec=RegExp("["+no+ze+Ki+Vi+"]"),tc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rc=-1,Me={};Me[He]=Me[Le]=Me[De]=Me[Pe]=Me[Ve]=Me[Pt]=Me[wt]=Me[yn]=Me[Xn]=!0,Me[je]=Me[Ze]=Me[ye]=Me[ct]=Me[Se]=Me[Qe]=Me[Fe]=Me[Mt]=Me[et]=Me[mt]=Me[ut]=Me[Ut]=Me[tt]=Me[$t]=Me[q]=!1;var Ae={};Ae[je]=Ae[Ze]=Ae[ye]=Ae[Se]=Ae[ct]=Ae[Qe]=Ae[He]=Ae[Le]=Ae[De]=Ae[Pe]=Ae[Ve]=Ae[et]=Ae[mt]=Ae[ut]=Ae[Ut]=Ae[tt]=Ae[$t]=Ae[Ot]=Ae[Pt]=Ae[wt]=Ae[yn]=Ae[Xn]=!0,Ae[Fe]=Ae[Mt]=Ae[q]=!1;var sc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},ic={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},oc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ac={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},lc=parseFloat,cc=parseInt,co=typeof xr=="object"&&xr&&xr.Object===Object&&xr,uc=typeof self=="object"&&self&&self.Object===Object&&self,nt=co||uc||Function("return this")(),Rs=u&&!u.nodeType&&u,_n=Rs&&!0&&a&&!a.nodeType&&a,uo=_n&&_n.exports===Rs,Ds=uo&&co.process,Nt=function(){try{var b=_n&&_n.require&&_n.require("util").types;return b||Ds&&Ds.binding&&Ds.binding("util")}catch{}}(),fo=Nt&&Nt.isArrayBuffer,ho=Nt&&Nt.isDate,go=Nt&&Nt.isMap,mo=Nt&&Nt.isRegExp,po=Nt&&Nt.isSet,xo=Nt&&Nt.isTypedArray;function pt(b,C,N){switch(N.length){case 0:return b.call(C);case 1:return b.call(C,N[0]);case 2:return b.call(C,N[0],N[1]);case 3:return b.call(C,N[0],N[1],N[2])}return b.apply(C,N)}function dc(b,C,N,K){for(var se=-1,Ne=b==null?0:b.length;++se<Ne;){var qe=b[se];C(K,qe,N(qe),b)}return K}function It(b,C){for(var N=-1,K=b==null?0:b.length;++N<K&&C(b[N],N,b)!==!1;);return b}function fc(b,C){for(var N=b==null?0:b.length;N--&&C(b[N],N,b)!==!1;);return b}function bo(b,C){for(var N=-1,K=b==null?0:b.length;++N<K;)if(!C(b[N],N,b))return!1;return!0}function cn(b,C){for(var N=-1,K=b==null?0:b.length,se=0,Ne=[];++N<K;){var qe=b[N];C(qe,N,b)&&(Ne[se++]=qe)}return Ne}function Ar(b,C){var N=b==null?0:b.length;return!!N&&Rn(b,C,0)>-1}function Ws(b,C,N){for(var K=-1,se=b==null?0:b.length;++K<se;)if(N(C,b[K]))return!0;return!1}function Re(b,C){for(var N=-1,K=b==null?0:b.length,se=Array(K);++N<K;)se[N]=C(b[N],N,b);return se}function un(b,C){for(var N=-1,K=C.length,se=b.length;++N<K;)b[se+N]=C[N];return b}function Fs(b,C,N,K){var se=-1,Ne=b==null?0:b.length;for(K&&Ne&&(N=b[++se]);++se<Ne;)N=C(N,b[se],se,b);return N}function hc(b,C,N,K){var se=b==null?0:b.length;for(K&&se&&(N=b[--se]);se--;)N=C(N,b[se],se,b);return N}function Bs(b,C){for(var N=-1,K=b==null?0:b.length;++N<K;)if(C(b[N],N,b))return!0;return!1}var gc=zs("length");function mc(b){return b.split("")}function pc(b){return b.match(As)||[]}function yo(b,C,N){var K;return N(b,function(se,Ne,qe){if(C(se,Ne,qe))return K=Ne,!1}),K}function Er(b,C,N,K){for(var se=b.length,Ne=N+(K?1:-1);K?Ne--:++Ne<se;)if(C(b[Ne],Ne,b))return Ne;return-1}function Rn(b,C,N){return C===C?Cc(b,C,N):Er(b,vo,N)}function xc(b,C,N,K){for(var se=N-1,Ne=b.length;++se<Ne;)if(K(b[se],C))return se;return-1}function vo(b){return b!==b}function _o(b,C){var N=b==null?0:b.length;return N?$s(b,C)/N:$}function zs(b){return function(C){return C==null?r:C[b]}}function Us(b){return function(C){return b==null?r:b[C]}}function wo(b,C,N,K,se){return se(b,function(Ne,qe,Ce){N=K?(K=!1,Ne):C(N,Ne,qe,Ce)}),N}function bc(b,C){var N=b.length;for(b.sort(C);N--;)b[N]=b[N].value;return b}function $s(b,C){for(var N,K=-1,se=b.length;++K<se;){var Ne=C(b[K]);Ne!==r&&(N=N===r?Ne:N+Ne)}return N}function Gs(b,C){for(var N=-1,K=Array(b);++N<b;)K[N]=C(N);return K}function yc(b,C){return Re(C,function(N){return[N,b[N]]})}function So(b){return b&&b.slice(0,ko(b)+1).replace(Qn,"")}function xt(b){return function(C){return b(C)}}function Ks(b,C){return Re(C,function(N){return b[N]})}function nr(b,C){return b.has(C)}function No(b,C){for(var N=-1,K=b.length;++N<K&&Rn(C,b[N],0)>-1;);return N}function Io(b,C){for(var N=b.length;N--&&Rn(C,b[N],0)>-1;);return N}function vc(b,C){for(var N=b.length,K=0;N--;)b[N]===C&&++K;return K}var _c=Us(sc),wc=Us(ic);function Sc(b){return"\\"+ac[b]}function Nc(b,C){return b==null?r:b[C]}function Dn(b){return ec.test(b)}function Ic(b){return tc.test(b)}function jc(b){for(var C,N=[];!(C=b.next()).done;)N.push(C.value);return N}function Hs(b){var C=-1,N=Array(b.size);return b.forEach(function(K,se){N[++C]=[se,K]}),N}function jo(b,C){return function(N){return b(C(N))}}function dn(b,C){for(var N=-1,K=b.length,se=0,Ne=[];++N<K;){var qe=b[N];(qe===C||qe===_)&&(b[N]=_,Ne[se++]=N)}return Ne}function Lr(b){var C=-1,N=Array(b.size);return b.forEach(function(K){N[++C]=K}),N}function kc(b){var C=-1,N=Array(b.size);return b.forEach(function(K){N[++C]=[K,K]}),N}function Cc(b,C,N){for(var K=N-1,se=b.length;++K<se;)if(b[K]===C)return K;return-1}function Ac(b,C,N){for(var K=N+1;K--;)if(b[K]===C)return K;return K}function Wn(b){return Dn(b)?Lc(b):gc(b)}function Rt(b){return Dn(b)?Mc(b):mc(b)}function ko(b){for(var C=b.length;C--&&js.test(b.charAt(C)););return C}var Ec=Us(oc);function Lc(b){for(var C=Ps.lastIndex=0;Ps.test(b);)++C;return C}function Mc(b){return b.match(Ps)||[]}function Tc(b){return b.match(Ql)||[]}var Oc=function b(C){C=C==null?nt:Fn.defaults(nt.Object(),C,Fn.pick(nt,nc));var N=C.Array,K=C.Date,se=C.Error,Ne=C.Function,qe=C.Math,Ce=C.Object,qs=C.RegExp,Pc=C.String,jt=C.TypeError,Mr=N.prototype,Rc=Ne.prototype,Bn=Ce.prototype,Tr=C["__core-js_shared__"],Or=Rc.toString,ke=Bn.hasOwnProperty,Dc=0,Co=function(){var e=/[^.]+$/.exec(Tr&&Tr.keys&&Tr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pr=Bn.toString,Wc=Or.call(Ce),Fc=nt._,Bc=qs("^"+Or.call(ke).replace(Mn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rr=uo?C.Buffer:r,fn=C.Symbol,Dr=C.Uint8Array,Ao=Rr?Rr.allocUnsafe:r,Wr=jo(Ce.getPrototypeOf,Ce),Eo=Ce.create,Lo=Bn.propertyIsEnumerable,Fr=Mr.splice,Mo=fn?fn.isConcatSpreadable:r,rr=fn?fn.iterator:r,wn=fn?fn.toStringTag:r,Br=function(){try{var e=kn(Ce,"defineProperty");return e({},"",{}),e}catch{}}(),zc=C.clearTimeout!==nt.clearTimeout&&C.clearTimeout,Uc=K&&K.now!==nt.Date.now&&K.now,$c=C.setTimeout!==nt.setTimeout&&C.setTimeout,zr=qe.ceil,Ur=qe.floor,Js=Ce.getOwnPropertySymbols,Gc=Rr?Rr.isBuffer:r,To=C.isFinite,Kc=Mr.join,Hc=jo(Ce.keys,Ce),Je=qe.max,st=qe.min,qc=K.now,Jc=C.parseInt,Oo=qe.random,Vc=Mr.reverse,Vs=kn(C,"DataView"),sr=kn(C,"Map"),Ys=kn(C,"Promise"),zn=kn(C,"Set"),ir=kn(C,"WeakMap"),or=kn(Ce,"create"),$r=ir&&new ir,Un={},Yc=Cn(Vs),Xc=Cn(sr),Zc=Cn(Ys),Qc=Cn(zn),eu=Cn(ir),Gr=fn?fn.prototype:r,ar=Gr?Gr.valueOf:r,Po=Gr?Gr.toString:r;function l(e){if(Ue(e)&&!ie(e)&&!(e instanceof pe)){if(e instanceof kt)return e;if(ke.call(e,"__wrapped__"))return Ra(e)}return new kt(e)}var $n=function(){function e(){}return function(t){if(!We(t))return{};if(Eo)return Eo(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Kr(){}function kt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:Sr,evaluate:Ss,interpolate:Nr,variable:"",imports:{_:l}},l.prototype=Kr.prototype,l.prototype.constructor=l,kt.prototype=$n(Kr.prototype),kt.prototype.constructor=kt;function pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Y,this.__views__=[]}function tu(){var e=new pe(this.__wrapped__);return e.__actions__=dt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=dt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=dt(this.__views__),e}function nu(){if(this.__filtered__){var e=new pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ru(){var e=this.__wrapped__.value(),t=this.__dir__,n=ie(e),s=t<0,o=n?e.length:0,c=md(0,o,this.__views__),g=c.start,p=c.end,y=p-g,A=s?p:g-1,E=this.__iteratees__,T=E.length,W=0,J=st(y,this.__takeCount__);if(!n||!s&&o==y&&J==y)return ia(e,this.__actions__);var Q=[];e:for(;y--&&W<J;){A+=t;for(var ue=-1,ee=e[A];++ue<T;){var me=E[ue],xe=me.iteratee,vt=me.type,lt=xe(ee);if(vt==ne)ee=lt;else if(!lt){if(vt==fe)continue e;break e}}Q[W++]=ee}return Q}pe.prototype=$n(Kr.prototype),pe.prototype.constructor=pe;function Sn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function su(){this.__data__=or?or(null):{},this.size=0}function iu(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function ou(e){var t=this.__data__;if(or){var n=t[e];return n===v?r:n}return ke.call(t,e)?t[e]:r}function au(e){var t=this.__data__;return or?t[e]!==r:ke.call(t,e)}function lu(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=or&&t===r?v:t,this}Sn.prototype.clear=su,Sn.prototype.delete=iu,Sn.prototype.get=ou,Sn.prototype.has=au,Sn.prototype.set=lu;function Yt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function cu(){this.__data__=[],this.size=0}function uu(e){var t=this.__data__,n=Hr(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Fr.call(t,n,1),--this.size,!0}function du(e){var t=this.__data__,n=Hr(t,e);return n<0?r:t[n][1]}function fu(e){return Hr(this.__data__,e)>-1}function hu(e,t){var n=this.__data__,s=Hr(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}Yt.prototype.clear=cu,Yt.prototype.delete=uu,Yt.prototype.get=du,Yt.prototype.has=fu,Yt.prototype.set=hu;function Xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function gu(){this.size=0,this.__data__={hash:new Sn,map:new(sr||Yt),string:new Sn}}function mu(e){var t=ss(this,e).delete(e);return this.size-=t?1:0,t}function pu(e){return ss(this,e).get(e)}function xu(e){return ss(this,e).has(e)}function bu(e,t){var n=ss(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}Xt.prototype.clear=gu,Xt.prototype.delete=mu,Xt.prototype.get=pu,Xt.prototype.has=xu,Xt.prototype.set=bu;function Nn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Xt;++t<n;)this.add(e[t])}function yu(e){return this.__data__.set(e,v),this}function vu(e){return this.__data__.has(e)}Nn.prototype.add=Nn.prototype.push=yu,Nn.prototype.has=vu;function Dt(e){var t=this.__data__=new Yt(e);this.size=t.size}function _u(){this.__data__=new Yt,this.size=0}function wu(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Su(e){return this.__data__.get(e)}function Nu(e){return this.__data__.has(e)}function Iu(e,t){var n=this.__data__;if(n instanceof Yt){var s=n.__data__;if(!sr||s.length<f-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xt(s)}return n.set(e,t),this.size=n.size,this}Dt.prototype.clear=_u,Dt.prototype.delete=wu,Dt.prototype.get=Su,Dt.prototype.has=Nu,Dt.prototype.set=Iu;function Ro(e,t){var n=ie(e),s=!n&&An(e),o=!n&&!s&&xn(e),c=!n&&!s&&!o&&qn(e),g=n||s||o||c,p=g?Gs(e.length,Pc):[],y=p.length;for(var A in e)(t||ke.call(e,A))&&!(g&&(A=="length"||o&&(A=="offset"||A=="parent")||c&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||tn(A,y)))&&p.push(A);return p}function Do(e){var t=e.length;return t?e[ai(0,t-1)]:r}function ju(e,t){return is(dt(e),In(t,0,e.length))}function ku(e){return is(dt(e))}function Xs(e,t,n){(n!==r&&!Wt(e[t],n)||n===r&&!(t in e))&&Zt(e,t,n)}function lr(e,t,n){var s=e[t];(!(ke.call(e,t)&&Wt(s,n))||n===r&&!(t in e))&&Zt(e,t,n)}function Hr(e,t){for(var n=e.length;n--;)if(Wt(e[n][0],t))return n;return-1}function Cu(e,t,n,s){return hn(e,function(o,c,g){t(s,o,n(o),g)}),s}function Wo(e,t){return e&&Kt(t,Ye(t),e)}function Au(e,t){return e&&Kt(t,ht(t),e)}function Zt(e,t,n){t=="__proto__"&&Br?Br(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Zs(e,t){for(var n=-1,s=t.length,o=N(s),c=e==null;++n<s;)o[n]=c?r:Mi(e,t[n]);return o}function In(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Ct(e,t,n,s,o,c){var g,p=t&S,y=t&j,A=t&M;if(n&&(g=o?n(e,s,o,c):n(e)),g!==r)return g;if(!We(e))return e;var E=ie(e);if(E){if(g=xd(e),!p)return dt(e,g)}else{var T=it(e),W=T==Mt||T==Tt;if(xn(e))return la(e,p);if(T==ut||T==je||W&&!o){if(g=y||W?{}:ka(e),!p)return y?od(e,Au(g,e)):id(e,Wo(g,e))}else{if(!Ae[T])return o?e:{};g=bd(e,T,p)}}c||(c=new Dt);var J=c.get(e);if(J)return J;c.set(e,g),nl(e)?e.forEach(function(ee){g.add(Ct(ee,t,n,ee,e,c))}):el(e)&&e.forEach(function(ee,me){g.set(me,Ct(ee,t,n,me,e,c))});var Q=A?y?bi:xi:y?ht:Ye,ue=E?r:Q(e);return It(ue||e,function(ee,me){ue&&(me=ee,ee=e[me]),lr(g,me,Ct(ee,t,n,me,e,c))}),g}function Eu(e){var t=Ye(e);return function(n){return Fo(n,e,t)}}function Fo(e,t,n){var s=n.length;if(e==null)return!s;for(e=Ce(e);s--;){var o=n[s],c=t[o],g=e[o];if(g===r&&!(o in e)||!c(g))return!1}return!0}function Bo(e,t,n){if(typeof e!="function")throw new jt(m);return mr(function(){e.apply(r,n)},t)}function cr(e,t,n,s){var o=-1,c=Ar,g=!0,p=e.length,y=[],A=t.length;if(!p)return y;n&&(t=Re(t,xt(n))),s?(c=Ws,g=!1):t.length>=f&&(c=nr,g=!1,t=new Nn(t));e:for(;++o<p;){var E=e[o],T=n==null?E:n(E);if(E=s||E!==0?E:0,g&&T===T){for(var W=A;W--;)if(t[W]===T)continue e;y.push(E)}else c(t,T,s)||y.push(E)}return y}var hn=ha(Gt),zo=ha(ei,!0);function Lu(e,t){var n=!0;return hn(e,function(s,o,c){return n=!!t(s,o,c),n}),n}function qr(e,t,n){for(var s=-1,o=e.length;++s<o;){var c=e[s],g=t(c);if(g!=null&&(p===r?g===g&&!yt(g):n(g,p)))var p=g,y=c}return y}function Mu(e,t,n,s){var o=e.length;for(n=oe(n),n<0&&(n=-n>o?0:o+n),s=s===r||s>o?o:oe(s),s<0&&(s+=o),s=n>s?0:sl(s);n<s;)e[n++]=t;return e}function Uo(e,t){var n=[];return hn(e,function(s,o,c){t(s,o,c)&&n.push(s)}),n}function rt(e,t,n,s,o){var c=-1,g=e.length;for(n||(n=vd),o||(o=[]);++c<g;){var p=e[c];t>0&&n(p)?t>1?rt(p,t-1,n,s,o):un(o,p):s||(o[o.length]=p)}return o}var Qs=ga(),$o=ga(!0);function Gt(e,t){return e&&Qs(e,t,Ye)}function ei(e,t){return e&&$o(e,t,Ye)}function Jr(e,t){return cn(t,function(n){return nn(e[n])})}function jn(e,t){t=mn(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[Ht(t[n++])];return n&&n==s?e:r}function Go(e,t,n){var s=t(e);return ie(e)?s:un(s,n(e))}function ot(e){return e==null?e===r?on:Jt:wn&&wn in Ce(e)?gd(e):kd(e)}function ti(e,t){return e>t}function Tu(e,t){return e!=null&&ke.call(e,t)}function Ou(e,t){return e!=null&&t in Ce(e)}function Pu(e,t,n){return e>=st(t,n)&&e<Je(t,n)}function ni(e,t,n){for(var s=n?Ws:Ar,o=e[0].length,c=e.length,g=c,p=N(c),y=1/0,A=[];g--;){var E=e[g];g&&t&&(E=Re(E,xt(t))),y=st(E.length,y),p[g]=!n&&(t||o>=120&&E.length>=120)?new Nn(g&&E):r}E=e[0];var T=-1,W=p[0];e:for(;++T<o&&A.length<y;){var J=E[T],Q=t?t(J):J;if(J=n||J!==0?J:0,!(W?nr(W,Q):s(A,Q,n))){for(g=c;--g;){var ue=p[g];if(!(ue?nr(ue,Q):s(e[g],Q,n)))continue e}W&&W.push(Q),A.push(J)}}return A}function Ru(e,t,n,s){return Gt(e,function(o,c,g){t(s,n(o),c,g)}),s}function ur(e,t,n){t=mn(t,e),e=La(e,t);var s=e==null?e:e[Ht(Et(t))];return s==null?r:pt(s,e,n)}function Ko(e){return Ue(e)&&ot(e)==je}function Du(e){return Ue(e)&&ot(e)==ye}function Wu(e){return Ue(e)&&ot(e)==Qe}function dr(e,t,n,s,o){return e===t?!0:e==null||t==null||!Ue(e)&&!Ue(t)?e!==e&&t!==t:Fu(e,t,n,s,dr,o)}function Fu(e,t,n,s,o,c){var g=ie(e),p=ie(t),y=g?Ze:it(e),A=p?Ze:it(t);y=y==je?ut:y,A=A==je?ut:A;var E=y==ut,T=A==ut,W=y==A;if(W&&xn(e)){if(!xn(t))return!1;g=!0,E=!1}if(W&&!E)return c||(c=new Dt),g||qn(e)?Na(e,t,n,s,o,c):fd(e,t,y,n,s,o,c);if(!(n&P)){var J=E&&ke.call(e,"__wrapped__"),Q=T&&ke.call(t,"__wrapped__");if(J||Q){var ue=J?e.value():e,ee=Q?t.value():t;return c||(c=new Dt),o(ue,ee,n,s,c)}}return W?(c||(c=new Dt),hd(e,t,n,s,o,c)):!1}function Bu(e){return Ue(e)&&it(e)==et}function ri(e,t,n,s){var o=n.length,c=o,g=!s;if(e==null)return!c;for(e=Ce(e);o--;){var p=n[o];if(g&&p[2]?p[1]!==e[p[0]]:!(p[0]in e))return!1}for(;++o<c;){p=n[o];var y=p[0],A=e[y],E=p[1];if(g&&p[2]){if(A===r&&!(y in e))return!1}else{var T=new Dt;if(s)var W=s(A,E,y,e,t,T);if(!(W===r?dr(E,A,P|R,s,T):W))return!1}}return!0}function Ho(e){if(!We(e)||wd(e))return!1;var t=nn(e)?Bc:Es;return t.test(Cn(e))}function zu(e){return Ue(e)&&ot(e)==Ut}function Uu(e){return Ue(e)&&it(e)==tt}function $u(e){return Ue(e)&&ds(e.length)&&!!Me[ot(e)]}function qo(e){return typeof e=="function"?e:e==null?gt:typeof e=="object"?ie(e)?Yo(e[0],e[1]):Vo(e):ml(e)}function si(e){if(!gr(e))return Hc(e);var t=[];for(var n in Ce(e))ke.call(e,n)&&n!="constructor"&&t.push(n);return t}function Gu(e){if(!We(e))return jd(e);var t=gr(e),n=[];for(var s in e)s=="constructor"&&(t||!ke.call(e,s))||n.push(s);return n}function ii(e,t){return e<t}function Jo(e,t){var n=-1,s=ft(e)?N(e.length):[];return hn(e,function(o,c,g){s[++n]=t(o,c,g)}),s}function Vo(e){var t=vi(e);return t.length==1&&t[0][2]?Aa(t[0][0],t[0][1]):function(n){return n===e||ri(n,e,t)}}function Yo(e,t){return wi(e)&&Ca(t)?Aa(Ht(e),t):function(n){var s=Mi(n,e);return s===r&&s===t?Ti(n,e):dr(t,s,P|R)}}function Vr(e,t,n,s,o){e!==t&&Qs(t,function(c,g){if(o||(o=new Dt),We(c))Ku(e,t,g,n,Vr,s,o);else{var p=s?s(Ni(e,g),c,g+"",e,t,o):r;p===r&&(p=c),Xs(e,g,p)}},ht)}function Ku(e,t,n,s,o,c,g){var p=Ni(e,n),y=Ni(t,n),A=g.get(y);if(A){Xs(e,n,A);return}var E=c?c(p,y,n+"",e,t,g):r,T=E===r;if(T){var W=ie(y),J=!W&&xn(y),Q=!W&&!J&&qn(y);E=y,W||J||Q?ie(p)?E=p:Ge(p)?E=dt(p):J?(T=!1,E=la(y,!0)):Q?(T=!1,E=ca(y,!0)):E=[]:pr(y)||An(y)?(E=p,An(p)?E=il(p):(!We(p)||nn(p))&&(E=ka(y))):T=!1}T&&(g.set(y,E),o(E,y,s,c,g),g.delete(y)),Xs(e,n,E)}function Xo(e,t){var n=e.length;if(n)return t+=t<0?n:0,tn(t,n)?e[t]:r}function Zo(e,t,n){t.length?t=Re(t,function(c){return ie(c)?function(g){return jn(g,c.length===1?c[0]:c)}:c}):t=[gt];var s=-1;t=Re(t,xt(X()));var o=Jo(e,function(c,g,p){var y=Re(t,function(A){return A(c)});return{criteria:y,index:++s,value:c}});return bc(o,function(c,g){return sd(c,g,n)})}function Hu(e,t){return Qo(e,t,function(n,s){return Ti(e,s)})}function Qo(e,t,n){for(var s=-1,o=t.length,c={};++s<o;){var g=t[s],p=jn(e,g);n(p,g)&&fr(c,mn(g,e),p)}return c}function qu(e){return function(t){return jn(t,e)}}function oi(e,t,n,s){var o=s?xc:Rn,c=-1,g=t.length,p=e;for(e===t&&(t=dt(t)),n&&(p=Re(e,xt(n)));++c<g;)for(var y=0,A=t[c],E=n?n(A):A;(y=o(p,E,y,s))>-1;)p!==e&&Fr.call(p,y,1),Fr.call(e,y,1);return e}function ea(e,t){for(var n=e?t.length:0,s=n-1;n--;){var o=t[n];if(n==s||o!==c){var c=o;tn(o)?Fr.call(e,o,1):ui(e,o)}}return e}function ai(e,t){return e+Ur(Oo()*(t-e+1))}function Ju(e,t,n,s){for(var o=-1,c=Je(zr((t-e)/(n||1)),0),g=N(c);c--;)g[s?c:++o]=e,e+=n;return g}function li(e,t){var n="";if(!e||t<1||t>H)return n;do t%2&&(n+=e),t=Ur(t/2),t&&(e+=e);while(t);return n}function he(e,t){return Ii(Ea(e,t,gt),e+"")}function Vu(e){return Do(Jn(e))}function Yu(e,t){var n=Jn(e);return is(n,In(t,0,n.length))}function fr(e,t,n,s){if(!We(e))return e;t=mn(t,e);for(var o=-1,c=t.length,g=c-1,p=e;p!=null&&++o<c;){var y=Ht(t[o]),A=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(o!=g){var E=p[y];A=s?s(E,y,p):r,A===r&&(A=We(E)?E:tn(t[o+1])?[]:{})}lr(p,y,A),p=p[y]}return e}var ta=$r?function(e,t){return $r.set(e,t),e}:gt,Xu=Br?function(e,t){return Br(e,"toString",{configurable:!0,enumerable:!1,value:Pi(t),writable:!0})}:gt;function Zu(e){return is(Jn(e))}function At(e,t,n){var s=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var c=N(o);++s<o;)c[s]=e[s+t];return c}function Qu(e,t){var n;return hn(e,function(s,o,c){return n=t(s,o,c),!n}),!!n}function Yr(e,t,n){var s=0,o=e==null?s:e.length;if(typeof t=="number"&&t===t&&o<=Ee){for(;s<o;){var c=s+o>>>1,g=e[c];g!==null&&!yt(g)&&(n?g<=t:g<t)?s=c+1:o=c}return o}return ci(e,t,gt,n)}function ci(e,t,n,s){var o=0,c=e==null?0:e.length;if(c===0)return 0;t=n(t);for(var g=t!==t,p=t===null,y=yt(t),A=t===r;o<c;){var E=Ur((o+c)/2),T=n(e[E]),W=T!==r,J=T===null,Q=T===T,ue=yt(T);if(g)var ee=s||Q;else A?ee=Q&&(s||W):p?ee=Q&&W&&(s||!J):y?ee=Q&&W&&!J&&(s||!ue):J||ue?ee=!1:ee=s?T<=t:T<t;ee?o=E+1:c=E}return st(c,we)}function na(e,t){for(var n=-1,s=e.length,o=0,c=[];++n<s;){var g=e[n],p=t?t(g):g;if(!n||!Wt(p,y)){var y=p;c[o++]=g===0?0:g}}return c}function ra(e){return typeof e=="number"?e:yt(e)?$:+e}function bt(e){if(typeof e=="string")return e;if(ie(e))return Re(e,bt)+"";if(yt(e))return Po?Po.call(e):"";var t=e+"";return t=="0"&&1/e==-be?"-0":t}function gn(e,t,n){var s=-1,o=Ar,c=e.length,g=!0,p=[],y=p;if(n)g=!1,o=Ws;else if(c>=f){var A=t?null:ud(e);if(A)return Lr(A);g=!1,o=nr,y=new Nn}else y=t?[]:p;e:for(;++s<c;){var E=e[s],T=t?t(E):E;if(E=n||E!==0?E:0,g&&T===T){for(var W=y.length;W--;)if(y[W]===T)continue e;t&&y.push(T),p.push(E)}else o(y,T,n)||(y!==p&&y.push(T),p.push(E))}return p}function ui(e,t){return t=mn(t,e),e=La(e,t),e==null||delete e[Ht(Et(t))]}function sa(e,t,n,s){return fr(e,t,n(jn(e,t)),s)}function Xr(e,t,n,s){for(var o=e.length,c=s?o:-1;(s?c--:++c<o)&&t(e[c],c,e););return n?At(e,s?0:c,s?c+1:o):At(e,s?c+1:0,s?o:c)}function ia(e,t){var n=e;return n instanceof pe&&(n=n.value()),Fs(t,function(s,o){return o.func.apply(o.thisArg,un([s],o.args))},n)}function di(e,t,n){var s=e.length;if(s<2)return s?gn(e[0]):[];for(var o=-1,c=N(s);++o<s;)for(var g=e[o],p=-1;++p<s;)p!=o&&(c[o]=cr(c[o]||g,e[p],t,n));return gn(rt(c,1),t,n)}function oa(e,t,n){for(var s=-1,o=e.length,c=t.length,g={};++s<o;){var p=s<c?t[s]:r;n(g,e[s],p)}return g}function fi(e){return Ge(e)?e:[]}function hi(e){return typeof e=="function"?e:gt}function mn(e,t){return ie(e)?e:wi(e,t)?[e]:Pa(Ie(e))}var ed=he;function pn(e,t,n){var s=e.length;return n=n===r?s:n,!t&&n>=s?e:At(e,t,n)}var aa=zc||function(e){return nt.clearTimeout(e)};function la(e,t){if(t)return e.slice();var n=e.length,s=Ao?Ao(n):new e.constructor(n);return e.copy(s),s}function gi(e){var t=new e.constructor(e.byteLength);return new Dr(t).set(new Dr(e)),t}function td(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function nd(e){var t=new e.constructor(e.source,tr.exec(e));return t.lastIndex=e.lastIndex,t}function rd(e){return ar?Ce(ar.call(e)):{}}function ca(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ua(e,t){if(e!==t){var n=e!==r,s=e===null,o=e===e,c=yt(e),g=t!==r,p=t===null,y=t===t,A=yt(t);if(!p&&!A&&!c&&e>t||c&&g&&y&&!p&&!A||s&&g&&y||!n&&y||!o)return 1;if(!s&&!c&&!A&&e<t||A&&n&&o&&!s&&!c||p&&n&&o||!g&&o||!y)return-1}return 0}function sd(e,t,n){for(var s=-1,o=e.criteria,c=t.criteria,g=o.length,p=n.length;++s<g;){var y=ua(o[s],c[s]);if(y){if(s>=p)return y;var A=n[s];return y*(A=="desc"?-1:1)}}return e.index-t.index}function da(e,t,n,s){for(var o=-1,c=e.length,g=n.length,p=-1,y=t.length,A=Je(c-g,0),E=N(y+A),T=!s;++p<y;)E[p]=t[p];for(;++o<g;)(T||o<c)&&(E[n[o]]=e[o]);for(;A--;)E[p++]=e[o++];return E}function fa(e,t,n,s){for(var o=-1,c=e.length,g=-1,p=n.length,y=-1,A=t.length,E=Je(c-p,0),T=N(E+A),W=!s;++o<E;)T[o]=e[o];for(var J=o;++y<A;)T[J+y]=t[y];for(;++g<p;)(W||o<c)&&(T[J+n[g]]=e[o++]);return T}function dt(e,t){var n=-1,s=e.length;for(t||(t=N(s));++n<s;)t[n]=e[n];return t}function Kt(e,t,n,s){var o=!n;n||(n={});for(var c=-1,g=t.length;++c<g;){var p=t[c],y=s?s(n[p],e[p],p,n,e):r;y===r&&(y=e[p]),o?Zt(n,p,y):lr(n,p,y)}return n}function id(e,t){return Kt(e,_i(e),t)}function od(e,t){return Kt(e,Ia(e),t)}function Zr(e,t){return function(n,s){var o=ie(n)?dc:Cu,c=t?t():{};return o(n,e,X(s,2),c)}}function Gn(e){return he(function(t,n){var s=-1,o=n.length,c=o>1?n[o-1]:r,g=o>2?n[2]:r;for(c=e.length>3&&typeof c=="function"?(o--,c):r,g&&at(n[0],n[1],g)&&(c=o<3?r:c,o=1),t=Ce(t);++s<o;){var p=n[s];p&&e(t,p,s,c)}return t})}function ha(e,t){return function(n,s){if(n==null)return n;if(!ft(n))return e(n,s);for(var o=n.length,c=t?o:-1,g=Ce(n);(t?c--:++c<o)&&s(g[c],c,g)!==!1;);return n}}function ga(e){return function(t,n,s){for(var o=-1,c=Ce(t),g=s(t),p=g.length;p--;){var y=g[e?p:++o];if(n(c[y],y,c)===!1)break}return t}}function ad(e,t,n){var s=t&D,o=hr(e);function c(){var g=this&&this!==nt&&this instanceof c?o:e;return g.apply(s?n:this,arguments)}return c}function ma(e){return function(t){t=Ie(t);var n=Dn(t)?Rt(t):r,s=n?n[0]:t.charAt(0),o=n?pn(n,1).join(""):t.slice(1);return s[e]()+o}}function Kn(e){return function(t){return Fs(hl(fl(t).replace(Xl,"")),e,"")}}function hr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=$n(e.prototype),s=e.apply(n,t);return We(s)?s:n}}function ld(e,t,n){var s=hr(e);function o(){for(var c=arguments.length,g=N(c),p=c,y=Hn(o);p--;)g[p]=arguments[p];var A=c<3&&g[0]!==y&&g[c-1]!==y?[]:dn(g,y);if(c-=A.length,c<n)return va(e,t,Qr,o.placeholder,r,g,A,r,r,n-c);var E=this&&this!==nt&&this instanceof o?s:e;return pt(E,this,g)}return o}function pa(e){return function(t,n,s){var o=Ce(t);if(!ft(t)){var c=X(n,3);t=Ye(t),n=function(p){return c(o[p],p,o)}}var g=e(t,n,s);return g>-1?o[c?t[g]:g]:r}}function xa(e){return en(function(t){var n=t.length,s=n,o=kt.prototype.thru;for(e&&t.reverse();s--;){var c=t[s];if(typeof c!="function")throw new jt(m);if(o&&!g&&rs(c)=="wrapper")var g=new kt([],!0)}for(s=g?s:n;++s<n;){c=t[s];var p=rs(c),y=p=="wrapper"?yi(c):r;y&&Si(y[0])&&y[1]==(V|Z|w|de)&&!y[4].length&&y[9]==1?g=g[rs(y[0])].apply(g,y[3]):g=c.length==1&&Si(c)?g[p]():g.thru(c)}return function(){var A=arguments,E=A[0];if(g&&A.length==1&&ie(E))return g.plant(E).value();for(var T=0,W=n?t[T].apply(this,A):E;++T<n;)W=t[T].call(this,W);return W}})}function Qr(e,t,n,s,o,c,g,p,y,A){var E=t&V,T=t&D,W=t&F,J=t&(Z|ae),Q=t&z,ue=W?r:hr(e);function ee(){for(var me=arguments.length,xe=N(me),vt=me;vt--;)xe[vt]=arguments[vt];if(J)var lt=Hn(ee),_t=vc(xe,lt);if(s&&(xe=da(xe,s,o,J)),c&&(xe=fa(xe,c,g,J)),me-=_t,J&&me<A){var Ke=dn(xe,lt);return va(e,t,Qr,ee.placeholder,n,xe,Ke,p,y,A-me)}var Ft=T?n:this,sn=W?Ft[e]:e;return me=xe.length,p?xe=Cd(xe,p):Q&&me>1&&xe.reverse(),E&&y<me&&(xe.length=y),this&&this!==nt&&this instanceof ee&&(sn=ue||hr(sn)),sn.apply(Ft,xe)}return ee}function ba(e,t){return function(n,s){return Ru(n,e,t(s),{})}}function es(e,t){return function(n,s){var o;if(n===r&&s===r)return t;if(n!==r&&(o=n),s!==r){if(o===r)return s;typeof n=="string"||typeof s=="string"?(n=bt(n),s=bt(s)):(n=ra(n),s=ra(s)),o=e(n,s)}return o}}function mi(e){return en(function(t){return t=Re(t,xt(X())),he(function(n){var s=this;return e(t,function(o){return pt(o,s,n)})})})}function ts(e,t){t=t===r?" ":bt(t);var n=t.length;if(n<2)return n?li(t,e):t;var s=li(t,zr(e/Wn(t)));return Dn(t)?pn(Rt(s),0,e).join(""):s.slice(0,e)}function cd(e,t,n,s){var o=t&D,c=hr(e);function g(){for(var p=-1,y=arguments.length,A=-1,E=s.length,T=N(E+y),W=this&&this!==nt&&this instanceof g?c:e;++A<E;)T[A]=s[A];for(;y--;)T[A++]=arguments[++p];return pt(W,o?n:this,T)}return g}function ya(e){return function(t,n,s){return s&&typeof s!="number"&&at(t,n,s)&&(n=s=r),t=rn(t),n===r?(n=t,t=0):n=rn(n),s=s===r?t<n?1:-1:rn(s),Ju(t,n,s,e)}}function ns(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Lt(t),n=Lt(n)),e(t,n)}}function va(e,t,n,s,o,c,g,p,y,A){var E=t&Z,T=E?g:r,W=E?r:g,J=E?c:r,Q=E?r:c;t|=E?w:B,t&=~(E?B:w),t&G||(t&=-4);var ue=[e,t,o,J,T,Q,W,p,y,A],ee=n.apply(r,ue);return Si(e)&&Ma(ee,ue),ee.placeholder=s,Ta(ee,e,t)}function pi(e){var t=qe[e];return function(n,s){if(n=Lt(n),s=s==null?0:st(oe(s),292),s&&To(n)){var o=(Ie(n)+"e").split("e"),c=t(o[0]+"e"+(+o[1]+s));return o=(Ie(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-s))}return t(n)}}var ud=zn&&1/Lr(new zn([,-0]))[1]==be?function(e){return new zn(e)}:Wi;function _a(e){return function(t){var n=it(t);return n==et?Hs(t):n==tt?kc(t):yc(t,e(t))}}function Qt(e,t,n,s,o,c,g,p){var y=t&F;if(!y&&typeof e!="function")throw new jt(m);var A=s?s.length:0;if(A||(t&=-97,s=o=r),g=g===r?g:Je(oe(g),0),p=p===r?p:oe(p),A-=o?o.length:0,t&B){var E=s,T=o;s=o=r}var W=y?r:yi(e),J=[e,t,n,s,o,E,T,c,g,p];if(W&&Id(J,W),e=J[0],t=J[1],n=J[2],s=J[3],o=J[4],p=J[9]=J[9]===r?y?0:e.length:Je(J[9]-A,0),!p&&t&(Z|ae)&&(t&=-25),!t||t==D)var Q=ad(e,t,n);else t==Z||t==ae?Q=ld(e,t,p):(t==w||t==(D|w))&&!o.length?Q=cd(e,t,n,s):Q=Qr.apply(r,J);var ue=W?ta:Ma;return Ta(ue(Q,J),e,t)}function wa(e,t,n,s){return e===r||Wt(e,Bn[n])&&!ke.call(s,n)?t:e}function Sa(e,t,n,s,o,c){return We(e)&&We(t)&&(c.set(t,e),Vr(e,t,r,Sa,c),c.delete(t)),e}function dd(e){return pr(e)?r:e}function Na(e,t,n,s,o,c){var g=n&P,p=e.length,y=t.length;if(p!=y&&!(g&&y>p))return!1;var A=c.get(e),E=c.get(t);if(A&&E)return A==t&&E==e;var T=-1,W=!0,J=n&R?new Nn:r;for(c.set(e,t),c.set(t,e);++T<p;){var Q=e[T],ue=t[T];if(s)var ee=g?s(ue,Q,T,t,e,c):s(Q,ue,T,e,t,c);if(ee!==r){if(ee)continue;W=!1;break}if(J){if(!Bs(t,function(me,xe){if(!nr(J,xe)&&(Q===me||o(Q,me,n,s,c)))return J.push(xe)})){W=!1;break}}else if(!(Q===ue||o(Q,ue,n,s,c))){W=!1;break}}return c.delete(e),c.delete(t),W}function fd(e,t,n,s,o,c,g){switch(n){case Se:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ye:return!(e.byteLength!=t.byteLength||!c(new Dr(e),new Dr(t)));case ct:case Qe:case mt:return Wt(+e,+t);case Fe:return e.name==t.name&&e.message==t.message;case Ut:case $t:return e==t+"";case et:var p=Hs;case tt:var y=s&P;if(p||(p=Lr),e.size!=t.size&&!y)return!1;var A=g.get(e);if(A)return A==t;s|=R,g.set(e,t);var E=Na(p(e),p(t),s,o,c,g);return g.delete(e),E;case Ot:if(ar)return ar.call(e)==ar.call(t)}return!1}function hd(e,t,n,s,o,c){var g=n&P,p=xi(e),y=p.length,A=xi(t),E=A.length;if(y!=E&&!g)return!1;for(var T=y;T--;){var W=p[T];if(!(g?W in t:ke.call(t,W)))return!1}var J=c.get(e),Q=c.get(t);if(J&&Q)return J==t&&Q==e;var ue=!0;c.set(e,t),c.set(t,e);for(var ee=g;++T<y;){W=p[T];var me=e[W],xe=t[W];if(s)var vt=g?s(xe,me,W,t,e,c):s(me,xe,W,e,t,c);if(!(vt===r?me===xe||o(me,xe,n,s,c):vt)){ue=!1;break}ee||(ee=W=="constructor")}if(ue&&!ee){var lt=e.constructor,_t=t.constructor;lt!=_t&&"constructor"in e&&"constructor"in t&&!(typeof lt=="function"&&lt instanceof lt&&typeof _t=="function"&&_t instanceof _t)&&(ue=!1)}return c.delete(e),c.delete(t),ue}function en(e){return Ii(Ea(e,r,Fa),e+"")}function xi(e){return Go(e,Ye,_i)}function bi(e){return Go(e,ht,Ia)}var yi=$r?function(e){return $r.get(e)}:Wi;function rs(e){for(var t=e.name+"",n=Un[t],s=ke.call(Un,t)?n.length:0;s--;){var o=n[s],c=o.func;if(c==null||c==e)return o.name}return t}function Hn(e){var t=ke.call(l,"placeholder")?l:e;return t.placeholder}function X(){var e=l.iteratee||Ri;return e=e===Ri?qo:e,arguments.length?e(arguments[0],arguments[1]):e}function ss(e,t){var n=e.__data__;return _d(t)?n[typeof t=="string"?"string":"hash"]:n.map}function vi(e){for(var t=Ye(e),n=t.length;n--;){var s=t[n],o=e[s];t[n]=[s,o,Ca(o)]}return t}function kn(e,t){var n=Nc(e,t);return Ho(n)?n:r}function gd(e){var t=ke.call(e,wn),n=e[wn];try{e[wn]=r;var s=!0}catch{}var o=Pr.call(e);return s&&(t?e[wn]=n:delete e[wn]),o}var _i=Js?function(e){return e==null?[]:(e=Ce(e),cn(Js(e),function(t){return Lo.call(e,t)}))}:Fi,Ia=Js?function(e){for(var t=[];e;)un(t,_i(e)),e=Wr(e);return t}:Fi,it=ot;(Vs&&it(new Vs(new ArrayBuffer(1)))!=Se||sr&&it(new sr)!=et||Ys&&it(Ys.resolve())!=Vt||zn&&it(new zn)!=tt||ir&&it(new ir)!=q)&&(it=function(e){var t=ot(e),n=t==ut?e.constructor:r,s=n?Cn(n):"";if(s)switch(s){case Yc:return Se;case Xc:return et;case Zc:return Vt;case Qc:return tt;case eu:return q}return t});function md(e,t,n){for(var s=-1,o=n.length;++s<o;){var c=n[s],g=c.size;switch(c.type){case"drop":e+=g;break;case"dropRight":t-=g;break;case"take":t=st(t,e+g);break;case"takeRight":e=Je(e,t-g);break}}return{start:e,end:t}}function pd(e){var t=e.match(ks);return t?t[1].split(Cs):[]}function ja(e,t,n){t=mn(t,e);for(var s=-1,o=t.length,c=!1;++s<o;){var g=Ht(t[s]);if(!(c=e!=null&&n(e,g)))break;e=e[g]}return c||++s!=o?c:(o=e==null?0:e.length,!!o&&ds(o)&&tn(g,o)&&(ie(e)||An(e)))}function xd(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ke.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ka(e){return typeof e.constructor=="function"&&!gr(e)?$n(Wr(e)):{}}function bd(e,t,n){var s=e.constructor;switch(t){case ye:return gi(e);case ct:case Qe:return new s(+e);case Se:return td(e,n);case He:case Le:case De:case Pe:case Ve:case Pt:case wt:case yn:case Xn:return ca(e,n);case et:return new s;case mt:case $t:return new s(e);case Ut:return nd(e);case tt:return new s;case Ot:return rd(e)}}function yd(e,t){var n=t.length;if(!n)return e;var s=n-1;return t[s]=(n>1?"& ":"")+t[s],t=t.join(n>2?", ":" "),e.replace(an,`{
/* [wrapped with `+t+`] */
`)}function vd(e){return ie(e)||An(e)||!!(Mo&&e&&e[Mo])}function tn(e,t){var n=typeof e;return t=t??H,!!t&&(n=="number"||n!="symbol"&&Tn.test(e))&&e>-1&&e%1==0&&e<t}function at(e,t,n){if(!We(n))return!1;var s=typeof t;return(s=="number"?ft(n)&&tn(t,n.length):s=="string"&&t in n)?Wt(n[t],e):!1}function wi(e,t){if(ie(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||yt(e)?!0:Be.test(e)||!Ns.test(e)||t!=null&&e in Ce(t)}function _d(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Si(e){var t=rs(e),n=l[t];if(typeof n!="function"||!(t in pe.prototype))return!1;if(e===n)return!0;var s=yi(n);return!!s&&e===s[0]}function wd(e){return!!Co&&Co in e}var Sd=Tr?nn:Bi;function gr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Bn;return e===n}function Ca(e){return e===e&&!We(e)}function Aa(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Ce(n))}}function Nd(e){var t=cs(e,function(s){return n.size===I&&n.clear(),s}),n=t.cache;return t}function Id(e,t){var n=e[1],s=t[1],o=n|s,c=o<(D|F|V),g=s==V&&n==Z||s==V&&n==de&&e[7].length<=t[8]||s==(V|de)&&t[7].length<=t[8]&&n==Z;if(!(c||g))return e;s&D&&(e[2]=t[2],o|=n&D?0:G);var p=t[3];if(p){var y=e[3];e[3]=y?da(y,p,t[4]):p,e[4]=y?dn(e[3],_):t[4]}return p=t[5],p&&(y=e[5],e[5]=y?fa(y,p,t[6]):p,e[6]=y?dn(e[5],_):t[6]),p=t[7],p&&(e[7]=p),s&V&&(e[8]=e[8]==null?t[8]:st(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function jd(e){var t=[];if(e!=null)for(var n in Ce(e))t.push(n);return t}function kd(e){return Pr.call(e)}function Ea(e,t,n){return t=Je(t===r?e.length-1:t,0),function(){for(var s=arguments,o=-1,c=Je(s.length-t,0),g=N(c);++o<c;)g[o]=s[t+o];o=-1;for(var p=N(t+1);++o<t;)p[o]=s[o];return p[t]=n(g),pt(e,this,p)}}function La(e,t){return t.length<2?e:jn(e,At(t,0,-1))}function Cd(e,t){for(var n=e.length,s=st(t.length,n),o=dt(e);s--;){var c=t[s];e[s]=tn(c,n)?o[c]:r}return e}function Ni(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ma=Oa(ta),mr=$c||function(e,t){return nt.setTimeout(e,t)},Ii=Oa(Xu);function Ta(e,t,n){var s=t+"";return Ii(e,yd(s,Ad(pd(s),n)))}function Oa(e){var t=0,n=0;return function(){var s=qc(),o=te-(s-n);if(n=s,o>0){if(++t>=U)return arguments[0]}else t=0;return e.apply(r,arguments)}}function is(e,t){var n=-1,s=e.length,o=s-1;for(t=t===r?s:t;++n<t;){var c=ai(n,o),g=e[c];e[c]=e[n],e[n]=g}return e.length=t,e}var Pa=Nd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Is,function(n,s,o,c){t.push(o?c.replace(er,"$1"):s||n)}),t});function Ht(e){if(typeof e=="string"||yt(e))return e;var t=e+"";return t=="0"&&1/e==-be?"-0":t}function Cn(e){if(e!=null){try{return Or.call(e)}catch{}try{return e+""}catch{}}return""}function Ad(e,t){return It(Oe,function(n){var s="_."+n[0];t&n[1]&&!Ar(e,s)&&e.push(s)}),e.sort()}function Ra(e){if(e instanceof pe)return e.clone();var t=new kt(e.__wrapped__,e.__chain__);return t.__actions__=dt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Ed(e,t,n){(n?at(e,t,n):t===r)?t=1:t=Je(oe(t),0);var s=e==null?0:e.length;if(!s||t<1)return[];for(var o=0,c=0,g=N(zr(s/t));o<s;)g[c++]=At(e,o,o+=t);return g}function Ld(e){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var c=e[t];c&&(o[s++]=c)}return o}function Md(){var e=arguments.length;if(!e)return[];for(var t=N(e-1),n=arguments[0],s=e;s--;)t[s-1]=arguments[s];return un(ie(n)?dt(n):[n],rt(t,1))}var Td=he(function(e,t){return Ge(e)?cr(e,rt(t,1,Ge,!0)):[]}),Od=he(function(e,t){var n=Et(t);return Ge(n)&&(n=r),Ge(e)?cr(e,rt(t,1,Ge,!0),X(n,2)):[]}),Pd=he(function(e,t){var n=Et(t);return Ge(n)&&(n=r),Ge(e)?cr(e,rt(t,1,Ge,!0),r,n):[]});function Rd(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:oe(t),At(e,t<0?0:t,s)):[]}function Dd(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:oe(t),t=s-t,At(e,0,t<0?0:t)):[]}function Wd(e,t){return e&&e.length?Xr(e,X(t,3),!0,!0):[]}function Fd(e,t){return e&&e.length?Xr(e,X(t,3),!0):[]}function Bd(e,t,n,s){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&at(e,t,n)&&(n=0,s=o),Mu(e,t,n,s)):[]}function Da(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:oe(n);return o<0&&(o=Je(s+o,0)),Er(e,X(t,3),o)}function Wa(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s-1;return n!==r&&(o=oe(n),o=n<0?Je(s+o,0):st(o,s-1)),Er(e,X(t,3),o,!0)}function Fa(e){var t=e==null?0:e.length;return t?rt(e,1):[]}function zd(e){var t=e==null?0:e.length;return t?rt(e,be):[]}function Ud(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:oe(t),rt(e,t)):[]}function $d(e){for(var t=-1,n=e==null?0:e.length,s={};++t<n;){var o=e[t];s[o[0]]=o[1]}return s}function Ba(e){return e&&e.length?e[0]:r}function Gd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:oe(n);return o<0&&(o=Je(s+o,0)),Rn(e,t,o)}function Kd(e){var t=e==null?0:e.length;return t?At(e,0,-1):[]}var Hd=he(function(e){var t=Re(e,fi);return t.length&&t[0]===e[0]?ni(t):[]}),qd=he(function(e){var t=Et(e),n=Re(e,fi);return t===Et(n)?t=r:n.pop(),n.length&&n[0]===e[0]?ni(n,X(t,2)):[]}),Jd=he(function(e){var t=Et(e),n=Re(e,fi);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?ni(n,r,t):[]});function Vd(e,t){return e==null?"":Kc.call(e,t)}function Et(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Yd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s;return n!==r&&(o=oe(n),o=o<0?Je(s+o,0):st(o,s-1)),t===t?Ac(e,t,o):Er(e,vo,o,!0)}function Xd(e,t){return e&&e.length?Xo(e,oe(t)):r}var Zd=he(za);function za(e,t){return e&&e.length&&t&&t.length?oi(e,t):e}function Qd(e,t,n){return e&&e.length&&t&&t.length?oi(e,t,X(n,2)):e}function ef(e,t,n){return e&&e.length&&t&&t.length?oi(e,t,r,n):e}var tf=en(function(e,t){var n=e==null?0:e.length,s=Zs(e,t);return ea(e,Re(t,function(o){return tn(o,n)?+o:o}).sort(ua)),s});function nf(e,t){var n=[];if(!(e&&e.length))return n;var s=-1,o=[],c=e.length;for(t=X(t,3);++s<c;){var g=e[s];t(g,s,e)&&(n.push(g),o.push(s))}return ea(e,o),n}function ji(e){return e==null?e:Vc.call(e)}function rf(e,t,n){var s=e==null?0:e.length;return s?(n&&typeof n!="number"&&at(e,t,n)?(t=0,n=s):(t=t==null?0:oe(t),n=n===r?s:oe(n)),At(e,t,n)):[]}function sf(e,t){return Yr(e,t)}function of(e,t,n){return ci(e,t,X(n,2))}function af(e,t){var n=e==null?0:e.length;if(n){var s=Yr(e,t);if(s<n&&Wt(e[s],t))return s}return-1}function lf(e,t){return Yr(e,t,!0)}function cf(e,t,n){return ci(e,t,X(n,2),!0)}function uf(e,t){var n=e==null?0:e.length;if(n){var s=Yr(e,t,!0)-1;if(Wt(e[s],t))return s}return-1}function df(e){return e&&e.length?na(e):[]}function ff(e,t){return e&&e.length?na(e,X(t,2)):[]}function hf(e){var t=e==null?0:e.length;return t?At(e,1,t):[]}function gf(e,t,n){return e&&e.length?(t=n||t===r?1:oe(t),At(e,0,t<0?0:t)):[]}function mf(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:oe(t),t=s-t,At(e,t<0?0:t,s)):[]}function pf(e,t){return e&&e.length?Xr(e,X(t,3),!1,!0):[]}function xf(e,t){return e&&e.length?Xr(e,X(t,3)):[]}var bf=he(function(e){return gn(rt(e,1,Ge,!0))}),yf=he(function(e){var t=Et(e);return Ge(t)&&(t=r),gn(rt(e,1,Ge,!0),X(t,2))}),vf=he(function(e){var t=Et(e);return t=typeof t=="function"?t:r,gn(rt(e,1,Ge,!0),r,t)});function _f(e){return e&&e.length?gn(e):[]}function wf(e,t){return e&&e.length?gn(e,X(t,2)):[]}function Sf(e,t){return t=typeof t=="function"?t:r,e&&e.length?gn(e,r,t):[]}function ki(e){if(!(e&&e.length))return[];var t=0;return e=cn(e,function(n){if(Ge(n))return t=Je(n.length,t),!0}),Gs(t,function(n){return Re(e,zs(n))})}function Ua(e,t){if(!(e&&e.length))return[];var n=ki(e);return t==null?n:Re(n,function(s){return pt(t,r,s)})}var Nf=he(function(e,t){return Ge(e)?cr(e,t):[]}),If=he(function(e){return di(cn(e,Ge))}),jf=he(function(e){var t=Et(e);return Ge(t)&&(t=r),di(cn(e,Ge),X(t,2))}),kf=he(function(e){var t=Et(e);return t=typeof t=="function"?t:r,di(cn(e,Ge),r,t)}),Cf=he(ki);function Af(e,t){return oa(e||[],t||[],lr)}function Ef(e,t){return oa(e||[],t||[],fr)}var Lf=he(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Ua(e,n)});function $a(e){var t=l(e);return t.__chain__=!0,t}function Mf(e,t){return t(e),e}function os(e,t){return t(e)}var Tf=en(function(e){var t=e.length,n=t?e[0]:0,s=this.__wrapped__,o=function(c){return Zs(c,e)};return t>1||this.__actions__.length||!(s instanceof pe)||!tn(n)?this.thru(o):(s=s.slice(n,+n+(t?1:0)),s.__actions__.push({func:os,args:[o],thisArg:r}),new kt(s,this.__chain__).thru(function(c){return t&&!c.length&&c.push(r),c}))});function Of(){return $a(this)}function Pf(){return new kt(this.value(),this.__chain__)}function Rf(){this.__values__===r&&(this.__values__=rl(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Df(){return this}function Wf(e){for(var t,n=this;n instanceof Kr;){var s=Ra(n);s.__index__=0,s.__values__=r,t?o.__wrapped__=s:t=s;var o=s;n=n.__wrapped__}return o.__wrapped__=e,t}function Ff(){var e=this.__wrapped__;if(e instanceof pe){var t=e;return this.__actions__.length&&(t=new pe(this)),t=t.reverse(),t.__actions__.push({func:os,args:[ji],thisArg:r}),new kt(t,this.__chain__)}return this.thru(ji)}function Bf(){return ia(this.__wrapped__,this.__actions__)}var zf=Zr(function(e,t,n){ke.call(e,n)?++e[n]:Zt(e,n,1)});function Uf(e,t,n){var s=ie(e)?bo:Lu;return n&&at(e,t,n)&&(t=r),s(e,X(t,3))}function $f(e,t){var n=ie(e)?cn:Uo;return n(e,X(t,3))}var Gf=pa(Da),Kf=pa(Wa);function Hf(e,t){return rt(as(e,t),1)}function qf(e,t){return rt(as(e,t),be)}function Jf(e,t,n){return n=n===r?1:oe(n),rt(as(e,t),n)}function Ga(e,t){var n=ie(e)?It:hn;return n(e,X(t,3))}function Ka(e,t){var n=ie(e)?fc:zo;return n(e,X(t,3))}var Vf=Zr(function(e,t,n){ke.call(e,n)?e[n].push(t):Zt(e,n,[t])});function Yf(e,t,n,s){e=ft(e)?e:Jn(e),n=n&&!s?oe(n):0;var o=e.length;return n<0&&(n=Je(o+n,0)),fs(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&Rn(e,t,n)>-1}var Xf=he(function(e,t,n){var s=-1,o=typeof t=="function",c=ft(e)?N(e.length):[];return hn(e,function(g){c[++s]=o?pt(t,g,n):ur(g,t,n)}),c}),Zf=Zr(function(e,t,n){Zt(e,n,t)});function as(e,t){var n=ie(e)?Re:Jo;return n(e,X(t,3))}function Qf(e,t,n,s){return e==null?[]:(ie(t)||(t=t==null?[]:[t]),n=s?r:n,ie(n)||(n=n==null?[]:[n]),Zo(e,t,n))}var eh=Zr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function th(e,t,n){var s=ie(e)?Fs:wo,o=arguments.length<3;return s(e,X(t,4),n,o,hn)}function nh(e,t,n){var s=ie(e)?hc:wo,o=arguments.length<3;return s(e,X(t,4),n,o,zo)}function rh(e,t){var n=ie(e)?cn:Uo;return n(e,us(X(t,3)))}function sh(e){var t=ie(e)?Do:Vu;return t(e)}function ih(e,t,n){(n?at(e,t,n):t===r)?t=1:t=oe(t);var s=ie(e)?ju:Yu;return s(e,t)}function oh(e){var t=ie(e)?ku:Zu;return t(e)}function ah(e){if(e==null)return 0;if(ft(e))return fs(e)?Wn(e):e.length;var t=it(e);return t==et||t==tt?e.size:si(e).length}function lh(e,t,n){var s=ie(e)?Bs:Qu;return n&&at(e,t,n)&&(t=r),s(e,X(t,3))}var ch=he(function(e,t){if(e==null)return[];var n=t.length;return n>1&&at(e,t[0],t[1])?t=[]:n>2&&at(t[0],t[1],t[2])&&(t=[t[0]]),Zo(e,rt(t,1),[])}),ls=Uc||function(){return nt.Date.now()};function uh(e,t){if(typeof t!="function")throw new jt(m);return e=oe(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ha(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Qt(e,V,r,r,r,r,t)}function qa(e,t){var n;if(typeof t!="function")throw new jt(m);return e=oe(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Ci=he(function(e,t,n){var s=D;if(n.length){var o=dn(n,Hn(Ci));s|=w}return Qt(e,s,t,n,o)}),Ja=he(function(e,t,n){var s=D|F;if(n.length){var o=dn(n,Hn(Ja));s|=w}return Qt(t,s,e,n,o)});function Va(e,t,n){t=n?r:t;var s=Qt(e,Z,r,r,r,r,r,t);return s.placeholder=Va.placeholder,s}function Ya(e,t,n){t=n?r:t;var s=Qt(e,ae,r,r,r,r,r,t);return s.placeholder=Ya.placeholder,s}function Xa(e,t,n){var s,o,c,g,p,y,A=0,E=!1,T=!1,W=!0;if(typeof e!="function")throw new jt(m);t=Lt(t)||0,We(n)&&(E=!!n.leading,T="maxWait"in n,c=T?Je(Lt(n.maxWait)||0,t):c,W="trailing"in n?!!n.trailing:W);function J(Ke){var Ft=s,sn=o;return s=o=r,A=Ke,g=e.apply(sn,Ft),g}function Q(Ke){return A=Ke,p=mr(me,t),E?J(Ke):g}function ue(Ke){var Ft=Ke-y,sn=Ke-A,pl=t-Ft;return T?st(pl,c-sn):pl}function ee(Ke){var Ft=Ke-y,sn=Ke-A;return y===r||Ft>=t||Ft<0||T&&sn>=c}function me(){var Ke=ls();if(ee(Ke))return xe(Ke);p=mr(me,ue(Ke))}function xe(Ke){return p=r,W&&s?J(Ke):(s=o=r,g)}function vt(){p!==r&&aa(p),A=0,s=y=o=p=r}function lt(){return p===r?g:xe(ls())}function _t(){var Ke=ls(),Ft=ee(Ke);if(s=arguments,o=this,y=Ke,Ft){if(p===r)return Q(y);if(T)return aa(p),p=mr(me,t),J(y)}return p===r&&(p=mr(me,t)),g}return _t.cancel=vt,_t.flush=lt,_t}var dh=he(function(e,t){return Bo(e,1,t)}),fh=he(function(e,t,n){return Bo(e,Lt(t)||0,n)});function hh(e){return Qt(e,z)}function cs(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new jt(m);var n=function(){var s=arguments,o=t?t.apply(this,s):s[0],c=n.cache;if(c.has(o))return c.get(o);var g=e.apply(this,s);return n.cache=c.set(o,g)||c,g};return n.cache=new(cs.Cache||Xt),n}cs.Cache=Xt;function us(e){if(typeof e!="function")throw new jt(m);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function gh(e){return qa(2,e)}var mh=ed(function(e,t){t=t.length==1&&ie(t[0])?Re(t[0],xt(X())):Re(rt(t,1),xt(X()));var n=t.length;return he(function(s){for(var o=-1,c=st(s.length,n);++o<c;)s[o]=t[o].call(this,s[o]);return pt(e,this,s)})}),Ai=he(function(e,t){var n=dn(t,Hn(Ai));return Qt(e,w,r,t,n)}),Za=he(function(e,t){var n=dn(t,Hn(Za));return Qt(e,B,r,t,n)}),ph=en(function(e,t){return Qt(e,de,r,r,r,t)});function xh(e,t){if(typeof e!="function")throw new jt(m);return t=t===r?t:oe(t),he(e,t)}function bh(e,t){if(typeof e!="function")throw new jt(m);return t=t==null?0:Je(oe(t),0),he(function(n){var s=n[t],o=pn(n,0,t);return s&&un(o,s),pt(e,this,o)})}function yh(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new jt(m);return We(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),Xa(e,t,{leading:s,maxWait:t,trailing:o})}function vh(e){return Ha(e,1)}function _h(e,t){return Ai(hi(t),e)}function wh(){if(!arguments.length)return[];var e=arguments[0];return ie(e)?e:[e]}function Sh(e){return Ct(e,M)}function Nh(e,t){return t=typeof t=="function"?t:r,Ct(e,M,t)}function Ih(e){return Ct(e,S|M)}function jh(e,t){return t=typeof t=="function"?t:r,Ct(e,S|M,t)}function kh(e,t){return t==null||Fo(e,t,Ye(t))}function Wt(e,t){return e===t||e!==e&&t!==t}var Ch=ns(ti),Ah=ns(function(e,t){return e>=t}),An=Ko(function(){return arguments}())?Ko:function(e){return Ue(e)&&ke.call(e,"callee")&&!Lo.call(e,"callee")},ie=N.isArray,Eh=fo?xt(fo):Du;function ft(e){return e!=null&&ds(e.length)&&!nn(e)}function Ge(e){return Ue(e)&&ft(e)}function Lh(e){return e===!0||e===!1||Ue(e)&&ot(e)==ct}var xn=Gc||Bi,Mh=ho?xt(ho):Wu;function Th(e){return Ue(e)&&e.nodeType===1&&!pr(e)}function Oh(e){if(e==null)return!0;if(ft(e)&&(ie(e)||typeof e=="string"||typeof e.splice=="function"||xn(e)||qn(e)||An(e)))return!e.length;var t=it(e);if(t==et||t==tt)return!e.size;if(gr(e))return!si(e).length;for(var n in e)if(ke.call(e,n))return!1;return!0}function Ph(e,t){return dr(e,t)}function Rh(e,t,n){n=typeof n=="function"?n:r;var s=n?n(e,t):r;return s===r?dr(e,t,r,n):!!s}function Ei(e){if(!Ue(e))return!1;var t=ot(e);return t==Fe||t==qt||typeof e.message=="string"&&typeof e.name=="string"&&!pr(e)}function Dh(e){return typeof e=="number"&&To(e)}function nn(e){if(!We(e))return!1;var t=ot(e);return t==Mt||t==Tt||t==zt||t==Ln}function Qa(e){return typeof e=="number"&&e==oe(e)}function ds(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=H}function We(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ue(e){return e!=null&&typeof e=="object"}var el=go?xt(go):Bu;function Wh(e,t){return e===t||ri(e,t,vi(t))}function Fh(e,t,n){return n=typeof n=="function"?n:r,ri(e,t,vi(t),n)}function Bh(e){return tl(e)&&e!=+e}function zh(e){if(Sd(e))throw new se(h);return Ho(e)}function Uh(e){return e===null}function $h(e){return e==null}function tl(e){return typeof e=="number"||Ue(e)&&ot(e)==mt}function pr(e){if(!Ue(e)||ot(e)!=ut)return!1;var t=Wr(e);if(t===null)return!0;var n=ke.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Or.call(n)==Wc}var Li=mo?xt(mo):zu;function Gh(e){return Qa(e)&&e>=-H&&e<=H}var nl=po?xt(po):Uu;function fs(e){return typeof e=="string"||!ie(e)&&Ue(e)&&ot(e)==$t}function yt(e){return typeof e=="symbol"||Ue(e)&&ot(e)==Ot}var qn=xo?xt(xo):$u;function Kh(e){return e===r}function Hh(e){return Ue(e)&&it(e)==q}function qh(e){return Ue(e)&&ot(e)==ce}var Jh=ns(ii),Vh=ns(function(e,t){return e<=t});function rl(e){if(!e)return[];if(ft(e))return fs(e)?Rt(e):dt(e);if(rr&&e[rr])return jc(e[rr]());var t=it(e),n=t==et?Hs:t==tt?Lr:Jn;return n(e)}function rn(e){if(!e)return e===0?e:0;if(e=Lt(e),e===be||e===-be){var t=e<0?-1:1;return t*re}return e===e?e:0}function oe(e){var t=rn(e),n=t%1;return t===t?n?t-n:t:0}function sl(e){return e?In(oe(e),0,Y):0}function Lt(e){if(typeof e=="number")return e;if(yt(e))return $;if(We(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=We(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=So(e);var n=vn.test(e);return n||ln.test(e)?cc(e.slice(2),n?2:8):kr.test(e)?$:+e}function il(e){return Kt(e,ht(e))}function Yh(e){return e?In(oe(e),-H,H):e===0?e:0}function Ie(e){return e==null?"":bt(e)}var Xh=Gn(function(e,t){if(gr(t)||ft(t)){Kt(t,Ye(t),e);return}for(var n in t)ke.call(t,n)&&lr(e,n,t[n])}),ol=Gn(function(e,t){Kt(t,ht(t),e)}),hs=Gn(function(e,t,n,s){Kt(t,ht(t),e,s)}),Zh=Gn(function(e,t,n,s){Kt(t,Ye(t),e,s)}),Qh=en(Zs);function eg(e,t){var n=$n(e);return t==null?n:Wo(n,t)}var tg=he(function(e,t){e=Ce(e);var n=-1,s=t.length,o=s>2?t[2]:r;for(o&&at(t[0],t[1],o)&&(s=1);++n<s;)for(var c=t[n],g=ht(c),p=-1,y=g.length;++p<y;){var A=g[p],E=e[A];(E===r||Wt(E,Bn[A])&&!ke.call(e,A))&&(e[A]=c[A])}return e}),ng=he(function(e){return e.push(r,Sa),pt(al,r,e)});function rg(e,t){return yo(e,X(t,3),Gt)}function sg(e,t){return yo(e,X(t,3),ei)}function ig(e,t){return e==null?e:Qs(e,X(t,3),ht)}function og(e,t){return e==null?e:$o(e,X(t,3),ht)}function ag(e,t){return e&&Gt(e,X(t,3))}function lg(e,t){return e&&ei(e,X(t,3))}function cg(e){return e==null?[]:Jr(e,Ye(e))}function ug(e){return e==null?[]:Jr(e,ht(e))}function Mi(e,t,n){var s=e==null?r:jn(e,t);return s===r?n:s}function dg(e,t){return e!=null&&ja(e,t,Tu)}function Ti(e,t){return e!=null&&ja(e,t,Ou)}var fg=ba(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),e[t]=n},Pi(gt)),hg=ba(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),ke.call(e,t)?e[t].push(n):e[t]=[n]},X),gg=he(ur);function Ye(e){return ft(e)?Ro(e):si(e)}function ht(e){return ft(e)?Ro(e,!0):Gu(e)}function mg(e,t){var n={};return t=X(t,3),Gt(e,function(s,o,c){Zt(n,t(s,o,c),s)}),n}function pg(e,t){var n={};return t=X(t,3),Gt(e,function(s,o,c){Zt(n,o,t(s,o,c))}),n}var xg=Gn(function(e,t,n){Vr(e,t,n)}),al=Gn(function(e,t,n,s){Vr(e,t,n,s)}),bg=en(function(e,t){var n={};if(e==null)return n;var s=!1;t=Re(t,function(c){return c=mn(c,e),s||(s=c.length>1),c}),Kt(e,bi(e),n),s&&(n=Ct(n,S|j|M,dd));for(var o=t.length;o--;)ui(n,t[o]);return n});function yg(e,t){return ll(e,us(X(t)))}var vg=en(function(e,t){return e==null?{}:Hu(e,t)});function ll(e,t){if(e==null)return{};var n=Re(bi(e),function(s){return[s]});return t=X(t),Qo(e,n,function(s,o){return t(s,o[0])})}function _g(e,t,n){t=mn(t,e);var s=-1,o=t.length;for(o||(o=1,e=r);++s<o;){var c=e==null?r:e[Ht(t[s])];c===r&&(s=o,c=n),e=nn(c)?c.call(e):c}return e}function wg(e,t,n){return e==null?e:fr(e,t,n)}function Sg(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:fr(e,t,n,s)}var cl=_a(Ye),ul=_a(ht);function Ng(e,t,n){var s=ie(e),o=s||xn(e)||qn(e);if(t=X(t,4),n==null){var c=e&&e.constructor;o?n=s?new c:[]:We(e)?n=nn(c)?$n(Wr(e)):{}:n={}}return(o?It:Gt)(e,function(g,p,y){return t(n,g,p,y)}),n}function Ig(e,t){return e==null?!0:ui(e,t)}function jg(e,t,n){return e==null?e:sa(e,t,hi(n))}function kg(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:sa(e,t,hi(n),s)}function Jn(e){return e==null?[]:Ks(e,Ye(e))}function Cg(e){return e==null?[]:Ks(e,ht(e))}function Ag(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Lt(n),n=n===n?n:0),t!==r&&(t=Lt(t),t=t===t?t:0),In(Lt(e),t,n)}function Eg(e,t,n){return t=rn(t),n===r?(n=t,t=0):n=rn(n),e=Lt(e),Pu(e,t,n)}function Lg(e,t,n){if(n&&typeof n!="boolean"&&at(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=rn(e),t===r?(t=e,e=0):t=rn(t)),e>t){var s=e;e=t,t=s}if(n||e%1||t%1){var o=Oo();return st(e+o*(t-e+lc("1e-"+((o+"").length-1))),t)}return ai(e,t)}var Mg=Kn(function(e,t,n){return t=t.toLowerCase(),e+(n?dl(t):t)});function dl(e){return Oi(Ie(e).toLowerCase())}function fl(e){return e=Ie(e),e&&e.replace(L,_c).replace(Zl,"")}function Tg(e,t,n){e=Ie(e),t=bt(t);var s=e.length;n=n===r?s:In(oe(n),0,s);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function Og(e){return e=Ie(e),e&&ws.test(e)?e.replace(wr,wc):e}function Pg(e){return e=Ie(e),e&&Zn.test(e)?e.replace(Mn,"\\$&"):e}var Rg=Kn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Dg=Kn(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Wg=ma("toLowerCase");function Fg(e,t,n){e=Ie(e),t=oe(t);var s=t?Wn(e):0;if(!t||s>=t)return e;var o=(t-s)/2;return ts(Ur(o),n)+e+ts(zr(o),n)}function Bg(e,t,n){e=Ie(e),t=oe(t);var s=t?Wn(e):0;return t&&s<t?e+ts(t-s,n):e}function zg(e,t,n){e=Ie(e),t=oe(t);var s=t?Wn(e):0;return t&&s<t?ts(t-s,n)+e:e}function Ug(e,t,n){return n||t==null?t=0:t&&(t=+t),Jc(Ie(e).replace(Qn,""),t||0)}function $g(e,t,n){return(n?at(e,t,n):t===r)?t=1:t=oe(t),li(Ie(e),t)}function Gg(){var e=arguments,t=Ie(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Kg=Kn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Hg(e,t,n){return n&&typeof n!="number"&&at(e,t,n)&&(t=n=r),n=n===r?Y:n>>>0,n?(e=Ie(e),e&&(typeof t=="string"||t!=null&&!Li(t))&&(t=bt(t),!t&&Dn(e))?pn(Rt(e),0,n):e.split(t,n)):[]}var qg=Kn(function(e,t,n){return e+(n?" ":"")+Oi(t)});function Jg(e,t,n){return e=Ie(e),n=n==null?0:In(oe(n),0,e.length),t=bt(t),e.slice(n,n+t.length)==t}function Vg(e,t,n){var s=l.templateSettings;n&&at(e,t,n)&&(t=r),e=Ie(e),t=hs({},t,s,wa);var o=hs({},t.imports,s.imports,wa),c=Ye(o),g=Ks(o,c),p,y,A=0,E=t.interpolate||O,T="__p += '",W=qs((t.escape||O).source+"|"+E.source+"|"+(E===Nr?jr:O).source+"|"+(t.evaluate||O).source+"|$","g"),J="//# sourceURL="+(ke.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rc+"]")+`
`;e.replace(W,function(ee,me,xe,vt,lt,_t){return xe||(xe=vt),T+=e.slice(A,_t).replace(_e,Sc),me&&(p=!0,T+=`' +
__e(`+me+`) +
'`),lt&&(y=!0,T+=`';
`+lt+`;
__p += '`),xe&&(T+=`' +
((__t = (`+xe+`)) == null ? '' : __t) +
'`),A=_t+ee.length,ee}),T+=`';
`;var Q=ke.call(t,"variable")&&t.variable;if(!Q)T=`with (obj) {
`+T+`
}
`;else if(Ir.test(Q))throw new se(x);T=(y?T.replace(bs,""):T).replace(ys,"$1").replace(vs,"$1;"),T="function("+(Q||"obj")+`) {
`+(Q?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(p?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+T+`return __p
}`;var ue=gl(function(){return Ne(c,J+"return "+T).apply(r,g)});if(ue.source=T,Ei(ue))throw ue;return ue}function Yg(e){return Ie(e).toLowerCase()}function Xg(e){return Ie(e).toUpperCase()}function Zg(e,t,n){if(e=Ie(e),e&&(n||t===r))return So(e);if(!e||!(t=bt(t)))return e;var s=Rt(e),o=Rt(t),c=No(s,o),g=Io(s,o)+1;return pn(s,c,g).join("")}function Qg(e,t,n){if(e=Ie(e),e&&(n||t===r))return e.slice(0,ko(e)+1);if(!e||!(t=bt(t)))return e;var s=Rt(e),o=Io(s,Rt(t))+1;return pn(s,0,o).join("")}function em(e,t,n){if(e=Ie(e),e&&(n||t===r))return e.replace(Qn,"");if(!e||!(t=bt(t)))return e;var s=Rt(e),o=No(s,Rt(t));return pn(s,o).join("")}function tm(e,t){var n=le,s=$e;if(We(t)){var o="separator"in t?t.separator:o;n="length"in t?oe(t.length):n,s="omission"in t?bt(t.omission):s}e=Ie(e);var c=e.length;if(Dn(e)){var g=Rt(e);c=g.length}if(n>=c)return e;var p=n-Wn(s);if(p<1)return s;var y=g?pn(g,0,p).join(""):e.slice(0,p);if(o===r)return y+s;if(g&&(p+=y.length-p),Li(o)){if(e.slice(p).search(o)){var A,E=y;for(o.global||(o=qs(o.source,Ie(tr.exec(o))+"g")),o.lastIndex=0;A=o.exec(E);)var T=A.index;y=y.slice(0,T===r?p:T)}}else if(e.indexOf(bt(o),p)!=p){var W=y.lastIndexOf(o);W>-1&&(y=y.slice(0,W))}return y+s}function nm(e){return e=Ie(e),e&&_s.test(e)?e.replace(_r,Ec):e}var rm=Kn(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Oi=ma("toUpperCase");function hl(e,t,n){return e=Ie(e),t=n?r:t,t===r?Ic(e)?Tc(e):pc(e):e.match(t)||[]}var gl=he(function(e,t){try{return pt(e,r,t)}catch(n){return Ei(n)?n:new se(n)}}),sm=en(function(e,t){return It(t,function(n){n=Ht(n),Zt(e,n,Ci(e[n],e))}),e});function im(e){var t=e==null?0:e.length,n=X();return e=t?Re(e,function(s){if(typeof s[1]!="function")throw new jt(m);return[n(s[0]),s[1]]}):[],he(function(s){for(var o=-1;++o<t;){var c=e[o];if(pt(c[0],this,s))return pt(c[1],this,s)}})}function om(e){return Eu(Ct(e,S))}function Pi(e){return function(){return e}}function am(e,t){return e==null||e!==e?t:e}var lm=xa(),cm=xa(!0);function gt(e){return e}function Ri(e){return qo(typeof e=="function"?e:Ct(e,S))}function um(e){return Vo(Ct(e,S))}function dm(e,t){return Yo(e,Ct(t,S))}var fm=he(function(e,t){return function(n){return ur(n,e,t)}}),hm=he(function(e,t){return function(n){return ur(e,n,t)}});function Di(e,t,n){var s=Ye(t),o=Jr(t,s);n==null&&!(We(t)&&(o.length||!s.length))&&(n=t,t=e,e=this,o=Jr(t,Ye(t)));var c=!(We(n)&&"chain"in n)||!!n.chain,g=nn(e);return It(o,function(p){var y=t[p];e[p]=y,g&&(e.prototype[p]=function(){var A=this.__chain__;if(c||A){var E=e(this.__wrapped__),T=E.__actions__=dt(this.__actions__);return T.push({func:y,args:arguments,thisArg:e}),E.__chain__=A,E}return y.apply(e,un([this.value()],arguments))})}),e}function gm(){return nt._===this&&(nt._=Fc),this}function Wi(){}function mm(e){return e=oe(e),he(function(t){return Xo(t,e)})}var pm=mi(Re),xm=mi(bo),bm=mi(Bs);function ml(e){return wi(e)?zs(Ht(e)):qu(e)}function ym(e){return function(t){return e==null?r:jn(e,t)}}var vm=ya(),_m=ya(!0);function Fi(){return[]}function Bi(){return!1}function wm(){return{}}function Sm(){return""}function Nm(){return!0}function Im(e,t){if(e=oe(e),e<1||e>H)return[];var n=Y,s=st(e,Y);t=X(t),e-=Y;for(var o=Gs(s,t);++n<e;)t(n);return o}function jm(e){return ie(e)?Re(e,Ht):yt(e)?[e]:dt(Pa(Ie(e)))}function km(e){var t=++Dc;return Ie(e)+t}var Cm=es(function(e,t){return e+t},0),Am=pi("ceil"),Em=es(function(e,t){return e/t},1),Lm=pi("floor");function Mm(e){return e&&e.length?qr(e,gt,ti):r}function Tm(e,t){return e&&e.length?qr(e,X(t,2),ti):r}function Om(e){return _o(e,gt)}function Pm(e,t){return _o(e,X(t,2))}function Rm(e){return e&&e.length?qr(e,gt,ii):r}function Dm(e,t){return e&&e.length?qr(e,X(t,2),ii):r}var Wm=es(function(e,t){return e*t},1),Fm=pi("round"),Bm=es(function(e,t){return e-t},0);function zm(e){return e&&e.length?$s(e,gt):0}function Um(e,t){return e&&e.length?$s(e,X(t,2)):0}return l.after=uh,l.ary=Ha,l.assign=Xh,l.assignIn=ol,l.assignInWith=hs,l.assignWith=Zh,l.at=Qh,l.before=qa,l.bind=Ci,l.bindAll=sm,l.bindKey=Ja,l.castArray=wh,l.chain=$a,l.chunk=Ed,l.compact=Ld,l.concat=Md,l.cond=im,l.conforms=om,l.constant=Pi,l.countBy=zf,l.create=eg,l.curry=Va,l.curryRight=Ya,l.debounce=Xa,l.defaults=tg,l.defaultsDeep=ng,l.defer=dh,l.delay=fh,l.difference=Td,l.differenceBy=Od,l.differenceWith=Pd,l.drop=Rd,l.dropRight=Dd,l.dropRightWhile=Wd,l.dropWhile=Fd,l.fill=Bd,l.filter=$f,l.flatMap=Hf,l.flatMapDeep=qf,l.flatMapDepth=Jf,l.flatten=Fa,l.flattenDeep=zd,l.flattenDepth=Ud,l.flip=hh,l.flow=lm,l.flowRight=cm,l.fromPairs=$d,l.functions=cg,l.functionsIn=ug,l.groupBy=Vf,l.initial=Kd,l.intersection=Hd,l.intersectionBy=qd,l.intersectionWith=Jd,l.invert=fg,l.invertBy=hg,l.invokeMap=Xf,l.iteratee=Ri,l.keyBy=Zf,l.keys=Ye,l.keysIn=ht,l.map=as,l.mapKeys=mg,l.mapValues=pg,l.matches=um,l.matchesProperty=dm,l.memoize=cs,l.merge=xg,l.mergeWith=al,l.method=fm,l.methodOf=hm,l.mixin=Di,l.negate=us,l.nthArg=mm,l.omit=bg,l.omitBy=yg,l.once=gh,l.orderBy=Qf,l.over=pm,l.overArgs=mh,l.overEvery=xm,l.overSome=bm,l.partial=Ai,l.partialRight=Za,l.partition=eh,l.pick=vg,l.pickBy=ll,l.property=ml,l.propertyOf=ym,l.pull=Zd,l.pullAll=za,l.pullAllBy=Qd,l.pullAllWith=ef,l.pullAt=tf,l.range=vm,l.rangeRight=_m,l.rearg=ph,l.reject=rh,l.remove=nf,l.rest=xh,l.reverse=ji,l.sampleSize=ih,l.set=wg,l.setWith=Sg,l.shuffle=oh,l.slice=rf,l.sortBy=ch,l.sortedUniq=df,l.sortedUniqBy=ff,l.split=Hg,l.spread=bh,l.tail=hf,l.take=gf,l.takeRight=mf,l.takeRightWhile=pf,l.takeWhile=xf,l.tap=Mf,l.throttle=yh,l.thru=os,l.toArray=rl,l.toPairs=cl,l.toPairsIn=ul,l.toPath=jm,l.toPlainObject=il,l.transform=Ng,l.unary=vh,l.union=bf,l.unionBy=yf,l.unionWith=vf,l.uniq=_f,l.uniqBy=wf,l.uniqWith=Sf,l.unset=Ig,l.unzip=ki,l.unzipWith=Ua,l.update=jg,l.updateWith=kg,l.values=Jn,l.valuesIn=Cg,l.without=Nf,l.words=hl,l.wrap=_h,l.xor=If,l.xorBy=jf,l.xorWith=kf,l.zip=Cf,l.zipObject=Af,l.zipObjectDeep=Ef,l.zipWith=Lf,l.entries=cl,l.entriesIn=ul,l.extend=ol,l.extendWith=hs,Di(l,l),l.add=Cm,l.attempt=gl,l.camelCase=Mg,l.capitalize=dl,l.ceil=Am,l.clamp=Ag,l.clone=Sh,l.cloneDeep=Ih,l.cloneDeepWith=jh,l.cloneWith=Nh,l.conformsTo=kh,l.deburr=fl,l.defaultTo=am,l.divide=Em,l.endsWith=Tg,l.eq=Wt,l.escape=Og,l.escapeRegExp=Pg,l.every=Uf,l.find=Gf,l.findIndex=Da,l.findKey=rg,l.findLast=Kf,l.findLastIndex=Wa,l.findLastKey=sg,l.floor=Lm,l.forEach=Ga,l.forEachRight=Ka,l.forIn=ig,l.forInRight=og,l.forOwn=ag,l.forOwnRight=lg,l.get=Mi,l.gt=Ch,l.gte=Ah,l.has=dg,l.hasIn=Ti,l.head=Ba,l.identity=gt,l.includes=Yf,l.indexOf=Gd,l.inRange=Eg,l.invoke=gg,l.isArguments=An,l.isArray=ie,l.isArrayBuffer=Eh,l.isArrayLike=ft,l.isArrayLikeObject=Ge,l.isBoolean=Lh,l.isBuffer=xn,l.isDate=Mh,l.isElement=Th,l.isEmpty=Oh,l.isEqual=Ph,l.isEqualWith=Rh,l.isError=Ei,l.isFinite=Dh,l.isFunction=nn,l.isInteger=Qa,l.isLength=ds,l.isMap=el,l.isMatch=Wh,l.isMatchWith=Fh,l.isNaN=Bh,l.isNative=zh,l.isNil=$h,l.isNull=Uh,l.isNumber=tl,l.isObject=We,l.isObjectLike=Ue,l.isPlainObject=pr,l.isRegExp=Li,l.isSafeInteger=Gh,l.isSet=nl,l.isString=fs,l.isSymbol=yt,l.isTypedArray=qn,l.isUndefined=Kh,l.isWeakMap=Hh,l.isWeakSet=qh,l.join=Vd,l.kebabCase=Rg,l.last=Et,l.lastIndexOf=Yd,l.lowerCase=Dg,l.lowerFirst=Wg,l.lt=Jh,l.lte=Vh,l.max=Mm,l.maxBy=Tm,l.mean=Om,l.meanBy=Pm,l.min=Rm,l.minBy=Dm,l.stubArray=Fi,l.stubFalse=Bi,l.stubObject=wm,l.stubString=Sm,l.stubTrue=Nm,l.multiply=Wm,l.nth=Xd,l.noConflict=gm,l.noop=Wi,l.now=ls,l.pad=Fg,l.padEnd=Bg,l.padStart=zg,l.parseInt=Ug,l.random=Lg,l.reduce=th,l.reduceRight=nh,l.repeat=$g,l.replace=Gg,l.result=_g,l.round=Fm,l.runInContext=b,l.sample=sh,l.size=ah,l.snakeCase=Kg,l.some=lh,l.sortedIndex=sf,l.sortedIndexBy=of,l.sortedIndexOf=af,l.sortedLastIndex=lf,l.sortedLastIndexBy=cf,l.sortedLastIndexOf=uf,l.startCase=qg,l.startsWith=Jg,l.subtract=Bm,l.sum=zm,l.sumBy=Um,l.template=Vg,l.times=Im,l.toFinite=rn,l.toInteger=oe,l.toLength=sl,l.toLower=Yg,l.toNumber=Lt,l.toSafeInteger=Yh,l.toString=Ie,l.toUpper=Xg,l.trim=Zg,l.trimEnd=Qg,l.trimStart=em,l.truncate=tm,l.unescape=nm,l.uniqueId=km,l.upperCase=rm,l.upperFirst=Oi,l.each=Ga,l.eachRight=Ka,l.first=Ba,Di(l,function(){var e={};return Gt(l,function(t,n){ke.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=d,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),It(["drop","take"],function(e,t){pe.prototype[e]=function(n){n=n===r?1:Je(oe(n),0);var s=this.__filtered__&&!t?new pe(this):this.clone();return s.__filtered__?s.__takeCount__=st(n,s.__takeCount__):s.__views__.push({size:st(n,Y),type:e+(s.__dir__<0?"Right":"")}),s},pe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),It(["filter","map","takeWhile"],function(e,t){var n=t+1,s=n==fe||n==ve;pe.prototype[e]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:X(o,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),It(["head","last"],function(e,t){var n="take"+(t?"Right":"");pe.prototype[e]=function(){return this[n](1).value()[0]}}),It(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");pe.prototype[e]=function(){return this.__filtered__?new pe(this):this[n](1)}}),pe.prototype.compact=function(){return this.filter(gt)},pe.prototype.find=function(e){return this.filter(e).head()},pe.prototype.findLast=function(e){return this.reverse().find(e)},pe.prototype.invokeMap=he(function(e,t){return typeof e=="function"?new pe(this):this.map(function(n){return ur(n,e,t)})}),pe.prototype.reject=function(e){return this.filter(us(X(e)))},pe.prototype.slice=function(e,t){e=oe(e);var n=this;return n.__filtered__&&(e>0||t<0)?new pe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=oe(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},pe.prototype.toArray=function(){return this.take(Y)},Gt(pe.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),s=/^(?:head|last)$/.test(t),o=l[s?"take"+(t=="last"?"Right":""):t],c=s||/^find/.test(t);o&&(l.prototype[t]=function(){var g=this.__wrapped__,p=s?[1]:arguments,y=g instanceof pe,A=p[0],E=y||ie(g),T=function(me){var xe=o.apply(l,un([me],p));return s&&W?xe[0]:xe};E&&n&&typeof A=="function"&&A.length!=1&&(y=E=!1);var W=this.__chain__,J=!!this.__actions__.length,Q=c&&!W,ue=y&&!J;if(!c&&E){g=ue?g:new pe(this);var ee=e.apply(g,p);return ee.__actions__.push({func:os,args:[T],thisArg:r}),new kt(ee,W)}return Q&&ue?e.apply(this,p):(ee=this.thru(T),Q?s?ee.value()[0]:ee.value():ee)})}),It(["pop","push","shift","sort","splice","unshift"],function(e){var t=Mr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",s=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var o=arguments;if(s&&!this.__chain__){var c=this.value();return t.apply(ie(c)?c:[],o)}return this[n](function(g){return t.apply(ie(g)?g:[],o)})}}),Gt(pe.prototype,function(e,t){var n=l[t];if(n){var s=n.name+"";ke.call(Un,s)||(Un[s]=[]),Un[s].push({name:t,func:n})}}),Un[Qr(r,F).name]=[{name:"wrapper",func:r}],pe.prototype.clone=tu,pe.prototype.reverse=nu,pe.prototype.value=ru,l.prototype.at=Tf,l.prototype.chain=Of,l.prototype.commit=Pf,l.prototype.next=Rf,l.prototype.plant=Wf,l.prototype.reverse=Ff,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Bf,l.prototype.first=l.prototype.head,rr&&(l.prototype[rr]=Df),l},Fn=Oc();_n?((_n.exports=Fn)._=Fn,Rs._=Fn):nt._=Fn}).call(xr)})(ps,ps.exports);var $i=ps.exports;function P0(a=!0){k.useEffect(()=>{if(!a)return;const u=$i.debounce(r=>{document.documentElement.style.setProperty("--mouse-x",`${r.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${r.clientY}px`)},16);return document.addEventListener("mousemove",u),()=>{u.cancel(),document.removeEventListener("mousemove",u)}},[a])}function R0(a=!0){const{state:u,dispatch:r}=bn(),{activeTab:d,screenState:f}=u;k.useEffect(()=>{if(!a)return;const h=m=>{const x=d==="parameter-debug",v=d==="chat";//!screenState || screenState.currentScreen === 0;
if(v||x){const I=Te.canvas.selected_nodes;Object.keys(I??{}).length?r({type:"SET_SELECTED_NODE",payload:Object.values(I)}):r({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[r,a,d,f])}const D0=({selectedNodes:a,handleParamSelect:u,selectedParams:r,handleNext:d,handleClose:f})=>{const m=a.flatMap(x=>(x.widgets||[]).map(v=>v.name)).some(x=>r[x]===!0);return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),i.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.map((x,v)=>{const I=x.title||"Unknown Node",_=x.widgets||[];return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:I}),i.jsx("div",{className:"p-4 space-y-3",children:i.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:_.map((S,j)=>{const M=S.name;return i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r[M]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:P=>u(M,P),children:r[M]&&i.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),i.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:M})]},`widget-${j}`)})})})]},`node-${v}`)}),i.jsx("div",{className:"mt-6 flex justify-center",children:i.jsx("button",{onClick:x=>d(x),disabled:!m,className:`px-3 py-1.5 text-xs ${m?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},W0=({selectedNodes:a,paramTestValues:u,selectedParams:r,updateParamTestValues:d,toggleDropdown:f,openDropdowns:h,handleTestValueSelect:m,searchTerms:x,handleSearch:v,handleSelectAll:I,handleNext:_,handlePrevious:S,handleClose:j,inputValues:M,updateState:P,textInputs:R,handleTextInputChange:D,handleAddTextInput:F,handleRemoveTextInput:G,openAiWritingModal:Z})=>{const ae=(w,B,V,de=0)=>{if(w=isNaN(w)?0:w,B=isNaN(B)?100:B,V=isNaN(V)||V<=0?1:V,B<w&&(B=w),Math.floor((B-w)/V)+1<=1)return[w];const le=[];let $e=w;for(;$e<=B;){const U=Math.pow(10,de),te=Math.round($e*U)/U;le.push(te),$e+=V}return le};return k.useEffect(()=>{!a||a.length===0||a.forEach(w=>{const B=w.id.toString(),V=w.widgets||{};Object.values(V).forEach(z=>{const le=z.name;if(!r[le])return;if(!(u[B]?.[le]?.length>0)&&z.type==="number"){const U=z.options?.min||0,te=z.options?.max||100;let fe=(z.options?.step||10)/10;fe<.1&&(fe=.1);const ne=z.options?.precision||0,ve=ae(U,te,fe,ne);if(ve.length>0){d(B,le,ve);const be=`${B}_${le}`;P(ge.InputValues,{...M,[be]:{min:U.toString(),max:te.toString(),step:fe.toString()}})}}if(z.type==="customtext"||z.type.toLowerCase().includes("text")){const U=`${B}_${le}`,te=R[U]||[""];JSON.stringify(te)!==JSON.stringify(u[B]?.[le]||[""])&&d(B,le,te)}})})},[a,r,u,R,d,ae]),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:j,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length>0?a.map((w,B)=>{const V=w.widgets||{},de=Object.values(V),z=w.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[i.jsxs("span",{children:[w.type," (ID: ",z,")"]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:le=>j(le,B),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"p-4 space-y-4",children:de.map((le,$e)=>{const U=le.name;if(!r[U])return null;const te=`${z}_${U}`;if(le.type==="customtext"||le.type.toLowerCase().includes("text")){const fe=R[te]||[""];return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[U,":"]}),i.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>Z(z,U),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),i.jsx("div",{className:"space-y-2",children:fe.map((ne,ve)=>i.jsxs("div",{className:"flex items-start",children:[i.jsx("textarea",{className:`flex-1 border ${ne?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:ne,onChange:be=>D(z,U,ve,be.target.value),required:!0}),i.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>G(z,U,ve),title:"Remove",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},ve))}),i.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>F(z,U),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},$e)}if(le.type==="number"){const fe=le.options?.min||0,ne=le.options?.max||100,ve=(le.options?.step||10)/10,be=le.options?.precision||0,H=ae(fe,ne,ve,be),re=M[te]||{min:fe.toString(),max:ne.toString(),step:ve.toString()};return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[U,":"]}),i.jsx("div",{className:"w-4"})]}),i.jsxs("div",{className:"flex space-x-2 items-center",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:re.min,required:!0,onClick:$=>{$.preventDefault(),$.stopPropagation()},onChange:$=>{$.preventDefault(),$.stopPropagation();const Y=$.target.value;if(P(ge.InputValues,{...M,[te]:{...M[te],min:Y}}),Y===""||!isNaN(parseFloat(Y))){const we=Y===""?0:parseFloat(Y),Ee=parseFloat(re.max||ne.toString()),Oe=parseFloat(re.step||ve.toString()),je=ae(we,Ee,Oe,be);d(z,U,je)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:re.max,onClick:$=>{$.preventDefault(),$.stopPropagation()},required:!0,onChange:$=>{$.preventDefault(),$.stopPropagation();const Y=$.target.value;if(P(ge.InputValues,{...M,[te]:{...M[te],max:Y}}),Y===""||!isNaN(parseFloat(Y))){const we=parseFloat(re.min||fe.toString()),Ee=Y===""?we:parseFloat(Y),Oe=parseFloat(re.step||ve.toString()),je=ae(we,Ee,Oe,be);d(z,U,je)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:re.step,required:!0,onClick:$=>{$.preventDefault(),$.stopPropagation()},onChange:$=>{$.preventDefault(),$.stopPropagation();const Y=$.target.value;if(P(ge.InputValues,{...M,[te]:{...M[te],step:Y}}),Y===""||!isNaN(parseFloat(Y))&&parseFloat(Y)>0){const we=parseFloat(re.min||fe.toString()),Ee=parseFloat(re.max||ne.toString());let Oe=Y===""?1:parseFloat(Y);Oe<.1&&(Oe=.1);const je=ae(we,Ee,Oe,be);d(z,U,je)}}})]}),i.jsxs("div",{className:"mt-1",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const $=u[z]?.[U]||H;if($.length<=10)return $.map((Y,we)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ee=>{Ee.stopPropagation(),m(z,U,Y,Ee)},children:[i.jsx("span",{children:Y}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},we));{const Y=$.slice(0,5),we=$.slice($.length-5);return i.jsxs(i.Fragment,{children:[Y.map((Ee,Oe)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:je=>{je.stopPropagation(),m(z,U,Ee,je)},children:[i.jsx("span",{children:Ee}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${Oe}`)),i.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),we.map((Ee,Oe)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:je=>{je.stopPropagation(),m(z,U,Ee,je)},children:[i.jsx("span",{children:Ee}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${Oe}`))]})}})()})]}),i.jsx("div",{className:"mt-1",children:i.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},$e)}else if(le.type==="combo"){const fe=le.options?.values||[],ne=`${z}_${U}`,ve=H=>typeof H=="string"?H:H&&typeof H=="object"&&"name"in H?H.name:String(H),be=H=>typeof H=="object"&&H!==null&&"name"in H?H.name:H;return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("label",{className:"text-xs font-medium text-gray-700",children:U}),i.jsxs("div",{className:"relative dropdown-container",children:[i.jsxs("button",{className:`appearance-none border ${(u[z]?.[U]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:H=>{H.preventDefault(),H.stopPropagation(),f(z,U,H)},"data-dropdown":ne,children:[i.jsx("span",{children:(u[z]?.[U]||[]).length>0?`${U}: ${(u[z]?.[U]||[]).length} selected`:`Select ${U}`}),i.jsx("div",{className:"ml-2",children:i.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:i.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),h[ne]&&i.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof h[ne]=="object"?`${h[ne].y}px`:"0px",left:typeof h[ne]=="object"?`${h[ne].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[i.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:i.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:x[ne]||"",onChange:H=>{H.preventDefault(),H.stopPropagation(),v(z,U,H.target.value)},onClick:H=>{H.preventDefault(),H.stopPropagation()},autoFocus:!0})}),i.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:H=>{H.preventDefault(),H.stopPropagation();const $=fe.filter(Y=>!x[ne]||ve(Y).toLowerCase().includes((x[ne]||"").toLowerCase())).map(be);I(z,U,$)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${fe.length>0&&(u[z]?.[U]||[]).length===fe.length?"bg-blue-500 border-blue-500":(u[z]?.[U]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(u[z]?.[U]||[]).length>0&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"font-medium",children:fe.length>0&&(u[z]?.[U]||[]).length===fe.length?"Deselect All":"Select All"})]}),i.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[fe.filter(H=>!x[ne]||ve(H).toLowerCase().includes((x[ne]||"").toLowerCase())).map((H,re)=>i.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:$=>{$.preventDefault(),$.stopPropagation(),m(z,U,be(H),$)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(u[z]?.[U]||[]).includes(be(H))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(u[z]?.[U]||[]).includes(be(H))&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:ve(H)})]},re)),fe.filter(H=>!x[ne]||ve(H).toLowerCase().includes((x[ne]||"").toLowerCase())).length===0&&i.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(u[z]?.[U]||[]).length===0&&i.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(u[z]?.[U]||[]).map((H,re)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:H}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:$=>{$.preventDefault(),$.stopPropagation(),m(z,U,H,$)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},re))})]})]},$e)}else return i.jsxs("div",{className:"border-b pb-3",children:[i.jsx("div",{className:"flex justify-between items-center",children:i.jsx("label",{className:"text-xs font-medium text-gray-700",children:U})}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(u[z]?.[U]||[]).map((fe,ne)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:fe}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:ve=>{ve.preventDefault(),ve.stopPropagation(),m(z,U,fe,ve)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ne)),i.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:fe=>{fe.preventDefault(),fe.stopPropagation();const ne=`${U}${(u[z]?.[U]||[]).length+1}`;d(z,U,[...u[z]?.[U]||[],ne])},children:[i.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),i.jsx("span",{children:"Add"})]})]})]})]},$e)})})]},B)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:w=>S(w),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:w=>_(w),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},F0=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:d,errorMessage:f,handlePrevious:h,handleStartGeneration:m,handleClose:x})=>{const[v,I]=k.useState([]),[_,S]=k.useState(null),[j,M]=k.useState(!1),{dispatch:P}=bn(),R=()=>{const F=Object.values(Te.graph._nodes_by_id),G=[],Z=[];for(const w of F)w.type==="SaveImage"?G.push(w.id):w.type==="PreviewImage"&&Z.push(w.id);const ae=[...G,...Z];I(ae),ae.length===1?S(ae[0]):ae.length>1&&(M(!0),S(null))};k.useEffect(()=>{R()},[]),k.useEffect(()=>{const F=()=>{if(!Te.canvas.selected_nodes)return;const G=Object.values(Te.canvas.selected_nodes);if(G.length===0)return;const Z=G[0];Z&&(Z.type==="SaveImage"||Z.type==="PreviewImage")&&(console.log("Selected image node:",Z.id),S(Z.id))};return document.addEventListener("click",F),()=>{document.removeEventListener("click",F)}},[]);const D=F=>{if(F&&(F.preventDefault(),F.stopPropagation()),v.length>1&&!_){M(!0);return}m(F,_||void 0)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",d," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:x,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),j&&v.length>1&&i.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:_===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${v.join(",")}. Please click the node on canvas.`:`Current node ID is ${_}, please click Start Generation again`})]})}),f&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:f})]})}),a.length>0?a.map((F,G)=>{const Z=F.type||"Unknown Node",ae=F.widgets||[],w=F.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[Z," (ID: ",w,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:ae.map((B,V)=>{const de=B.name;if(!r[de])return null;const z=u[w]?.[de]||[],le=Array.isArray(z)?`[${z.join(", ")}]`:JSON.stringify(z);return i.jsxs("div",{className:V<ae.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700 text-xs",children:de}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:le,onClick:$e=>$e.preventDefault()})})]},V)})})]},G)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:F=>h(F),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:F=>D(F),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${v.length>1&&!_?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:v.length>1&&!_,children:"Generate & Compare"})]})]})},B0=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:d,completedCount:f,errorMessage:h,handleClose:m,updateState:x,cleanupPolling:v})=>{const I=_=>{_.preventDefault(),_.stopPropagation(),M0({clear:!0}),T0(),v&&v(),x(ge.IsProcessing,!1),x(ge.CurrentSceen,2)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[i.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:i.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[i.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),i.jsxs("div",{className:"text-xs mb-3",children:["Completed ",f," of ",d," runs"]}),i.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${f/d*100}%`}})}),i.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",f," images"]}),i.jsx("button",{onClick:I,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",d," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:m,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:h})]})}),a.length>0?a.map((_,S)=>{const j=_.type||"Unknown Node",M=_.widgets||[],P=_.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[j," (ID: ",P,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:M.map((R,D)=>{const F=R.name;if(!r[F])return null;const G=u[P]?.[F]||[],Z=Array.isArray(G)?`[${G.join(", ")}]`:JSON.stringify(G);return i.jsxs("div",{className:D<M.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700",children:F}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:Z,onClick:ae=>ae.preventDefault()})})]},D)})})]},S)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},br=({visible:a,imageUrl:u,params:r,onClose:d})=>{if(!a)return null;const f=()=>{if(!r||!r.nodeParams)return null;const h=Object.entries(r.nodeParams).map(([m,x])=>{const v=r.nodeNames?.[m]||r.selectedNodeInfoMap&&r.selectedNodeInfoMap[m]||(m.includes("text")?"Text Node":`Node ${m}`),I=Object.entries(x).filter(([_,S])=>typeof S!="object"||S===null).map(([_,S])=>i.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[i.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),i.jsxs("span",{className:"font-medium mr-1",children:[_,":"]}),i.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(S)})]},_));return i.jsxs("div",{className:"mb-4",children:[i.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:v}),I.length>0?I:i.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},m)});return i.jsx("div",{className:"overflow-y-auto max-h-full",children:h.length>0?h:i.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:d,children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[i.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:d,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),i.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:i.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:i.jsx("img",{src:u,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),i.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:i.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),r&&!r.nodeParams&&Object.entries(r).filter(([h,m])=>h!=="nodeParams"&&typeof m!="object").map(([h,m])=>i.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[i.jsxs("span",{className:"font-medium",children:[h,":"]})," ",String(m)]},h)),i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:f()})]})})]})})};function Yn(a,u,r){let d=r.initialDeps??[],f;function h(){var m,x,v,I;let _;r.key&&((m=r.debug)!=null&&m.call(r))&&(_=Date.now());const S=a();if(!(S.length!==d.length||S.some((P,R)=>d[R]!==P)))return f;d=S;let M;if(r.key&&((x=r.debug)!=null&&x.call(r))&&(M=Date.now()),f=u(...S),r.key&&((v=r.debug)!=null&&v.call(r))){const P=Math.round((Date.now()-_)*100)/100,R=Math.round((Date.now()-M)*100)/100,D=R/16,F=(G,Z)=>{for(G=String(G);G.length<Z;)G=" "+G;return G};console.info(`%c⏱ ${F(R,5)} /${F(P,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*D,120))}deg 100% 31%);`,r?.key)}return(I=r?.onChange)==null||I.call(r,f),f}return h.updateDeps=m=>{d=m},h}function yl(a,u){if(a===void 0)throw new Error("Unexpected undefined");return a}const z0=(a,u)=>Math.abs(a-u)<1.01,U0=(a,u,r)=>{let d;return function(...f){a.clearTimeout(d),d=a.setTimeout(()=>u.apply(this,f),r)}},vl=a=>{const{offsetWidth:u,offsetHeight:r}=a;return{width:u,height:r}},$0=a=>a,G0=a=>{const u=Math.max(a.startIndex-a.overscan,0),r=Math.min(a.endIndex+a.overscan,a.count-1),d=[];for(let f=u;f<=r;f++)d.push(f);return d},K0=(a,u)=>{const r=a.scrollElement;if(!r)return;const d=a.targetWindow;if(!d)return;const f=m=>{const{width:x,height:v}=m;u({width:Math.round(x),height:Math.round(v)})};if(f(vl(r)),!d.ResizeObserver)return()=>{};const h=new d.ResizeObserver(m=>{const x=()=>{const v=m[0];if(v?.borderBoxSize){const I=v.borderBoxSize[0];if(I){f({width:I.inlineSize,height:I.blockSize});return}}f(vl(r))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()});return h.observe(r,{box:"border-box"}),()=>{h.unobserve(r)}},_l={passive:!0},wl=typeof window>"u"?!0:"onscrollend"in window,H0=(a,u)=>{const r=a.scrollElement;if(!r)return;const d=a.targetWindow;if(!d)return;let f=0;const h=a.options.useScrollendEvent&&wl?()=>{}:U0(d,()=>{u(f,!1)},a.options.isScrollingResetDelay),m=_=>()=>{const{horizontal:S,isRtl:j}=a.options;f=S?r.scrollLeft*(j&&-1||1):r.scrollTop,h(),u(f,_)},x=m(!0),v=m(!1);v(),r.addEventListener("scroll",x,_l);const I=a.options.useScrollendEvent&&wl;return I&&r.addEventListener("scrollend",v,_l),()=>{r.removeEventListener("scroll",x),I&&r.removeEventListener("scrollend",v)}},q0=(a,u,r)=>{if(u?.borderBoxSize){const d=u.borderBoxSize[0];if(d)return Math.round(d[r.options.horizontal?"inlineSize":"blockSize"])}return a[r.options.horizontal?"offsetWidth":"offsetHeight"]},J0=(a,{adjustments:u=0,behavior:r},d)=>{var f,h;const m=a+u;(h=(f=d.scrollElement)==null?void 0:f.scrollTo)==null||h.call(f,{[d.options.horizontal?"left":"top"]:m,behavior:r})};class V0{constructor(u){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const d=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(f=>{f.forEach(h=>{const m=()=>{this._measureElement(h.target,h)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(m):m()})}));return{disconnect:()=>{var f;(f=d())==null||f.disconnect(),r=null},observe:f=>{var h;return(h=d())==null?void 0:h.observe(f,{box:"border-box"})},unobserve:f=>{var h;return(h=d())==null?void 0:h.unobserve(f)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([d,f])=>{typeof f>"u"&&delete r[d]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:$0,rangeExtractor:G0,onChange:()=>{},measureElement:q0,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var d,f;(f=(d=this.options).onChange)==null||f.call(d,this,r)},this.maybeNotify=Yn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const d=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==d){if(this.cleanup(),!d){this.maybeNotify();return}this.scrollElement=d,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(f=>{this.observer.observe(f)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,f=>{this.scrollRect=f,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(f,h)=>{this.scrollAdjustments=0,this.scrollDirection=h?this.getScrollOffset()<f?"forward":"backward":null,this.scrollOffset=f,this.isScrolling=h,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,d)=>{const f=new Map,h=new Map;for(let m=d-1;m>=0;m--){const x=r[m];if(f.has(x.lane))continue;const v=h.get(x.lane);if(v==null||x.end>v.end?h.set(x.lane,x):x.end<v.end&&f.set(x.lane,!0),f.size===this.options.lanes)break}return h.size===this.options.lanes?Array.from(h.values()).sort((m,x)=>m.end===x.end?m.index-x.index:m.end-x.end)[0]:void 0},this.getMeasurementOptions=Yn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,d,f,h,m)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:d,scrollMargin:f,getItemKey:h,enabled:m}),{key:!1}),this.getMeasurements=Yn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:d,scrollMargin:f,getItemKey:h,enabled:m},x)=>{if(!m)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(_=>{this.itemSizeCache.set(_.key,_.size)}));const v=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const I=this.measurementsCache.slice(0,v);for(let _=v;_<r;_++){const S=h(_),j=this.options.lanes===1?I[_-1]:this.getFurthestMeasurement(I,_),M=j?j.end+this.options.gap:d+f,P=x.get(S),R=typeof P=="number"?P:this.options.estimateSize(_),D=M+R,F=j?j.lane:_%this.options.lanes;I[_]={index:_,start:M,size:R,end:D,key:S,lane:F}}return this.measurementsCache=I,I},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Yn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,d,f,h)=>this.range=r.length>0&&d>0?Y0({measurements:r,outerSize:d,scrollOffset:f,lanes:h}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Yn(()=>{let r=null,d=null;const f=this.calculateRange();return f&&(r=f.startIndex,d=f.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,d]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,d]},(r,d,f,h,m)=>h===null||m===null?[]:r({startIndex:h,endIndex:m,overscan:d,count:f}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const d=this.options.indexAttribute,f=r.getAttribute(d);return f?parseInt(f,10):(console.warn(`Missing attribute name '${d}={index}' on measured element.`),-1)},this._measureElement=(r,d)=>{const f=this.indexFromElement(r),h=this.measurementsCache[f];if(!h)return;const m=h.key,x=this.elementsCache.get(m);x!==r&&(x&&this.observer.unobserve(x),this.observer.observe(r),this.elementsCache.set(m,r)),r.isConnected&&this.resizeItem(f,this.options.measureElement(r,d,this))},this.resizeItem=(r,d)=>{const f=this.measurementsCache[r];if(!f)return;const h=this.itemSizeCache.get(f.key)??f.size,m=d-h;m!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(f,m,this):f.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=m,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(f.index),this.itemSizeCache=new Map(this.itemSizeCache.set(f.key,d)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((d,f)=>{d.isConnected||(this.observer.unobserve(d),this.elementsCache.delete(f))});return}this._measureElement(r,void 0)},this.getVirtualItems=Yn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,d)=>{const f=[];for(let h=0,m=r.length;h<m;h++){const x=r[h],v=d[x];f.push(v)}return f},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const d=this.getMeasurements();if(d.length!==0)return yl(d[El(0,d.length-1,f=>yl(d[f]).start,r)])},this.getOffsetForAlignment=(r,d,f=0)=>{const h=this.getSize(),m=this.getScrollOffset();d==="auto"&&(d=r>=m+h?"end":"start"),d==="center"?r+=(f-h)/2:d==="end"&&(r-=h);const x=this.getTotalSize()+this.options.scrollMargin-h;return Math.max(Math.min(x,r),0)},this.getOffsetForIndex=(r,d="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const f=this.measurementsCache[r];if(!f)return;const h=this.getSize(),m=this.getScrollOffset();if(d==="auto")if(f.end>=m+h-this.options.scrollPaddingEnd)d="end";else if(f.start<=m+this.options.scrollPaddingStart)d="start";else return[m,d];const x=d==="end"?f.end+this.options.scrollPaddingEnd:f.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(x,d,f.size),d]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:d="start",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,d),{adjustments:void 0,behavior:f})},this.scrollToIndex=(r,{align:d="auto",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let h=0;const m=10,x=I=>{if(!this.targetWindow)return;const _=this.getOffsetForIndex(r,I);if(!_){console.warn("Failed to get offset for index:",r);return}const[S,j]=_;this._scrollToOffset(S,{adjustments:void 0,behavior:f}),this.targetWindow.requestAnimationFrame(()=>{const M=this.getScrollOffset(),P=this.getOffsetForIndex(r,j);if(!P){console.warn("Failed to get offset for index:",r);return}z0(P[0],M)||v(j)})},v=I=>{this.targetWindow&&(h++,h<m?this.targetWindow.requestAnimationFrame(()=>x(I)):console.warn(`Failed to scroll to index ${r} after ${m} attempts.`))};x(d)},this.scrollBy=(r,{behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:d})},this.getTotalSize=()=>{var r;const d=this.getMeasurements();let f;if(d.length===0)f=this.options.paddingStart;else if(this.options.lanes===1)f=((r=d[d.length-1])==null?void 0:r.end)??0;else{const h=Array(this.options.lanes).fill(null);let m=d.length-1;for(;m>=0&&h.some(x=>x===null);){const x=d[m];h[x.lane]===null&&(h[x.lane]=x.end),m--}f=Math.max(...h.filter(x=>x!==null))}return Math.max(f-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:d,behavior:f})=>{this.options.scrollToFn(r,{behavior:f,adjustments:d},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(u)}}const El=(a,u,r,d)=>{for(;a<=u;){const f=(a+u)/2|0,h=r(f);if(h<d)a=f+1;else if(h>d)u=f-1;else return f}return a>0?a-1:0};function Y0({measurements:a,outerSize:u,scrollOffset:r,lanes:d}){const f=a.length-1,h=v=>a[v].start;if(a.length<=d)return{startIndex:0,endIndex:f};let m=El(0,f,h,r),x=m;if(d===1)for(;x<f&&a[x].end<r+u;)x++;else if(d>1){const v=Array(d).fill(0);for(;x<f&&v.some(_=>_<r+u);){const _=a[x];v[_.lane]=_.end,x++}const I=Array(d).fill(r+u);for(;m>=0&&I.some(_=>_>=r);){const _=a[m];I[_.lane]=_.start,m--}m=Math.max(0,m-m%d),x=Math.min(f,x+(d-1-x%d))}return{startIndex:m,endIndex:x}}const Sl=typeof document<"u"?k.useLayoutEffect:k.useEffect;function X0(a){const u=k.useReducer(()=>({}),{})[1],r={...a,onChange:(f,h)=>{var m;h?Km.flushSync(u):u(),(m=a.onChange)==null||m.call(a,f,h)}},[d]=k.useState(()=>new V0(r));return d.setOptions(r),Sl(()=>d._didMount(),[]),Sl(()=>d._willUpdate()),d}function Z0(a){return X0({observeElementRect:K0,observeElementOffset:H0,scrollToFn:J0,...a})}const Ll=a=>{const{items:u,renderItem:r,minWidth:d=200,gap:f=16}=a,h=k.useRef(null),[m,x]=k.useState(1),[v,I]=k.useState(0);k.useLayoutEffect(()=>{if(!h.current)return;const S=()=>{if(h.current){const M=h.current.offsetWidth,P=Math.max(1,Math.floor(M/(d+f/2)));x(P),I(Math.ceil(u.length/P))}};S();const j=new window.ResizeObserver($i.debounce(S,50));return j.observe(h.current),()=>j.disconnect()},[]);const _=Z0({count:v,getScrollElement:()=>h.current,estimateSize:()=>d+40,overscan:3,gap:f});return i.jsx("div",{ref:h,className:"h-full relative overflow-auto hide-scrollbar",children:i.jsx("div",{style:{height:_.getTotalSize(),position:"relative"},children:_.getVirtualItems().map(S=>{const j=S.index,M=j*m,P=Math.min(M+m,u.length);return i.jsx("div",{"data-index":j,ref:_.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${S.start}px)`,display:"grid",gridTemplateColumns:`repeat(${m}, minmax(${d}px, 1fr))`,gap:`${f}px`},children:u.slice(M,P).map((R,D)=>r(R,M+D))},j)})})})},Q0=({generatedImages:a,selectedImageIndex:u,handleSelectImage:r,handleApplySelected:d,handleClose:f,notificationVisible:h,modalVisible:m,modalImageUrl:x,modalImageParams:v,openImageModal:I,closeImageModal:_})=>{const S=(j,M)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===j.index?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:P=>r(M,P),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:P=>I(j.url,j.params,P),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:j.url,alt:`Generated image ${M+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(j.params).filter(([P,R])=>P!=="nodeParams"&&typeof R!="object").map(([P,R])=>i.jsxs("div",{children:[P,": ",String(R)]},P))})]},M.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["All ",a.length," images have been generated."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"py-1",children:i.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Ll,{items:a,renderItem:S})}),i.jsx("div",{className:"mt-6 flex justify-end",children:i.jsx("button",{onClick:j=>d(j),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:u===null,children:"Apply Selected"})}),i.jsx(br,{visible:m,imageUrl:x,params:v||{},onClose:_})]})},ep=({visible:a,aiWritingModalText:u,setAiWritingModalText:r,aiGeneratedTexts:d,aiSelectedTexts:f,aiWritingLoading:h,aiWritingError:m,handleAiWriting:x,toggleTextSelection:v,addSelectedTexts:I,onClose:_})=>a?i.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),i.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:_,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),i.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white
                bg-gray-50 dark:bg-gray-700 
                placeholder-gray-500 dark:placeholder-gray-400
                focus:border-blue-500 dark:focus:border-blue-400 
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:u,onChange:S=>r(S.target.value)}),i.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:x,disabled:h,children:h?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):i.jsx(i.Fragment,{children:"Generate"})})]}),m&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:m}),d.length>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),i.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:d.map((S,j)=>i.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[i.jsx("div",{className:"mr-2 mt-1",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",id:`text${j+1}`,checked:!!f[`text${j+1}`],onChange:()=>v(`text${j+1}`),className:"sr-only"}),i.jsx("div",{className:`h-4 w-4 rounded border ${f[`text${j+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>v(`text${j+1}`),children:f[`text${j+1}`]&&i.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),i.jsx("label",{htmlFor:`text${j+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:S})]},j))})]})]}),i.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[i.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 
            rounded-lg font-medium transition-colors mr-3`,onClick:_,children:"Cancel"}),i.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(f).every(S=>!S)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:I,disabled:Object.values(f).every(S=>!S),children:"Add Selected"})]})]})}):null,Ui=a=>{const u=[],r={};if(Object.keys(a).forEach(h=>{const m=parseInt(h),x=a[h]||{},v=Object.keys(x).filter(_=>x[_]&&x[_].length>0);if(v.length===0)return;const I=[[]];v.forEach(_=>{const S=x[_],j=[];I.forEach(M=>{S.forEach(P=>{const R=[...M,{nodeId:m,paramName:_,paramValue:String(P)}];j.push(R)})}),I.length=0,I.push(...j)}),r[h]=I}),Object.keys(r).length===0)return u;if(Object.keys(r).length===1){const h=Object.keys(r)[0];return r[h]}const d=Object.keys(r);let f=r[d[0]];for(let h=1;h<d.length;h++){const m=r[d[h]],x=[];f.forEach(v=>{m.forEach(I=>{x.push([...v,...I])})}),f=x}return f},tp=(a,u)=>{const r={};r.nodeParams={};const d=Ui(a);return u<d.length&&d[u].forEach(h=>{const m=h.nodeId.toString(),x=h.paramName,v=h.paramValue;r.nodeParams[m]||(r.nodeParams[m]={}),r.nodeParams[m][x]=v,r[x]=v}),r},Ml="parameter_debug_history",Nl=30,Il=async(a,u,r,d,f)=>{try{const h=Tl(),m={id:Xe(),timestamp:Date.now(),title:Gi(a,u),nodeName:a,params:{...u,nodeNames:{...u.nodeNames||{},[a.split("<")[0]]:a.split("<")[0]}},generatedImages:r,totalCount:d,workflow:f};return h.unshift(m),h.length>Nl&&h.splice(Nl),localStorage.setItem(Ml,JSON.stringify(h)),m}catch(h){return console.error("Error saving parameter debug history:",h),null}},Tl=()=>{try{const a=localStorage.getItem(Ml);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug history:",a)}return[]},Ol=a=>{const u=new Date(a);return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`},Gi=(a,u)=>{if(u.nodeParams)return Object.entries(u.nodeParams).map(([h,m])=>{let x=a;u.selectedNodeInfoMap&&u.selectedNodeInfoMap[h]&&(x=u.selectedNodeInfoMap[h]);const v=Object.keys(m).slice(0,3);return`${x}<${v.join(",")}>`}).join(";");const r=Object.keys(u).filter(d=>d!=="nodeParams"&&d!=="selectedNodeInfoMap").slice(0,3);return`${a}<${r.join(",")}>`},np=({historyItems:a,onViewHistoryItem:u,onClose:r})=>i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",a.length," experiments"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:r,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length===0?i.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):i.jsx("div",{className:"flex-1 overflow-y-auto",children:a.map(d=>i.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[i.jsx("div",{className:"text-[14px] text-gray-600",children:Ol(d.timestamp)}),i.jsx("button",{onClick:()=>u(d),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),i.jsx("div",{className:"p-3",children:i.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:Gi(d.nodeName,d.params)})})]},d.id))})]}),rp=({historyItem:a,selectedImageIndex:u,handleSelectImage:r,handleClose:d,modalVisible:f,modalImageUrl:h,modalImageParams:m,openImageModal:x,closeImageModal:v})=>{const{timestamp:I,nodeName:_,generatedImages:S,params:j}=a,M=(P,R)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===R?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:D=>r(R,D),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:D=>x(P.url,P.params,D),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:P.url,alt:`Generated image ${R+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(P.params).filter(([D,F])=>D!=="nodeParams"&&typeof F!="object").map(([D,F])=>i.jsxs("div",{children:[D,": ",String(F)]},D))})]},R.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:Gi(_,j)}),i.jsxs("p",{className:"text-xs text-gray-500",children:[Ol(I)," • ",S.length," images"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Ll,{items:S,renderItem:M})}),i.jsx(br,{visible:f,imageUrl:h,params:m?{...m,nodeNames:{[a.nodeName.split("<")[0]]:a.nodeName.split("<")[0]}}:void 0,onClose:v})]})},sp=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,yr="parameter_debug_state",ip=a=>{try{localStorage.setItem(yr,JSON.stringify(a))}catch(u){console.error("Error saving parameter debug state:",u)}},op=()=>{try{const a=localStorage.getItem(yr);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug state:",a)}return null},ap=()=>{try{localStorage.removeItem(yr)}catch(a){console.error("Error clearing parameter debug state:",a)}},lp=(a,u,r,d,f,h)=>{const m=`${a}_${u}`,x=[...f[m]||[]];return x[r]=d,h(ge.TextInputs,{...f,[m]:x.map((v,I)=>I===r?d:v)}),x},cp=(a,u,r,d)=>{const f=`${a}_${u}`,h=[...r[f]||[]];return h.push(""),d(ge.TextInputs,{...r,[f]:h}),h},up=(a,u,r,d,f)=>{const h=`${a}_${u}`,m=[...d[h]||[]];return m.splice(r,1),f(ge.TextInputs,{...d,[h]:m}),m},dp=(a,u,r,d,f)=>{r.preventDefault(),r.stopPropagation();const h=`${a}_${u}`;f(m=>{if(m[h]&&typeof m[h]=="object"?m[h].isOpen:!!m[h])return{...m,[h]:!1};{let v=0,I=0;if(r.currentTarget){const j=r.currentTarget.getBoundingClientRect();v=j.left,I=j.bottom}else v=r.clientX,I=r.clientY+20;const _=window.innerWidth,S=250;return v+S>_&&(v=_-S-10),v<0&&(v=10),{...m,[h]:{isOpen:!0,x:v,y:I}}}})},fp=(a,u,r,d,f)=>{const h={...d};h[a]||(h[a]={}),h[a][u]=r,f(ge.ParamTestValues,h)},hp=(a,u,r,d,f,h)=>{h&&(h.preventDefault(),h.stopPropagation());const m={...d};m[a]||(m[a]={}),m[a][u]||(m[a][u]=[]);const x=m[a][u];x.includes(r)?m[a][u]=x.filter(v=>v!==r):m[a][u]=[...x,r],f(ge.ParamTestValues,m)},gp=(a,u,r,d,f)=>{const h=`${a}_${u}`;f(ge.SearchTerms,{...d,[h]:r})},mp=(a,u,r,d,f)=>{if(!d[a]){f(a,u,r);return}const h=d[a][u]||[];r.length===h.length?f(a,u,[]):f(a,u,[...r])},pp=(a,u,r,d,f)=>{f&&(f.preventDefault(),f.stopPropagation());const h=u[a];if(d(ge.SelectedParams,{...u,[a]:!h}),h){const m={...r};Object.keys(m).forEach(x=>{m[x][a]&&delete m[x][a]}),d(ge.ParamTestValues,m)}},xp=(a,u,r,d,f,h,m)=>{m.preventDefault(),m.stopPropagation();const x={...u};if(u.nodeParams){const v={};Object.keys(u.nodeParams).forEach(I=>{const _=r.find(S=>S.id.toString()===I);v[I]=_?_.title||`Node ${I}`:`Node ${I}`}),x.nodeNames=v}else if(Object.keys(u).length>0){const v={};Object.entries(u).forEach(([I,_])=>{(typeof _!="object"||_===null)&&(v[I]=_)}),Object.keys(v).length>0&&(x.nodeParams={default:v},x.nodeNames={default:u.node_name||u.nodeName||"参数"})}d(a),f(x),h(!0)},bp=(a,u)=>{u&&(u.preventDefault(),u.stopPropagation()),a(!1)},yp=(a,u,r,d,f,h,m,x,v)=>{if(v&&(v.preventDefault(),v.stopPropagation()),a===0){const I={...r};Object.keys(I).forEach(_=>{const S=I[_];Object.keys(S).forEach(j=>{u[j]||delete S[j]})}),x(ge.ParamTestValues,I)}if(a===1){const I={...r};f.forEach(S=>{const j=S.id.toString(),M=S.widgets||{};Object.values(M).forEach(P=>{const R=P.name;if(u[R]&&(P.type==="customtext"||P.type.toLowerCase().includes("text"))){const D=`${j}_${R}`,F=d[D]||[""];I[j]=I[j]||{},I[j][R]=F}})}),x(ge.ParamTestValues,I);const _=m(I);x(ge.TotalCount,_.length)}h(null),x(ge.CurrentSceen,Math.min(a+1,2))},vp=(a,u,r,d,f,h,m,x)=>{if(x&&(x.preventDefault(),x.stopPropagation()),h(null),f&&m(ge.IsCompleted,!1),a===1){const v=u.map(S=>S.id.toString()),I=Object.keys(r),_={...r};I.forEach(S=>{v.includes(S)||delete _[S]}),m(ge.ParamTestValues,_)}if(a===2||f){const v={...r};Object.entries(d).forEach(([I,_])=>{if(!_||_.length===0)return;const[S,j]=I.split("_");u.some(M=>M.id.toString()===S)&&(v[S]=v[S]||{},JSON.stringify(v[S][j])!==JSON.stringify(_)&&(v[S][j]=_))}),m(ge.ParamTestValues,v)}m(ge.CurrentSceen,Math.max(a-1,0))},_p=(a,u,r,d,f)=>{f&&(f.preventDefault(),f.stopPropagation()),d(ge.CurrentPage,Math.max(1,Math.min(a,Math.ceil(r.length/u))))};function wp(a,u){try{if(!a)return console.error("Invalid prompt_output: ",a),a;for(const r of u){if(!a[r.nodeId]){console.error(`Node with ID ${r.nodeId} not found`);continue}if(!a[r.nodeId].inputs){console.error(`Inputs not found for node with ID ${r.nodeId}`);continue}a[r.nodeId].inputs[r.paramName]=r.paramValue}return a}catch(r){return console.error("Error updating prompt:",r),a}}async function Sp(a){const u=await Te.graphToPrompt(),r=wp(u.output,a);console.log("queuePrompt updated_prompt:",r);const d={prompt:r,client_id:Te.api.clientId,extra_data:{extra_pageinfo:{workflow:u.workflow}}};console.debug("queuePrompt request_body.prompt:",r);const f=await L0(d);return console.debug("queuePrompt response:",f),f}function jl(a){const u=document.createElement("canvas"),r=u.getContext("2d");if(u.width=512,u.height=512,r){r.fillStyle="#f8d7da",r.fillRect(0,0,u.width,u.height),r.strokeStyle="#dc3545",r.lineWidth=4,r.strokeRect(10,10,u.width-20,u.height-20),r.fillStyle="#dc3545",r.beginPath(),r.arc(u.width/2,150,50,0,2*Math.PI),r.fill(),r.fillStyle="white",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("!",u.width/2,150),r.fillStyle="#721c24",r.font="20px Arial",r.textAlign="center",r.textBaseline="middle";const d=u.width-60,f=30,h=a.split(" ");let m="",x=250;for(let v=0;v<h.length;v++){const I=m+h[v]+" ";r.measureText(I).width>d&&v>0?(r.fillText(m,u.width/2,x),m=h[v]+" ",x+=f):m=I}r.fillText(m,u.width/2,x)}return u.toDataURL("image/png")}async function Np(a){try{if(!a||a==="")return console.log("No prompt ID provided"),{1:[jl("Fail to generate prompt ID")]};const u=await O0(a);if(!u||!u[a])return console.log("Not finished for prompt ID:",a),{};const r=u[a];if(r.status&&r.status.status_str==="error"){console.error("Error for prompt ID:",a);const f=r.status.messages;if(f&&f.length>0){const h=f[f.length-1];if(h&&h.length>0){const m=h[0];return{1:[jl(m)]}}}}const d={};if(r.outputs)for(const f in r.outputs){const h=r.outputs[f];if(h&&h.images){d[f]=[];for(const m of h.images)if(m&&m.filename&&m.type){const x=Te?.graph._nodes_by_id?.[f]?.imgs?.[0]?.currentSrc?.split("?")[0];d[f].push(x+"?filename="+encodeURIComponent(m.filename)+"&type="+encodeURIComponent(m.type)+(m.subfolder?"&subfolder="+encodeURIComponent(m.subfolder):""))}console.log("outputImages for nodeId:",f,d[f])}}return d}catch(u){throw console.error("Error getting output images from prompt:",u),u}}function Ip(){const a=Object.values(Te.graph._nodes_by_id),u=[],r=[];for(const d of a)d.type==="SaveImage"?u.push(d.id):d.type==="PreviewImage"&&r.push(d.id);if(console.log("saveNodeIds:",u),console.log("previewNodeIds:",r),u.length===0&&r.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return u.length===1?u[0]:u.length==0&&r.length===1?r[0]:null}async function jp(a,u){const r=await Np(a);return Object.keys(r).length===0?null:r[u.toString()]&&r[u.toString()].length>0?r[u.toString()][0]:null}const kp=async(a,u,r,d,f,h,m,x,v,I)=>{v&&(v.preventDefault(),v.stopPropagation()),Rl(f,d);const _=h(a),S=_.length;if(S>100){r(`Cannot generate more than 100 images at once (currently: ${S} images)`);return}r(null),x(ge.IsProcessing,!0),x(ge.CompletedCount,0),console.log("Generated parameter combinations:",_);let j=null;try{j=(await m.graphToPrompt()).output}catch(D){console.error("Error capturing workflow data:",D)}if(Bt.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:u,data:{workflow:j,all_params:a,count:S}}),_.length===0){r("No valid parameter combinations found. Please check your parameter selections."),x(ge.IsProcessing,!1);return}let M=I||null;if(M===null){const D=Ip();D!==null&&(M=D)}if(M===null){r("Please select a SaveImage or PreviewImage node first."),x(ge.IsProcessing,!1);return}const P={};Object.keys(a).forEach(D=>{const F=m.graph._nodes_by_id[D];F&&(P[D]=F.type||F.comfyClass||"Unknown Node")});const R=[];try{const D=Date.now().toString();d.current=D;for(const B of _){const V=await Sp(B);V.prompt_id?R.push(V.prompt_id):(console.error("Failed to get prompt_id from response:",V),R.push(""))}const F=Array(_.length).fill(null).map((B,V)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:tp(a,V)}));x(ge.GeneratedImages,F);const G=Date.now(),Z=5*60*1e3,ae=Object.keys(a)[0],w=P[ae]||"Unknown Node";Pl(R,M,F,D,G,Z,d,f,x,w,a,S,j,P)}catch(D){console.error("Error generating images:",D),x(ge.IsProcessing,!1)}},Pl=async(a,u,r,d,f,h,m,x,v,I,_,S,j,M)=>{if(m.current!==d){console.log("Another polling session has started, stopping this one");return}if(Date.now()-f>h){if(console.log("Timeout reached while waiting for images"),m.current===d&&(v(ge.IsProcessing,!1),v(ge.IsCompleted,!0),v(ge.CurrentPage,1),r.length>0&&I&&_)){const R=r[0].params;M&&(R.selectedNodeInfoMap=M),Il(I,R,r,S||r.length,j)}return}let P=0;for(let R=0;R<a.length;R++){const D=a[R];if(D)try{const F=await jp(D,Number(u));F&&(r[R]={...r[R],url:F},P++)}catch(F){console.error(`Error fetching image for prompt ID ${D}:`,F)}}if(v(ge.GeneratedImages,[...r]),v(ge.CompletedCount,P),P===a.length){if(console.log("All images have been generated!"),m.current===d&&(v(ge.IsProcessing,!1),v(ge.IsCompleted,!0),v(ge.CurrentPage,1),r.length>0&&I&&_)){const R=r[0].params;M&&(R.selectedNodeInfoMap=M),Il(I,R,r,S||r.length,j)}return}m.current===d&&(x.current=setTimeout(()=>{Pl(a,u,r,d,f,h,m,x,v,I,_,S,j,M)},2e3))},Rl=(a,u)=>{a.current&&(clearTimeout(a.current),a.current=null),u.current=null},Cp=async(a,u,r,d,f,h)=>{if(!a.trim()){d("Please enter some text to generate variations");return}r(!0),d(null),f([]),h({});try{const m=await Bt.generateSDPrompts(a);f(m),Bt.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:u,data:{input_text:a,generated_texts:m}});const x={};m.forEach((v,I)=>{x[`text${I+1}`]=!1}),h(x)}catch(m){console.error("Error generating text:",m),d("Failed to generate text variations. Please try again.")}finally{r(!1)}},Ap=(a,u)=>{u(r=>({...r,[a]:!r[a]}))},Ep=(a,u,r,d,f,h,m,x,v,I)=>{const _=`${a}_${u}`,S=Object.entries(r).filter(([P,R])=>R).map(([P])=>{const R=parseInt(P.replace("text",""))-1;return d[R]});if(S.length===0)return;const j=[...m[_]||[]];x(ge.TextInputs,{...m,[_]:[...j,...S]}),Bt.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:h,data:{input_text:f,generated_texts:d,selected_texts:S}});const M=[...m[_]||[],...S];v(a,u,M),I(!1)},Lp=(a,u,r,d,f,h,m,x,v,I)=>{r(!0),d(a),f(u),h(""),m([]),x({}),v(!1),I(null)},Mp=(a,u,r,d,f,h,m,x,v,I,_,S,j,M,P,R,D,F,G,Z,ae,w,B,V,de,z,le,$e,U,te=!1)=>{a(0),u({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),r(Xe()),d(),f(!1),h(!1),m(0),x(12),v(null),I(Array(12).fill(null).map((fe,ne)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:ne%3===0?5:ne%3===1?10:15,sampler_name:"euler",cfg:1}}))),_({}),S({}),j({}),M({}),P(1),R(null),D(!1),F(!1),G(""),Z(null),ae({}),w(!1),B(""),V([]),de(!1),z(""),le(""),$e(null),U({}),te&&ap()},Tp=async(a,u,r,d,f,h,m)=>{if(m&&(m.preventDefault(),m.stopPropagation()),a!==null){console.log(`Applied image ${a+1} with parameters:`,u[a].params);let x=1;if(f){for(const I in f)if(f[I])for(const _ in f[I]){const S=f[I][_];if(S){let j=1;Array.isArray(S)?j=S.length>0?S.length:1:typeof S=="object"&&S!==null&&(j=Object.keys(S).length>0?Object.keys(S).length:1),x=x*j}}}Bt.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:d,data:{workflow:(await r.graphToPrompt()).output,selected_params:u[a].params,all_params:f,count:x}});const v=u[a].params;v.nodeParams&&(Object.entries(v.nodeParams).forEach(([I,_])=>{const S=r.graph._nodes_by_id[I];!S||!S.widgets||Object.entries(_).forEach(([j,M])=>{for(const P of S.widgets)if(P.name===j){P.value=M;break}})}),r.graph.setDirtyCanvas(!1,!0),h(!0),setTimeout(()=>{h(!1)},3e3))}},Op=(a,u,r,d,f,h,m)=>{if(m&&(m.preventDefault(),m.stopPropagation()),a===1&&r!==void 0){const x=[...u];x[r],x.splice(r,1),x.length===0?f&&(d({type:"SET_SCREEN_STATE",payload:null}),h(!0),f()):d({type:"SET_SELECTED_NODE",payload:x});return}f&&(d({type:"SET_SCREEN_STATE",payload:null}),h(!0),f())};var ge=(a=>(a.CurrentSceen="currentSceen",a.SelectedParams="selectedParams",a.TaskId="taskId",a.IsProcessing="isProcessing",a.IsCompleted="isCompleted",a.CompletedCount="completedCount",a.TotalCount="totalCount",a.SelectedImageIndex="selectedImageIndex",a.GeneratedImages="generatedImages",a.ParamTestValues="paramTestValues",a.SearchTerms="searchTerms",a.InputValues="inputValues",a.CurrentPage="currentPage",a.TextInputs="textInputs",a))(ge||{});const Pp=({selectedNodes:a,visible:u,onClose:r})=>{const[d,f]=k.useState(0),[h,m]=k.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[x,v]=k.useState(Xe()),[I,_]=k.useState(!1),[S,j]=k.useState(!1),[M,P]=k.useState(0),[R,D]=k.useState(12),[F,G]=k.useState(null),[Z,ae]=k.useState(()=>Array(12).fill(null).map((L,O)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:O%3===0?5:O%3===1?10:15,sampler_name:"euler",cfg:1}}))),[w,B]=k.useState({}),[V,de]=k.useState({}),[z,le]=k.useState({}),[$e,U]=k.useState({}),[te,fe]=k.useState(1),ne=6,[ve,be]=k.useState(null),[H,re]=k.useState(!1),[$,Y]=k.useState(!1),[we,Ee]=k.useState(""),[Oe,je]=k.useState(null),[Ze,zt]=k.useState({}),[ct,Qe]=k.useState(!1),[qt,Fe]=k.useState(""),[Mt,Tt]=k.useState([]),[et,mt]=k.useState(!1),[Jt,ut]=k.useState(""),[Vt,Ln]=k.useState(""),[Ut,tt]=k.useState(null),[$t,Ot]=k.useState({}),[on,q]=k.useState(!1),[ce,ye]=k.useState([]),[Se,He]=k.useState(null),{dispatch:Le}=bn(),De=k.useRef(null),Pe=k.useRef(null),Ve=k.useRef(!0),[Pt,wt]=k.useState(()=>u),[yn,Xn]=k.useState(!1);k.useEffect(()=>{if(on){const L=Tl();ye(L)}},[on]);const bs=async()=>{Cp(qt,x,mt,tt,Tt,Ot)},ys=(L,O,_e,ze)=>{const St=lp(L,O,_e,ze,Ze,Be);an(L,O,St)},vs=(L,O)=>{const _e=cp(L,O,Ze,Be);an(L,O,_e)},_r=(L,O,_e)=>{const ze=up(L,O,_e,Ze,Be);an(L,O,ze)},wr=L=>{Ap(L,Ot)},_s=()=>{Ep(Jt,Vt,$t,Mt,qt,x,Ze,Be,an,Qe)},ws=(L,O)=>{Lp(L,O,Qe,ut,Ln,Fe,Tt,Ot,mt,tt)},Sr=L=>{L&&(L.preventDefault(),L.stopPropagation()),q(O=>!O)},Ss=L=>{He(L),q(!1),Be("generatedImages",L.generatedImages||[]),Be("selectedImageIndex",null),Be("currentPage",1)},Nr=L=>{L&&(L.preventDefault(),L.stopPropagation()),He(null)},Ns=(L,O)=>{console.log("key--->",L,O);const _e={currentScreen:d,selectedParams:h,task_id:x,isProcessing:I,isCompleted:S,completedCount:M,totalCount:R,selectedImageIndex:F,generatedImages:Z,paramTestValues:w,searchTerms:z,inputValues:$e,currentPage:te,textInputs:Ze};console.log("doSaveState-->",_e),ip({..._e,[L]:O})},Be=(L,O)=>{switch(L){case"currentSceen":f(O);break;case"selectedParams":m(O);break;case"taskId":v(O);break;case"isProcessing":_(O);break;case"isCompleted":j(O);break;case"completedCount":P(O);break;case"totalCount":D(O);break;case"selectedImageIndex":G(O);break;case"generatedImages":ae(O);break;case"paramTestValues":B(O);break;case"searchTerms":le(O);break;case"inputValues":U(O);break;case"currentPage":fe(O);break;case"textInputs":zt(O);break}Ns(L,O)};k.useEffect(()=>{if(!yn||!a||a.length===0)return;const L={...w},O=a.map(ze=>ze.id.toString());Object.keys(L).forEach(ze=>{O.includes(ze)||delete L[ze]}),a.forEach(ze=>{const St=ze.id.toString();L[St]||(L[St]={})}),JSON.stringify(L)!==JSON.stringify(w)&&Be("paramTestValues",L)},[a,w,yn]),k.useEffect(()=>{Le({type:"SET_SCREEN_STATE",payload:{currentScreen:d,isProcessing:I,isCompleted:S}})},[d,I,S,Le]),k.useEffect(()=>{const L=document.createElement("style");return L.textContent=sp,document.head.appendChild(L),()=>{document.head.removeChild(L)}},[]),k.useEffect(()=>{const L=O=>{if(Object.values(V).some(_e=>_e)){const _e=O.target,ze=!!_e.closest(".dropdown-menu"),St=!!_e.closest("[data-dropdown]");!ze&&!St&&de({})}};return document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[V]),k.useEffect(()=>{u&&(JSON.parse(localStorage.getItem(yr)||"{}").task_id||Be("taskId",Xe()))},[u]),k.useEffect(()=>{if(I&&Ve.current){Ve.current=!1;let L=0;const O=Object.values(Te.graph._nodes_by_id),_e=[],ze=[];for(const On of O)On.type==="SaveImage"?_e.push(On.id):On.type==="PreviewImage"&&ze.push(On.id);const St=[..._e,...ze];St.length===1?L=St[0]:St.length>1&&(L=void 0),jr(void 0,L)}},[I]),k.useEffect(()=>{if(u){wt(!0);try{const L=localStorage.getItem(yr);if(L){const O=JSON.parse(L);if(!a||a.length===0){console.log("Not restoring parameter debug state: no nodes selected"),wt(!1);return}O.currentScreen!==void 0&&f(O.currentScreen),O.selectedParams&&m(O.selectedParams),O.task_id&&v(O.task_id),_(O?.isProcessing);const _e=O.generatedImages&&O.generatedImages.length>0;O.isCompleted!==void 0&&_e&&j(O.isCompleted),O.completedCount!==void 0&&P(O.completedCount),O.totalCount!==void 0&&D(O.totalCount),O.selectedImageIndex!==void 0&&G(O.selectedImageIndex),O.generatedImages&&ae(O.generatedImages),O.paramTestValues&&B(O.paramTestValues),O.searchTerms&&le(O.searchTerms),O.inputValues&&U(O.inputValues),O.currentPage!==void 0&&fe(O.currentPage),O.textInputs&&zt(O.textInputs),yn||Xn(!0)}}catch(L){console.error("Error loading parameter debug state:",L)}finally{setTimeout(()=>{wt(!1)},50)}}else wt(!0)},[u,a]);const Is=(L=!1)=>{Mp(f,m,v,er,_,j,P,D,G,ae,B,de,le,U,fe,be,re,Y,Ee,je,zt,Qe,Fe,Tt,mt,ut,Ln,tt,Ot,L),q(!1),He(null)},Mn=L=>{yp(d,h,w,Ze,a,be,Ui,Be,L)},Zn=L=>{vp(d,a,w,Ze,S,be,Be,L)},Qn=(L,O)=>{pp(L,h,w,Be,O)},js=(L,O,_e)=>{dp(L,O,_e,V,de)},an=(L,O,_e)=>{fp(L,O,_e,w,Be)},ks=(L,O,_e,ze)=>{hp(L,O,_e,w,Be,ze)},Cs=(L,O,_e)=>{gp(L,O,_e,z,Be)},As=(L,O,_e)=>{mp(L,O,_e,w,an)},Ir=(L,O)=>{_p(L,ne,Z,Be,O)},er=()=>{Rl(De,Pe)};k.useEffect(()=>()=>{er()},[]);const jr=async(L,O)=>{kp(w,x,be,Pe,De,Ui,Te,Be,L,O)},tr=(L,O)=>{O&&(O.preventDefault(),O.stopPropagation()),Be("selectedImageIndex",L)},kr=(L,O,_e)=>{xp(L,O,a,Ee,je,Y,_e)},vn=L=>{bp(Y,L)},Es=async L=>{Tp(F,Z,Te,x,w,re,L)},ln=(L,O)=>{Op(d,a,O,Le,r,Is,L)},Tn=()=>i.jsx(i.Fragment,{children:i.jsx(br,{visible:$,imageUrl:we,params:Oe||{},onClose:vn})});return Se?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:L=>L.stopPropagation(),children:i.jsx(rp,{historyItem:Se,selectedImageIndex:F,handleSelectImage:tr,handleClose:Nr,currentPage:te,handlePageChange:Ir,imagesPerPage:ne,modalVisible:$,modalImageUrl:we,modalImageParams:Oe,openImageModal:kr,closeImageModal:vn})}):on?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:L=>L.stopPropagation(),children:i.jsx(np,{historyItems:ce,onViewHistoryItem:Ss,onClose:Sr})}):Pt&&u&&a.length>0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:L=>L.stopPropagation(),children:[i.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),i.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),i.jsx(br,{visible:$,imageUrl:we,params:Oe||{},onClose:vn})]}):!u||a.length===0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:L=>L.stopPropagation(),children:[i.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[i.jsxs("div",{className:"absolute top-3 right-3 flex",children:[i.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:Sr,title:"Show History",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:ln,children:i.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"mb-6 text-center",children:[i.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),i.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"text-left mb-4",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),i.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),i.jsx(br,{visible:$,imageUrl:we,params:Oe||{},onClose:vn})]}):S?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:L=>L.stopPropagation(),children:i.jsx(Q0,{generatedImages:Z,selectedImageIndex:F,handleSelectImage:tr,handleApplySelected:Es,handlePrevious:Zn,handleClose:ln,currentPage:te,handlePageChange:Ir,imagesPerPage:ne,notificationVisible:H,modalVisible:$,modalImageUrl:we,modalImageParams:Oe,openImageModal:kr,closeImageModal:vn})}):I?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:L=>L.stopPropagation(),children:[i.jsx(B0,{selectedNodes:a,paramTestValues:w,selectedParams:h,totalCount:R,completedCount:M,errorMessage:ve,handleClose:ln,updateState:Be,cleanupPolling:er}),i.jsx(Tn,{})]}):d===0?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:L=>L.stopPropagation(),children:[i.jsx(D0,{selectedNodes:a,handleParamSelect:Qn,selectedParams:h,handleNext:Mn,handleClose:ln}),i.jsx(Tn,{})]}):d===1?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:L=>L.stopPropagation(),children:[i.jsx(W0,{selectedNodes:a,paramTestValues:w,selectedParams:h,updateParamTestValues:an,toggleDropdown:js,openDropdowns:V,handleTestValueSelect:ks,searchTerms:z,handleSearch:Cs,handleSelectAll:As,handleNext:Mn,handlePrevious:Zn,handleClose:ln,inputValues:$e,updateState:Be,textInputs:Ze,handleTextInputChange:ys,handleAddTextInput:vs,handleRemoveTextInput:_r,openAiWritingModal:ws}),i.jsx(ep,{visible:ct,aiWritingModalText:qt,setAiWritingModalText:Fe,aiGeneratedTexts:Mt,aiSelectedTexts:$t,aiWritingLoading:et,aiWritingError:Ut,handleAiWriting:bs,toggleTextSelection:wr,addSelectedTexts:_s,onClose:()=>Qe(!1)}),i.jsx(Tn,{})]}):i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:L=>L.stopPropagation(),children:[i.jsx(F0,{selectedNodes:a,paramTestValues:w,selectedParams:h,totalCount:R,errorMessage:ve,handlePrevious:Zn,handleStartGeneration:jr,handleClose:ln}),i.jsx(Tn,{})]})},Rp=a=>{const{dispatch:u}=bn(),[r,d]=k.useState(!1);return k.useEffect(()=>{if(a.visible&&!r){const f=op();f&&f.screenState&&u({type:"SET_SCREEN_STATE",payload:{currentScreen:f.currentScreen,isProcessing:f.isProcessing,isCompleted:f.isCompleted}}),d(!0)}},[a.visible,r,u]),k.useEffect(()=>()=>{a.visible||u({type:"SET_SCREEN_STATE",payload:null})},[a.visible,u]),i.jsx(Pp,{...a})},Dp=({message:a,onClose:u})=>a?i.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex-shrink-0 mr-1",children:i.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),i.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:i.jsx(Ym,{rehypePlugins:[[Gm,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[$m],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:r,...d})=>i.jsx("a",{...d,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:r})=>i.jsx("span",{className:"inline",style:{fontSize:"11px"},children:r}),span:({children:r})=>i.jsx("span",{style:{fontSize:"11px"},children:r}),li:({children:r})=>i.jsx("li",{style:{fontSize:"11px"},children:r}),ul:({children:r})=>i.jsx("ul",{style:{fontSize:"11px"},children:r}),ol:({children:r})=>i.jsx("ol",{style:{fontSize:"11px"},children:r})},children:a})})]}),i.jsx("button",{onClick:u,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,Wp=()=>{const{state:a,dispatch:u}=bn(),{selectedNode:r,screenState:d}=a,f=r||[],h=()=>{u({type:"SET_SELECTED_NODE",payload:null}),u({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return i.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:i.jsx(Rp,{selectedNodes:f,visible:!0,onClose:h})})},kl=({active:a,onClick:u,children:r})=>i.jsx("button",{onClick:u,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 border-b-2 ${a?"text-[#71A3F2] border-[#71A3F2]":"text-gray-600 border-transparent hover:!text-[#71A3F2] hover:!border-[#71A3F2]"}`,children:r});function Kp({onClose:a,visible:u=!0,triggerUsage:r=!1,onUsageTriggered:d}){const{state:f,dispatch:h,isAutoScroll:m,showcasIng:x}=bn(),{messages:v,installedNodes:I,loading:_,sessionId:S,selectedNode:j,activeTab:M,guiding:P}=f;k.useRef(null);const[R,D]=k.useState(""),[F,G]=k.useState(""),[Z,ae]=k.useState(window.innerWidth/3),[w,B]=k.useState(!1),[V,de]=k.useState([]),[z,le]=k.useState("gpt-4o-mini"),[$e,U]=k.useState(window.innerHeight),[te,fe]=k.useState(0),[ne,ve]=k.useState(""),[be,H]=k.useState(!1),re=k.useRef(null);k.useRef(j);const[$,Y]=k.useState("None");P0(u&&M==="chat"),R0(u),k.useEffect(()=>{switch($){case"Usage":et();break;case"Parameters":mt();break;case"DownstreamNodes":ut();break}Y("None")},[$]),k.useEffect(()=>{if(M!=="chat")return;(async()=>{const ce=await E0();console.log("[WorkflowChat] Received installed nodes:",ce.length),h({type:"SET_INSTALLED_NODES",payload:ce})})()},[M]);const we=()=>{h({type:"SET_GUIDING",payload:!0}),h({type:"SET_MESSAGES",payload:[{id:Xe(),role:"showcase",content:""}]})},Ee=async q=>{try{const ce=await Bt.fetchMessages(q);ce?.length>0?h({type:"SET_MESSAGES",payload:ce}):we()}catch(ce){console.error("Error fetching messages:",ce)}};k.useEffect(()=>{if(M!=="chat")return;let q=localStorage.getItem("sessionId");q?(h({type:"SET_SESSION_ID",payload:q}),Ee(q)):(q=Xe(),h({type:"SET_SESSION_ID",payload:q}),localStorage.setItem("sessionId",q))},[M]),k.useEffect(()=>{const q=localStorage.getItem("activeTab");q&&h({type:"SET_ACTIVE_TAB",payload:q});const ce=localStorage.getItem("screenState");ce&&h({type:"SET_SCREEN_STATE",payload:JSON.parse(ce)});const ye=()=>{Y("Usage")},Se=()=>{Y("Parameters")},He=()=>{Y("DownstreamNodes")};return window.addEventListener(Vn.TOOLBOX_USAGE,ye),window.addEventListener(Vn.TOOLBOX_PARAMETERS,Se),window.addEventListener(Vn.TOOLBOX_DOWNSTREAMNODES,He),()=>{window.removeEventListener(Vn.TOOLBOX_USAGE,ye),window.removeEventListener(Vn.TOOLBOX_PARAMETERS,Se),window.removeEventListener(Vn.TOOLBOX_DOWNSTREAMNODES,He)}},[]),k.useEffect(()=>{localStorage.setItem("activeTab",M)},[M]),k.useEffect(()=>{f.screenState&&localStorage.setItem("screenState",JSON.stringify(f.screenState))},[f.screenState]);const Oe=ms.useCallback(q=>{if(!w)return;const ce=window.innerWidth-q.clientX,ye=Math.min(Math.max(300,ce),window.innerWidth*.8);ae(ye)},[w]),je=ms.useMemo(()=>$i.debounce(Oe,16),[Oe]);k.useEffect(()=>(w&&(document.addEventListener("mousemove",je),document.addEventListener("mouseup",Ut)),()=>{document.removeEventListener("mousemove",je),document.removeEventListener("mouseup",Ut),je.cancel()}),[w,je]);const Ze=q=>{D(q.target.value)},zt=()=>{re.current&&(re.current.abort(),re.current=null,h({type:"SET_LOADING",payload:!1}))},ct=async()=>{if(P&&(h({type:"SET_GUIDING",payload:!1}),h({type:"CLEAR_MESSAGES"})),m.current=!0,x.current=!1,h({type:"SET_LOADING",payload:!0}),R.trim()===""&&!j||!S)return;G(R);const q=Xe(),ce={id:Xe(),role:"user",content:R,trace_id:q};h({type:"ADD_MESSAGE",payload:ce}),D(""),re.current=new AbortController;try{const ye={type:"model_select",data:[z]};let Se=Xe(),He=!0;for await(const Le of Bt.streamInvokeServer(S,R,V.map(De=>De.file),null,ye,q,re.current.signal)){const De={id:Se,role:"ai",content:JSON.stringify(Le),format:Le.format,finished:Le.finished,name:"Assistant"};if(He)h({type:"ADD_MESSAGE",payload:De}),He=!1;else{h({type:"UPDATE_MESSAGE",payload:De});const Pe=f.messages.map(Ve=>Ve.id===De.id&&!Ve.finished?De:Ve);Vt(Pe)}Le.finished&&(h({type:"SET_LOADING",payload:!1}),re.current=null)}}catch(ye){ye instanceof Error&&ye.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",ye),h({type:"SET_LOADING",payload:!1}),re.current=null}finally{de([])}},Qe=async q=>{if(!S)return;h({type:"SET_LOADING",payload:!0}),G(q);const ce=Xe(),ye={id:Xe(),role:"user",content:q,trace_id:ce};h({type:"ADD_MESSAGE",payload:ye}),re.current=new AbortController;try{const Se={type:"model_select",data:[z]};let He=Xe(),Le=!0;for await(const De of Bt.streamInvokeServer(S,q,V.map(Pe=>Pe.file),null,Se,ce,re.current.signal)){const Pe={id:He,role:"ai",content:JSON.stringify(De),format:De.format,finished:De.finished,name:"Assistant"};if(Le)h({type:"ADD_MESSAGE",payload:Pe}),Le=!1;else{h({type:"UPDATE_MESSAGE",payload:Pe});const Ve=f.messages.map(Pt=>Pt.id===Pe.id&&!Pt.finished?Pe:Pt);Vt(Ve)}De.finished&&(h({type:"SET_LOADING",payload:!1}),re.current=null)}}catch(Se){Se instanceof Error&&Se.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Se),h({type:"SET_LOADING",payload:!1}),re.current=null}finally{de([])}},qt=q=>{q.metaKey&&q.key==="Enter"&&ct()},Fe=()=>{x.current=!1,h({type:"CLEAR_MESSAGES"});const q=f.sessionId;q&&localStorage.removeItem(`messages_${q}`),localStorage.removeItem("sessionId");const ce=Xe();h({type:"SET_SESSION_ID",payload:ce}),localStorage.setItem("sessionId",ce),setTimeout(()=>{we()},500)},Mt=q=>{D(q)},Tt=async(q,ce)=>{if(!S||!j)return;h({type:"SET_LOADING",payload:!0});const ye=j[0].comfyClass||j[0].type,Se=Xe(),He={id:Xe(),role:"user",content:ye,trace_id:Se};h({type:"ADD_MESSAGE",payload:He}),re.current=new AbortController;try{let Le=Xe(),De=!0;for await(const Pe of Bt.streamInvokeServer(S,ye,[],q,ce,Se,re.current.signal)){const Ve={id:Le,role:"ai",content:JSON.stringify(Pe),format:Pe.format,finished:Pe.finished,name:"Assistant"};if(q&&q!==""&&(Ve.metadata={intent:q}),De)h({type:"ADD_MESSAGE",payload:Ve}),De=!1;else{h({type:"UPDATE_MESSAGE",payload:Ve});const Pt=f.messages.map(wt=>wt.id===Ve.id&&!wt.finished?Ve:wt);Vt(Pt)}Pe.finished&&(h({type:"SET_LOADING",payload:!1}),re.current=null)}}catch(Le){Le instanceof Error&&Le.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Le),h({type:"SET_LOADING",payload:!1}),re.current=null}},et=()=>{Qe(`Reply in ${navigator.language} language: How does the ${j?.[0]?.type} node work? I need its official usage guide.`)},mt=()=>{Qe(`Reply in ${navigator.language} language: Show me the technical specifications for the ${j?.[0].type} node's inputs and outputs.`)},Jt=()=>{const q=new Set;function ce(ye,Se){if(!(!ye||Se>=1)&&ye.inputs)for(const He of Object.values(ye.inputs)){const Le=He.link;if(Le&&Te.graph.links[Le]){const De=Te.graph.links[Le].origin_id,Pe=Te.graph._nodes_by_id[De];Pe&&(q.add(Pe.type),ce(Pe,Se+1))}}}return j[0]?(ce(j[0],0),[{type:"upstream_node_types",data:Array.from(q)}]):null},ut=()=>{Tt("downstream_subgraph_search",Jt())},Vt=q=>{f.sessionId&&localStorage.setItem(`messages_${f.sessionId}`,JSON.stringify(q))},Ln=q=>{console.log("[WorkflowChat] Adding new message:",q);const ce=[...f.messages,q];h({type:"ADD_MESSAGE",payload:q}),Vt(ce)},Ut=()=>{B(!1)},tt=q=>{const ce=Array.from(q).map(ye=>({id:Math.random().toString(36).substr(2,9),file:ye,preview:URL.createObjectURL(ye)}));de(ye=>[...ye,...ce])},$t=q=>{de(ce=>ce.filter(Se=>Se.id!==q))};ms.useEffect(()=>()=>{V.forEach(q=>URL.revokeObjectURL(q.preview))},[V]),k.useEffect(()=>{r&&d&&M==="chat"&&(Tt("node_explain"),d())},[r,M]),k.useEffect(()=>{if(!u||M!=="chat")return;(async()=>{try{const ce=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==ce){const Se=await Bt.fetchAnnouncement();Se&&Se.trim()!==""&&(ve(Se),H(!0),localStorage.setItem("announcementLastShownDate",ce))}}catch(ce){console.error("Error fetching announcement:",ce)}})()},[u,M]);const Ot=()=>{H(!1)},on=q=>{h({type:"SET_ACTIVE_TAB",payload:q})};return u?i.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:u?"flex":"none"},children:[i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx(m0,{onClose:a,onClear:Fe,hasMessages:v.length>0,title:"ComfyUI-Copilot"}),i.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[i.jsx(kl,{active:M==="chat",onClick:()=>on("chat"),children:"Chat"}),i.jsx(kl,{active:M==="parameter-debug",onClick:()=>on("parameter-debug"),children:"GenLab"})]}),be&&ne&&M==="chat"&&i.jsx(Dp,{message:ne,onClose:Ot}),i.jsx(C0,{messages:v,latestInput:F,onOptionClick:Mt,installedNodes:I,onAddMessage:Ln,loading:_,isActive:M==="chat"}),i.jsx("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:M==="chat"?"block":"none"},children:i.jsx(x0,{input:R,loading:_,onChange:Ze,onSend:ct,onKeyPress:qt,onUploadImages:tt,uploadedImages:V,onRemoveImage:$t,selectedModel:z,onModelChange:le,onStop:zt})}),i.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:M==="parameter-debug"?"flex":"none"},children:i.jsx(Wp,{})})]})]}):null}export{Kp as default};
