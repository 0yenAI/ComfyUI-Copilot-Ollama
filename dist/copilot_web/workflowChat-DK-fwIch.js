function getImportPath(filename) {
            return `./${filename}`;
        }
            const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/WorkflowOption-Bw9rjRRx.js","copilot_web/vendor-markdown-CBmlBP6m.js","copilot_web/vendor-react-Dixhfmvb.js","copilot_web/message-components-CUa5mpgi.js"].map(path => {
                        const apiBase = window.comfyAPI?.api?.api?.api_base;
                        if (apiBase) {
                            // 有 API base 时，使用完整路径
                            return `${apiBase.substring(1)}/${path}`;
                        } else {        
                            // 没有 API base 时，使用相对路径
                            return `./${path}`;
                        }
                    }))))=>i.map(i=>d[i]);
import{j as i,r as Bg,b as Fg}from"./vendor-markdown-CBmlBP6m.js";import{r as j,R as hs,c as gr,a as zg}from"./vendor-react-Dixhfmvb.js";import{f as Ug,v as Gg,W as Dt,a as Oe,B as Hg,U as Kg,A as fs,b as qg,g as et,c as xr,u as Jn,M as Jg}from"./message-components-CUa5mpgi.js";import{_ as ps}from"./input.js";/* empty css     *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kl=(...a)=>a.filter((u,r,d)=>!!u&&u.trim()!==""&&d.indexOf(u)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zg=j.forwardRef(({color:a="currentColor",size:u=24,strokeWidth:r=2,absoluteStrokeWidth:d,className:f="",children:h,iconNode:p,...x},b)=>j.createElement("svg",{ref:b,...Yg,width:u,height:u,stroke:a,strokeWidth:d?Number(r)*24/Number(u):r,className:kl("lucide",f),...x},[...p.map(([S,w])=>j.createElement(S,w)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=(a,u)=>{const r=j.forwardRef(({className:d,...f},h)=>j.createElement(Zg,{ref:h,iconNode:u,className:kl(`lucide-${Vg(a)}`,d),...f}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],Qg=kn("CircleStop",Xg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],tp=kn("Image",ep);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],rp=kn("Plus",np);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ip=kn("Send",sp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ap=kn("Settings",op);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],cp=kn("Trash",lp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Fi=kn("X",up);function dp({isOpen:a,onClose:u,onSave:r,initialApiKey:d=""}){const[f,h]=j.useState(d),[p,x]=j.useState(!1),[b,S]=j.useState(""),[w,_]=j.useState("https://api.openai.com/v1"),[A,O]=j.useState(!1),[R,W]=j.useState(!1),[F,B]=j.useState(null),[z,X]=j.useState(null);j.useEffect(()=>{h(d);const U=localStorage.getItem("openaiApiKey"),Y=localStorage.getItem("openaiBaseUrl");U&&S(U),Y&&_(Y),(async()=>{try{const G=localStorage.getItem("rsaPublicKey");if(G)X(G);else{const ue=await Ug();X(ue),localStorage.setItem("rsaPublicKey",ue)}}catch(G){console.error("Failed to fetch RSA public key:",G)}})()},[d]);const M=async()=>{if(!b.trim()){B({success:!1,message:"Please enter an OpenAI API key"});return}if(!z){B({success:!1,message:"RSA public key not available. Please try again later."});return}W(!0),B(null);try{const U=await Gg(b,w,z);B({success:U,message:U?"API key is valid!":"Invalid API key. Please check and try again."})}catch(U){B({success:!1,message:U instanceof Error?U.message:"Failed to verify API key"})}finally{W(!1)}},T=()=>{r(f),b.trim()?(localStorage.setItem("openaiApiKey",b),localStorage.setItem("openaiBaseUrl",w)):(localStorage.removeItem("openaiApiKey"),localStorage.removeItem("openaiBaseUrl")),u()};return a?i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] shadow-2xl",children:[i.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:p?"text":"password",value:f,onChange:U=>h(U.target.value),placeholder:"Enter your API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg mb-4 pr-12
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                            hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>x(!p),children:p?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[i.jsx("span",{children:"Don't have an API key? "}),i.jsx("a",{href:"https://form.typeform.com/to/tkg91K8D",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Click here to request one"})]})]}),i.jsxs("div",{className:"mb-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[i.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:"OpenAI API Configuration (Optional)"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:A?"text":"password",value:b,onChange:U=>S(U.target.value),placeholder:"Enter your OpenAI API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs
                                bg-gray-50 dark:bg-gray-700 
                                text-gray-900 dark:text-white
                                placeholder-gray-500 dark:placeholder-gray-400
                                focus:border-blue-500 dark:focus:border-blue-400 
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                                hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>O(!A),children:A?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI Base URL"}),i.jsx("input",{type:"text",value:w,onChange:U=>_(U.target.value),placeholder:"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`})]}),i.jsx("div",{className:"flex items-center mb-2",children:i.jsx("button",{onClick:M,disabled:R||!b.trim(),className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${R||!b.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:R?i.jsxs("span",{className:"flex items-center",children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),F&&i.jsx("div",{className:`text-xs p-2 rounded-md ${F.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:F.message})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:u,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),i.jsx("button",{onClick:T,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]})}):null}const fp="/copilot_web/assets/logo-BTZhX0BN.png";function hp({onClose:a,onClear:u,hasMessages:r,onHeightResize:d,title:f="ComfyUI-Copilot"}){const[h,p]=j.useState(!1),[x,b]=j.useState(!1),S=()=>{p(!0)},w=_=>{localStorage.setItem("chatApiKey",_)};return j.useEffect(()=>{const _=O=>{if(!x)return;const R=O.movementY;d?.(R)},A=()=>{b(!1)};return x&&(document.addEventListener("mousemove",_),document.addEventListener("mouseup",A)),()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",A)}},[x,d]),i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 
                        bg-white border-gray-200 sticky top-2 z-10`,children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("img",{src:`.${fp}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),i.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:f}),i.jsx("button",{onClick:S,className:"p-1 bg-white border-none hover:bg-gray-100 rounded text-gray-500",children:i.jsx(ap,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex items-center gap-1",children:i.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${r?"text-gray-500 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!r,onClick:u,children:i.jsx(cp,{className:"h-4 w-4"})})})]}),i.jsx(dp,{isOpen:h,onClose:()=>p(!1),onSave:w,initialApiKey:localStorage.getItem("chatApiKey")||""})]})}const gp=5*1024*1024,xl=["image/jpeg","image/png","image/gif","image/webp"];function pp({input:a,loading:u,onChange:r,onSend:d,onKeyPress:f,onUploadImages:h,uploadedImages:p,onRemoveImage:x,selectedModel:b,onModelChange:S,onStop:w}){const[_,A]=j.useState(!1),[O,R]=j.useState([]),W=hs.useRef(null),F=j.useRef(null);j.useEffect(()=>{F.current&&(F.current.style.height="auto",F.current.style.height=`${Math.min(F.current.scrollHeight,400)}px`)},[a]),j.useEffect(()=>{(async()=>{try{const X=await Dt.listModels();R(X.models)}catch(X){console.error("Failed to load models:",X),R([{name:"gpt-4o",image_enable:!0},{name:"gpt-4o-mini",image_enable:!0},{name:"qwen-plus",image_enable:!1},{name:"DeepSeek-V3",image_enable:!1}])}})()},[]);const B=z=>{if(z.target.files){const X=[],M=[];if(Array.from(z.target.files).forEach(T=>{xl.includes(T.type)?T.size>gp?X.push(`${T.name} (exceeds 5MB)`):M.push(T):X.push(`${T.name} (unsupported format)`)}),X.length>0&&alert(`The following files couldn't be uploaded:
${X.join(`
`)}`),M.length>0){const T=new DataTransfer;M.forEach(U=>T.items.add(U)),h(T.files)}}};return i.jsxs("div",{className:`relative ${p.length>0?"mt-12":""}`,children:[p.length>0&&i.jsx("div",{className:"absolute -top-10 left-0 flex gap-2",children:p.map(z=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:z.preview,alt:"uploaded",className:"w-8 h-8 rounded object-cover"}),i.jsx("button",{onClick:()=>x(z.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5
                                         opacity-0 group-hover:opacity-100 transition-opacity`,children:i.jsx(Fi,{className:"w-3 h-3"})})]},z.id))}),i.jsx("textarea",{ref:F,onChange:r,onKeyDown:z=>{if(z.key==="Enter"&&!z.shiftKey){if(z.nativeEvent.isComposing)return;z.preventDefault(),a.trim()!==""&&d()}f(z)},value:a,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border 
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm 
                         focus:outline-none focus:ring-2 focus:ring-blue-500 
                         focus:border-transparent bg-white transition-all 
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),i.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-2 
                          bg-white border-t border-gray-100 pt-1`,children:[i.jsx("select",{value:b,onChange:z=>S(z.target.value),className:`px-1.5 py-0.5 text-xs rounded-md 
                             border border-gray-200 bg-white text-gray-700
                             focus:outline-none focus:ring-2 focus:ring-blue-500
                             focus:border-transparent hover:bg-gray-50
                             transition-colors border-0`,children:O.map(z=>i.jsx("option",{value:z.name,children:z.name},z.name))}),i.jsx("button",{type:"button",onClick:()=>A(!0),disabled:!O.find(z=>z.name===b)?.image_enable,className:`p-1.5 text-gray-500 bg-white border-none
                             hover:bg-gray-100 hover:text-gray-600 
                             transition-all duration-200 outline-none
                             ${O.find(z=>z.name===b)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx(tp,{className:"h-4 w-4"})})]}),i.jsx("button",{type:"submit",onClick:u?w:d,disabled:u?!1:a.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50 
                         transition-all duration-200 active:scale-95`,children:u?i.jsx(Qg,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):i.jsx(ip,{className:"h-5 w-5 group-hover:translate-x-1"})}),_&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[i.jsx("button",{onClick:()=>A(!1),className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:text-gray-700",children:i.jsx(Fi,{className:"w-5 h-5"})}),i.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),i.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8
                                      flex flex-col items-center justify-center gap-4
                                      hover:border-blue-500 transition-colors cursor-pointer`,onClick:()=>W.current?.click(),children:[i.jsx(rp,{className:"w-8 h-8 text-gray-400"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB"})]})]}),i.jsx("input",{ref:W,type:"file",multiple:!0,accept:xl.join(","),onChange:B,className:"hidden"}),p.length>0&&i.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:p.map(z=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:z.preview,alt:"preview",className:"w-full h-20 object-cover rounded"}),i.jsx("button",{onClick:()=>x(z.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 
                                                     rounded-full p-0.5 opacity-0 group-hover:opacity-100 
                                                     transition-opacity`,children:i.jsx(Fi,{className:"w-3 h-3"})})]},z.id))}),i.jsx("div",{className:"mt-4 flex justify-end gap-2",children:i.jsx("button",{onClick:()=>A(!1),className:`px-4 py-2 text-sm font-medium text-gray-700 
                                         bg-white border border-gray-300 rounded-md 
                                         hover:bg-gray-50`,children:"Close"})})]})})]})}function mp(a){const u=a[0],r=new Set;function d(f,h){if(!(!f||h>=1)&&f.inputs)for(const p of Object.values(f.inputs)){const x=p.link;if(x&&Oe.graph.links[x]){const b=Oe.graph.links[x].origin_id,S=Oe.graph._nodes_by_id[b];S&&(r.add(S.type),d(S,h+1))}}}return u?(d(u,0),[{type:"upstream_node_types",data:Array.from(r)}]):null}function xp({nodeInfo:a,onSendWithIntent:u,loading:r,onSendWithContent:d}){return console.log("SelectedNodeInfo nodeInfo:",a[0]),i.jsx("div",{className:"mb-3 p-3 rounded-md bg-gray-50 border border-gray-200",children:i.jsxs("div",{className:"text-sm text-gray-700",children:[i.jsxs("p",{children:["Selected node: ",a[0].type]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-blue-50 
                                 text-blue-700 hover:bg-blue-100`,onClick:()=>d(`Reply in ${navigator.language} language: How does the ${a[0].type} node work? I need its official usage guide.`),disabled:r,children:"Usage"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-green-100 
                                 text-green-700 hover:bg-green-200`,onClick:()=>d(`Reply in ${navigator.language} language: Show me the technical specifications for the ${a[0].type} node's inputs and outputs.`),disabled:r,children:"Parameters"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-purple-100 
                                 text-purple-700 hover:bg-purple-200`,onClick:()=>u("downstream_subgraph_search",mp(a)),disabled:r,children:"Downstream Nodes"})]})]})})}function vp(){return i.jsx(Hg,{name:"Assistant",children:i.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),i.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const yp=a=>`https://ui-avatars.com/api/?name=${a||"User"}&background=random`,bp=j.lazy(()=>ps(()=>import(getImportPath("WorkflowOption-Bw9rjRRx.js")),__vite__mapDeps([0,1,2,3])).then(a=>({default:a.WorkflowOption}))),_p=j.lazy(()=>ps(()=>import(getImportPath("message-components-CUa5mpgi.js")).then(a=>a.N),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeSearch}))),wp=j.lazy(()=>ps(()=>import(getImportPath("message-components-CUa5mpgi.js")).then(a=>a.D),__vite__mapDeps([3,2,1])).then(a=>({default:a.DownstreamSubgraphs}))),Np=j.lazy(()=>ps(()=>import(getImportPath("message-components-CUa5mpgi.js")).then(a=>a.d),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeInstallGuide}))),Sp=3;function jp({messages:a,latestInput:u,onOptionClick:r,installedNodes:d,onAddMessage:f,loading:h,isActive:p}){const[x,b]=j.useState(0),[S,w]=j.useState([]),_=j.useRef(null),A=j.useRef(0),O=j.useRef(0),R=j.useRef(!1),W=()=>{_?.current&&(_.current.scrollTop=_.current.scrollHeight)},F=M=>{if(M.role==="user")return i.jsx(Kg,{content:M.content,trace_id:M.trace_id},M.id);if(M.role==="ai"||M.role==="tool"){const T=yp(M.role);try{const U=JSON.parse(M.content),Y=U.ext?.find(D=>D.type==="workflow"),Me=U.ext?.find(D=>D.type==="node"),G=U.ext?.find(D=>D.type==="downstream_subgraph_search"),ue=U.ext?.find(D=>D.type==="node_install_guide");let je=null;if(Y)je=i.jsx(j.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(bp,{content:M.content,name:M.name,avatar:T,latestInput:u,installedNodes:d,onAddMessage:f,onFinishLoad:W})});else if(Me)je=i.jsx(j.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(_p,{content:M.content,name:M.name,avatar:T,installedNodes:d,onFinishLoad:W})});else if(G){const D=i.jsx(j.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(wp,{content:M.content,name:M.name,avatar:T,onAddMessage:f,onFinishLoad:W})});if(M.metadata?.intent==="downstream_subgraph_search")return i.jsx(fs,{content:M.content,name:M.name,avatar:T,format:M.format,onOptionClick:r,extComponent:D,metadata:M.metadata},M.id);je=D}else ue&&(je=i.jsx(j.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Np,{content:M.content,onLoadSubgraph:()=>{if(M.metadata?.pendingSubgraph){const D=Object.values(Oe.canvas.selected_nodes)[0];if(D){const be=M.metadata.pendingSubgraph,le=be.json.nodes,re=be.json.links,ne=le.find(oe=>oe.id===0),he=ne?.id,q={};he&&(q[he]=D),Oe.canvas.emitBeforeChange();try{for(const oe of le)if(oe.id!==he){const J=ne?.pos||[0,0],Z=D._pos||[0,0],Ee=[oe.pos[0]+Z[0]-J[0],oe.pos[1]+Z[1]-J[1]];q[oe.id]=qg(oe.type,{pos:Ee})}}finally{Oe.canvas.emitAfterChange()}for(const oe of re){const J=q[oe.origin_id],Z=q[oe.target_id];J&&Z&&J.connect(oe.origin_slot,Z,oe.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(M.metadata?.pendingWorkflow){const D=M.metadata.pendingWorkflow,be=M.metadata.optimizedParams;if(D.nodes)Oe.loadGraphData(D);else{Oe.loadApiJson(D);const re=Object.keys(D),ne=Object.keys(Oe.graph._nodes_by_id)[0],he=Oe.graph._nodes_by_id[ne],q=he?he.pos[0]:0,oe=he?he.pos[1]:0,J=250,Z=60,Ee=20,Te=60,Le=50,Ie=1e3;let Ve=q,yt=oe,tt=0;for(const at of re){const He=Oe.graph._nodes_by_id[at];if(He){tt>Ie&&(Ve+=J+Te,tt=0,yt=oe);const bt=He.inputs?He.inputs.length:0,At=He.outputs?He.outputs.length:0,Wt=He.widgets?He.widgets.length:0,Ye=Math.max(bt,At)+Wt,K=Ee*Ye+Z;He.size[0]=J,He.size[1]=K,He.pos[0]=Ve,He.pos[1]=yt,tt+=K+Le,yt+=K+Le}}}for(const[re,ne,he,q,oe]of be){const J=Oe.graph._nodes_by_id[re].widgets;for(const Z of J)Z.name===q&&(Z.value=oe)}Oe.graph.setDirtyCanvas(!1,!0);const le={id:et(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};f?.(le)}},onFinishLoad:W})}));return U.text||je?i.jsx(fs,{content:M.content,name:M.name,avatar:T,format:M.format,onOptionClick:r,extComponent:je,metadata:M.metadata},M.id):je||i.jsx(fs,{content:M.content,name:M.name,avatar:T,format:M.format,onOptionClick:r,metadata:M.metadata},M.id)}catch(U){return console.error("[MessageList] Error parsing message content:",U),console.error("解析JSON失败",M.content),i.jsx(fs,{content:M.content,name:M.name,avatar:T,format:M.format,onOptionClick:r,metadata:M.metadata},M.id)}}return null},B=M=>{const T=M?.buttonStatus==="not_used";return i.jsx("div",{className:"flex justify-center items-center",children:T?i.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:X,children:"Load more"}):i.jsx("div",{className:"w-full h-[24px] bg-transparent"})},M.id)};function z(M){return M&&typeof M=="object"&&M.buttonType==="loadmore"}const X=()=>{R.current=!0,b(M=>M+1)};return j.useEffect(()=>{let M=[];if(A.current>0&&A.current<a.length)M=a.slice(A.current),a[A.current].role==="user"&&M.unshift({id:`${a[A.current].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),w(T=>[...T,...M]);else{let T=0,U=a?.length;for(let Y=a?.length-1;Y>=0;Y--)if(a[Y].role==="ai"||Y===0)if(T>Sp+x){M.unshift({id:`${a[Y].id}_loadmore`,buttonType:"loadmore",buttonStatus:"not_used"});break}else T++,M?.length>0&&M.unshift({id:`${a[Y].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),M=[...a?.slice(Math.min(U,Y===0?Y:Y+1),U+1),...M],U=Y;w(M)}A.current=a.length},[a,x]),j.useLayoutEffect(()=>{_?.current&&(R.current?(_.current.scrollTop=_.current.scrollHeight-O.current,R.current=!1):_.current.scrollTop=_.current.scrollHeight,O.current=_.current.scrollHeight)},[S]),i.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:_,style:{display:p?"block":"none"},children:[S?.map(M=>!!M&&(z(M)?B(M):F(M))),h&&i.jsx(vp,{})]})}async function Cp(){try{return await(await xr.fetchApi("/object_info",{method:"GET"})).json()}catch(a){throw console.error("Error fetching object info:",a),a}}async function kp(){const a=await Cp();return Object.keys(a)}async function Ep(a){return await(await xr.fetchApi("/prompt",{method:"POST",body:JSON.stringify(a)})).json()}async function Ip(a){try{const u=await xr.fetchApi("/queue",{method:"POST",body:JSON.stringify(a)});if(!u.ok)throw new Error(`Failed to manage queue: ${u.status} ${u.statusText}`);return u}catch(u){throw console.error("Error managing queue:",u),u}}async function Ap(){try{const a=await xr.fetchApi("/interrupt",{method:"POST"});if(!a.ok)throw new Error(`Failed to interrupt processing: ${a.status} ${a.statusText}`);return a}catch(a){throw console.error("Error interrupting processing:",a),a}}async function Mp(a){try{const u=await xr.fetchApi(`/history/${a}`,{method:"GET"});if(!u.ok)throw new Error(`Failed to fetch history: ${u.status} ${u.statusText}`);return await u.json()}catch(u){throw console.error("Error fetching history:",u),u}}var gs={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */gs.exports;(function(a,u){(function(){var r,d="4.17.21",f=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",x="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",S=500,w="__lodash_placeholder__",_=1,A=2,O=4,R=1,W=2,F=1,B=2,z=4,X=8,M=16,T=32,U=64,Y=128,Me=256,G=512,ue=30,je="...",D=800,be=16,le=1,re=2,ne=3,he=1/0,q=9007199254740991,oe=17976931348623157e292,J=NaN,Z=4294967295,Ee=Z-1,Te=Z>>>1,Le=[["ary",Y],["bind",F],["bindKey",B],["curry",X],["curryRight",M],["flip",G],["partial",T],["partialRight",U],["rearg",Me]],Ie="[object Arguments]",Ve="[object Array]",yt="[object AsyncFunction]",tt="[object Boolean]",at="[object Date]",He="[object DOMException]",bt="[object Error]",At="[object Function]",Wt="[object GeneratorFunction]",Ye="[object Map]",K="[object Number]",pe="[object Null]",ye="[object Object]",Be="[object Promise]",Mt="[object Proxy]",Fe="[object RegExp]",we="[object Set]",De="[object String]",ze="[object Symbol]",Lt="[object Undefined]",ft="[object WeakMap]",ms="[object WeakSet]",dn="[object ArrayBuffer]",zt="[object DataView]",fn="[object Float32Array]",hn="[object Float64Array]",En="[object Int8Array]",In="[object Int16Array]",An="[object Int32Array]",gn="[object Uint8Array]",Vn="[object Uint8ClampedArray]",Xt="[object Uint16Array]",pn="[object Uint32Array]",xs=/\b__p \+= '';/g,vs=/\b(__p \+=) '' \+/g,ys=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vr=/&(?:amp|lt|gt|quot|#39);/g,yr=/[&<>"']/g,bs=RegExp(vr.source),_s=RegExp(yr.source),ws=/<%-([\s\S]+?)%>/g,br=/<%([\s\S]+?)%>/g,_r=/<%=([\s\S]+?)%>/g,Ns=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ss=/^\w*$/,We=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yn=/[\\^$.*+?()[\]{}|]/g,wr=RegExp(Yn.source),mn=/^\s+/,js=/\s/,Cs=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qt=/\{\n\/\* \[wrapped with (.+)\] \*/,ks=/,? & /,Es=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Is=/[()=,{}\[\]\/\s]/,Nr=/\\(\\)?/g,Zn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xn=/\w*$/,Sr=/^[-+]0x[0-9a-f]+$/i,jr=/^0b[01]+$/i,xn=/^\[object .+?Constructor\]$/,As=/^0o[0-7]+$/i,en=/^(?:0|[1-9]\d*)$/,Mn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,I=/($^)/,P=/['\n\r\u2028\u2029\\]/g,me="\\ud800-\\udfff",Ke="\\u0300-\\u036f",_t="\\ufe20-\\ufe2f",Ln="\\u20d0-\\u20ff",Hi=Ke+_t+Ln,Ki="\\u2700-\\u27bf",qi="a-z\\xdf-\\xf6\\xf8-\\xff",Tl="\\xac\\xb1\\xd7\\xf7",Rl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Dl="\\u2000-\\u206f",Wl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ji="A-Z\\xc0-\\xd6\\xd8-\\xde",Vi="\\ufe0e\\ufe0f",Yi=Tl+Rl+Dl+Wl,Ms="['’]",$l="["+me+"]",Zi="["+Yi+"]",Cr="["+Hi+"]",Xi="\\d+",Bl="["+Ki+"]",Qi="["+qi+"]",eo="[^"+me+Yi+Xi+Ki+qi+Ji+"]",Ls="\\ud83c[\\udffb-\\udfff]",Fl="(?:"+Cr+"|"+Ls+")",to="[^"+me+"]",Ps="(?:\\ud83c[\\udde6-\\uddff]){2}",Os="[\\ud800-\\udbff][\\udc00-\\udfff]",Pn="["+Ji+"]",no="\\u200d",ro="(?:"+Qi+"|"+eo+")",zl="(?:"+Pn+"|"+eo+")",so="(?:"+Ms+"(?:d|ll|m|re|s|t|ve))?",io="(?:"+Ms+"(?:D|LL|M|RE|S|T|VE))?",oo=Fl+"?",ao="["+Vi+"]?",Ul="(?:"+no+"(?:"+[to,Ps,Os].join("|")+")"+ao+oo+")*",Gl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Hl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lo=ao+oo+Ul,Kl="(?:"+[Bl,Ps,Os].join("|")+")"+lo,ql="(?:"+[to+Cr+"?",Cr,Ps,Os,$l].join("|")+")",Jl=RegExp(Ms,"g"),Vl=RegExp(Cr,"g"),Ts=RegExp(Ls+"(?="+Ls+")|"+ql+lo,"g"),Yl=RegExp([Pn+"?"+Qi+"+"+so+"(?="+[Zi,Pn,"$"].join("|")+")",zl+"+"+io+"(?="+[Zi,Pn+ro,"$"].join("|")+")",Pn+"?"+ro+"+"+so,Pn+"+"+io,Hl,Gl,Xi,Kl].join("|"),"g"),Zl=RegExp("["+no+me+Hi+Vi+"]"),Xl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ql=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ec=-1,Ae={};Ae[fn]=Ae[hn]=Ae[En]=Ae[In]=Ae[An]=Ae[gn]=Ae[Vn]=Ae[Xt]=Ae[pn]=!0,Ae[Ie]=Ae[Ve]=Ae[dn]=Ae[tt]=Ae[zt]=Ae[at]=Ae[bt]=Ae[At]=Ae[Ye]=Ae[K]=Ae[ye]=Ae[Fe]=Ae[we]=Ae[De]=Ae[ft]=!1;var ke={};ke[Ie]=ke[Ve]=ke[dn]=ke[zt]=ke[tt]=ke[at]=ke[fn]=ke[hn]=ke[En]=ke[In]=ke[An]=ke[Ye]=ke[K]=ke[ye]=ke[Fe]=ke[we]=ke[De]=ke[ze]=ke[gn]=ke[Vn]=ke[Xt]=ke[pn]=!0,ke[bt]=ke[At]=ke[ft]=!1;var tc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},nc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},rc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},sc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ic=parseFloat,oc=parseInt,co=typeof gr=="object"&&gr&&gr.Object===Object&&gr,ac=typeof self=="object"&&self&&self.Object===Object&&self,Xe=co||ac||Function("return this")(),Rs=u&&!u.nodeType&&u,vn=Rs&&!0&&a&&!a.nodeType&&a,uo=vn&&vn.exports===Rs,Ds=uo&&co.process,wt=function(){try{var v=vn&&vn.require&&vn.require("util").types;return v||Ds&&Ds.binding&&Ds.binding("util")}catch{}}(),fo=wt&&wt.isArrayBuffer,ho=wt&&wt.isDate,go=wt&&wt.isMap,po=wt&&wt.isRegExp,mo=wt&&wt.isSet,xo=wt&&wt.isTypedArray;function ht(v,C,N){switch(N.length){case 0:return v.call(C);case 1:return v.call(C,N[0]);case 2:return v.call(C,N[0],N[1]);case 3:return v.call(C,N[0],N[1],N[2])}return v.apply(C,N)}function lc(v,C,N,H){for(var se=-1,_e=v==null?0:v.length;++se<_e;){var qe=v[se];C(H,qe,N(qe),v)}return H}function Nt(v,C){for(var N=-1,H=v==null?0:v.length;++N<H&&C(v[N],N,v)!==!1;);return v}function cc(v,C){for(var N=v==null?0:v.length;N--&&C(v[N],N,v)!==!1;);return v}function vo(v,C){for(var N=-1,H=v==null?0:v.length;++N<H;)if(!C(v[N],N,v))return!1;return!0}function tn(v,C){for(var N=-1,H=v==null?0:v.length,se=0,_e=[];++N<H;){var qe=v[N];C(qe,N,v)&&(_e[se++]=qe)}return _e}function kr(v,C){var N=v==null?0:v.length;return!!N&&On(v,C,0)>-1}function Ws(v,C,N){for(var H=-1,se=v==null?0:v.length;++H<se;)if(N(C,v[H]))return!0;return!1}function Pe(v,C){for(var N=-1,H=v==null?0:v.length,se=Array(H);++N<H;)se[N]=C(v[N],N,v);return se}function nn(v,C){for(var N=-1,H=C.length,se=v.length;++N<H;)v[se+N]=C[N];return v}function $s(v,C,N,H){var se=-1,_e=v==null?0:v.length;for(H&&_e&&(N=v[++se]);++se<_e;)N=C(N,v[se],se,v);return N}function uc(v,C,N,H){var se=v==null?0:v.length;for(H&&se&&(N=v[--se]);se--;)N=C(N,v[se],se,v);return N}function Bs(v,C){for(var N=-1,H=v==null?0:v.length;++N<H;)if(C(v[N],N,v))return!0;return!1}var dc=Fs("length");function fc(v){return v.split("")}function hc(v){return v.match(Es)||[]}function yo(v,C,N){var H;return N(v,function(se,_e,qe){if(C(se,_e,qe))return H=_e,!1}),H}function Er(v,C,N,H){for(var se=v.length,_e=N+(H?1:-1);H?_e--:++_e<se;)if(C(v[_e],_e,v))return _e;return-1}function On(v,C,N){return C===C?jc(v,C,N):Er(v,bo,N)}function gc(v,C,N,H){for(var se=N-1,_e=v.length;++se<_e;)if(H(v[se],C))return se;return-1}function bo(v){return v!==v}function _o(v,C){var N=v==null?0:v.length;return N?Us(v,C)/N:J}function Fs(v){return function(C){return C==null?r:C[v]}}function zs(v){return function(C){return v==null?r:v[C]}}function wo(v,C,N,H,se){return se(v,function(_e,qe,Ce){N=H?(H=!1,_e):C(N,_e,qe,Ce)}),N}function pc(v,C){var N=v.length;for(v.sort(C);N--;)v[N]=v[N].value;return v}function Us(v,C){for(var N,H=-1,se=v.length;++H<se;){var _e=C(v[H]);_e!==r&&(N=N===r?_e:N+_e)}return N}function Gs(v,C){for(var N=-1,H=Array(v);++N<v;)H[N]=C(N);return H}function mc(v,C){return Pe(C,function(N){return[N,v[N]]})}function No(v){return v&&v.slice(0,ko(v)+1).replace(mn,"")}function gt(v){return function(C){return v(C)}}function Hs(v,C){return Pe(C,function(N){return v[N]})}function Qn(v,C){return v.has(C)}function So(v,C){for(var N=-1,H=v.length;++N<H&&On(C,v[N],0)>-1;);return N}function jo(v,C){for(var N=v.length;N--&&On(C,v[N],0)>-1;);return N}function xc(v,C){for(var N=v.length,H=0;N--;)v[N]===C&&++H;return H}var vc=zs(tc),yc=zs(nc);function bc(v){return"\\"+sc[v]}function _c(v,C){return v==null?r:v[C]}function Tn(v){return Zl.test(v)}function wc(v){return Xl.test(v)}function Nc(v){for(var C,N=[];!(C=v.next()).done;)N.push(C.value);return N}function Ks(v){var C=-1,N=Array(v.size);return v.forEach(function(H,se){N[++C]=[se,H]}),N}function Co(v,C){return function(N){return v(C(N))}}function rn(v,C){for(var N=-1,H=v.length,se=0,_e=[];++N<H;){var qe=v[N];(qe===C||qe===w)&&(v[N]=w,_e[se++]=N)}return _e}function Ir(v){var C=-1,N=Array(v.size);return v.forEach(function(H){N[++C]=H}),N}function Sc(v){var C=-1,N=Array(v.size);return v.forEach(function(H){N[++C]=[H,H]}),N}function jc(v,C,N){for(var H=N-1,se=v.length;++H<se;)if(v[H]===C)return H;return-1}function Cc(v,C,N){for(var H=N+1;H--;)if(v[H]===C)return H;return H}function Rn(v){return Tn(v)?Ec(v):dc(v)}function Pt(v){return Tn(v)?Ic(v):fc(v)}function ko(v){for(var C=v.length;C--&&js.test(v.charAt(C)););return C}var kc=zs(rc);function Ec(v){for(var C=Ts.lastIndex=0;Ts.test(v);)++C;return C}function Ic(v){return v.match(Ts)||[]}function Ac(v){return v.match(Yl)||[]}var Mc=function v(C){C=C==null?Xe:Dn.defaults(Xe.Object(),C,Dn.pick(Xe,Ql));var N=C.Array,H=C.Date,se=C.Error,_e=C.Function,qe=C.Math,Ce=C.Object,qs=C.RegExp,Lc=C.String,St=C.TypeError,Ar=N.prototype,Pc=_e.prototype,Wn=Ce.prototype,Mr=C["__core-js_shared__"],Lr=Pc.toString,Se=Wn.hasOwnProperty,Oc=0,Eo=function(){var e=/[^.]+$/.exec(Mr&&Mr.keys&&Mr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pr=Wn.toString,Tc=Lr.call(Ce),Rc=Xe._,Dc=qs("^"+Lr.call(Se).replace(Yn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Or=uo?C.Buffer:r,sn=C.Symbol,Tr=C.Uint8Array,Io=Or?Or.allocUnsafe:r,Rr=Co(Ce.getPrototypeOf,Ce),Ao=Ce.create,Mo=Wn.propertyIsEnumerable,Dr=Ar.splice,Lo=sn?sn.isConcatSpreadable:r,er=sn?sn.iterator:r,yn=sn?sn.toStringTag:r,Wr=function(){try{var e=Sn(Ce,"defineProperty");return e({},"",{}),e}catch{}}(),Wc=C.clearTimeout!==Xe.clearTimeout&&C.clearTimeout,$c=H&&H.now!==Xe.Date.now&&H.now,Bc=C.setTimeout!==Xe.setTimeout&&C.setTimeout,$r=qe.ceil,Br=qe.floor,Js=Ce.getOwnPropertySymbols,Fc=Or?Or.isBuffer:r,Po=C.isFinite,zc=Ar.join,Uc=Co(Ce.keys,Ce),Je=qe.max,nt=qe.min,Gc=H.now,Hc=C.parseInt,Oo=qe.random,Kc=Ar.reverse,Vs=Sn(C,"DataView"),tr=Sn(C,"Map"),Ys=Sn(C,"Promise"),$n=Sn(C,"Set"),nr=Sn(C,"WeakMap"),rr=Sn(Ce,"create"),Fr=nr&&new nr,Bn={},qc=jn(Vs),Jc=jn(tr),Vc=jn(Ys),Yc=jn($n),Zc=jn(nr),zr=sn?sn.prototype:r,sr=zr?zr.valueOf:r,To=zr?zr.toString:r;function l(e){if($e(e)&&!ie(e)&&!(e instanceof xe)){if(e instanceof jt)return e;if(Se.call(e,"__wrapped__"))return Ra(e)}return new jt(e)}var Fn=function(){function e(){}return function(t){if(!Re(t))return{};if(Ao)return Ao(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Ur(){}function jt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:ws,evaluate:br,interpolate:_r,variable:"",imports:{_:l}},l.prototype=Ur.prototype,l.prototype.constructor=l,jt.prototype=Fn(Ur.prototype),jt.prototype.constructor=jt;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function Xc(){var e=new xe(this.__wrapped__);return e.__actions__=lt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=lt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=lt(this.__views__),e}function Qc(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function eu(){var e=this.__wrapped__.value(),t=this.__dir__,n=ie(e),s=t<0,o=n?e.length:0,c=fd(0,o,this.__views__),g=c.start,m=c.end,y=m-g,k=s?m:g-1,E=this.__iteratees__,L=E.length,$=0,V=nt(y,this.__takeCount__);if(!n||!s&&o==y&&V==y)return ia(e,this.__actions__);var ee=[];e:for(;y--&&$<V;){k+=t;for(var ce=-1,te=e[k];++ce<L;){var ge=E[ce],ve=ge.iteratee,xt=ge.type,ot=ve(te);if(xt==re)te=ot;else if(!ot){if(xt==le)continue e;break e}}ee[$++]=te}return ee}xe.prototype=Fn(Ur.prototype),xe.prototype.constructor=xe;function bn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function tu(){this.__data__=rr?rr(null):{},this.size=0}function nu(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function ru(e){var t=this.__data__;if(rr){var n=t[e];return n===b?r:n}return Se.call(t,e)?t[e]:r}function su(e){var t=this.__data__;return rr?t[e]!==r:Se.call(t,e)}function iu(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=rr&&t===r?b:t,this}bn.prototype.clear=tu,bn.prototype.delete=nu,bn.prototype.get=ru,bn.prototype.has=su,bn.prototype.set=iu;function Ut(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function ou(){this.__data__=[],this.size=0}function au(e){var t=this.__data__,n=Gr(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Dr.call(t,n,1),--this.size,!0}function lu(e){var t=this.__data__,n=Gr(t,e);return n<0?r:t[n][1]}function cu(e){return Gr(this.__data__,e)>-1}function uu(e,t){var n=this.__data__,s=Gr(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}Ut.prototype.clear=ou,Ut.prototype.delete=au,Ut.prototype.get=lu,Ut.prototype.has=cu,Ut.prototype.set=uu;function Gt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function du(){this.size=0,this.__data__={hash:new bn,map:new(tr||Ut),string:new bn}}function fu(e){var t=ns(this,e).delete(e);return this.size-=t?1:0,t}function hu(e){return ns(this,e).get(e)}function gu(e){return ns(this,e).has(e)}function pu(e,t){var n=ns(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}Gt.prototype.clear=du,Gt.prototype.delete=fu,Gt.prototype.get=hu,Gt.prototype.has=gu,Gt.prototype.set=pu;function _n(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Gt;++t<n;)this.add(e[t])}function mu(e){return this.__data__.set(e,b),this}function xu(e){return this.__data__.has(e)}_n.prototype.add=_n.prototype.push=mu,_n.prototype.has=xu;function Ot(e){var t=this.__data__=new Ut(e);this.size=t.size}function vu(){this.__data__=new Ut,this.size=0}function yu(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function bu(e){return this.__data__.get(e)}function _u(e){return this.__data__.has(e)}function wu(e,t){var n=this.__data__;if(n instanceof Ut){var s=n.__data__;if(!tr||s.length<f-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Gt(s)}return n.set(e,t),this.size=n.size,this}Ot.prototype.clear=vu,Ot.prototype.delete=yu,Ot.prototype.get=bu,Ot.prototype.has=_u,Ot.prototype.set=wu;function Ro(e,t){var n=ie(e),s=!n&&Cn(e),o=!n&&!s&&un(e),c=!n&&!s&&!o&&Hn(e),g=n||s||o||c,m=g?Gs(e.length,Lc):[],y=m.length;for(var k in e)(t||Se.call(e,k))&&!(g&&(k=="length"||o&&(k=="offset"||k=="parent")||c&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||Jt(k,y)))&&m.push(k);return m}function Do(e){var t=e.length;return t?e[ai(0,t-1)]:r}function Nu(e,t){return rs(lt(e),wn(t,0,e.length))}function Su(e){return rs(lt(e))}function Zs(e,t,n){(n!==r&&!Tt(e[t],n)||n===r&&!(t in e))&&Ht(e,t,n)}function ir(e,t,n){var s=e[t];(!(Se.call(e,t)&&Tt(s,n))||n===r&&!(t in e))&&Ht(e,t,n)}function Gr(e,t){for(var n=e.length;n--;)if(Tt(e[n][0],t))return n;return-1}function ju(e,t,n,s){return on(e,function(o,c,g){t(s,o,n(o),g)}),s}function Wo(e,t){return e&&Bt(t,Ze(t),e)}function Cu(e,t){return e&&Bt(t,ut(t),e)}function Ht(e,t,n){t=="__proto__"&&Wr?Wr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xs(e,t){for(var n=-1,s=t.length,o=N(s),c=e==null;++n<s;)o[n]=c?r:Li(e,t[n]);return o}function wn(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Ct(e,t,n,s,o,c){var g,m=t&_,y=t&A,k=t&O;if(n&&(g=o?n(e,s,o,c):n(e)),g!==r)return g;if(!Re(e))return e;var E=ie(e);if(E){if(g=gd(e),!m)return lt(e,g)}else{var L=rt(e),$=L==At||L==Wt;if(un(e))return la(e,m);if(L==ye||L==Ie||$&&!o){if(g=y||$?{}:ka(e),!m)return y?rd(e,Cu(g,e)):nd(e,Wo(g,e))}else{if(!ke[L])return o?e:{};g=pd(e,L,m)}}c||(c=new Ot);var V=c.get(e);if(V)return V;c.set(e,g),nl(e)?e.forEach(function(te){g.add(Ct(te,t,n,te,e,c))}):el(e)&&e.forEach(function(te,ge){g.set(ge,Ct(te,t,n,ge,e,c))});var ee=k?y?vi:xi:y?ut:Ze,ce=E?r:ee(e);return Nt(ce||e,function(te,ge){ce&&(ge=te,te=e[ge]),ir(g,ge,Ct(te,t,n,ge,e,c))}),g}function ku(e){var t=Ze(e);return function(n){return $o(n,e,t)}}function $o(e,t,n){var s=n.length;if(e==null)return!s;for(e=Ce(e);s--;){var o=n[s],c=t[o],g=e[o];if(g===r&&!(o in e)||!c(g))return!1}return!0}function Bo(e,t,n){if(typeof e!="function")throw new St(p);return fr(function(){e.apply(r,n)},t)}function or(e,t,n,s){var o=-1,c=kr,g=!0,m=e.length,y=[],k=t.length;if(!m)return y;n&&(t=Pe(t,gt(n))),s?(c=Ws,g=!1):t.length>=f&&(c=Qn,g=!1,t=new _n(t));e:for(;++o<m;){var E=e[o],L=n==null?E:n(E);if(E=s||E!==0?E:0,g&&L===L){for(var $=k;$--;)if(t[$]===L)continue e;y.push(E)}else c(t,L,s)||y.push(E)}return y}var on=ha($t),Fo=ha(ei,!0);function Eu(e,t){var n=!0;return on(e,function(s,o,c){return n=!!t(s,o,c),n}),n}function Hr(e,t,n){for(var s=-1,o=e.length;++s<o;){var c=e[s],g=t(c);if(g!=null&&(m===r?g===g&&!mt(g):n(g,m)))var m=g,y=c}return y}function Iu(e,t,n,s){var o=e.length;for(n=ae(n),n<0&&(n=-n>o?0:o+n),s=s===r||s>o?o:ae(s),s<0&&(s+=o),s=n>s?0:sl(s);n<s;)e[n++]=t;return e}function zo(e,t){var n=[];return on(e,function(s,o,c){t(s,o,c)&&n.push(s)}),n}function Qe(e,t,n,s,o){var c=-1,g=e.length;for(n||(n=xd),o||(o=[]);++c<g;){var m=e[c];t>0&&n(m)?t>1?Qe(m,t-1,n,s,o):nn(o,m):s||(o[o.length]=m)}return o}var Qs=ga(),Uo=ga(!0);function $t(e,t){return e&&Qs(e,t,Ze)}function ei(e,t){return e&&Uo(e,t,Ze)}function Kr(e,t){return tn(t,function(n){return Vt(e[n])})}function Nn(e,t){t=ln(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[Ft(t[n++])];return n&&n==s?e:r}function Go(e,t,n){var s=t(e);return ie(e)?s:nn(s,n(e))}function st(e){return e==null?e===r?Lt:pe:yn&&yn in Ce(e)?dd(e):Sd(e)}function ti(e,t){return e>t}function Au(e,t){return e!=null&&Se.call(e,t)}function Mu(e,t){return e!=null&&t in Ce(e)}function Lu(e,t,n){return e>=nt(t,n)&&e<Je(t,n)}function ni(e,t,n){for(var s=n?Ws:kr,o=e[0].length,c=e.length,g=c,m=N(c),y=1/0,k=[];g--;){var E=e[g];g&&t&&(E=Pe(E,gt(t))),y=nt(E.length,y),m[g]=!n&&(t||o>=120&&E.length>=120)?new _n(g&&E):r}E=e[0];var L=-1,$=m[0];e:for(;++L<o&&k.length<y;){var V=E[L],ee=t?t(V):V;if(V=n||V!==0?V:0,!($?Qn($,ee):s(k,ee,n))){for(g=c;--g;){var ce=m[g];if(!(ce?Qn(ce,ee):s(e[g],ee,n)))continue e}$&&$.push(ee),k.push(V)}}return k}function Pu(e,t,n,s){return $t(e,function(o,c,g){t(s,n(o),c,g)}),s}function ar(e,t,n){t=ln(t,e),e=Ma(e,t);var s=e==null?e:e[Ft(Et(t))];return s==null?r:ht(s,e,n)}function Ho(e){return $e(e)&&st(e)==Ie}function Ou(e){return $e(e)&&st(e)==dn}function Tu(e){return $e(e)&&st(e)==at}function lr(e,t,n,s,o){return e===t?!0:e==null||t==null||!$e(e)&&!$e(t)?e!==e&&t!==t:Ru(e,t,n,s,lr,o)}function Ru(e,t,n,s,o,c){var g=ie(e),m=ie(t),y=g?Ve:rt(e),k=m?Ve:rt(t);y=y==Ie?ye:y,k=k==Ie?ye:k;var E=y==ye,L=k==ye,$=y==k;if($&&un(e)){if(!un(t))return!1;g=!0,E=!1}if($&&!E)return c||(c=new Ot),g||Hn(e)?Sa(e,t,n,s,o,c):cd(e,t,y,n,s,o,c);if(!(n&R)){var V=E&&Se.call(e,"__wrapped__"),ee=L&&Se.call(t,"__wrapped__");if(V||ee){var ce=V?e.value():e,te=ee?t.value():t;return c||(c=new Ot),o(ce,te,n,s,c)}}return $?(c||(c=new Ot),ud(e,t,n,s,o,c)):!1}function Du(e){return $e(e)&&rt(e)==Ye}function ri(e,t,n,s){var o=n.length,c=o,g=!s;if(e==null)return!c;for(e=Ce(e);o--;){var m=n[o];if(g&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++o<c;){m=n[o];var y=m[0],k=e[y],E=m[1];if(g&&m[2]){if(k===r&&!(y in e))return!1}else{var L=new Ot;if(s)var $=s(k,E,y,e,t,L);if(!($===r?lr(E,k,R|W,s,L):$))return!1}}return!0}function Ko(e){if(!Re(e)||yd(e))return!1;var t=Vt(e)?Dc:xn;return t.test(jn(e))}function Wu(e){return $e(e)&&st(e)==Fe}function $u(e){return $e(e)&&rt(e)==we}function Bu(e){return $e(e)&&cs(e.length)&&!!Ae[st(e)]}function qo(e){return typeof e=="function"?e:e==null?dt:typeof e=="object"?ie(e)?Yo(e[0],e[1]):Vo(e):pl(e)}function si(e){if(!dr(e))return Uc(e);var t=[];for(var n in Ce(e))Se.call(e,n)&&n!="constructor"&&t.push(n);return t}function Fu(e){if(!Re(e))return Nd(e);var t=dr(e),n=[];for(var s in e)s=="constructor"&&(t||!Se.call(e,s))||n.push(s);return n}function ii(e,t){return e<t}function Jo(e,t){var n=-1,s=ct(e)?N(e.length):[];return on(e,function(o,c,g){s[++n]=t(o,c,g)}),s}function Vo(e){var t=bi(e);return t.length==1&&t[0][2]?Ia(t[0][0],t[0][1]):function(n){return n===e||ri(n,e,t)}}function Yo(e,t){return wi(e)&&Ea(t)?Ia(Ft(e),t):function(n){var s=Li(n,e);return s===r&&s===t?Pi(n,e):lr(t,s,R|W)}}function qr(e,t,n,s,o){e!==t&&Qs(t,function(c,g){if(o||(o=new Ot),Re(c))zu(e,t,g,n,qr,s,o);else{var m=s?s(Si(e,g),c,g+"",e,t,o):r;m===r&&(m=c),Zs(e,g,m)}},ut)}function zu(e,t,n,s,o,c,g){var m=Si(e,n),y=Si(t,n),k=g.get(y);if(k){Zs(e,n,k);return}var E=c?c(m,y,n+"",e,t,g):r,L=E===r;if(L){var $=ie(y),V=!$&&un(y),ee=!$&&!V&&Hn(y);E=y,$||V||ee?ie(m)?E=m:Ue(m)?E=lt(m):V?(L=!1,E=la(y,!0)):ee?(L=!1,E=ca(y,!0)):E=[]:hr(y)||Cn(y)?(E=m,Cn(m)?E=il(m):(!Re(m)||Vt(m))&&(E=ka(y))):L=!1}L&&(g.set(y,E),o(E,y,s,c,g),g.delete(y)),Zs(e,n,E)}function Zo(e,t){var n=e.length;if(n)return t+=t<0?n:0,Jt(t,n)?e[t]:r}function Xo(e,t,n){t.length?t=Pe(t,function(c){return ie(c)?function(g){return Nn(g,c.length===1?c[0]:c)}:c}):t=[dt];var s=-1;t=Pe(t,gt(Q()));var o=Jo(e,function(c,g,m){var y=Pe(t,function(k){return k(c)});return{criteria:y,index:++s,value:c}});return pc(o,function(c,g){return td(c,g,n)})}function Uu(e,t){return Qo(e,t,function(n,s){return Pi(e,s)})}function Qo(e,t,n){for(var s=-1,o=t.length,c={};++s<o;){var g=t[s],m=Nn(e,g);n(m,g)&&cr(c,ln(g,e),m)}return c}function Gu(e){return function(t){return Nn(t,e)}}function oi(e,t,n,s){var o=s?gc:On,c=-1,g=t.length,m=e;for(e===t&&(t=lt(t)),n&&(m=Pe(e,gt(n)));++c<g;)for(var y=0,k=t[c],E=n?n(k):k;(y=o(m,E,y,s))>-1;)m!==e&&Dr.call(m,y,1),Dr.call(e,y,1);return e}function ea(e,t){for(var n=e?t.length:0,s=n-1;n--;){var o=t[n];if(n==s||o!==c){var c=o;Jt(o)?Dr.call(e,o,1):ui(e,o)}}return e}function ai(e,t){return e+Br(Oo()*(t-e+1))}function Hu(e,t,n,s){for(var o=-1,c=Je($r((t-e)/(n||1)),0),g=N(c);c--;)g[s?c:++o]=e,e+=n;return g}function li(e,t){var n="";if(!e||t<1||t>q)return n;do t%2&&(n+=e),t=Br(t/2),t&&(e+=e);while(t);return n}function de(e,t){return ji(Aa(e,t,dt),e+"")}function Ku(e){return Do(Kn(e))}function qu(e,t){var n=Kn(e);return rs(n,wn(t,0,n.length))}function cr(e,t,n,s){if(!Re(e))return e;t=ln(t,e);for(var o=-1,c=t.length,g=c-1,m=e;m!=null&&++o<c;){var y=Ft(t[o]),k=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(o!=g){var E=m[y];k=s?s(E,y,m):r,k===r&&(k=Re(E)?E:Jt(t[o+1])?[]:{})}ir(m,y,k),m=m[y]}return e}var ta=Fr?function(e,t){return Fr.set(e,t),e}:dt,Ju=Wr?function(e,t){return Wr(e,"toString",{configurable:!0,enumerable:!1,value:Ti(t),writable:!0})}:dt;function Vu(e){return rs(Kn(e))}function kt(e,t,n){var s=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var c=N(o);++s<o;)c[s]=e[s+t];return c}function Yu(e,t){var n;return on(e,function(s,o,c){return n=t(s,o,c),!n}),!!n}function Jr(e,t,n){var s=0,o=e==null?s:e.length;if(typeof t=="number"&&t===t&&o<=Te){for(;s<o;){var c=s+o>>>1,g=e[c];g!==null&&!mt(g)&&(n?g<=t:g<t)?s=c+1:o=c}return o}return ci(e,t,dt,n)}function ci(e,t,n,s){var o=0,c=e==null?0:e.length;if(c===0)return 0;t=n(t);for(var g=t!==t,m=t===null,y=mt(t),k=t===r;o<c;){var E=Br((o+c)/2),L=n(e[E]),$=L!==r,V=L===null,ee=L===L,ce=mt(L);if(g)var te=s||ee;else k?te=ee&&(s||$):m?te=ee&&$&&(s||!V):y?te=ee&&$&&!V&&(s||!ce):V||ce?te=!1:te=s?L<=t:L<t;te?o=E+1:c=E}return nt(c,Ee)}function na(e,t){for(var n=-1,s=e.length,o=0,c=[];++n<s;){var g=e[n],m=t?t(g):g;if(!n||!Tt(m,y)){var y=m;c[o++]=g===0?0:g}}return c}function ra(e){return typeof e=="number"?e:mt(e)?J:+e}function pt(e){if(typeof e=="string")return e;if(ie(e))return Pe(e,pt)+"";if(mt(e))return To?To.call(e):"";var t=e+"";return t=="0"&&1/e==-he?"-0":t}function an(e,t,n){var s=-1,o=kr,c=e.length,g=!0,m=[],y=m;if(n)g=!1,o=Ws;else if(c>=f){var k=t?null:ad(e);if(k)return Ir(k);g=!1,o=Qn,y=new _n}else y=t?[]:m;e:for(;++s<c;){var E=e[s],L=t?t(E):E;if(E=n||E!==0?E:0,g&&L===L){for(var $=y.length;$--;)if(y[$]===L)continue e;t&&y.push(L),m.push(E)}else o(y,L,n)||(y!==m&&y.push(L),m.push(E))}return m}function ui(e,t){return t=ln(t,e),e=Ma(e,t),e==null||delete e[Ft(Et(t))]}function sa(e,t,n,s){return cr(e,t,n(Nn(e,t)),s)}function Vr(e,t,n,s){for(var o=e.length,c=s?o:-1;(s?c--:++c<o)&&t(e[c],c,e););return n?kt(e,s?0:c,s?c+1:o):kt(e,s?c+1:0,s?o:c)}function ia(e,t){var n=e;return n instanceof xe&&(n=n.value()),$s(t,function(s,o){return o.func.apply(o.thisArg,nn([s],o.args))},n)}function di(e,t,n){var s=e.length;if(s<2)return s?an(e[0]):[];for(var o=-1,c=N(s);++o<s;)for(var g=e[o],m=-1;++m<s;)m!=o&&(c[o]=or(c[o]||g,e[m],t,n));return an(Qe(c,1),t,n)}function oa(e,t,n){for(var s=-1,o=e.length,c=t.length,g={};++s<o;){var m=s<c?t[s]:r;n(g,e[s],m)}return g}function fi(e){return Ue(e)?e:[]}function hi(e){return typeof e=="function"?e:dt}function ln(e,t){return ie(e)?e:wi(e,t)?[e]:Ta(Ne(e))}var Zu=de;function cn(e,t,n){var s=e.length;return n=n===r?s:n,!t&&n>=s?e:kt(e,t,n)}var aa=Wc||function(e){return Xe.clearTimeout(e)};function la(e,t){if(t)return e.slice();var n=e.length,s=Io?Io(n):new e.constructor(n);return e.copy(s),s}function gi(e){var t=new e.constructor(e.byteLength);return new Tr(t).set(new Tr(e)),t}function Xu(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Qu(e){var t=new e.constructor(e.source,Xn.exec(e));return t.lastIndex=e.lastIndex,t}function ed(e){return sr?Ce(sr.call(e)):{}}function ca(e,t){var n=t?gi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ua(e,t){if(e!==t){var n=e!==r,s=e===null,o=e===e,c=mt(e),g=t!==r,m=t===null,y=t===t,k=mt(t);if(!m&&!k&&!c&&e>t||c&&g&&y&&!m&&!k||s&&g&&y||!n&&y||!o)return 1;if(!s&&!c&&!k&&e<t||k&&n&&o&&!s&&!c||m&&n&&o||!g&&o||!y)return-1}return 0}function td(e,t,n){for(var s=-1,o=e.criteria,c=t.criteria,g=o.length,m=n.length;++s<g;){var y=ua(o[s],c[s]);if(y){if(s>=m)return y;var k=n[s];return y*(k=="desc"?-1:1)}}return e.index-t.index}function da(e,t,n,s){for(var o=-1,c=e.length,g=n.length,m=-1,y=t.length,k=Je(c-g,0),E=N(y+k),L=!s;++m<y;)E[m]=t[m];for(;++o<g;)(L||o<c)&&(E[n[o]]=e[o]);for(;k--;)E[m++]=e[o++];return E}function fa(e,t,n,s){for(var o=-1,c=e.length,g=-1,m=n.length,y=-1,k=t.length,E=Je(c-m,0),L=N(E+k),$=!s;++o<E;)L[o]=e[o];for(var V=o;++y<k;)L[V+y]=t[y];for(;++g<m;)($||o<c)&&(L[V+n[g]]=e[o++]);return L}function lt(e,t){var n=-1,s=e.length;for(t||(t=N(s));++n<s;)t[n]=e[n];return t}function Bt(e,t,n,s){var o=!n;n||(n={});for(var c=-1,g=t.length;++c<g;){var m=t[c],y=s?s(n[m],e[m],m,n,e):r;y===r&&(y=e[m]),o?Ht(n,m,y):ir(n,m,y)}return n}function nd(e,t){return Bt(e,_i(e),t)}function rd(e,t){return Bt(e,ja(e),t)}function Yr(e,t){return function(n,s){var o=ie(n)?lc:ju,c=t?t():{};return o(n,e,Q(s,2),c)}}function zn(e){return de(function(t,n){var s=-1,o=n.length,c=o>1?n[o-1]:r,g=o>2?n[2]:r;for(c=e.length>3&&typeof c=="function"?(o--,c):r,g&&it(n[0],n[1],g)&&(c=o<3?r:c,o=1),t=Ce(t);++s<o;){var m=n[s];m&&e(t,m,s,c)}return t})}function ha(e,t){return function(n,s){if(n==null)return n;if(!ct(n))return e(n,s);for(var o=n.length,c=t?o:-1,g=Ce(n);(t?c--:++c<o)&&s(g[c],c,g)!==!1;);return n}}function ga(e){return function(t,n,s){for(var o=-1,c=Ce(t),g=s(t),m=g.length;m--;){var y=g[e?m:++o];if(n(c[y],y,c)===!1)break}return t}}function sd(e,t,n){var s=t&F,o=ur(e);function c(){var g=this&&this!==Xe&&this instanceof c?o:e;return g.apply(s?n:this,arguments)}return c}function pa(e){return function(t){t=Ne(t);var n=Tn(t)?Pt(t):r,s=n?n[0]:t.charAt(0),o=n?cn(n,1).join(""):t.slice(1);return s[e]()+o}}function Un(e){return function(t){return $s(hl(fl(t).replace(Jl,"")),e,"")}}function ur(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Fn(e.prototype),s=e.apply(n,t);return Re(s)?s:n}}function id(e,t,n){var s=ur(e);function o(){for(var c=arguments.length,g=N(c),m=c,y=Gn(o);m--;)g[m]=arguments[m];var k=c<3&&g[0]!==y&&g[c-1]!==y?[]:rn(g,y);if(c-=k.length,c<n)return ba(e,t,Zr,o.placeholder,r,g,k,r,r,n-c);var E=this&&this!==Xe&&this instanceof o?s:e;return ht(E,this,g)}return o}function ma(e){return function(t,n,s){var o=Ce(t);if(!ct(t)){var c=Q(n,3);t=Ze(t),n=function(m){return c(o[m],m,o)}}var g=e(t,n,s);return g>-1?o[c?t[g]:g]:r}}function xa(e){return qt(function(t){var n=t.length,s=n,o=jt.prototype.thru;for(e&&t.reverse();s--;){var c=t[s];if(typeof c!="function")throw new St(p);if(o&&!g&&ts(c)=="wrapper")var g=new jt([],!0)}for(s=g?s:n;++s<n;){c=t[s];var m=ts(c),y=m=="wrapper"?yi(c):r;y&&Ni(y[0])&&y[1]==(Y|X|T|Me)&&!y[4].length&&y[9]==1?g=g[ts(y[0])].apply(g,y[3]):g=c.length==1&&Ni(c)?g[m]():g.thru(c)}return function(){var k=arguments,E=k[0];if(g&&k.length==1&&ie(E))return g.plant(E).value();for(var L=0,$=n?t[L].apply(this,k):E;++L<n;)$=t[L].call(this,$);return $}})}function Zr(e,t,n,s,o,c,g,m,y,k){var E=t&Y,L=t&F,$=t&B,V=t&(X|M),ee=t&G,ce=$?r:ur(e);function te(){for(var ge=arguments.length,ve=N(ge),xt=ge;xt--;)ve[xt]=arguments[xt];if(V)var ot=Gn(te),vt=xc(ve,ot);if(s&&(ve=da(ve,s,o,V)),c&&(ve=fa(ve,c,g,V)),ge-=vt,V&&ge<k){var Ge=rn(ve,ot);return ba(e,t,Zr,te.placeholder,n,ve,Ge,m,y,k-ge)}var Rt=L?n:this,Zt=$?Rt[e]:e;return ge=ve.length,m?ve=jd(ve,m):ee&&ge>1&&ve.reverse(),E&&y<ge&&(ve.length=y),this&&this!==Xe&&this instanceof te&&(Zt=ce||ur(Zt)),Zt.apply(Rt,ve)}return te}function va(e,t){return function(n,s){return Pu(n,e,t(s),{})}}function Xr(e,t){return function(n,s){var o;if(n===r&&s===r)return t;if(n!==r&&(o=n),s!==r){if(o===r)return s;typeof n=="string"||typeof s=="string"?(n=pt(n),s=pt(s)):(n=ra(n),s=ra(s)),o=e(n,s)}return o}}function pi(e){return qt(function(t){return t=Pe(t,gt(Q())),de(function(n){var s=this;return e(t,function(o){return ht(o,s,n)})})})}function Qr(e,t){t=t===r?" ":pt(t);var n=t.length;if(n<2)return n?li(t,e):t;var s=li(t,$r(e/Rn(t)));return Tn(t)?cn(Pt(s),0,e).join(""):s.slice(0,e)}function od(e,t,n,s){var o=t&F,c=ur(e);function g(){for(var m=-1,y=arguments.length,k=-1,E=s.length,L=N(E+y),$=this&&this!==Xe&&this instanceof g?c:e;++k<E;)L[k]=s[k];for(;y--;)L[k++]=arguments[++m];return ht($,o?n:this,L)}return g}function ya(e){return function(t,n,s){return s&&typeof s!="number"&&it(t,n,s)&&(n=s=r),t=Yt(t),n===r?(n=t,t=0):n=Yt(n),s=s===r?t<n?1:-1:Yt(s),Hu(t,n,s,e)}}function es(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=It(t),n=It(n)),e(t,n)}}function ba(e,t,n,s,o,c,g,m,y,k){var E=t&X,L=E?g:r,$=E?r:g,V=E?c:r,ee=E?r:c;t|=E?T:U,t&=~(E?U:T),t&z||(t&=-4);var ce=[e,t,o,V,L,ee,$,m,y,k],te=n.apply(r,ce);return Ni(e)&&La(te,ce),te.placeholder=s,Pa(te,e,t)}function mi(e){var t=qe[e];return function(n,s){if(n=It(n),s=s==null?0:nt(ae(s),292),s&&Po(n)){var o=(Ne(n)+"e").split("e"),c=t(o[0]+"e"+(+o[1]+s));return o=(Ne(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-s))}return t(n)}}var ad=$n&&1/Ir(new $n([,-0]))[1]==he?function(e){return new $n(e)}:Wi;function _a(e){return function(t){var n=rt(t);return n==Ye?Ks(t):n==we?Sc(t):mc(t,e(t))}}function Kt(e,t,n,s,o,c,g,m){var y=t&B;if(!y&&typeof e!="function")throw new St(p);var k=s?s.length:0;if(k||(t&=-97,s=o=r),g=g===r?g:Je(ae(g),0),m=m===r?m:ae(m),k-=o?o.length:0,t&U){var E=s,L=o;s=o=r}var $=y?r:yi(e),V=[e,t,n,s,o,E,L,c,g,m];if($&&wd(V,$),e=V[0],t=V[1],n=V[2],s=V[3],o=V[4],m=V[9]=V[9]===r?y?0:e.length:Je(V[9]-k,0),!m&&t&(X|M)&&(t&=-25),!t||t==F)var ee=sd(e,t,n);else t==X||t==M?ee=id(e,t,m):(t==T||t==(F|T))&&!o.length?ee=od(e,t,n,s):ee=Zr.apply(r,V);var ce=$?ta:La;return Pa(ce(ee,V),e,t)}function wa(e,t,n,s){return e===r||Tt(e,Wn[n])&&!Se.call(s,n)?t:e}function Na(e,t,n,s,o,c){return Re(e)&&Re(t)&&(c.set(t,e),qr(e,t,r,Na,c),c.delete(t)),e}function ld(e){return hr(e)?r:e}function Sa(e,t,n,s,o,c){var g=n&R,m=e.length,y=t.length;if(m!=y&&!(g&&y>m))return!1;var k=c.get(e),E=c.get(t);if(k&&E)return k==t&&E==e;var L=-1,$=!0,V=n&W?new _n:r;for(c.set(e,t),c.set(t,e);++L<m;){var ee=e[L],ce=t[L];if(s)var te=g?s(ce,ee,L,t,e,c):s(ee,ce,L,e,t,c);if(te!==r){if(te)continue;$=!1;break}if(V){if(!Bs(t,function(ge,ve){if(!Qn(V,ve)&&(ee===ge||o(ee,ge,n,s,c)))return V.push(ve)})){$=!1;break}}else if(!(ee===ce||o(ee,ce,n,s,c))){$=!1;break}}return c.delete(e),c.delete(t),$}function cd(e,t,n,s,o,c,g){switch(n){case zt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case dn:return!(e.byteLength!=t.byteLength||!c(new Tr(e),new Tr(t)));case tt:case at:case K:return Tt(+e,+t);case bt:return e.name==t.name&&e.message==t.message;case Fe:case De:return e==t+"";case Ye:var m=Ks;case we:var y=s&R;if(m||(m=Ir),e.size!=t.size&&!y)return!1;var k=g.get(e);if(k)return k==t;s|=W,g.set(e,t);var E=Sa(m(e),m(t),s,o,c,g);return g.delete(e),E;case ze:if(sr)return sr.call(e)==sr.call(t)}return!1}function ud(e,t,n,s,o,c){var g=n&R,m=xi(e),y=m.length,k=xi(t),E=k.length;if(y!=E&&!g)return!1;for(var L=y;L--;){var $=m[L];if(!(g?$ in t:Se.call(t,$)))return!1}var V=c.get(e),ee=c.get(t);if(V&&ee)return V==t&&ee==e;var ce=!0;c.set(e,t),c.set(t,e);for(var te=g;++L<y;){$=m[L];var ge=e[$],ve=t[$];if(s)var xt=g?s(ve,ge,$,t,e,c):s(ge,ve,$,e,t,c);if(!(xt===r?ge===ve||o(ge,ve,n,s,c):xt)){ce=!1;break}te||(te=$=="constructor")}if(ce&&!te){var ot=e.constructor,vt=t.constructor;ot!=vt&&"constructor"in e&&"constructor"in t&&!(typeof ot=="function"&&ot instanceof ot&&typeof vt=="function"&&vt instanceof vt)&&(ce=!1)}return c.delete(e),c.delete(t),ce}function qt(e){return ji(Aa(e,r,$a),e+"")}function xi(e){return Go(e,Ze,_i)}function vi(e){return Go(e,ut,ja)}var yi=Fr?function(e){return Fr.get(e)}:Wi;function ts(e){for(var t=e.name+"",n=Bn[t],s=Se.call(Bn,t)?n.length:0;s--;){var o=n[s],c=o.func;if(c==null||c==e)return o.name}return t}function Gn(e){var t=Se.call(l,"placeholder")?l:e;return t.placeholder}function Q(){var e=l.iteratee||Ri;return e=e===Ri?qo:e,arguments.length?e(arguments[0],arguments[1]):e}function ns(e,t){var n=e.__data__;return vd(t)?n[typeof t=="string"?"string":"hash"]:n.map}function bi(e){for(var t=Ze(e),n=t.length;n--;){var s=t[n],o=e[s];t[n]=[s,o,Ea(o)]}return t}function Sn(e,t){var n=_c(e,t);return Ko(n)?n:r}function dd(e){var t=Se.call(e,yn),n=e[yn];try{e[yn]=r;var s=!0}catch{}var o=Pr.call(e);return s&&(t?e[yn]=n:delete e[yn]),o}var _i=Js?function(e){return e==null?[]:(e=Ce(e),tn(Js(e),function(t){return Mo.call(e,t)}))}:$i,ja=Js?function(e){for(var t=[];e;)nn(t,_i(e)),e=Rr(e);return t}:$i,rt=st;(Vs&&rt(new Vs(new ArrayBuffer(1)))!=zt||tr&&rt(new tr)!=Ye||Ys&&rt(Ys.resolve())!=Be||$n&&rt(new $n)!=we||nr&&rt(new nr)!=ft)&&(rt=function(e){var t=st(e),n=t==ye?e.constructor:r,s=n?jn(n):"";if(s)switch(s){case qc:return zt;case Jc:return Ye;case Vc:return Be;case Yc:return we;case Zc:return ft}return t});function fd(e,t,n){for(var s=-1,o=n.length;++s<o;){var c=n[s],g=c.size;switch(c.type){case"drop":e+=g;break;case"dropRight":t-=g;break;case"take":t=nt(t,e+g);break;case"takeRight":e=Je(e,t-g);break}}return{start:e,end:t}}function hd(e){var t=e.match(Qt);return t?t[1].split(ks):[]}function Ca(e,t,n){t=ln(t,e);for(var s=-1,o=t.length,c=!1;++s<o;){var g=Ft(t[s]);if(!(c=e!=null&&n(e,g)))break;e=e[g]}return c||++s!=o?c:(o=e==null?0:e.length,!!o&&cs(o)&&Jt(g,o)&&(ie(e)||Cn(e)))}function gd(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Se.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ka(e){return typeof e.constructor=="function"&&!dr(e)?Fn(Rr(e)):{}}function pd(e,t,n){var s=e.constructor;switch(t){case dn:return gi(e);case tt:case at:return new s(+e);case zt:return Xu(e,n);case fn:case hn:case En:case In:case An:case gn:case Vn:case Xt:case pn:return ca(e,n);case Ye:return new s;case K:case De:return new s(e);case Fe:return Qu(e);case we:return new s;case ze:return ed(e)}}function md(e,t){var n=t.length;if(!n)return e;var s=n-1;return t[s]=(n>1?"& ":"")+t[s],t=t.join(n>2?", ":" "),e.replace(Cs,`{
/* [wrapped with `+t+`] */
`)}function xd(e){return ie(e)||Cn(e)||!!(Lo&&e&&e[Lo])}function Jt(e,t){var n=typeof e;return t=t??q,!!t&&(n=="number"||n!="symbol"&&en.test(e))&&e>-1&&e%1==0&&e<t}function it(e,t,n){if(!Re(n))return!1;var s=typeof t;return(s=="number"?ct(n)&&Jt(t,n.length):s=="string"&&t in n)?Tt(n[t],e):!1}function wi(e,t){if(ie(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||mt(e)?!0:Ss.test(e)||!Ns.test(e)||t!=null&&e in Ce(t)}function vd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ni(e){var t=ts(e),n=l[t];if(typeof n!="function"||!(t in xe.prototype))return!1;if(e===n)return!0;var s=yi(n);return!!s&&e===s[0]}function yd(e){return!!Eo&&Eo in e}var bd=Mr?Vt:Bi;function dr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Wn;return e===n}function Ea(e){return e===e&&!Re(e)}function Ia(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Ce(n))}}function _d(e){var t=as(e,function(s){return n.size===S&&n.clear(),s}),n=t.cache;return t}function wd(e,t){var n=e[1],s=t[1],o=n|s,c=o<(F|B|Y),g=s==Y&&n==X||s==Y&&n==Me&&e[7].length<=t[8]||s==(Y|Me)&&t[7].length<=t[8]&&n==X;if(!(c||g))return e;s&F&&(e[2]=t[2],o|=n&F?0:z);var m=t[3];if(m){var y=e[3];e[3]=y?da(y,m,t[4]):m,e[4]=y?rn(e[3],w):t[4]}return m=t[5],m&&(y=e[5],e[5]=y?fa(y,m,t[6]):m,e[6]=y?rn(e[5],w):t[6]),m=t[7],m&&(e[7]=m),s&Y&&(e[8]=e[8]==null?t[8]:nt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function Nd(e){var t=[];if(e!=null)for(var n in Ce(e))t.push(n);return t}function Sd(e){return Pr.call(e)}function Aa(e,t,n){return t=Je(t===r?e.length-1:t,0),function(){for(var s=arguments,o=-1,c=Je(s.length-t,0),g=N(c);++o<c;)g[o]=s[t+o];o=-1;for(var m=N(t+1);++o<t;)m[o]=s[o];return m[t]=n(g),ht(e,this,m)}}function Ma(e,t){return t.length<2?e:Nn(e,kt(t,0,-1))}function jd(e,t){for(var n=e.length,s=nt(t.length,n),o=lt(e);s--;){var c=t[s];e[s]=Jt(c,n)?o[c]:r}return e}function Si(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var La=Oa(ta),fr=Bc||function(e,t){return Xe.setTimeout(e,t)},ji=Oa(Ju);function Pa(e,t,n){var s=t+"";return ji(e,md(s,Cd(hd(s),n)))}function Oa(e){var t=0,n=0;return function(){var s=Gc(),o=be-(s-n);if(n=s,o>0){if(++t>=D)return arguments[0]}else t=0;return e.apply(r,arguments)}}function rs(e,t){var n=-1,s=e.length,o=s-1;for(t=t===r?s:t;++n<t;){var c=ai(n,o),g=e[c];e[c]=e[n],e[n]=g}return e.length=t,e}var Ta=_d(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(We,function(n,s,o,c){t.push(o?c.replace(Nr,"$1"):s||n)}),t});function Ft(e){if(typeof e=="string"||mt(e))return e;var t=e+"";return t=="0"&&1/e==-he?"-0":t}function jn(e){if(e!=null){try{return Lr.call(e)}catch{}try{return e+""}catch{}}return""}function Cd(e,t){return Nt(Le,function(n){var s="_."+n[0];t&n[1]&&!kr(e,s)&&e.push(s)}),e.sort()}function Ra(e){if(e instanceof xe)return e.clone();var t=new jt(e.__wrapped__,e.__chain__);return t.__actions__=lt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function kd(e,t,n){(n?it(e,t,n):t===r)?t=1:t=Je(ae(t),0);var s=e==null?0:e.length;if(!s||t<1)return[];for(var o=0,c=0,g=N($r(s/t));o<s;)g[c++]=kt(e,o,o+=t);return g}function Ed(e){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var c=e[t];c&&(o[s++]=c)}return o}function Id(){var e=arguments.length;if(!e)return[];for(var t=N(e-1),n=arguments[0],s=e;s--;)t[s-1]=arguments[s];return nn(ie(n)?lt(n):[n],Qe(t,1))}var Ad=de(function(e,t){return Ue(e)?or(e,Qe(t,1,Ue,!0)):[]}),Md=de(function(e,t){var n=Et(t);return Ue(n)&&(n=r),Ue(e)?or(e,Qe(t,1,Ue,!0),Q(n,2)):[]}),Ld=de(function(e,t){var n=Et(t);return Ue(n)&&(n=r),Ue(e)?or(e,Qe(t,1,Ue,!0),r,n):[]});function Pd(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ae(t),kt(e,t<0?0:t,s)):[]}function Od(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ae(t),t=s-t,kt(e,0,t<0?0:t)):[]}function Td(e,t){return e&&e.length?Vr(e,Q(t,3),!0,!0):[]}function Rd(e,t){return e&&e.length?Vr(e,Q(t,3),!0):[]}function Dd(e,t,n,s){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&it(e,t,n)&&(n=0,s=o),Iu(e,t,n,s)):[]}function Da(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ae(n);return o<0&&(o=Je(s+o,0)),Er(e,Q(t,3),o)}function Wa(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s-1;return n!==r&&(o=ae(n),o=n<0?Je(s+o,0):nt(o,s-1)),Er(e,Q(t,3),o,!0)}function $a(e){var t=e==null?0:e.length;return t?Qe(e,1):[]}function Wd(e){var t=e==null?0:e.length;return t?Qe(e,he):[]}function $d(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:ae(t),Qe(e,t)):[]}function Bd(e){for(var t=-1,n=e==null?0:e.length,s={};++t<n;){var o=e[t];s[o[0]]=o[1]}return s}function Ba(e){return e&&e.length?e[0]:r}function Fd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ae(n);return o<0&&(o=Je(s+o,0)),On(e,t,o)}function zd(e){var t=e==null?0:e.length;return t?kt(e,0,-1):[]}var Ud=de(function(e){var t=Pe(e,fi);return t.length&&t[0]===e[0]?ni(t):[]}),Gd=de(function(e){var t=Et(e),n=Pe(e,fi);return t===Et(n)?t=r:n.pop(),n.length&&n[0]===e[0]?ni(n,Q(t,2)):[]}),Hd=de(function(e){var t=Et(e),n=Pe(e,fi);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?ni(n,r,t):[]});function Kd(e,t){return e==null?"":zc.call(e,t)}function Et(e){var t=e==null?0:e.length;return t?e[t-1]:r}function qd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s;return n!==r&&(o=ae(n),o=o<0?Je(s+o,0):nt(o,s-1)),t===t?Cc(e,t,o):Er(e,bo,o,!0)}function Jd(e,t){return e&&e.length?Zo(e,ae(t)):r}var Vd=de(Fa);function Fa(e,t){return e&&e.length&&t&&t.length?oi(e,t):e}function Yd(e,t,n){return e&&e.length&&t&&t.length?oi(e,t,Q(n,2)):e}function Zd(e,t,n){return e&&e.length&&t&&t.length?oi(e,t,r,n):e}var Xd=qt(function(e,t){var n=e==null?0:e.length,s=Xs(e,t);return ea(e,Pe(t,function(o){return Jt(o,n)?+o:o}).sort(ua)),s});function Qd(e,t){var n=[];if(!(e&&e.length))return n;var s=-1,o=[],c=e.length;for(t=Q(t,3);++s<c;){var g=e[s];t(g,s,e)&&(n.push(g),o.push(s))}return ea(e,o),n}function Ci(e){return e==null?e:Kc.call(e)}function ef(e,t,n){var s=e==null?0:e.length;return s?(n&&typeof n!="number"&&it(e,t,n)?(t=0,n=s):(t=t==null?0:ae(t),n=n===r?s:ae(n)),kt(e,t,n)):[]}function tf(e,t){return Jr(e,t)}function nf(e,t,n){return ci(e,t,Q(n,2))}function rf(e,t){var n=e==null?0:e.length;if(n){var s=Jr(e,t);if(s<n&&Tt(e[s],t))return s}return-1}function sf(e,t){return Jr(e,t,!0)}function of(e,t,n){return ci(e,t,Q(n,2),!0)}function af(e,t){var n=e==null?0:e.length;if(n){var s=Jr(e,t,!0)-1;if(Tt(e[s],t))return s}return-1}function lf(e){return e&&e.length?na(e):[]}function cf(e,t){return e&&e.length?na(e,Q(t,2)):[]}function uf(e){var t=e==null?0:e.length;return t?kt(e,1,t):[]}function df(e,t,n){return e&&e.length?(t=n||t===r?1:ae(t),kt(e,0,t<0?0:t)):[]}function ff(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ae(t),t=s-t,kt(e,t<0?0:t,s)):[]}function hf(e,t){return e&&e.length?Vr(e,Q(t,3),!1,!0):[]}function gf(e,t){return e&&e.length?Vr(e,Q(t,3)):[]}var pf=de(function(e){return an(Qe(e,1,Ue,!0))}),mf=de(function(e){var t=Et(e);return Ue(t)&&(t=r),an(Qe(e,1,Ue,!0),Q(t,2))}),xf=de(function(e){var t=Et(e);return t=typeof t=="function"?t:r,an(Qe(e,1,Ue,!0),r,t)});function vf(e){return e&&e.length?an(e):[]}function yf(e,t){return e&&e.length?an(e,Q(t,2)):[]}function bf(e,t){return t=typeof t=="function"?t:r,e&&e.length?an(e,r,t):[]}function ki(e){if(!(e&&e.length))return[];var t=0;return e=tn(e,function(n){if(Ue(n))return t=Je(n.length,t),!0}),Gs(t,function(n){return Pe(e,Fs(n))})}function za(e,t){if(!(e&&e.length))return[];var n=ki(e);return t==null?n:Pe(n,function(s){return ht(t,r,s)})}var _f=de(function(e,t){return Ue(e)?or(e,t):[]}),wf=de(function(e){return di(tn(e,Ue))}),Nf=de(function(e){var t=Et(e);return Ue(t)&&(t=r),di(tn(e,Ue),Q(t,2))}),Sf=de(function(e){var t=Et(e);return t=typeof t=="function"?t:r,di(tn(e,Ue),r,t)}),jf=de(ki);function Cf(e,t){return oa(e||[],t||[],ir)}function kf(e,t){return oa(e||[],t||[],cr)}var Ef=de(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,za(e,n)});function Ua(e){var t=l(e);return t.__chain__=!0,t}function If(e,t){return t(e),e}function ss(e,t){return t(e)}var Af=qt(function(e){var t=e.length,n=t?e[0]:0,s=this.__wrapped__,o=function(c){return Xs(c,e)};return t>1||this.__actions__.length||!(s instanceof xe)||!Jt(n)?this.thru(o):(s=s.slice(n,+n+(t?1:0)),s.__actions__.push({func:ss,args:[o],thisArg:r}),new jt(s,this.__chain__).thru(function(c){return t&&!c.length&&c.push(r),c}))});function Mf(){return Ua(this)}function Lf(){return new jt(this.value(),this.__chain__)}function Pf(){this.__values__===r&&(this.__values__=rl(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Of(){return this}function Tf(e){for(var t,n=this;n instanceof Ur;){var s=Ra(n);s.__index__=0,s.__values__=r,t?o.__wrapped__=s:t=s;var o=s;n=n.__wrapped__}return o.__wrapped__=e,t}function Rf(){var e=this.__wrapped__;if(e instanceof xe){var t=e;return this.__actions__.length&&(t=new xe(this)),t=t.reverse(),t.__actions__.push({func:ss,args:[Ci],thisArg:r}),new jt(t,this.__chain__)}return this.thru(Ci)}function Df(){return ia(this.__wrapped__,this.__actions__)}var Wf=Yr(function(e,t,n){Se.call(e,n)?++e[n]:Ht(e,n,1)});function $f(e,t,n){var s=ie(e)?vo:Eu;return n&&it(e,t,n)&&(t=r),s(e,Q(t,3))}function Bf(e,t){var n=ie(e)?tn:zo;return n(e,Q(t,3))}var Ff=ma(Da),zf=ma(Wa);function Uf(e,t){return Qe(is(e,t),1)}function Gf(e,t){return Qe(is(e,t),he)}function Hf(e,t,n){return n=n===r?1:ae(n),Qe(is(e,t),n)}function Ga(e,t){var n=ie(e)?Nt:on;return n(e,Q(t,3))}function Ha(e,t){var n=ie(e)?cc:Fo;return n(e,Q(t,3))}var Kf=Yr(function(e,t,n){Se.call(e,n)?e[n].push(t):Ht(e,n,[t])});function qf(e,t,n,s){e=ct(e)?e:Kn(e),n=n&&!s?ae(n):0;var o=e.length;return n<0&&(n=Je(o+n,0)),us(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&On(e,t,n)>-1}var Jf=de(function(e,t,n){var s=-1,o=typeof t=="function",c=ct(e)?N(e.length):[];return on(e,function(g){c[++s]=o?ht(t,g,n):ar(g,t,n)}),c}),Vf=Yr(function(e,t,n){Ht(e,n,t)});function is(e,t){var n=ie(e)?Pe:Jo;return n(e,Q(t,3))}function Yf(e,t,n,s){return e==null?[]:(ie(t)||(t=t==null?[]:[t]),n=s?r:n,ie(n)||(n=n==null?[]:[n]),Xo(e,t,n))}var Zf=Yr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Xf(e,t,n){var s=ie(e)?$s:wo,o=arguments.length<3;return s(e,Q(t,4),n,o,on)}function Qf(e,t,n){var s=ie(e)?uc:wo,o=arguments.length<3;return s(e,Q(t,4),n,o,Fo)}function eh(e,t){var n=ie(e)?tn:zo;return n(e,ls(Q(t,3)))}function th(e){var t=ie(e)?Do:Ku;return t(e)}function nh(e,t,n){(n?it(e,t,n):t===r)?t=1:t=ae(t);var s=ie(e)?Nu:qu;return s(e,t)}function rh(e){var t=ie(e)?Su:Vu;return t(e)}function sh(e){if(e==null)return 0;if(ct(e))return us(e)?Rn(e):e.length;var t=rt(e);return t==Ye||t==we?e.size:si(e).length}function ih(e,t,n){var s=ie(e)?Bs:Yu;return n&&it(e,t,n)&&(t=r),s(e,Q(t,3))}var oh=de(function(e,t){if(e==null)return[];var n=t.length;return n>1&&it(e,t[0],t[1])?t=[]:n>2&&it(t[0],t[1],t[2])&&(t=[t[0]]),Xo(e,Qe(t,1),[])}),os=$c||function(){return Xe.Date.now()};function ah(e,t){if(typeof t!="function")throw new St(p);return e=ae(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ka(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Kt(e,Y,r,r,r,r,t)}function qa(e,t){var n;if(typeof t!="function")throw new St(p);return e=ae(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Ei=de(function(e,t,n){var s=F;if(n.length){var o=rn(n,Gn(Ei));s|=T}return Kt(e,s,t,n,o)}),Ja=de(function(e,t,n){var s=F|B;if(n.length){var o=rn(n,Gn(Ja));s|=T}return Kt(t,s,e,n,o)});function Va(e,t,n){t=n?r:t;var s=Kt(e,X,r,r,r,r,r,t);return s.placeholder=Va.placeholder,s}function Ya(e,t,n){t=n?r:t;var s=Kt(e,M,r,r,r,r,r,t);return s.placeholder=Ya.placeholder,s}function Za(e,t,n){var s,o,c,g,m,y,k=0,E=!1,L=!1,$=!0;if(typeof e!="function")throw new St(p);t=It(t)||0,Re(n)&&(E=!!n.leading,L="maxWait"in n,c=L?Je(It(n.maxWait)||0,t):c,$="trailing"in n?!!n.trailing:$);function V(Ge){var Rt=s,Zt=o;return s=o=r,k=Ge,g=e.apply(Zt,Rt),g}function ee(Ge){return k=Ge,m=fr(ge,t),E?V(Ge):g}function ce(Ge){var Rt=Ge-y,Zt=Ge-k,ml=t-Rt;return L?nt(ml,c-Zt):ml}function te(Ge){var Rt=Ge-y,Zt=Ge-k;return y===r||Rt>=t||Rt<0||L&&Zt>=c}function ge(){var Ge=os();if(te(Ge))return ve(Ge);m=fr(ge,ce(Ge))}function ve(Ge){return m=r,$&&s?V(Ge):(s=o=r,g)}function xt(){m!==r&&aa(m),k=0,s=y=o=m=r}function ot(){return m===r?g:ve(os())}function vt(){var Ge=os(),Rt=te(Ge);if(s=arguments,o=this,y=Ge,Rt){if(m===r)return ee(y);if(L)return aa(m),m=fr(ge,t),V(y)}return m===r&&(m=fr(ge,t)),g}return vt.cancel=xt,vt.flush=ot,vt}var lh=de(function(e,t){return Bo(e,1,t)}),ch=de(function(e,t,n){return Bo(e,It(t)||0,n)});function uh(e){return Kt(e,G)}function as(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new St(p);var n=function(){var s=arguments,o=t?t.apply(this,s):s[0],c=n.cache;if(c.has(o))return c.get(o);var g=e.apply(this,s);return n.cache=c.set(o,g)||c,g};return n.cache=new(as.Cache||Gt),n}as.Cache=Gt;function ls(e){if(typeof e!="function")throw new St(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function dh(e){return qa(2,e)}var fh=Zu(function(e,t){t=t.length==1&&ie(t[0])?Pe(t[0],gt(Q())):Pe(Qe(t,1),gt(Q()));var n=t.length;return de(function(s){for(var o=-1,c=nt(s.length,n);++o<c;)s[o]=t[o].call(this,s[o]);return ht(e,this,s)})}),Ii=de(function(e,t){var n=rn(t,Gn(Ii));return Kt(e,T,r,t,n)}),Xa=de(function(e,t){var n=rn(t,Gn(Xa));return Kt(e,U,r,t,n)}),hh=qt(function(e,t){return Kt(e,Me,r,r,r,t)});function gh(e,t){if(typeof e!="function")throw new St(p);return t=t===r?t:ae(t),de(e,t)}function ph(e,t){if(typeof e!="function")throw new St(p);return t=t==null?0:Je(ae(t),0),de(function(n){var s=n[t],o=cn(n,0,t);return s&&nn(o,s),ht(e,this,o)})}function mh(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new St(p);return Re(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),Za(e,t,{leading:s,maxWait:t,trailing:o})}function xh(e){return Ka(e,1)}function vh(e,t){return Ii(hi(t),e)}function yh(){if(!arguments.length)return[];var e=arguments[0];return ie(e)?e:[e]}function bh(e){return Ct(e,O)}function _h(e,t){return t=typeof t=="function"?t:r,Ct(e,O,t)}function wh(e){return Ct(e,_|O)}function Nh(e,t){return t=typeof t=="function"?t:r,Ct(e,_|O,t)}function Sh(e,t){return t==null||$o(e,t,Ze(t))}function Tt(e,t){return e===t||e!==e&&t!==t}var jh=es(ti),Ch=es(function(e,t){return e>=t}),Cn=Ho(function(){return arguments}())?Ho:function(e){return $e(e)&&Se.call(e,"callee")&&!Mo.call(e,"callee")},ie=N.isArray,kh=fo?gt(fo):Ou;function ct(e){return e!=null&&cs(e.length)&&!Vt(e)}function Ue(e){return $e(e)&&ct(e)}function Eh(e){return e===!0||e===!1||$e(e)&&st(e)==tt}var un=Fc||Bi,Ih=ho?gt(ho):Tu;function Ah(e){return $e(e)&&e.nodeType===1&&!hr(e)}function Mh(e){if(e==null)return!0;if(ct(e)&&(ie(e)||typeof e=="string"||typeof e.splice=="function"||un(e)||Hn(e)||Cn(e)))return!e.length;var t=rt(e);if(t==Ye||t==we)return!e.size;if(dr(e))return!si(e).length;for(var n in e)if(Se.call(e,n))return!1;return!0}function Lh(e,t){return lr(e,t)}function Ph(e,t,n){n=typeof n=="function"?n:r;var s=n?n(e,t):r;return s===r?lr(e,t,r,n):!!s}function Ai(e){if(!$e(e))return!1;var t=st(e);return t==bt||t==He||typeof e.message=="string"&&typeof e.name=="string"&&!hr(e)}function Oh(e){return typeof e=="number"&&Po(e)}function Vt(e){if(!Re(e))return!1;var t=st(e);return t==At||t==Wt||t==yt||t==Mt}function Qa(e){return typeof e=="number"&&e==ae(e)}function cs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=q}function Re(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function $e(e){return e!=null&&typeof e=="object"}var el=go?gt(go):Du;function Th(e,t){return e===t||ri(e,t,bi(t))}function Rh(e,t,n){return n=typeof n=="function"?n:r,ri(e,t,bi(t),n)}function Dh(e){return tl(e)&&e!=+e}function Wh(e){if(bd(e))throw new se(h);return Ko(e)}function $h(e){return e===null}function Bh(e){return e==null}function tl(e){return typeof e=="number"||$e(e)&&st(e)==K}function hr(e){if(!$e(e)||st(e)!=ye)return!1;var t=Rr(e);if(t===null)return!0;var n=Se.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Lr.call(n)==Tc}var Mi=po?gt(po):Wu;function Fh(e){return Qa(e)&&e>=-q&&e<=q}var nl=mo?gt(mo):$u;function us(e){return typeof e=="string"||!ie(e)&&$e(e)&&st(e)==De}function mt(e){return typeof e=="symbol"||$e(e)&&st(e)==ze}var Hn=xo?gt(xo):Bu;function zh(e){return e===r}function Uh(e){return $e(e)&&rt(e)==ft}function Gh(e){return $e(e)&&st(e)==ms}var Hh=es(ii),Kh=es(function(e,t){return e<=t});function rl(e){if(!e)return[];if(ct(e))return us(e)?Pt(e):lt(e);if(er&&e[er])return Nc(e[er]());var t=rt(e),n=t==Ye?Ks:t==we?Ir:Kn;return n(e)}function Yt(e){if(!e)return e===0?e:0;if(e=It(e),e===he||e===-he){var t=e<0?-1:1;return t*oe}return e===e?e:0}function ae(e){var t=Yt(e),n=t%1;return t===t?n?t-n:t:0}function sl(e){return e?wn(ae(e),0,Z):0}function It(e){if(typeof e=="number")return e;if(mt(e))return J;if(Re(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Re(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=No(e);var n=jr.test(e);return n||As.test(e)?oc(e.slice(2),n?2:8):Sr.test(e)?J:+e}function il(e){return Bt(e,ut(e))}function qh(e){return e?wn(ae(e),-q,q):e===0?e:0}function Ne(e){return e==null?"":pt(e)}var Jh=zn(function(e,t){if(dr(t)||ct(t)){Bt(t,Ze(t),e);return}for(var n in t)Se.call(t,n)&&ir(e,n,t[n])}),ol=zn(function(e,t){Bt(t,ut(t),e)}),ds=zn(function(e,t,n,s){Bt(t,ut(t),e,s)}),Vh=zn(function(e,t,n,s){Bt(t,Ze(t),e,s)}),Yh=qt(Xs);function Zh(e,t){var n=Fn(e);return t==null?n:Wo(n,t)}var Xh=de(function(e,t){e=Ce(e);var n=-1,s=t.length,o=s>2?t[2]:r;for(o&&it(t[0],t[1],o)&&(s=1);++n<s;)for(var c=t[n],g=ut(c),m=-1,y=g.length;++m<y;){var k=g[m],E=e[k];(E===r||Tt(E,Wn[k])&&!Se.call(e,k))&&(e[k]=c[k])}return e}),Qh=de(function(e){return e.push(r,Na),ht(al,r,e)});function e0(e,t){return yo(e,Q(t,3),$t)}function t0(e,t){return yo(e,Q(t,3),ei)}function n0(e,t){return e==null?e:Qs(e,Q(t,3),ut)}function r0(e,t){return e==null?e:Uo(e,Q(t,3),ut)}function s0(e,t){return e&&$t(e,Q(t,3))}function i0(e,t){return e&&ei(e,Q(t,3))}function o0(e){return e==null?[]:Kr(e,Ze(e))}function a0(e){return e==null?[]:Kr(e,ut(e))}function Li(e,t,n){var s=e==null?r:Nn(e,t);return s===r?n:s}function l0(e,t){return e!=null&&Ca(e,t,Au)}function Pi(e,t){return e!=null&&Ca(e,t,Mu)}var c0=va(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),e[t]=n},Ti(dt)),u0=va(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),Se.call(e,t)?e[t].push(n):e[t]=[n]},Q),d0=de(ar);function Ze(e){return ct(e)?Ro(e):si(e)}function ut(e){return ct(e)?Ro(e,!0):Fu(e)}function f0(e,t){var n={};return t=Q(t,3),$t(e,function(s,o,c){Ht(n,t(s,o,c),s)}),n}function h0(e,t){var n={};return t=Q(t,3),$t(e,function(s,o,c){Ht(n,o,t(s,o,c))}),n}var g0=zn(function(e,t,n){qr(e,t,n)}),al=zn(function(e,t,n,s){qr(e,t,n,s)}),p0=qt(function(e,t){var n={};if(e==null)return n;var s=!1;t=Pe(t,function(c){return c=ln(c,e),s||(s=c.length>1),c}),Bt(e,vi(e),n),s&&(n=Ct(n,_|A|O,ld));for(var o=t.length;o--;)ui(n,t[o]);return n});function m0(e,t){return ll(e,ls(Q(t)))}var x0=qt(function(e,t){return e==null?{}:Uu(e,t)});function ll(e,t){if(e==null)return{};var n=Pe(vi(e),function(s){return[s]});return t=Q(t),Qo(e,n,function(s,o){return t(s,o[0])})}function v0(e,t,n){t=ln(t,e);var s=-1,o=t.length;for(o||(o=1,e=r);++s<o;){var c=e==null?r:e[Ft(t[s])];c===r&&(s=o,c=n),e=Vt(c)?c.call(e):c}return e}function y0(e,t,n){return e==null?e:cr(e,t,n)}function b0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:cr(e,t,n,s)}var cl=_a(Ze),ul=_a(ut);function _0(e,t,n){var s=ie(e),o=s||un(e)||Hn(e);if(t=Q(t,4),n==null){var c=e&&e.constructor;o?n=s?new c:[]:Re(e)?n=Vt(c)?Fn(Rr(e)):{}:n={}}return(o?Nt:$t)(e,function(g,m,y){return t(n,g,m,y)}),n}function w0(e,t){return e==null?!0:ui(e,t)}function N0(e,t,n){return e==null?e:sa(e,t,hi(n))}function S0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:sa(e,t,hi(n),s)}function Kn(e){return e==null?[]:Hs(e,Ze(e))}function j0(e){return e==null?[]:Hs(e,ut(e))}function C0(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=It(n),n=n===n?n:0),t!==r&&(t=It(t),t=t===t?t:0),wn(It(e),t,n)}function k0(e,t,n){return t=Yt(t),n===r?(n=t,t=0):n=Yt(n),e=It(e),Lu(e,t,n)}function E0(e,t,n){if(n&&typeof n!="boolean"&&it(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Yt(e),t===r?(t=e,e=0):t=Yt(t)),e>t){var s=e;e=t,t=s}if(n||e%1||t%1){var o=Oo();return nt(e+o*(t-e+ic("1e-"+((o+"").length-1))),t)}return ai(e,t)}var I0=Un(function(e,t,n){return t=t.toLowerCase(),e+(n?dl(t):t)});function dl(e){return Oi(Ne(e).toLowerCase())}function fl(e){return e=Ne(e),e&&e.replace(Mn,vc).replace(Vl,"")}function A0(e,t,n){e=Ne(e),t=pt(t);var s=e.length;n=n===r?s:wn(ae(n),0,s);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function M0(e){return e=Ne(e),e&&_s.test(e)?e.replace(yr,yc):e}function L0(e){return e=Ne(e),e&&wr.test(e)?e.replace(Yn,"\\$&"):e}var P0=Un(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),O0=Un(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),T0=pa("toLowerCase");function R0(e,t,n){e=Ne(e),t=ae(t);var s=t?Rn(e):0;if(!t||s>=t)return e;var o=(t-s)/2;return Qr(Br(o),n)+e+Qr($r(o),n)}function D0(e,t,n){e=Ne(e),t=ae(t);var s=t?Rn(e):0;return t&&s<t?e+Qr(t-s,n):e}function W0(e,t,n){e=Ne(e),t=ae(t);var s=t?Rn(e):0;return t&&s<t?Qr(t-s,n)+e:e}function $0(e,t,n){return n||t==null?t=0:t&&(t=+t),Hc(Ne(e).replace(mn,""),t||0)}function B0(e,t,n){return(n?it(e,t,n):t===r)?t=1:t=ae(t),li(Ne(e),t)}function F0(){var e=arguments,t=Ne(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var z0=Un(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function U0(e,t,n){return n&&typeof n!="number"&&it(e,t,n)&&(t=n=r),n=n===r?Z:n>>>0,n?(e=Ne(e),e&&(typeof t=="string"||t!=null&&!Mi(t))&&(t=pt(t),!t&&Tn(e))?cn(Pt(e),0,n):e.split(t,n)):[]}var G0=Un(function(e,t,n){return e+(n?" ":"")+Oi(t)});function H0(e,t,n){return e=Ne(e),n=n==null?0:wn(ae(n),0,e.length),t=pt(t),e.slice(n,n+t.length)==t}function K0(e,t,n){var s=l.templateSettings;n&&it(e,t,n)&&(t=r),e=Ne(e),t=ds({},t,s,wa);var o=ds({},t.imports,s.imports,wa),c=Ze(o),g=Hs(o,c),m,y,k=0,E=t.interpolate||I,L="__p += '",$=qs((t.escape||I).source+"|"+E.source+"|"+(E===_r?Zn:I).source+"|"+(t.evaluate||I).source+"|$","g"),V="//# sourceURL="+(Se.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ec+"]")+`
`;e.replace($,function(te,ge,ve,xt,ot,vt){return ve||(ve=xt),L+=e.slice(k,vt).replace(P,bc),ge&&(m=!0,L+=`' +
__e(`+ge+`) +
'`),ot&&(y=!0,L+=`';
`+ot+`;
__p += '`),ve&&(L+=`' +
((__t = (`+ve+`)) == null ? '' : __t) +
'`),k=vt+te.length,te}),L+=`';
`;var ee=Se.call(t,"variable")&&t.variable;if(!ee)L=`with (obj) {
`+L+`
}
`;else if(Is.test(ee))throw new se(x);L=(y?L.replace(xs,""):L).replace(vs,"$1").replace(ys,"$1;"),L="function("+(ee||"obj")+`) {
`+(ee?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+L+`return __p
}`;var ce=gl(function(){return _e(c,V+"return "+L).apply(r,g)});if(ce.source=L,Ai(ce))throw ce;return ce}function q0(e){return Ne(e).toLowerCase()}function J0(e){return Ne(e).toUpperCase()}function V0(e,t,n){if(e=Ne(e),e&&(n||t===r))return No(e);if(!e||!(t=pt(t)))return e;var s=Pt(e),o=Pt(t),c=So(s,o),g=jo(s,o)+1;return cn(s,c,g).join("")}function Y0(e,t,n){if(e=Ne(e),e&&(n||t===r))return e.slice(0,ko(e)+1);if(!e||!(t=pt(t)))return e;var s=Pt(e),o=jo(s,Pt(t))+1;return cn(s,0,o).join("")}function Z0(e,t,n){if(e=Ne(e),e&&(n||t===r))return e.replace(mn,"");if(!e||!(t=pt(t)))return e;var s=Pt(e),o=So(s,Pt(t));return cn(s,o).join("")}function X0(e,t){var n=ue,s=je;if(Re(t)){var o="separator"in t?t.separator:o;n="length"in t?ae(t.length):n,s="omission"in t?pt(t.omission):s}e=Ne(e);var c=e.length;if(Tn(e)){var g=Pt(e);c=g.length}if(n>=c)return e;var m=n-Rn(s);if(m<1)return s;var y=g?cn(g,0,m).join(""):e.slice(0,m);if(o===r)return y+s;if(g&&(m+=y.length-m),Mi(o)){if(e.slice(m).search(o)){var k,E=y;for(o.global||(o=qs(o.source,Ne(Xn.exec(o))+"g")),o.lastIndex=0;k=o.exec(E);)var L=k.index;y=y.slice(0,L===r?m:L)}}else if(e.indexOf(pt(o),m)!=m){var $=y.lastIndexOf(o);$>-1&&(y=y.slice(0,$))}return y+s}function Q0(e){return e=Ne(e),e&&bs.test(e)?e.replace(vr,kc):e}var eg=Un(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Oi=pa("toUpperCase");function hl(e,t,n){return e=Ne(e),t=n?r:t,t===r?wc(e)?Ac(e):hc(e):e.match(t)||[]}var gl=de(function(e,t){try{return ht(e,r,t)}catch(n){return Ai(n)?n:new se(n)}}),tg=qt(function(e,t){return Nt(t,function(n){n=Ft(n),Ht(e,n,Ei(e[n],e))}),e});function ng(e){var t=e==null?0:e.length,n=Q();return e=t?Pe(e,function(s){if(typeof s[1]!="function")throw new St(p);return[n(s[0]),s[1]]}):[],de(function(s){for(var o=-1;++o<t;){var c=e[o];if(ht(c[0],this,s))return ht(c[1],this,s)}})}function rg(e){return ku(Ct(e,_))}function Ti(e){return function(){return e}}function sg(e,t){return e==null||e!==e?t:e}var ig=xa(),og=xa(!0);function dt(e){return e}function Ri(e){return qo(typeof e=="function"?e:Ct(e,_))}function ag(e){return Vo(Ct(e,_))}function lg(e,t){return Yo(e,Ct(t,_))}var cg=de(function(e,t){return function(n){return ar(n,e,t)}}),ug=de(function(e,t){return function(n){return ar(e,n,t)}});function Di(e,t,n){var s=Ze(t),o=Kr(t,s);n==null&&!(Re(t)&&(o.length||!s.length))&&(n=t,t=e,e=this,o=Kr(t,Ze(t)));var c=!(Re(n)&&"chain"in n)||!!n.chain,g=Vt(e);return Nt(o,function(m){var y=t[m];e[m]=y,g&&(e.prototype[m]=function(){var k=this.__chain__;if(c||k){var E=e(this.__wrapped__),L=E.__actions__=lt(this.__actions__);return L.push({func:y,args:arguments,thisArg:e}),E.__chain__=k,E}return y.apply(e,nn([this.value()],arguments))})}),e}function dg(){return Xe._===this&&(Xe._=Rc),this}function Wi(){}function fg(e){return e=ae(e),de(function(t){return Zo(t,e)})}var hg=pi(Pe),gg=pi(vo),pg=pi(Bs);function pl(e){return wi(e)?Fs(Ft(e)):Gu(e)}function mg(e){return function(t){return e==null?r:Nn(e,t)}}var xg=ya(),vg=ya(!0);function $i(){return[]}function Bi(){return!1}function yg(){return{}}function bg(){return""}function _g(){return!0}function wg(e,t){if(e=ae(e),e<1||e>q)return[];var n=Z,s=nt(e,Z);t=Q(t),e-=Z;for(var o=Gs(s,t);++n<e;)t(n);return o}function Ng(e){return ie(e)?Pe(e,Ft):mt(e)?[e]:lt(Ta(Ne(e)))}function Sg(e){var t=++Oc;return Ne(e)+t}var jg=Xr(function(e,t){return e+t},0),Cg=mi("ceil"),kg=Xr(function(e,t){return e/t},1),Eg=mi("floor");function Ig(e){return e&&e.length?Hr(e,dt,ti):r}function Ag(e,t){return e&&e.length?Hr(e,Q(t,2),ti):r}function Mg(e){return _o(e,dt)}function Lg(e,t){return _o(e,Q(t,2))}function Pg(e){return e&&e.length?Hr(e,dt,ii):r}function Og(e,t){return e&&e.length?Hr(e,Q(t,2),ii):r}var Tg=Xr(function(e,t){return e*t},1),Rg=mi("round"),Dg=Xr(function(e,t){return e-t},0);function Wg(e){return e&&e.length?Us(e,dt):0}function $g(e,t){return e&&e.length?Us(e,Q(t,2)):0}return l.after=ah,l.ary=Ka,l.assign=Jh,l.assignIn=ol,l.assignInWith=ds,l.assignWith=Vh,l.at=Yh,l.before=qa,l.bind=Ei,l.bindAll=tg,l.bindKey=Ja,l.castArray=yh,l.chain=Ua,l.chunk=kd,l.compact=Ed,l.concat=Id,l.cond=ng,l.conforms=rg,l.constant=Ti,l.countBy=Wf,l.create=Zh,l.curry=Va,l.curryRight=Ya,l.debounce=Za,l.defaults=Xh,l.defaultsDeep=Qh,l.defer=lh,l.delay=ch,l.difference=Ad,l.differenceBy=Md,l.differenceWith=Ld,l.drop=Pd,l.dropRight=Od,l.dropRightWhile=Td,l.dropWhile=Rd,l.fill=Dd,l.filter=Bf,l.flatMap=Uf,l.flatMapDeep=Gf,l.flatMapDepth=Hf,l.flatten=$a,l.flattenDeep=Wd,l.flattenDepth=$d,l.flip=uh,l.flow=ig,l.flowRight=og,l.fromPairs=Bd,l.functions=o0,l.functionsIn=a0,l.groupBy=Kf,l.initial=zd,l.intersection=Ud,l.intersectionBy=Gd,l.intersectionWith=Hd,l.invert=c0,l.invertBy=u0,l.invokeMap=Jf,l.iteratee=Ri,l.keyBy=Vf,l.keys=Ze,l.keysIn=ut,l.map=is,l.mapKeys=f0,l.mapValues=h0,l.matches=ag,l.matchesProperty=lg,l.memoize=as,l.merge=g0,l.mergeWith=al,l.method=cg,l.methodOf=ug,l.mixin=Di,l.negate=ls,l.nthArg=fg,l.omit=p0,l.omitBy=m0,l.once=dh,l.orderBy=Yf,l.over=hg,l.overArgs=fh,l.overEvery=gg,l.overSome=pg,l.partial=Ii,l.partialRight=Xa,l.partition=Zf,l.pick=x0,l.pickBy=ll,l.property=pl,l.propertyOf=mg,l.pull=Vd,l.pullAll=Fa,l.pullAllBy=Yd,l.pullAllWith=Zd,l.pullAt=Xd,l.range=xg,l.rangeRight=vg,l.rearg=hh,l.reject=eh,l.remove=Qd,l.rest=gh,l.reverse=Ci,l.sampleSize=nh,l.set=y0,l.setWith=b0,l.shuffle=rh,l.slice=ef,l.sortBy=oh,l.sortedUniq=lf,l.sortedUniqBy=cf,l.split=U0,l.spread=ph,l.tail=uf,l.take=df,l.takeRight=ff,l.takeRightWhile=hf,l.takeWhile=gf,l.tap=If,l.throttle=mh,l.thru=ss,l.toArray=rl,l.toPairs=cl,l.toPairsIn=ul,l.toPath=Ng,l.toPlainObject=il,l.transform=_0,l.unary=xh,l.union=pf,l.unionBy=mf,l.unionWith=xf,l.uniq=vf,l.uniqBy=yf,l.uniqWith=bf,l.unset=w0,l.unzip=ki,l.unzipWith=za,l.update=N0,l.updateWith=S0,l.values=Kn,l.valuesIn=j0,l.without=_f,l.words=hl,l.wrap=vh,l.xor=wf,l.xorBy=Nf,l.xorWith=Sf,l.zip=jf,l.zipObject=Cf,l.zipObjectDeep=kf,l.zipWith=Ef,l.entries=cl,l.entriesIn=ul,l.extend=ol,l.extendWith=ds,Di(l,l),l.add=jg,l.attempt=gl,l.camelCase=I0,l.capitalize=dl,l.ceil=Cg,l.clamp=C0,l.clone=bh,l.cloneDeep=wh,l.cloneDeepWith=Nh,l.cloneWith=_h,l.conformsTo=Sh,l.deburr=fl,l.defaultTo=sg,l.divide=kg,l.endsWith=A0,l.eq=Tt,l.escape=M0,l.escapeRegExp=L0,l.every=$f,l.find=Ff,l.findIndex=Da,l.findKey=e0,l.findLast=zf,l.findLastIndex=Wa,l.findLastKey=t0,l.floor=Eg,l.forEach=Ga,l.forEachRight=Ha,l.forIn=n0,l.forInRight=r0,l.forOwn=s0,l.forOwnRight=i0,l.get=Li,l.gt=jh,l.gte=Ch,l.has=l0,l.hasIn=Pi,l.head=Ba,l.identity=dt,l.includes=qf,l.indexOf=Fd,l.inRange=k0,l.invoke=d0,l.isArguments=Cn,l.isArray=ie,l.isArrayBuffer=kh,l.isArrayLike=ct,l.isArrayLikeObject=Ue,l.isBoolean=Eh,l.isBuffer=un,l.isDate=Ih,l.isElement=Ah,l.isEmpty=Mh,l.isEqual=Lh,l.isEqualWith=Ph,l.isError=Ai,l.isFinite=Oh,l.isFunction=Vt,l.isInteger=Qa,l.isLength=cs,l.isMap=el,l.isMatch=Th,l.isMatchWith=Rh,l.isNaN=Dh,l.isNative=Wh,l.isNil=Bh,l.isNull=$h,l.isNumber=tl,l.isObject=Re,l.isObjectLike=$e,l.isPlainObject=hr,l.isRegExp=Mi,l.isSafeInteger=Fh,l.isSet=nl,l.isString=us,l.isSymbol=mt,l.isTypedArray=Hn,l.isUndefined=zh,l.isWeakMap=Uh,l.isWeakSet=Gh,l.join=Kd,l.kebabCase=P0,l.last=Et,l.lastIndexOf=qd,l.lowerCase=O0,l.lowerFirst=T0,l.lt=Hh,l.lte=Kh,l.max=Ig,l.maxBy=Ag,l.mean=Mg,l.meanBy=Lg,l.min=Pg,l.minBy=Og,l.stubArray=$i,l.stubFalse=Bi,l.stubObject=yg,l.stubString=bg,l.stubTrue=_g,l.multiply=Tg,l.nth=Jd,l.noConflict=dg,l.noop=Wi,l.now=os,l.pad=R0,l.padEnd=D0,l.padStart=W0,l.parseInt=$0,l.random=E0,l.reduce=Xf,l.reduceRight=Qf,l.repeat=B0,l.replace=F0,l.result=v0,l.round=Rg,l.runInContext=v,l.sample=th,l.size=sh,l.snakeCase=z0,l.some=ih,l.sortedIndex=tf,l.sortedIndexBy=nf,l.sortedIndexOf=rf,l.sortedLastIndex=sf,l.sortedLastIndexBy=of,l.sortedLastIndexOf=af,l.startCase=G0,l.startsWith=H0,l.subtract=Dg,l.sum=Wg,l.sumBy=$g,l.template=K0,l.times=wg,l.toFinite=Yt,l.toInteger=ae,l.toLength=sl,l.toLower=q0,l.toNumber=It,l.toSafeInteger=qh,l.toString=Ne,l.toUpper=J0,l.trim=V0,l.trimEnd=Y0,l.trimStart=Z0,l.truncate=X0,l.unescape=Q0,l.uniqueId=Sg,l.upperCase=eg,l.upperFirst=Oi,l.each=Ga,l.eachRight=Ha,l.first=Ba,Di(l,function(){var e={};return $t(l,function(t,n){Se.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=d,Nt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),Nt(["drop","take"],function(e,t){xe.prototype[e]=function(n){n=n===r?1:Je(ae(n),0);var s=this.__filtered__&&!t?new xe(this):this.clone();return s.__filtered__?s.__takeCount__=nt(n,s.__takeCount__):s.__views__.push({size:nt(n,Z),type:e+(s.__dir__<0?"Right":"")}),s},xe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Nt(["filter","map","takeWhile"],function(e,t){var n=t+1,s=n==le||n==ne;xe.prototype[e]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:Q(o,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),Nt(["head","last"],function(e,t){var n="take"+(t?"Right":"");xe.prototype[e]=function(){return this[n](1).value()[0]}}),Nt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[n](1)}}),xe.prototype.compact=function(){return this.filter(dt)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=de(function(e,t){return typeof e=="function"?new xe(this):this.map(function(n){return ar(n,e,t)})}),xe.prototype.reject=function(e){return this.filter(ls(Q(e)))},xe.prototype.slice=function(e,t){e=ae(e);var n=this;return n.__filtered__&&(e>0||t<0)?new xe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=ae(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(Z)},$t(xe.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),s=/^(?:head|last)$/.test(t),o=l[s?"take"+(t=="last"?"Right":""):t],c=s||/^find/.test(t);o&&(l.prototype[t]=function(){var g=this.__wrapped__,m=s?[1]:arguments,y=g instanceof xe,k=m[0],E=y||ie(g),L=function(ge){var ve=o.apply(l,nn([ge],m));return s&&$?ve[0]:ve};E&&n&&typeof k=="function"&&k.length!=1&&(y=E=!1);var $=this.__chain__,V=!!this.__actions__.length,ee=c&&!$,ce=y&&!V;if(!c&&E){g=ce?g:new xe(this);var te=e.apply(g,m);return te.__actions__.push({func:ss,args:[L],thisArg:r}),new jt(te,$)}return ee&&ce?e.apply(this,m):(te=this.thru(L),ee?s?te.value()[0]:te.value():te)})}),Nt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ar[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",s=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var o=arguments;if(s&&!this.__chain__){var c=this.value();return t.apply(ie(c)?c:[],o)}return this[n](function(g){return t.apply(ie(g)?g:[],o)})}}),$t(xe.prototype,function(e,t){var n=l[t];if(n){var s=n.name+"";Se.call(Bn,s)||(Bn[s]=[]),Bn[s].push({name:t,func:n})}}),Bn[Zr(r,B).name]=[{name:"wrapper",func:r}],xe.prototype.clone=Xc,xe.prototype.reverse=Qc,xe.prototype.value=eu,l.prototype.at=Af,l.prototype.chain=Mf,l.prototype.commit=Lf,l.prototype.next=Pf,l.prototype.plant=Tf,l.prototype.reverse=Rf,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Df,l.prototype.first=l.prototype.head,er&&(l.prototype[er]=Of),l},Dn=Mc();vn?((vn.exports=Dn)._=Dn,Rs._=Dn):Xe._=Dn}).call(gr)})(gs,gs.exports);var Ui=gs.exports;function Lp(a=!0){j.useEffect(()=>{if(!a)return;const u=Ui.debounce(r=>{document.documentElement.style.setProperty("--mouse-x",`${r.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${r.clientY}px`)},16);return document.addEventListener("mousemove",u),()=>{u.cancel(),document.removeEventListener("mousemove",u)}},[a])}function Pp(a=!0){const{state:u,dispatch:r}=Jn(),{activeTab:d,screenState:f}=u;j.useEffect(()=>{if(!a)return;const h=p=>{const x=d==="parameter-debug",b=d==="chat";//!screenState || screenState.currentScreen === 0;
if(b||x){const S=Oe.canvas.selected_nodes;Object.keys(S??{}).length?r({type:"SET_SELECTED_NODE",payload:Object.values(S)}):r({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[r,a,d,f])}const Op=({selectedNodes:a,handleParamSelect:u,selectedParams:r,handleNext:d,handleClose:f})=>{const p=a.flatMap(x=>(x.widgets||[]).map(b=>b.name)).some(x=>r[x]===!0);return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),i.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.map((x,b)=>{const S=x.title||"Unknown Node",w=x.widgets||[];return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:S}),i.jsx("div",{className:"p-4 space-y-3",children:i.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:w.map((_,A)=>{const O=_.name;return i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r[O]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:R=>u(O,R),children:r[O]&&i.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),i.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:O})]},`widget-${A}`)})})})]},`node-${b}`)}),i.jsx("div",{className:"mt-6 flex justify-center",children:i.jsx("button",{onClick:x=>d(x),disabled:!p,className:`px-3 py-1.5 text-xs ${p?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},Tp=({selectedNodes:a,paramTestValues:u,selectedParams:r,updateParamTestValues:d,toggleDropdown:f,openDropdowns:h,handleTestValueSelect:p,searchTerms:x,handleSearch:b,handleSelectAll:S,handleNext:w,handlePrevious:_,handleClose:A,inputValues:O,updateState:R,textInputs:W,handleTextInputChange:F,handleAddTextInput:B,handleRemoveTextInput:z,openAiWritingModal:X})=>{const M=(T,U,Y,Me=0)=>{if(T=isNaN(T)?0:T,U=isNaN(U)?100:U,Y=isNaN(Y)||Y<=0?1:Y,U<T&&(U=T),Math.floor((U-T)/Y)+1<=1)return[T];const ue=[];let je=T;for(;je<=U;){const D=Math.pow(10,Me),be=Math.round(je*D)/D;ue.push(be),je+=Y}return ue};return j.useEffect(()=>{!a||a.length===0||a.forEach(T=>{const U=T.id.toString(),Y=T.widgets||{};Object.values(Y).forEach(G=>{const ue=G.name;if(!r[ue])return;if(!(u[U]?.[ue]?.length>0)&&G.type==="number"){const D=G.options?.min||0,be=G.options?.max||100;let le=(G.options?.step||10)/10;le<.1&&(le=.1);const re=G.options?.precision||0,ne=M(D,be,le,re);if(ne.length>0){d(U,ue,ne);const he=`${U}_${ue}`;R(fe.InputValues,{...O,[he]:{min:D.toString(),max:be.toString(),step:le.toString()}})}}if(G.type==="customtext"||G.type.toLowerCase().includes("text")){const D=`${U}_${ue}`,be=W[D]||[""];JSON.stringify(be)!==JSON.stringify(u[U]?.[ue]||[""])&&d(U,ue,be)}})})},[a,r,u,W,d,M]),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:A,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length>0?a.map((T,U)=>{const Y=T.widgets||{},Me=Object.values(Y),G=T.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[i.jsxs("span",{children:[T.type," (ID: ",G,")"]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:ue=>A(ue,U),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"p-4 space-y-4",children:Me.map((ue,je)=>{const D=ue.name;if(!r[D])return null;const be=`${G}_${D}`;if(ue.type==="customtext"||ue.type.toLowerCase().includes("text")){const le=W[be]||[""];return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[D,":"]}),i.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>X(G,D),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),i.jsx("div",{className:"space-y-2",children:le.map((re,ne)=>i.jsxs("div",{className:"flex items-start",children:[i.jsx("textarea",{className:`flex-1 border ${re?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:re,onChange:he=>F(G,D,ne,he.target.value),required:!0}),i.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>z(G,D,ne),title:"Remove",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},ne))}),i.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>B(G,D),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},je)}if(ue.type==="number"){const le=ue.options?.min||0,re=ue.options?.max||100,ne=(ue.options?.step||10)/10,he=ue.options?.precision||0,q=M(le,re,ne,he),oe=O[be]||{min:le.toString(),max:re.toString(),step:ne.toString()};return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[D,":"]}),i.jsx("div",{className:"w-4"})]}),i.jsxs("div",{className:"flex space-x-2 items-center",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:oe.min,required:!0,onClick:J=>{J.preventDefault(),J.stopPropagation()},onChange:J=>{J.preventDefault(),J.stopPropagation();const Z=J.target.value;if(R(fe.InputValues,{...O,[be]:{...O[be],min:Z}}),Z===""||!isNaN(parseFloat(Z))){const Ee=Z===""?0:parseFloat(Z),Te=parseFloat(oe.max||re.toString()),Le=parseFloat(oe.step||ne.toString()),Ie=M(Ee,Te,Le,he);d(G,D,Ie)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:oe.max,onClick:J=>{J.preventDefault(),J.stopPropagation()},required:!0,onChange:J=>{J.preventDefault(),J.stopPropagation();const Z=J.target.value;if(R(fe.InputValues,{...O,[be]:{...O[be],max:Z}}),Z===""||!isNaN(parseFloat(Z))){const Ee=parseFloat(oe.min||le.toString()),Te=Z===""?Ee:parseFloat(Z),Le=parseFloat(oe.step||ne.toString()),Ie=M(Ee,Te,Le,he);d(G,D,Ie)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:oe.step,required:!0,onClick:J=>{J.preventDefault(),J.stopPropagation()},onChange:J=>{J.preventDefault(),J.stopPropagation();const Z=J.target.value;if(R(fe.InputValues,{...O,[be]:{...O[be],step:Z}}),Z===""||!isNaN(parseFloat(Z))&&parseFloat(Z)>0){const Ee=parseFloat(oe.min||le.toString()),Te=parseFloat(oe.max||re.toString());let Le=Z===""?1:parseFloat(Z);Le<.1&&(Le=.1);const Ie=M(Ee,Te,Le,he);d(G,D,Ie)}}})]}),i.jsxs("div",{className:"mt-1",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const J=u[G]?.[D]||q;if(J.length<=10)return J.map((Z,Ee)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Te=>{Te.stopPropagation(),p(G,D,Z,Te)},children:[i.jsx("span",{children:Z}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},Ee));{const Z=J.slice(0,5),Ee=J.slice(J.length-5);return i.jsxs(i.Fragment,{children:[Z.map((Te,Le)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ie=>{Ie.stopPropagation(),p(G,D,Te,Ie)},children:[i.jsx("span",{children:Te}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${Le}`)),i.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),Ee.map((Te,Le)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ie=>{Ie.stopPropagation(),p(G,D,Te,Ie)},children:[i.jsx("span",{children:Te}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${Le}`))]})}})()})]}),i.jsx("div",{className:"mt-1",children:i.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},je)}else if(ue.type==="combo"){const le=ue.options?.values||[],re=`${G}_${D}`,ne=q=>typeof q=="string"?q:q&&typeof q=="object"&&"name"in q?q.name:String(q),he=q=>typeof q=="object"&&q!==null&&"name"in q?q.name:q;return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("label",{className:"text-xs font-medium text-gray-700",children:D}),i.jsxs("div",{className:"relative dropdown-container",children:[i.jsxs("button",{className:`appearance-none border ${(u[G]?.[D]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:q=>{q.preventDefault(),q.stopPropagation(),f(G,D,q)},"data-dropdown":re,children:[i.jsx("span",{children:(u[G]?.[D]||[]).length>0?`${D}: ${(u[G]?.[D]||[]).length} selected`:`Select ${D}`}),i.jsx("div",{className:"ml-2",children:i.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:i.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),h[re]&&i.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof h[re]=="object"?`${h[re].y}px`:"0px",left:typeof h[re]=="object"?`${h[re].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[i.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:i.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:x[re]||"",onChange:q=>{q.preventDefault(),q.stopPropagation(),b(G,D,q.target.value)},onClick:q=>{q.preventDefault(),q.stopPropagation()},autoFocus:!0})}),i.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:q=>{q.preventDefault(),q.stopPropagation();const J=le.filter(Z=>!x[re]||ne(Z).toLowerCase().includes((x[re]||"").toLowerCase())).map(he);S(G,D,J)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${le.length>0&&(u[G]?.[D]||[]).length===le.length?"bg-blue-500 border-blue-500":(u[G]?.[D]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(u[G]?.[D]||[]).length>0&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"font-medium",children:le.length>0&&(u[G]?.[D]||[]).length===le.length?"Deselect All":"Select All"})]}),i.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[le.filter(q=>!x[re]||ne(q).toLowerCase().includes((x[re]||"").toLowerCase())).map((q,oe)=>i.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:J=>{J.preventDefault(),J.stopPropagation(),p(G,D,he(q),J)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(u[G]?.[D]||[]).includes(he(q))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(u[G]?.[D]||[]).includes(he(q))&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:ne(q)})]},oe)),le.filter(q=>!x[re]||ne(q).toLowerCase().includes((x[re]||"").toLowerCase())).length===0&&i.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(u[G]?.[D]||[]).length===0&&i.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(u[G]?.[D]||[]).map((q,oe)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:q}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:J=>{J.preventDefault(),J.stopPropagation(),p(G,D,q,J)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},oe))})]})]},je)}else return i.jsxs("div",{className:"border-b pb-3",children:[i.jsx("div",{className:"flex justify-between items-center",children:i.jsx("label",{className:"text-xs font-medium text-gray-700",children:D})}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(u[G]?.[D]||[]).map((le,re)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:le}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:ne=>{ne.preventDefault(),ne.stopPropagation(),p(G,D,le,ne)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},re)),i.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:le=>{le.preventDefault(),le.stopPropagation();const re=`${D}${(u[G]?.[D]||[]).length+1}`;d(G,D,[...u[G]?.[D]||[],re])},children:[i.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),i.jsx("span",{children:"Add"})]})]})]})]},je)})})]},U)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:T=>_(T),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:T=>w(T),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},Rp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:d,errorMessage:f,handlePrevious:h,handleStartGeneration:p,handleClose:x})=>{const[b,S]=j.useState([]),[w,_]=j.useState(null),[A,O]=j.useState(!1),{dispatch:R}=Jn(),W=()=>{const B=Object.values(Oe.graph._nodes_by_id),z=[],X=[];for(const T of B)T.type==="SaveImage"?z.push(T.id):T.type==="PreviewImage"&&X.push(T.id);const M=[...z,...X];S(M),M.length===1?_(M[0]):M.length>1&&(O(!0),_(null))};j.useEffect(()=>{W()},[]),j.useEffect(()=>{const B=()=>{if(!Oe.canvas.selected_nodes)return;const z=Object.values(Oe.canvas.selected_nodes);if(z.length===0)return;const X=z[0];X&&(X.type==="SaveImage"||X.type==="PreviewImage")&&(console.log("Selected image node:",X.id),_(X.id))};return document.addEventListener("click",B),()=>{document.removeEventListener("click",B)}},[]);const F=B=>{if(B&&(B.preventDefault(),B.stopPropagation()),b.length>1&&!w){O(!0);return}p(B,w||void 0)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",d," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:x,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),A&&b.length>1&&i.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:w===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${b.join(",")}. Please click the node on canvas.`:`Current node ID is ${w}, please click Start Generation again`})]})}),f&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:f})]})}),a.length>0?a.map((B,z)=>{const X=B.type||"Unknown Node",M=B.widgets||[],T=B.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[X," (ID: ",T,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:M.map((U,Y)=>{const Me=U.name;if(!r[Me])return null;const G=u[T]?.[Me]||[],ue=Array.isArray(G)?`[${G.join(", ")}]`:JSON.stringify(G);return i.jsxs("div",{className:Y<M.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700 text-xs",children:Me}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:ue,onClick:je=>je.preventDefault()})})]},Y)})})]},z)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:B=>h(B),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:B=>F(B),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${b.length>1&&!w?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:b.length>1&&!w,children:"Generate & Compare"})]})]})},Dp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:d,completedCount:f,errorMessage:h,handleClose:p,updateState:x,cleanupPolling:b})=>{const S=w=>{w.preventDefault(),w.stopPropagation(),Ip({clear:!0}),Ap(),b&&b(),x(fe.IsProcessing,!1),x(fe.CurrentSceen,2)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[i.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:i.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[i.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),i.jsxs("div",{className:"text-xs mb-3",children:["Completed ",f," of ",d," runs"]}),i.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${f/d*100}%`}})}),i.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",f," images"]}),i.jsx("button",{onClick:S,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",d," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:p,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:h})]})}),a.length>0?a.map((w,_)=>{const A=w.type||"Unknown Node",O=w.widgets||[],R=w.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[A," (ID: ",R,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:O.map((W,F)=>{const B=W.name;if(!r[B])return null;const z=u[R]?.[B]||[],X=Array.isArray(z)?`[${z.join(", ")}]`:JSON.stringify(z);return i.jsxs("div",{className:F<O.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700",children:B}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:X,onClick:M=>M.preventDefault()})})]},F)})})]},_)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},pr=({visible:a,imageUrl:u,params:r,onClose:d})=>{if(!a)return null;const f=()=>{if(!r||!r.nodeParams)return null;const h=Object.entries(r.nodeParams).map(([p,x])=>{const b=r.nodeNames?.[p]||r.selectedNodeInfoMap&&r.selectedNodeInfoMap[p]||(p.includes("text")?"Text Node":`Node ${p}`),S=Object.entries(x).filter(([w,_])=>typeof _!="object"||_===null).map(([w,_])=>i.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[i.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),i.jsxs("span",{className:"font-medium mr-1",children:[w,":"]}),i.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(_)})]},w));return i.jsxs("div",{className:"mb-4",children:[i.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:b}),S.length>0?S:i.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},p)});return i.jsx("div",{className:"overflow-y-auto max-h-full",children:h.length>0?h:i.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:d,children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[i.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:d,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),i.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:i.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:i.jsx("img",{src:u,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),i.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:i.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),r&&!r.nodeParams&&Object.entries(r).filter(([h,p])=>h!=="nodeParams"&&typeof p!="object").map(([h,p])=>i.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[i.jsxs("span",{className:"font-medium",children:[h,":"]})," ",String(p)]},h)),i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:f()})]})})]})})};function qn(a,u,r){let d=r.initialDeps??[],f;function h(){var p,x,b,S;let w;r.key&&((p=r.debug)!=null&&p.call(r))&&(w=Date.now());const _=a();if(!(_.length!==d.length||_.some((R,W)=>d[W]!==R)))return f;d=_;let O;if(r.key&&((x=r.debug)!=null&&x.call(r))&&(O=Date.now()),f=u(..._),r.key&&((b=r.debug)!=null&&b.call(r))){const R=Math.round((Date.now()-w)*100)/100,W=Math.round((Date.now()-O)*100)/100,F=W/16,B=(z,X)=>{for(z=String(z);z.length<X;)z=" "+z;return z};console.info(`%c⏱ ${B(W,5)} /${B(R,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*F,120))}deg 100% 31%);`,r?.key)}return(S=r?.onChange)==null||S.call(r,f),f}return h.updateDeps=p=>{d=p},h}function vl(a,u){if(a===void 0)throw new Error("Unexpected undefined");return a}const Wp=(a,u)=>Math.abs(a-u)<1.01,$p=(a,u,r)=>{let d;return function(...f){a.clearTimeout(d),d=a.setTimeout(()=>u.apply(this,f),r)}},yl=a=>{const{offsetWidth:u,offsetHeight:r}=a;return{width:u,height:r}},Bp=a=>a,Fp=a=>{const u=Math.max(a.startIndex-a.overscan,0),r=Math.min(a.endIndex+a.overscan,a.count-1),d=[];for(let f=u;f<=r;f++)d.push(f);return d},zp=(a,u)=>{const r=a.scrollElement;if(!r)return;const d=a.targetWindow;if(!d)return;const f=p=>{const{width:x,height:b}=p;u({width:Math.round(x),height:Math.round(b)})};if(f(yl(r)),!d.ResizeObserver)return()=>{};const h=new d.ResizeObserver(p=>{const x=()=>{const b=p[0];if(b?.borderBoxSize){const S=b.borderBoxSize[0];if(S){f({width:S.inlineSize,height:S.blockSize});return}}f(yl(r))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()});return h.observe(r,{box:"border-box"}),()=>{h.unobserve(r)}},bl={passive:!0},_l=typeof window>"u"?!0:"onscrollend"in window,Up=(a,u)=>{const r=a.scrollElement;if(!r)return;const d=a.targetWindow;if(!d)return;let f=0;const h=a.options.useScrollendEvent&&_l?()=>{}:$p(d,()=>{u(f,!1)},a.options.isScrollingResetDelay),p=w=>()=>{const{horizontal:_,isRtl:A}=a.options;f=_?r.scrollLeft*(A&&-1||1):r.scrollTop,h(),u(f,w)},x=p(!0),b=p(!1);b(),r.addEventListener("scroll",x,bl);const S=a.options.useScrollendEvent&&_l;return S&&r.addEventListener("scrollend",b,bl),()=>{r.removeEventListener("scroll",x),S&&r.removeEventListener("scrollend",b)}},Gp=(a,u,r)=>{if(u?.borderBoxSize){const d=u.borderBoxSize[0];if(d)return Math.round(d[r.options.horizontal?"inlineSize":"blockSize"])}return a[r.options.horizontal?"offsetWidth":"offsetHeight"]},Hp=(a,{adjustments:u=0,behavior:r},d)=>{var f,h;const p=a+u;(h=(f=d.scrollElement)==null?void 0:f.scrollTo)==null||h.call(f,{[d.options.horizontal?"left":"top"]:p,behavior:r})};class Kp{constructor(u){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const d=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(f=>{f.forEach(h=>{const p=()=>{this._measureElement(h.target,h)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(p):p()})}));return{disconnect:()=>{var f;(f=d())==null||f.disconnect(),r=null},observe:f=>{var h;return(h=d())==null?void 0:h.observe(f,{box:"border-box"})},unobserve:f=>{var h;return(h=d())==null?void 0:h.unobserve(f)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([d,f])=>{typeof f>"u"&&delete r[d]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Bp,rangeExtractor:Fp,onChange:()=>{},measureElement:Gp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var d,f;(f=(d=this.options).onChange)==null||f.call(d,this,r)},this.maybeNotify=qn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const d=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==d){if(this.cleanup(),!d){this.maybeNotify();return}this.scrollElement=d,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(f=>{this.observer.observe(f)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,f=>{this.scrollRect=f,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(f,h)=>{this.scrollAdjustments=0,this.scrollDirection=h?this.getScrollOffset()<f?"forward":"backward":null,this.scrollOffset=f,this.isScrolling=h,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,d)=>{const f=new Map,h=new Map;for(let p=d-1;p>=0;p--){const x=r[p];if(f.has(x.lane))continue;const b=h.get(x.lane);if(b==null||x.end>b.end?h.set(x.lane,x):x.end<b.end&&f.set(x.lane,!0),f.size===this.options.lanes)break}return h.size===this.options.lanes?Array.from(h.values()).sort((p,x)=>p.end===x.end?p.index-x.index:p.end-x.end)[0]:void 0},this.getMeasurementOptions=qn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,d,f,h,p)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:d,scrollMargin:f,getItemKey:h,enabled:p}),{key:!1}),this.getMeasurements=qn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:d,scrollMargin:f,getItemKey:h,enabled:p},x)=>{if(!p)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(w=>{this.itemSizeCache.set(w.key,w.size)}));const b=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const S=this.measurementsCache.slice(0,b);for(let w=b;w<r;w++){const _=h(w),A=this.options.lanes===1?S[w-1]:this.getFurthestMeasurement(S,w),O=A?A.end+this.options.gap:d+f,R=x.get(_),W=typeof R=="number"?R:this.options.estimateSize(w),F=O+W,B=A?A.lane:w%this.options.lanes;S[w]={index:w,start:O,size:W,end:F,key:_,lane:B}}return this.measurementsCache=S,S},{key:!1,debug:()=>this.options.debug}),this.calculateRange=qn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,d,f,h)=>this.range=r.length>0&&d>0?qp({measurements:r,outerSize:d,scrollOffset:f,lanes:h}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=qn(()=>{let r=null,d=null;const f=this.calculateRange();return f&&(r=f.startIndex,d=f.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,d]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,d]},(r,d,f,h,p)=>h===null||p===null?[]:r({startIndex:h,endIndex:p,overscan:d,count:f}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const d=this.options.indexAttribute,f=r.getAttribute(d);return f?parseInt(f,10):(console.warn(`Missing attribute name '${d}={index}' on measured element.`),-1)},this._measureElement=(r,d)=>{const f=this.indexFromElement(r),h=this.measurementsCache[f];if(!h)return;const p=h.key,x=this.elementsCache.get(p);x!==r&&(x&&this.observer.unobserve(x),this.observer.observe(r),this.elementsCache.set(p,r)),r.isConnected&&this.resizeItem(f,this.options.measureElement(r,d,this))},this.resizeItem=(r,d)=>{const f=this.measurementsCache[r];if(!f)return;const h=this.itemSizeCache.get(f.key)??f.size,p=d-h;p!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(f,p,this):f.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=p,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(f.index),this.itemSizeCache=new Map(this.itemSizeCache.set(f.key,d)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((d,f)=>{d.isConnected||(this.observer.unobserve(d),this.elementsCache.delete(f))});return}this._measureElement(r,void 0)},this.getVirtualItems=qn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,d)=>{const f=[];for(let h=0,p=r.length;h<p;h++){const x=r[h],b=d[x];f.push(b)}return f},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const d=this.getMeasurements();if(d.length!==0)return vl(d[El(0,d.length-1,f=>vl(d[f]).start,r)])},this.getOffsetForAlignment=(r,d,f=0)=>{const h=this.getSize(),p=this.getScrollOffset();d==="auto"&&(d=r>=p+h?"end":"start"),d==="center"?r+=(f-h)/2:d==="end"&&(r-=h);const x=this.getTotalSize()+this.options.scrollMargin-h;return Math.max(Math.min(x,r),0)},this.getOffsetForIndex=(r,d="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const f=this.measurementsCache[r];if(!f)return;const h=this.getSize(),p=this.getScrollOffset();if(d==="auto")if(f.end>=p+h-this.options.scrollPaddingEnd)d="end";else if(f.start<=p+this.options.scrollPaddingStart)d="start";else return[p,d];const x=d==="end"?f.end+this.options.scrollPaddingEnd:f.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(x,d,f.size),d]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:d="start",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,d),{adjustments:void 0,behavior:f})},this.scrollToIndex=(r,{align:d="auto",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let h=0;const p=10,x=S=>{if(!this.targetWindow)return;const w=this.getOffsetForIndex(r,S);if(!w){console.warn("Failed to get offset for index:",r);return}const[_,A]=w;this._scrollToOffset(_,{adjustments:void 0,behavior:f}),this.targetWindow.requestAnimationFrame(()=>{const O=this.getScrollOffset(),R=this.getOffsetForIndex(r,A);if(!R){console.warn("Failed to get offset for index:",r);return}Wp(R[0],O)||b(A)})},b=S=>{this.targetWindow&&(h++,h<p?this.targetWindow.requestAnimationFrame(()=>x(S)):console.warn(`Failed to scroll to index ${r} after ${p} attempts.`))};x(d)},this.scrollBy=(r,{behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:d})},this.getTotalSize=()=>{var r;const d=this.getMeasurements();let f;if(d.length===0)f=this.options.paddingStart;else if(this.options.lanes===1)f=((r=d[d.length-1])==null?void 0:r.end)??0;else{const h=Array(this.options.lanes).fill(null);let p=d.length-1;for(;p>=0&&h.some(x=>x===null);){const x=d[p];h[x.lane]===null&&(h[x.lane]=x.end),p--}f=Math.max(...h.filter(x=>x!==null))}return Math.max(f-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:d,behavior:f})=>{this.options.scrollToFn(r,{behavior:f,adjustments:d},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(u)}}const El=(a,u,r,d)=>{for(;a<=u;){const f=(a+u)/2|0,h=r(f);if(h<d)a=f+1;else if(h>d)u=f-1;else return f}return a>0?a-1:0};function qp({measurements:a,outerSize:u,scrollOffset:r,lanes:d}){const f=a.length-1,h=b=>a[b].start;if(a.length<=d)return{startIndex:0,endIndex:f};let p=El(0,f,h,r),x=p;if(d===1)for(;x<f&&a[x].end<r+u;)x++;else if(d>1){const b=Array(d).fill(0);for(;x<f&&b.some(w=>w<r+u);){const w=a[x];b[w.lane]=w.end,x++}const S=Array(d).fill(r+u);for(;p>=0&&S.some(w=>w>=r);){const w=a[p];S[w.lane]=w.start,p--}p=Math.max(0,p-p%d),x=Math.min(f,x+(d-1-x%d))}return{startIndex:p,endIndex:x}}const wl=typeof document<"u"?j.useLayoutEffect:j.useEffect;function Jp(a){const u=j.useReducer(()=>({}),{})[1],r={...a,onChange:(f,h)=>{var p;h?zg.flushSync(u):u(),(p=a.onChange)==null||p.call(a,f,h)}},[d]=j.useState(()=>new Kp(r));return d.setOptions(r),wl(()=>d._didMount(),[]),wl(()=>d._willUpdate()),d}function Vp(a){return Jp({observeElementRect:zp,observeElementOffset:Up,scrollToFn:Hp,...a})}const Il=a=>{const{items:u,renderItem:r,minWidth:d=200,gap:f=16}=a,h=j.useRef(null),[p,x]=j.useState(1),[b,S]=j.useState(0);j.useLayoutEffect(()=>{if(!h.current)return;const _=()=>{if(h.current){const O=h.current.offsetWidth,R=Math.max(1,Math.floor(O/(d+f/2)));x(R),S(Math.ceil(u.length/R))}};_();const A=new window.ResizeObserver(Ui.debounce(_,50));return A.observe(h.current),()=>A.disconnect()},[]);const w=Vp({count:b,getScrollElement:()=>h.current,estimateSize:()=>d+40,overscan:3,gap:f});return i.jsx("div",{ref:h,className:"h-full relative overflow-auto hide-scrollbar",children:i.jsx("div",{style:{height:w.getTotalSize(),position:"relative"},children:w.getVirtualItems().map(_=>{const A=_.index,O=A*p,R=Math.min(O+p,u.length);return i.jsx("div",{"data-index":A,ref:w.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${_.start}px)`,display:"grid",gridTemplateColumns:`repeat(${p}, minmax(${d}px, 1fr))`,gap:`${f}px`},children:u.slice(O,R).map((W,F)=>r(W,O+F))},A)})})})},Yp=({generatedImages:a,selectedImageIndex:u,handleSelectImage:r,handleApplySelected:d,handleClose:f,notificationVisible:h,modalVisible:p,modalImageUrl:x,modalImageParams:b,openImageModal:S,closeImageModal:w})=>{const _=(A,O)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===A.index?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:R=>r(O,R),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:R=>S(A.url,A.params,R),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:A.url,alt:`Generated image ${O+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(A.params).filter(([R,W])=>R!=="nodeParams"&&typeof W!="object").map(([R,W])=>i.jsxs("div",{children:[R,": ",String(W)]},R))})]},O.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["All ",a.length," images have been generated."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"py-1",children:i.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Il,{items:a,renderItem:_})}),i.jsx("div",{className:"mt-6 flex justify-end",children:i.jsx("button",{onClick:A=>d(A),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:u===null,children:"Apply Selected"})}),i.jsx(pr,{visible:p,imageUrl:x,params:b||{},onClose:w})]})},Zp=({visible:a,aiWritingModalText:u,setAiWritingModalText:r,aiGeneratedTexts:d,aiSelectedTexts:f,aiWritingLoading:h,aiWritingError:p,handleAiWriting:x,toggleTextSelection:b,addSelectedTexts:S,onClose:w})=>a?i.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),i.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:w,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),i.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white
                bg-gray-50 dark:bg-gray-700 
                placeholder-gray-500 dark:placeholder-gray-400
                focus:border-blue-500 dark:focus:border-blue-400 
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:u,onChange:_=>r(_.target.value)}),i.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:x,disabled:h,children:h?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):i.jsx(i.Fragment,{children:"Generate"})})]}),p&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:p}),d.length>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),i.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:d.map((_,A)=>i.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[i.jsx("div",{className:"mr-2 mt-1",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",id:`text${A+1}`,checked:!!f[`text${A+1}`],onChange:()=>b(`text${A+1}`),className:"sr-only"}),i.jsx("div",{className:`h-4 w-4 rounded border ${f[`text${A+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>b(`text${A+1}`),children:f[`text${A+1}`]&&i.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),i.jsx("label",{htmlFor:`text${A+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:_})]},A))})]})]}),i.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[i.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 
            rounded-lg font-medium transition-colors mr-3`,onClick:w,children:"Cancel"}),i.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(f).every(_=>!_)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:S,disabled:Object.values(f).every(_=>!_),children:"Add Selected"})]})]})}):null,zi=a=>{const u=[],r={};if(Object.keys(a).forEach(h=>{const p=parseInt(h),x=a[h]||{},b=Object.keys(x).filter(w=>x[w]&&x[w].length>0);if(b.length===0)return;const S=[[]];b.forEach(w=>{const _=x[w],A=[];S.forEach(O=>{_.forEach(R=>{const W=[...O,{nodeId:p,paramName:w,paramValue:String(R)}];A.push(W)})}),S.length=0,S.push(...A)}),r[h]=S}),Object.keys(r).length===0)return u;if(Object.keys(r).length===1){const h=Object.keys(r)[0];return r[h]}const d=Object.keys(r);let f=r[d[0]];for(let h=1;h<d.length;h++){const p=r[d[h]],x=[];f.forEach(b=>{p.forEach(S=>{x.push([...b,...S])})}),f=x}return f},Xp=(a,u)=>{const r={};r.nodeParams={};const d=zi(a);return u<d.length&&d[u].forEach(h=>{const p=h.nodeId.toString(),x=h.paramName,b=h.paramValue;r.nodeParams[p]||(r.nodeParams[p]={}),r.nodeParams[p][x]=b,r[x]=b}),r},Al="parameter_debug_history",Nl=30,Sl=async(a,u,r,d,f)=>{try{const h=Ml(),p={id:et(),timestamp:Date.now(),title:Gi(a,u),nodeName:a,params:{...u,nodeNames:{...u.nodeNames||{},[a.split("<")[0]]:a.split("<")[0]}},generatedImages:r,totalCount:d,workflow:f};return h.unshift(p),h.length>Nl&&h.splice(Nl),localStorage.setItem(Al,JSON.stringify(h)),p}catch(h){return console.error("Error saving parameter debug history:",h),null}},Ml=()=>{try{const a=localStorage.getItem(Al);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug history:",a)}return[]},Ll=a=>{const u=new Date(a);return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`},Gi=(a,u)=>{if(u.nodeParams)return Object.entries(u.nodeParams).map(([h,p])=>{let x=a;u.selectedNodeInfoMap&&u.selectedNodeInfoMap[h]&&(x=u.selectedNodeInfoMap[h]);const b=Object.keys(p).slice(0,3);return`${x}<${b.join(",")}>`}).join(";");const r=Object.keys(u).filter(d=>d!=="nodeParams"&&d!=="selectedNodeInfoMap").slice(0,3);return`${a}<${r.join(",")}>`},Qp=({historyItems:a,onViewHistoryItem:u,onClose:r})=>i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",a.length," experiments"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:r,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length===0?i.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):i.jsx("div",{className:"flex-1 overflow-y-auto",children:a.map(d=>i.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[i.jsx("div",{className:"text-[14px] text-gray-600",children:Ll(d.timestamp)}),i.jsx("button",{onClick:()=>u(d),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),i.jsx("div",{className:"p-3",children:i.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:Gi(d.nodeName,d.params)})})]},d.id))})]}),em=({historyItem:a,selectedImageIndex:u,handleSelectImage:r,handleClose:d,modalVisible:f,modalImageUrl:h,modalImageParams:p,openImageModal:x,closeImageModal:b})=>{const{timestamp:S,nodeName:w,generatedImages:_,params:A}=a,O=(R,W)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===W?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:F=>r(W,F),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:F=>x(R.url,R.params,F),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:R.url,alt:`Generated image ${W+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(R.params).filter(([F,B])=>F!=="nodeParams"&&typeof B!="object").map(([F,B])=>i.jsxs("div",{children:[F,": ",String(B)]},F))})]},W.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:Gi(w,A)}),i.jsxs("p",{className:"text-xs text-gray-500",children:[Ll(S)," • ",_.length," images"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Il,{items:_,renderItem:O})}),i.jsx(pr,{visible:f,imageUrl:h,params:p?{...p,nodeNames:{[a.nodeName.split("<")[0]]:a.nodeName.split("<")[0]}}:void 0,onClose:b})]})},tm=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,mr="parameter_debug_state",nm=a=>{try{localStorage.setItem(mr,JSON.stringify(a))}catch(u){console.error("Error saving parameter debug state:",u)}},rm=()=>{try{const a=localStorage.getItem(mr);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug state:",a)}return null},sm=()=>{try{localStorage.removeItem(mr)}catch(a){console.error("Error clearing parameter debug state:",a)}},im=(a,u,r,d,f,h)=>{const p=`${a}_${u}`,x=[...f[p]||[]];return x[r]=d,h(fe.TextInputs,{...f,[p]:x.map((b,S)=>S===r?d:b)}),x},om=(a,u,r,d)=>{const f=`${a}_${u}`,h=[...r[f]||[]];return h.push(""),d(fe.TextInputs,{...r,[f]:h}),h},am=(a,u,r,d,f)=>{const h=`${a}_${u}`,p=[...d[h]||[]];return p.splice(r,1),f(fe.TextInputs,{...d,[h]:p}),p},lm=(a,u,r,d,f)=>{r.preventDefault(),r.stopPropagation();const h=`${a}_${u}`;f(p=>{if(p[h]&&typeof p[h]=="object"?p[h].isOpen:!!p[h])return{...p,[h]:!1};{let b=0,S=0;if(r.currentTarget){const A=r.currentTarget.getBoundingClientRect();b=A.left,S=A.bottom}else b=r.clientX,S=r.clientY+20;const w=window.innerWidth,_=250;return b+_>w&&(b=w-_-10),b<0&&(b=10),{...p,[h]:{isOpen:!0,x:b,y:S}}}})},cm=(a,u,r,d,f)=>{const h={...d};h[a]||(h[a]={}),h[a][u]=r,f(fe.ParamTestValues,h)},um=(a,u,r,d,f,h)=>{h&&(h.preventDefault(),h.stopPropagation());const p={...d};p[a]||(p[a]={}),p[a][u]||(p[a][u]=[]);const x=p[a][u];x.includes(r)?p[a][u]=x.filter(b=>b!==r):p[a][u]=[...x,r],f(fe.ParamTestValues,p)},dm=(a,u,r,d,f)=>{const h=`${a}_${u}`;f(fe.SearchTerms,{...d,[h]:r})},fm=(a,u,r,d,f)=>{if(!d[a]){f(a,u,r);return}const h=d[a][u]||[];r.length===h.length?f(a,u,[]):f(a,u,[...r])},hm=(a,u,r,d,f)=>{f&&(f.preventDefault(),f.stopPropagation());const h=u[a];if(d(fe.SelectedParams,{...u,[a]:!h}),h){const p={...r};Object.keys(p).forEach(x=>{p[x][a]&&delete p[x][a]}),d(fe.ParamTestValues,p)}},gm=(a,u,r,d,f,h,p)=>{p.preventDefault(),p.stopPropagation();const x={...u};if(u.nodeParams){const b={};Object.keys(u.nodeParams).forEach(S=>{const w=r.find(_=>_.id.toString()===S);b[S]=w?w.title||`Node ${S}`:`Node ${S}`}),x.nodeNames=b}else if(Object.keys(u).length>0){const b={};Object.entries(u).forEach(([S,w])=>{(typeof w!="object"||w===null)&&(b[S]=w)}),Object.keys(b).length>0&&(x.nodeParams={default:b},x.nodeNames={default:u.node_name||u.nodeName||"参数"})}d(a),f(x),h(!0)},pm=(a,u)=>{u&&(u.preventDefault(),u.stopPropagation()),a(!1)},mm=(a,u,r,d,f,h,p,x,b)=>{if(b&&(b.preventDefault(),b.stopPropagation()),a===0){const S={...r};Object.keys(S).forEach(w=>{const _=S[w];Object.keys(_).forEach(A=>{u[A]||delete _[A]})}),x(fe.ParamTestValues,S)}if(a===1){const S={...r};f.forEach(_=>{const A=_.id.toString(),O=_.widgets||{};Object.values(O).forEach(R=>{const W=R.name;if(u[W]&&(R.type==="customtext"||R.type.toLowerCase().includes("text"))){const F=`${A}_${W}`,B=d[F]||[""];S[A]=S[A]||{},S[A][W]=B}})}),x(fe.ParamTestValues,S);const w=p(S);x(fe.TotalCount,w.length)}h(null),x(fe.CurrentSceen,Math.min(a+1,2))},xm=(a,u,r,d,f,h,p,x)=>{if(x&&(x.preventDefault(),x.stopPropagation()),h(null),f&&p(fe.IsCompleted,!1),a===1){const b=u.map(_=>_.id.toString()),S=Object.keys(r),w={...r};S.forEach(_=>{b.includes(_)||delete w[_]}),p(fe.ParamTestValues,w)}if(a===2||f){const b={...r};Object.entries(d).forEach(([S,w])=>{if(!w||w.length===0)return;const[_,A]=S.split("_");u.some(O=>O.id.toString()===_)&&(b[_]=b[_]||{},JSON.stringify(b[_][A])!==JSON.stringify(w)&&(b[_][A]=w))}),p(fe.ParamTestValues,b)}p(fe.CurrentSceen,Math.max(a-1,0))},vm=(a,u,r,d,f)=>{f&&(f.preventDefault(),f.stopPropagation()),d(fe.CurrentPage,Math.max(1,Math.min(a,Math.ceil(r.length/u))))};function ym(a,u){try{if(!a)return console.error("Invalid prompt_output: ",a),a;for(const r of u){if(!a[r.nodeId]){console.error(`Node with ID ${r.nodeId} not found`);continue}if(!a[r.nodeId].inputs){console.error(`Inputs not found for node with ID ${r.nodeId}`);continue}a[r.nodeId].inputs[r.paramName]=r.paramValue}return a}catch(r){return console.error("Error updating prompt:",r),a}}async function bm(a){const u=await Oe.graphToPrompt(),r=ym(u.output,a);console.log("queuePrompt updated_prompt:",r);const d={prompt:r,client_id:Oe.api.clientId,extra_data:{extra_pageinfo:{workflow:u.workflow}}};console.debug("queuePrompt request_body.prompt:",r);const f=await Ep(d);return console.debug("queuePrompt response:",f),f}function jl(a){const u=document.createElement("canvas"),r=u.getContext("2d");if(u.width=512,u.height=512,r){r.fillStyle="#f8d7da",r.fillRect(0,0,u.width,u.height),r.strokeStyle="#dc3545",r.lineWidth=4,r.strokeRect(10,10,u.width-20,u.height-20),r.fillStyle="#dc3545",r.beginPath(),r.arc(u.width/2,150,50,0,2*Math.PI),r.fill(),r.fillStyle="white",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("!",u.width/2,150),r.fillStyle="#721c24",r.font="20px Arial",r.textAlign="center",r.textBaseline="middle";const d=u.width-60,f=30,h=a.split(" ");let p="",x=250;for(let b=0;b<h.length;b++){const S=p+h[b]+" ";r.measureText(S).width>d&&b>0?(r.fillText(p,u.width/2,x),p=h[b]+" ",x+=f):p=S}r.fillText(p,u.width/2,x)}return u.toDataURL("image/png")}async function _m(a){try{if(!a||a==="")return console.log("No prompt ID provided"),{1:[jl("Fail to generate prompt ID")]};const u=await Mp(a);if(!u||!u[a])return console.log("Not finished for prompt ID:",a),{};const r=u[a];if(r.status&&r.status.status_str==="error"){console.error("Error for prompt ID:",a);const f=r.status.messages;if(f&&f.length>0){const h=f[f.length-1];if(h&&h.length>0){const p=h[0];return{1:[jl(p)]}}}}const d={};if(r.outputs)for(const f in r.outputs){const h=r.outputs[f];if(h&&h.images){d[f]=[];for(const p of h.images)if(p&&p.filename&&p.type){const x=Oe?.graph._nodes_by_id?.[f]?.imgs?.[0]?.currentSrc?.split("?")[0];d[f].push(x+"?filename="+encodeURIComponent(p.filename)+"&type="+encodeURIComponent(p.type)+(p.subfolder?"&subfolder="+encodeURIComponent(p.subfolder):""))}console.log("outputImages for nodeId:",f,d[f])}}return d}catch(u){throw console.error("Error getting output images from prompt:",u),u}}function wm(){const a=Object.values(Oe.graph._nodes_by_id),u=[],r=[];for(const d of a)d.type==="SaveImage"?u.push(d.id):d.type==="PreviewImage"&&r.push(d.id);if(console.log("saveNodeIds:",u),console.log("previewNodeIds:",r),u.length===0&&r.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return u.length===1?u[0]:u.length==0&&r.length===1?r[0]:null}async function Nm(a,u){const r=await _m(a);return Object.keys(r).length===0?null:r[u.toString()]&&r[u.toString()].length>0?r[u.toString()][0]:null}const Sm=async(a,u,r,d,f,h,p,x,b,S)=>{b&&(b.preventDefault(),b.stopPropagation()),Ol(f,d);const w=h(a),_=w.length;if(_>100){r(`Cannot generate more than 100 images at once (currently: ${_} images)`);return}r(null),x(fe.IsProcessing,!0),x(fe.CompletedCount,0),console.log("Generated parameter combinations:",w);let A=null;try{A=(await p.graphToPrompt()).output}catch(F){console.error("Error capturing workflow data:",F)}if(Dt.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:u,data:{workflow:A,all_params:a,count:_}}),w.length===0){r("No valid parameter combinations found. Please check your parameter selections."),x(fe.IsProcessing,!1);return}let O=S||null;if(O===null){const F=wm();F!==null&&(O=F)}if(O===null){r("Please select a SaveImage or PreviewImage node first."),x(fe.IsProcessing,!1);return}const R={};Object.keys(a).forEach(F=>{const B=p.graph._nodes_by_id[F];B&&(R[F]=B.type||B.comfyClass||"Unknown Node")});const W=[];try{const F=Date.now().toString();d.current=F;for(const U of w){const Y=await bm(U);Y.prompt_id?W.push(Y.prompt_id):(console.error("Failed to get prompt_id from response:",Y),W.push(""))}const B=Array(w.length).fill(null).map((U,Y)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:Xp(a,Y)}));x(fe.GeneratedImages,B);const z=Date.now(),X=5*60*1e3,M=Object.keys(a)[0],T=R[M]||"Unknown Node";Pl(W,O,B,F,z,X,d,f,x,T,a,_,A,R)}catch(F){console.error("Error generating images:",F),x(fe.IsProcessing,!1)}},Pl=async(a,u,r,d,f,h,p,x,b,S,w,_,A,O)=>{if(p.current!==d){console.log("Another polling session has started, stopping this one");return}if(Date.now()-f>h){if(console.log("Timeout reached while waiting for images"),p.current===d&&(b(fe.IsProcessing,!1),b(fe.IsCompleted,!0),b(fe.CurrentPage,1),r.length>0&&S&&w)){const W=r[0].params;O&&(W.selectedNodeInfoMap=O),Sl(S,W,r,_||r.length,A)}return}let R=0;for(let W=0;W<a.length;W++){const F=a[W];if(F)try{const B=await Nm(F,Number(u));B&&(r[W]={...r[W],url:B},R++)}catch(B){console.error(`Error fetching image for prompt ID ${F}:`,B)}}if(b(fe.GeneratedImages,[...r]),b(fe.CompletedCount,R),R===a.length){if(console.log("All images have been generated!"),p.current===d&&(b(fe.IsProcessing,!1),b(fe.IsCompleted,!0),b(fe.CurrentPage,1),r.length>0&&S&&w)){const W=r[0].params;O&&(W.selectedNodeInfoMap=O),Sl(S,W,r,_||r.length,A)}return}p.current===d&&(x.current=setTimeout(()=>{Pl(a,u,r,d,f,h,p,x,b,S,w,_,A,O)},2e3))},Ol=(a,u)=>{a.current&&(clearTimeout(a.current),a.current=null),u.current=null},jm=async(a,u,r,d,f,h)=>{if(!a.trim()){d("Please enter some text to generate variations");return}r(!0),d(null),f([]),h({});try{const p=await Dt.generateSDPrompts(a);f(p),Dt.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:u,data:{input_text:a,generated_texts:p}});const x={};p.forEach((b,S)=>{x[`text${S+1}`]=!1}),h(x)}catch(p){console.error("Error generating text:",p),d("Failed to generate text variations. Please try again.")}finally{r(!1)}},Cm=(a,u)=>{u(r=>({...r,[a]:!r[a]}))},km=(a,u,r,d,f,h,p,x,b,S)=>{const w=`${a}_${u}`,_=Object.entries(r).filter(([R,W])=>W).map(([R])=>{const W=parseInt(R.replace("text",""))-1;return d[W]});if(_.length===0)return;const A=[...p[w]||[]];x(fe.TextInputs,{...p,[w]:[...A,..._]}),Dt.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:h,data:{input_text:f,generated_texts:d,selected_texts:_}});const O=[...p[w]||[],..._];b(a,u,O),S(!1)},Em=(a,u,r,d,f,h,p,x,b,S)=>{r(!0),d(a),f(u),h(""),p([]),x({}),b(!1),S(null)},Im=(a,u,r,d,f,h,p,x,b,S,w,_,A,O,R,W,F,B,z,X,M,T,U,Y,Me,G,ue,je,D,be=!1)=>{a(0),u({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),r(et()),d(),f(!1),h(!1),p(0),x(12),b(null),S(Array(12).fill(null).map((le,re)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:re%3===0?5:re%3===1?10:15,sampler_name:"euler",cfg:1}}))),w({}),_({}),A({}),O({}),R(1),W(null),F(!1),B(!1),z(""),X(null),M({}),T(!1),U(""),Y([]),Me(!1),G(""),ue(""),je(null),D({}),be&&sm()},Am=async(a,u,r,d,f,h,p)=>{if(p&&(p.preventDefault(),p.stopPropagation()),a!==null){console.log(`Applied image ${a+1} with parameters:`,u[a].params);let x=1;if(f){for(const S in f)if(f[S])for(const w in f[S]){const _=f[S][w];if(_){let A=1;Array.isArray(_)?A=_.length>0?_.length:1:typeof _=="object"&&_!==null&&(A=Object.keys(_).length>0?Object.keys(_).length:1),x=x*A}}}Dt.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:d,data:{workflow:(await r.graphToPrompt()).output,selected_params:u[a].params,all_params:f,count:x}});const b=u[a].params;b.nodeParams&&(Object.entries(b.nodeParams).forEach(([S,w])=>{const _=r.graph._nodes_by_id[S];!_||!_.widgets||Object.entries(w).forEach(([A,O])=>{for(const R of _.widgets)if(R.name===A){R.value=O;break}})}),r.graph.setDirtyCanvas(!1,!0),h(!0),setTimeout(()=>{h(!1)},3e3))}},Mm=(a,u,r,d,f,h,p)=>{if(p&&(p.preventDefault(),p.stopPropagation()),a===1&&r!==void 0){const x=[...u];x[r],x.splice(r,1),x.length===0?f&&(d({type:"SET_SCREEN_STATE",payload:null}),h(!0),f()):d({type:"SET_SELECTED_NODE",payload:x});return}f&&(d({type:"SET_SCREEN_STATE",payload:null}),h(!0),f())};var fe=(a=>(a.CurrentSceen="currentSceen",a.SelectedParams="selectedParams",a.TaskId="taskId",a.IsProcessing="isProcessing",a.IsCompleted="isCompleted",a.CompletedCount="completedCount",a.TotalCount="totalCount",a.SelectedImageIndex="selectedImageIndex",a.GeneratedImages="generatedImages",a.ParamTestValues="paramTestValues",a.SearchTerms="searchTerms",a.InputValues="inputValues",a.CurrentPage="currentPage",a.TextInputs="textInputs",a))(fe||{});const Lm=({selectedNodes:a,visible:u,onClose:r})=>{const[d,f]=j.useState(0),[h,p]=j.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[x,b]=j.useState(et()),[S,w]=j.useState(!1),[_,A]=j.useState(!1),[O,R]=j.useState(0),[W,F]=j.useState(12),[B,z]=j.useState(null),[X,M]=j.useState(()=>Array(12).fill(null).map((I,P)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:P%3===0?5:P%3===1?10:15,sampler_name:"euler",cfg:1}}))),[T,U]=j.useState({}),[Y,Me]=j.useState({}),[G,ue]=j.useState({}),[je,D]=j.useState({}),[be,le]=j.useState(1),re=6,[ne,he]=j.useState(null),[q,oe]=j.useState(!1),[J,Z]=j.useState(!1),[Ee,Te]=j.useState(""),[Le,Ie]=j.useState(null),[Ve,yt]=j.useState({}),[tt,at]=j.useState(!1),[He,bt]=j.useState(""),[At,Wt]=j.useState([]),[Ye,K]=j.useState(!1),[pe,ye]=j.useState(""),[Be,Mt]=j.useState(""),[Fe,we]=j.useState(null),[De,ze]=j.useState({}),[Lt,ft]=j.useState(!1),[ms,dn]=j.useState([]),[zt,fn]=j.useState(null),{dispatch:hn}=Jn(),En=j.useRef(null),In=j.useRef(null),An=j.useRef(!0),gn=j.useRef(et()),[Vn,Xt]=j.useState(()=>u),[pn,xs]=j.useState(!1);j.useEffect(()=>{if(Lt){const I=Ml();dn(I)}},[Lt]);const vs=async()=>{jm(He,x,K,we,Wt,ze)},ys=(I,P,me,Ke)=>{const _t=im(I,P,me,Ke,Ve,We);Qt(I,P,_t)},vr=(I,P)=>{const me=om(I,P,Ve,We);Qt(I,P,me)},yr=(I,P,me)=>{const Ke=am(I,P,me,Ve,We);Qt(I,P,Ke)},bs=I=>{Cm(I,ze)},_s=()=>{km(pe,Be,De,At,He,x,Ve,We,Qt,at)},ws=(I,P)=>{Em(I,P,at,ye,Mt,bt,Wt,ze,K,we)},br=I=>{I&&(I.preventDefault(),I.stopPropagation()),ft(P=>!P)},_r=I=>{fn(I),ft(!1),We("generatedImages",I.generatedImages||[]),We("selectedImageIndex",null),We("currentPage",1)},Ns=I=>{I&&(I.preventDefault(),I.stopPropagation()),fn(null)},Ss=(I,P)=>{console.log("key--->",I,P);const me={currentScreen:d,selectedParams:h,task_id:x,isProcessing:S,isCompleted:_,completedCount:O,totalCount:W,selectedImageIndex:B,generatedImages:X,paramTestValues:T,searchTerms:G,inputValues:je,currentPage:be,textInputs:Ve};console.log("doSaveState-->",me),nm({...me,[I]:P})},We=(I,P)=>{switch(I){case"currentSceen":f(P);break;case"selectedParams":p(P);break;case"taskId":b(P);break;case"isProcessing":w(P);break;case"isCompleted":A(P);break;case"completedCount":R(P);break;case"totalCount":F(P);break;case"selectedImageIndex":z(P);break;case"generatedImages":M(P);break;case"paramTestValues":U(P);break;case"searchTerms":ue(P);break;case"inputValues":D(P);break;case"currentPage":le(P);break;case"textInputs":yt(P);break}Ss(I,P)};j.useEffect(()=>{if(!pn||!a||a.length===0)return;const I={...T},P=a.map(Ke=>Ke.id.toString());Object.keys(I).forEach(Ke=>{P.includes(Ke)||delete I[Ke]}),a.forEach(Ke=>{const _t=Ke.id.toString();I[_t]||(I[_t]={})}),JSON.stringify(I)!==JSON.stringify(T)&&We("paramTestValues",I)},[a,T,pn]),j.useEffect(()=>{hn({type:"SET_SCREEN_STATE",payload:{currentScreen:d,isProcessing:S,isCompleted:_}})},[d,S,_,hn]),j.useEffect(()=>{const I=document.createElement("style");return I.textContent=tm,document.head.appendChild(I),()=>{document.head.removeChild(I)}},[]),j.useEffect(()=>{const I=P=>{if(Object.values(Y).some(me=>me)){const me=P.target,Ke=!!me.closest(".dropdown-menu"),_t=!!me.closest("[data-dropdown]");!Ke&&!_t&&Me({})}};return document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[Y]),j.useEffect(()=>{u&&(JSON.parse(localStorage.getItem(mr)||"{}").task_id||We("taskId",et()))},[u]),j.useEffect(()=>{if(S&&An.current){An.current=!1;let I=0;const P=Object.values(Oe.graph._nodes_by_id),me=[],Ke=[];for(const Ln of P)Ln.type==="SaveImage"?me.push(Ln.id):Ln.type==="PreviewImage"&&Ke.push(Ln.id);const _t=[...me,...Ke];_t.length===1?I=_t[0]:_t.length>1&&(I=void 0),Xn(void 0,I)}},[S]),j.useEffect(()=>{if(u){Xt(!0);try{const I=localStorage.getItem(mr);if(console.log("savedState--->",I,a,Date.now(),gn.current),I){const P=JSON.parse(I);if(!a||a.length===0){console.log("Not restoring parameter debug state: no nodes selected"),Xt(!1);return}P.currentScreen!==void 0&&f(P.currentScreen),P.selectedParams&&p(P.selectedParams),P.task_id&&b(P.task_id),w(P?.isProcessing);const me=P.generatedImages&&P.generatedImages.length>0;P.isCompleted!==void 0&&me&&A(P.isCompleted),P.completedCount!==void 0&&R(P.completedCount),P.totalCount!==void 0&&F(P.totalCount),P.selectedImageIndex!==void 0&&z(P.selectedImageIndex),P.generatedImages&&M(P.generatedImages),P.paramTestValues&&U(P.paramTestValues),P.searchTerms&&ue(P.searchTerms),P.inputValues&&D(P.inputValues),P.currentPage!==void 0&&le(P.currentPage),P.textInputs&&yt(P.textInputs),pn||xs(!0)}}catch(I){console.error("Error loading parameter debug state:",I)}finally{setTimeout(()=>{Xt(!1)},50)}}else Xt(!0)},[u,a]);const Yn=(I=!1)=>{Im(f,p,b,Zn,w,A,R,F,z,M,U,Me,ue,D,le,he,oe,Z,Te,Ie,yt,at,bt,Wt,K,ye,Mt,we,ze,I),ft(!1),fn(null)};j.useEffect(()=>{console.log("useEffect isCompleted--->",_,gn.current)},[_]),j.useEffect(()=>{console.log("useEffect completedCount--->",O,gn.current)},[O]);const wr=I=>{mm(d,h,T,Ve,a,he,zi,We,I)},mn=I=>{xm(d,a,T,Ve,_,he,We,I)},js=(I,P)=>{hm(I,h,T,We,P)},Cs=(I,P,me)=>{lm(I,P,me,Y,Me)},Qt=(I,P,me)=>{cm(I,P,me,T,We)},ks=(I,P,me,Ke)=>{um(I,P,me,T,We,Ke)},Es=(I,P,me)=>{dm(I,P,me,G,We)},Is=(I,P,me)=>{fm(I,P,me,T,Qt)},Nr=(I,P)=>{vm(I,re,X,We,P)},Zn=()=>{Ol(En,In)};j.useEffect(()=>()=>{Zn()},[]);const Xn=async(I,P)=>{Sm(T,x,he,In,En,zi,Oe,We,I,P)},Sr=(I,P)=>{P&&(P.preventDefault(),P.stopPropagation()),We("selectedImageIndex",I)},jr=(I,P,me)=>{gm(I,P,a,Te,Ie,Z,me)},xn=I=>{pm(Z,I)},As=async I=>{Am(B,X,Oe,x,T,oe,I)},en=(I,P)=>{Mm(d,a,P,hn,r,Yn,I)},Mn=()=>i.jsx(i.Fragment,{children:i.jsx(pr,{visible:J,imageUrl:Ee,params:Le||{},onClose:xn})});return zt?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:I=>I.stopPropagation(),children:i.jsx(em,{historyItem:zt,selectedImageIndex:B,handleSelectImage:Sr,handleClose:Ns,currentPage:be,handlePageChange:Nr,imagesPerPage:re,modalVisible:J,modalImageUrl:Ee,modalImageParams:Le,openImageModal:jr,closeImageModal:xn})}):Lt?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:I=>I.stopPropagation(),children:i.jsx(Qp,{historyItems:ms,onViewHistoryItem:_r,onClose:br})}):Vn&&u&&a.length>0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:I=>I.stopPropagation(),children:[i.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),i.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),i.jsx(pr,{visible:J,imageUrl:Ee,params:Le||{},onClose:xn})]}):!u||a.length===0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:I=>I.stopPropagation(),children:[i.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[i.jsxs("div",{className:"absolute top-3 right-3 flex",children:[i.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:br,title:"Show History",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:en,children:i.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"mb-6 text-center",children:[i.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),i.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"text-left mb-4",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),i.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),i.jsx(pr,{visible:J,imageUrl:Ee,params:Le||{},onClose:xn})]}):_?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:I=>I.stopPropagation(),children:i.jsx(Yp,{generatedImages:X,selectedImageIndex:B,handleSelectImage:Sr,handleApplySelected:As,handlePrevious:mn,handleClose:en,currentPage:be,handlePageChange:Nr,imagesPerPage:re,notificationVisible:q,modalVisible:J,modalImageUrl:Ee,modalImageParams:Le,openImageModal:jr,closeImageModal:xn})}):S?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:I=>I.stopPropagation(),children:[i.jsx(Dp,{selectedNodes:a,paramTestValues:T,selectedParams:h,totalCount:W,completedCount:O,errorMessage:ne,handleClose:en,updateState:We,cleanupPolling:Zn}),i.jsx(Mn,{})]}):d===0?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:I=>I.stopPropagation(),children:[i.jsx(Op,{selectedNodes:a,handleParamSelect:js,selectedParams:h,handleNext:wr,handleClose:en}),i.jsx(Mn,{})]}):d===1?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:I=>I.stopPropagation(),children:[i.jsx(Tp,{selectedNodes:a,paramTestValues:T,selectedParams:h,updateParamTestValues:Qt,toggleDropdown:Cs,openDropdowns:Y,handleTestValueSelect:ks,searchTerms:G,handleSearch:Es,handleSelectAll:Is,handleNext:wr,handlePrevious:mn,handleClose:en,inputValues:je,updateState:We,textInputs:Ve,handleTextInputChange:ys,handleAddTextInput:vr,handleRemoveTextInput:yr,openAiWritingModal:ws}),i.jsx(Zp,{visible:tt,aiWritingModalText:He,setAiWritingModalText:bt,aiGeneratedTexts:At,aiSelectedTexts:De,aiWritingLoading:Ye,aiWritingError:Fe,handleAiWriting:vs,toggleTextSelection:bs,addSelectedTexts:_s,onClose:()=>at(!1)}),i.jsx(Mn,{})]}):i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:I=>I.stopPropagation(),children:[i.jsx(Rp,{selectedNodes:a,paramTestValues:T,selectedParams:h,totalCount:W,errorMessage:ne,handlePrevious:mn,handleStartGeneration:Xn,handleClose:en}),i.jsx(Mn,{})]})},Pm=a=>{const{dispatch:u}=Jn(),[r,d]=j.useState(!1);return j.useEffect(()=>{if(a.visible&&!r){const f=rm();f&&f.screenState&&u({type:"SET_SCREEN_STATE",payload:{currentScreen:f.currentScreen,isProcessing:f.isProcessing,isCompleted:f.isCompleted}}),d(!0)}},[a.visible,r,u]),j.useEffect(()=>()=>{a.visible||u({type:"SET_SCREEN_STATE",payload:null})},[a.visible,u]),i.jsx(Lm,{...a})},Om=({message:a,onClose:u})=>a?i.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex-shrink-0 mr-1",children:i.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),i.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:i.jsx(Jg,{rehypePlugins:[[Fg,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[Bg],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:r,...d})=>i.jsx("a",{...d,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:r})=>i.jsx("span",{className:"inline",style:{fontSize:"11px"},children:r}),span:({children:r})=>i.jsx("span",{style:{fontSize:"11px"},children:r}),li:({children:r})=>i.jsx("li",{style:{fontSize:"11px"},children:r}),ul:({children:r})=>i.jsx("ul",{style:{fontSize:"11px"},children:r}),ol:({children:r})=>i.jsx("ol",{style:{fontSize:"11px"},children:r})},children:a})})]}),i.jsx("button",{onClick:u,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,Tm=()=>{const{state:a,dispatch:u}=Jn(),{selectedNode:r,screenState:d}=a,f=r||[],h=()=>{u({type:"SET_SELECTED_NODE",payload:null}),u({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return i.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:i.jsx(Pm,{selectedNodes:f,visible:!0,onClose:h})})},Cl=({active:a,onClick:u,children:r})=>i.jsx("button",{onClick:u,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 ${a?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-blue-500 hover:border-b-2 hover:border-blue-300"}`,children:r});function Fm({onClose:a,visible:u=!0,triggerUsage:r=!1,onUsageTriggered:d}){const{state:f,dispatch:h}=Jn(),{messages:p,installedNodes:x,loading:b,sessionId:S,selectedNode:w,activeTab:_}=f;j.useRef(null);const[A,O]=j.useState(""),[R,W]=j.useState(""),[F,B]=j.useState(window.innerWidth/3),[z,X]=j.useState(!1),[M,T]=j.useState([]),[U,Y]=j.useState("gpt-4o-mini"),[Me,G]=j.useState(window.innerHeight),[ue,je]=j.useState(0),[D,be]=j.useState(""),[le,re]=j.useState(!1),ne=j.useRef(null);Lp(u&&_==="chat"),Pp(u),j.useEffect(()=>{if(_!=="chat")return;(async()=>{const pe=await kp();console.log("[WorkflowChat] Received installed nodes:",pe.length),h({type:"SET_INSTALLED_NODES",payload:pe})})()},[_]);const he=async K=>{try{const pe=await Dt.fetchMessages(K);h({type:"SET_MESSAGES",payload:pe})}catch(pe){console.error("Error fetching messages:",pe)}};j.useEffect(()=>{if(_!=="chat")return;let K=localStorage.getItem("sessionId");K?(h({type:"SET_SESSION_ID",payload:K}),he(K)):(K=et(),h({type:"SET_SESSION_ID",payload:K}),localStorage.setItem("sessionId",K))},[_]),j.useEffect(()=>{const K=localStorage.getItem("activeTab");K&&h({type:"SET_ACTIVE_TAB",payload:K});const pe=localStorage.getItem("screenState");pe&&h({type:"SET_SCREEN_STATE",payload:JSON.parse(pe)})},[]),j.useEffect(()=>{localStorage.setItem("activeTab",_)},[_]),j.useEffect(()=>{f.screenState&&localStorage.setItem("screenState",JSON.stringify(f.screenState))},[f.screenState]);const q=hs.useCallback(K=>{if(!z)return;const pe=window.innerWidth-K.clientX,ye=Math.min(Math.max(300,pe),window.innerWidth*.8);B(ye)},[z]),oe=hs.useMemo(()=>Ui.debounce(q,16),[q]);j.useEffect(()=>(z&&(document.addEventListener("mousemove",oe),document.addEventListener("mouseup",He)),()=>{document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",He),oe.cancel()}),[z,oe]);const J=K=>{O(K.target.value)},Z=()=>{ne.current&&(ne.current.abort(),ne.current=null,h({type:"SET_LOADING",payload:!1}))},Ee=async()=>{if(h({type:"SET_LOADING",payload:!0}),A.trim()===""&&!w||!S)return;W(A);const K=et(),pe={id:et(),role:"user",content:A,trace_id:K};h({type:"ADD_MESSAGE",payload:pe}),O(""),ne.current=new AbortController;try{const ye={type:"model_select",data:[U]};let Be=et(),Mt=!0;for await(const Fe of Dt.streamInvokeServer(S,A,M.map(we=>we.file),null,ye,K,ne.current.signal)){const we={id:Be,role:"ai",content:JSON.stringify(Fe),format:Fe.format,finished:Fe.finished,name:"Assistant"};if(Mt)h({type:"ADD_MESSAGE",payload:we}),Mt=!1;else{h({type:"UPDATE_MESSAGE",payload:we});const De=f.messages.map(ze=>ze.id===we.id&&!ze.finished?we:ze);tt(De)}Fe.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch(ye){ye instanceof Error&&ye.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",ye),h({type:"SET_LOADING",payload:!1}),ne.current=null}finally{T([])}},Te=async K=>{if(!S)return;h({type:"SET_LOADING",payload:!0}),W(K);const pe=et(),ye={id:et(),role:"user",content:K,trace_id:pe};h({type:"ADD_MESSAGE",payload:ye}),ne.current=new AbortController;try{const Be={type:"model_select",data:[U]};let Mt=et(),Fe=!0;for await(const we of Dt.streamInvokeServer(S,K,M.map(De=>De.file),null,Be,pe,ne.current.signal)){const De={id:Mt,role:"ai",content:JSON.stringify(we),format:we.format,finished:we.finished,name:"Assistant"};if(Fe)h({type:"ADD_MESSAGE",payload:De}),Fe=!1;else{h({type:"UPDATE_MESSAGE",payload:De});const ze=f.messages.map(Lt=>Lt.id===De.id&&!Lt.finished?De:Lt);tt(ze)}we.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch(Be){Be instanceof Error&&Be.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Be),h({type:"SET_LOADING",payload:!1}),ne.current=null}finally{T([])}},Le=K=>{K.metaKey&&K.key==="Enter"&&Ee()},Ie=()=>{h({type:"CLEAR_MESSAGES"});const K=f.sessionId;K&&localStorage.removeItem(`messages_${K}`),localStorage.removeItem("sessionId");const pe=et();h({type:"SET_SESSION_ID",payload:pe}),localStorage.setItem("sessionId",pe)},Ve=K=>{O(K)},yt=async(K,pe)=>{if(!S||!w)return;h({type:"SET_LOADING",payload:!0});const ye=w[0].comfyClass||w[0].type,Be=et(),Mt={id:et(),role:"user",content:ye,trace_id:Be};h({type:"ADD_MESSAGE",payload:Mt}),ne.current=new AbortController;try{let Fe=et(),we=!0;for await(const De of Dt.streamInvokeServer(S,ye,[],K,pe,Be,ne.current.signal)){const ze={id:Fe,role:"ai",content:JSON.stringify(De),format:De.format,finished:De.finished,name:"Assistant"};if(K&&K!==""&&(ze.metadata={intent:K}),we)h({type:"ADD_MESSAGE",payload:ze}),we=!1;else{h({type:"UPDATE_MESSAGE",payload:ze});const Lt=f.messages.map(ft=>ft.id===ze.id&&!ft.finished?ze:ft);tt(Lt)}De.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch(Fe){Fe instanceof Error&&Fe.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Fe),h({type:"SET_LOADING",payload:!1}),ne.current=null}},tt=K=>{f.sessionId&&localStorage.setItem(`messages_${f.sessionId}`,JSON.stringify(K))},at=K=>{console.log("[WorkflowChat] Adding new message:",K);const pe=[...f.messages,K];h({type:"ADD_MESSAGE",payload:K}),tt(pe)},He=()=>{X(!1)},bt=K=>{const pe=Array.from(K).map(ye=>({id:Math.random().toString(36).substr(2,9),file:ye,preview:URL.createObjectURL(ye)}));T(ye=>[...ye,...pe])},At=K=>{T(pe=>pe.filter(Be=>Be.id!==K))};hs.useEffect(()=>()=>{M.forEach(K=>URL.revokeObjectURL(K.preview))},[M]),j.useEffect(()=>{r&&d&&_==="chat"&&(yt("node_explain"),d())},[r,_]),j.useEffect(()=>{if(!u||_!=="chat")return;(async()=>{try{const pe=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==pe){const Be=await Dt.fetchAnnouncement();Be&&Be.trim()!==""&&(be(Be),re(!0),localStorage.setItem("announcementLastShownDate",pe))}}catch(pe){console.error("Error fetching announcement:",pe)}})()},[u,_]);const Wt=()=>{re(!1)},Ye=K=>{h({type:"SET_ACTIVE_TAB",payload:K})};return u?i.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:u?"flex":"none"},children:[i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx(hp,{onClose:a,onClear:Ie,hasMessages:p.length>0,title:"ComfyUI-Copilot"}),i.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[i.jsx(Cl,{active:_==="chat",onClick:()=>Ye("chat"),children:"Chat"}),i.jsx(Cl,{active:_==="parameter-debug",onClick:()=>Ye("parameter-debug"),children:"GenLab"})]}),le&&D&&_==="chat"&&i.jsx(Om,{message:D,onClose:Wt}),i.jsx(jp,{messages:p,latestInput:R,onOptionClick:Ve,installedNodes:x,onAddMessage:at,loading:b,isActive:_==="chat"}),i.jsxs("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:_==="chat"?"block":"none"},children:[w&&i.jsx(xp,{nodeInfo:w,onSendWithIntent:yt,loading:b,onSendWithContent:Te}),i.jsx(pp,{input:A,loading:b,onChange:J,onSend:Ee,onKeyPress:Le,onUploadImages:bt,uploadedImages:M,onRemoveImage:At,selectedModel:U,onModelChange:Y,onStop:Z})]}),i.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:_==="parameter-debug"?"flex":"none"},children:i.jsx(Tm,{})})]})]}):null}export{Fm as default};
